(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))a(f);new MutationObserver(f=>{for(const y of f)if(y.type==="childList")for(const w of y.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&a(w)}).observe(document,{childList:!0,subtree:!0});function i(f){const y={};return f.integrity&&(y.integrity=f.integrity),f.referrerPolicy&&(y.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?y.credentials="include":f.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function a(f){if(f.ep)return;f.ep=!0;const y=i(f);fetch(f.href,y)}})();var Ig=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fz={exports:{}},u1={},Nz={exports:{}},an={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zy=Symbol.for("react.element"),p$=Symbol.for("react.portal"),m$=Symbol.for("react.fragment"),g$=Symbol.for("react.strict_mode"),y$=Symbol.for("react.profiler"),_$=Symbol.for("react.provider"),v$=Symbol.for("react.context"),x$=Symbol.for("react.forward_ref"),b$=Symbol.for("react.suspense"),w$=Symbol.for("react.memo"),T$=Symbol.for("react.lazy"),FO=Symbol.iterator;function S$(e){return e===null||typeof e!="object"?null:(e=FO&&e[FO]||e["@@iterator"],typeof e=="function"?e:null)}var jz={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$z=Object.assign,Uz={};function ip(e,t,i){this.props=e,this.context=t,this.refs=Uz,this.updater=i||jz}ip.prototype.isReactComponent={};ip.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ip.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Vz(){}Vz.prototype=ip.prototype;function bE(e,t,i){this.props=e,this.context=t,this.refs=Uz,this.updater=i||jz}var wE=bE.prototype=new Vz;wE.constructor=bE;$z(wE,ip.prototype);wE.isPureReactComponent=!0;var NO=Array.isArray,Gz=Object.prototype.hasOwnProperty,TE={current:null},qz={key:!0,ref:!0,__self:!0,__source:!0};function Wz(e,t,i){var a,f={},y=null,w=null;if(t!=null)for(a in t.ref!==void 0&&(w=t.ref),t.key!==void 0&&(y=""+t.key),t)Gz.call(t,a)&&!qz.hasOwnProperty(a)&&(f[a]=t[a]);var O=arguments.length-2;if(O===1)f.children=i;else if(1<O){for(var o=Array(O),L=0;L<O;L++)o[L]=arguments[L+2];f.children=o}if(e&&e.defaultProps)for(a in O=e.defaultProps,O)f[a]===void 0&&(f[a]=O[a]);return{$$typeof:Zy,type:e,key:y,ref:w,props:f,_owner:TE.current}}function A$(e,t){return{$$typeof:Zy,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function SE(e){return typeof e=="object"&&e!==null&&e.$$typeof===Zy}function E$(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var jO=/\/+/g;function nT(e,t){return typeof e=="object"&&e!==null&&e.key!=null?E$(""+e.key):t.toString(36)}function M0(e,t,i,a,f){var y=typeof e;(y==="undefined"||y==="boolean")&&(e=null);var w=!1;if(e===null)w=!0;else switch(y){case"string":case"number":w=!0;break;case"object":switch(e.$$typeof){case Zy:case p$:w=!0}}if(w)return w=e,f=f(w),e=a===""?"."+nT(w,0):a,NO(f)?(i="",e!=null&&(i=e.replace(jO,"$&/")+"/"),M0(f,t,i,"",function(L){return L})):f!=null&&(SE(f)&&(f=A$(f,i+(!f.key||w&&w.key===f.key?"":(""+f.key).replace(jO,"$&/")+"/")+e)),t.push(f)),1;if(w=0,a=a===""?".":a+":",NO(e))for(var O=0;O<e.length;O++){y=e[O];var o=a+nT(y,O);w+=M0(y,t,i,o,f)}else if(o=S$(e),typeof o=="function")for(e=o.call(e),O=0;!(y=e.next()).done;)y=y.value,o=a+nT(y,O++),w+=M0(y,t,i,o,f);else if(y==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return w}function Yv(e,t,i){if(e==null)return e;var a=[],f=0;return M0(e,a,"","",function(y){return t.call(i,y,f++)}),a}function M$(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Po={current:null},P0={transition:null},P$={ReactCurrentDispatcher:Po,ReactCurrentBatchConfig:P0,ReactCurrentOwner:TE};function Hz(){throw Error("act(...) is not supported in production builds of React.")}an.Children={map:Yv,forEach:function(e,t,i){Yv(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return Yv(e,function(){t++}),t},toArray:function(e){return Yv(e,function(t){return t})||[]},only:function(e){if(!SE(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};an.Component=ip;an.Fragment=m$;an.Profiler=y$;an.PureComponent=bE;an.StrictMode=g$;an.Suspense=b$;an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P$;an.act=Hz;an.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=$z({},e.props),f=e.key,y=e.ref,w=e._owner;if(t!=null){if(t.ref!==void 0&&(y=t.ref,w=TE.current),t.key!==void 0&&(f=""+t.key),e.type&&e.type.defaultProps)var O=e.type.defaultProps;for(o in t)Gz.call(t,o)&&!qz.hasOwnProperty(o)&&(a[o]=t[o]===void 0&&O!==void 0?O[o]:t[o])}var o=arguments.length-2;if(o===1)a.children=i;else if(1<o){O=Array(o);for(var L=0;L<o;L++)O[L]=arguments[L+2];a.children=O}return{$$typeof:Zy,type:e.type,key:f,ref:y,props:a,_owner:w}};an.createContext=function(e){return e={$$typeof:v$,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:_$,_context:e},e.Consumer=e};an.createElement=Wz;an.createFactory=function(e){var t=Wz.bind(null,e);return t.type=e,t};an.createRef=function(){return{current:null}};an.forwardRef=function(e){return{$$typeof:x$,render:e}};an.isValidElement=SE;an.lazy=function(e){return{$$typeof:T$,_payload:{_status:-1,_result:e},_init:M$}};an.memo=function(e,t){return{$$typeof:w$,type:e,compare:t===void 0?null:t}};an.startTransition=function(e){var t=P0.transition;P0.transition={};try{e()}finally{P0.transition=t}};an.unstable_act=Hz;an.useCallback=function(e,t){return Po.current.useCallback(e,t)};an.useContext=function(e){return Po.current.useContext(e)};an.useDebugValue=function(){};an.useDeferredValue=function(e){return Po.current.useDeferredValue(e)};an.useEffect=function(e,t){return Po.current.useEffect(e,t)};an.useId=function(){return Po.current.useId()};an.useImperativeHandle=function(e,t,i){return Po.current.useImperativeHandle(e,t,i)};an.useInsertionEffect=function(e,t){return Po.current.useInsertionEffect(e,t)};an.useLayoutEffect=function(e,t){return Po.current.useLayoutEffect(e,t)};an.useMemo=function(e,t){return Po.current.useMemo(e,t)};an.useReducer=function(e,t,i){return Po.current.useReducer(e,t,i)};an.useRef=function(e){return Po.current.useRef(e)};an.useState=function(e){return Po.current.useState(e)};an.useSyncExternalStore=function(e,t,i){return Po.current.useSyncExternalStore(e,t,i)};an.useTransition=function(){return Po.current.useTransition()};an.version="18.3.1";Nz.exports=an;var Wt=Nz.exports;const tt=Fn(Wt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I$=Wt,C$=Symbol.for("react.element"),O$=Symbol.for("react.fragment"),k$=Object.prototype.hasOwnProperty,D$=I$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,L$={key:!0,ref:!0,__self:!0,__source:!0};function Zz(e,t,i){var a,f={},y=null,w=null;i!==void 0&&(y=""+i),t.key!==void 0&&(y=""+t.key),t.ref!==void 0&&(w=t.ref);for(a in t)k$.call(t,a)&&!L$.hasOwnProperty(a)&&(f[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)f[a]===void 0&&(f[a]=t[a]);return{$$typeof:C$,type:e,key:y,ref:w,props:f,_owner:D$.current}}u1.Fragment=O$;u1.jsx=Zz;u1.jsxs=Zz;Fz.exports=u1;var ze=Fz.exports,Xz={exports:{}},ha={},Yz={exports:{}},Kz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(mt,Lt){var yt=mt.length;mt.push(Lt);e:for(;0<yt;){var Zt=yt-1>>>1,Yt=mt[Zt];if(0<f(Yt,Lt))mt[Zt]=Lt,mt[yt]=Yt,yt=Zt;else break e}}function i(mt){return mt.length===0?null:mt[0]}function a(mt){if(mt.length===0)return null;var Lt=mt[0],yt=mt.pop();if(yt!==Lt){mt[0]=yt;e:for(var Zt=0,Yt=mt.length,xr=Yt>>>1;Zt<xr;){var Vt=2*(Zt+1)-1,Sn=mt[Vt],vn=Vt+1,sn=mt[vn];if(0>f(Sn,yt))vn<Yt&&0>f(sn,Sn)?(mt[Zt]=sn,mt[vn]=yt,Zt=vn):(mt[Zt]=Sn,mt[Vt]=yt,Zt=Vt);else if(vn<Yt&&0>f(sn,yt))mt[Zt]=sn,mt[vn]=yt,Zt=vn;else break e}}return Lt}function f(mt,Lt){var yt=mt.sortIndex-Lt.sortIndex;return yt!==0?yt:mt.id-Lt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;e.unstable_now=function(){return y.now()}}else{var w=Date,O=w.now();e.unstable_now=function(){return w.now()-O}}var o=[],L=[],$=1,F=null,H=3,Y=!1,oe=!1,te=!1,ie=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(mt){for(var Lt=i(L);Lt!==null;){if(Lt.callback===null)a(L);else if(Lt.startTime<=mt)a(L),Lt.sortIndex=Lt.expirationTime,t(o,Lt);else break;Lt=i(L)}}function le(mt){if(te=!1,ue(mt),!oe)if(i(o)!==null)oe=!0,ct(se);else{var Lt=i(L);Lt!==null&&Ot(le,Lt.startTime-mt)}}function se(mt,Lt){oe=!1,te&&(te=!1,ae(Ae),Ae=-1),Y=!0;var yt=H;try{for(ue(Lt),F=i(o);F!==null&&(!(F.expirationTime>Lt)||mt&&!We());){var Zt=F.callback;if(typeof Zt=="function"){F.callback=null,H=F.priorityLevel;var Yt=Zt(F.expirationTime<=Lt);Lt=e.unstable_now(),typeof Yt=="function"?F.callback=Yt:F===i(o)&&a(o),ue(Lt)}else a(o);F=i(o)}if(F!==null)var xr=!0;else{var Vt=i(L);Vt!==null&&Ot(le,Vt.startTime-Lt),xr=!1}return xr}finally{F=null,H=yt,Y=!1}}var be=!1,Ie=null,Ae=-1,ht=5,st=-1;function We(){return!(e.unstable_now()-st<ht)}function He(){if(Ie!==null){var mt=e.unstable_now();st=mt;var Lt=!0;try{Lt=Ie(!0,mt)}finally{Lt?At():(be=!1,Ie=null)}}else be=!1}var At;if(typeof J=="function")At=function(){J(He)};else if(typeof MessageChannel<"u"){var Tt=new MessageChannel,kt=Tt.port2;Tt.port1.onmessage=He,At=function(){kt.postMessage(null)}}else At=function(){ie(He,0)};function ct(mt){Ie=mt,be||(be=!0,At())}function Ot(mt,Lt){Ae=ie(function(){mt(e.unstable_now())},Lt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(mt){mt.callback=null},e.unstable_continueExecution=function(){oe||Y||(oe=!0,ct(se))},e.unstable_forceFrameRate=function(mt){0>mt||125<mt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ht=0<mt?Math.floor(1e3/mt):5},e.unstable_getCurrentPriorityLevel=function(){return H},e.unstable_getFirstCallbackNode=function(){return i(o)},e.unstable_next=function(mt){switch(H){case 1:case 2:case 3:var Lt=3;break;default:Lt=H}var yt=H;H=Lt;try{return mt()}finally{H=yt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(mt,Lt){switch(mt){case 1:case 2:case 3:case 4:case 5:break;default:mt=3}var yt=H;H=mt;try{return Lt()}finally{H=yt}},e.unstable_scheduleCallback=function(mt,Lt,yt){var Zt=e.unstable_now();switch(typeof yt=="object"&&yt!==null?(yt=yt.delay,yt=typeof yt=="number"&&0<yt?Zt+yt:Zt):yt=Zt,mt){case 1:var Yt=-1;break;case 2:Yt=250;break;case 5:Yt=1073741823;break;case 4:Yt=1e4;break;default:Yt=5e3}return Yt=yt+Yt,mt={id:$++,callback:Lt,priorityLevel:mt,startTime:yt,expirationTime:Yt,sortIndex:-1},yt>Zt?(mt.sortIndex=yt,t(L,mt),i(o)===null&&mt===i(L)&&(te?(ae(Ae),Ae=-1):te=!0,Ot(le,yt-Zt))):(mt.sortIndex=Yt,t(o,mt),oe||Y||(oe=!0,ct(se))),mt},e.unstable_shouldYield=We,e.unstable_wrapCallback=function(mt){var Lt=H;return function(){var yt=H;H=Lt;try{return mt.apply(this,arguments)}finally{H=yt}}}})(Kz);Yz.exports=Kz;var R$=Yz.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z$=Wt,ua=R$;function qt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Jz=new Set,Yg={};function Ch(e,t){Md(e,t),Md(e+"Capture",t)}function Md(e,t){for(Yg[e]=t,e=0;e<t.length;e++)Jz.add(t[e])}var El=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),iS=Object.prototype.hasOwnProperty,B$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$O={},UO={};function F$(e){return iS.call(UO,e)?!0:iS.call($O,e)?!1:B$.test(e)?UO[e]=!0:($O[e]=!0,!1)}function N$(e,t,i,a){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function j$(e,t,i,a){if(t===null||typeof t>"u"||N$(e,t,i,a))return!0;if(a)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Io(e,t,i,a,f,y,w){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=f,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=y,this.removeEmptyString=w}var Ji={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ji[e]=new Io(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ji[t]=new Io(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ji[e]=new Io(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ji[e]=new Io(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ji[e]=new Io(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ji[e]=new Io(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ji[e]=new Io(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ji[e]=new Io(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ji[e]=new Io(e,5,!1,e.toLowerCase(),null,!1,!1)});var AE=/[\-:]([a-z])/g;function EE(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(AE,EE);Ji[t]=new Io(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(AE,EE);Ji[t]=new Io(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(AE,EE);Ji[t]=new Io(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ji[e]=new Io(e,1,!1,e.toLowerCase(),null,!1,!1)});Ji.xlinkHref=new Io("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ji[e]=new Io(e,1,!1,e.toLowerCase(),null,!0,!0)});function ME(e,t,i,a){var f=Ji.hasOwnProperty(t)?Ji[t]:null;(f!==null?f.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(j$(t,i,f,a)&&(i=null),a||f===null?F$(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):f.mustUseProperty?e[f.propertyName]=i===null?f.type===3?!1:"":i:(t=f.attributeName,a=f.attributeNamespace,i===null?e.removeAttribute(t):(f=f.type,i=f===3||f===4&&i===!0?"":""+i,a?e.setAttributeNS(a,t,i):e.setAttribute(t,i))))}var Dl=z$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kv=Symbol.for("react.element"),rd=Symbol.for("react.portal"),nd=Symbol.for("react.fragment"),PE=Symbol.for("react.strict_mode"),oS=Symbol.for("react.profiler"),Qz=Symbol.for("react.provider"),e4=Symbol.for("react.context"),IE=Symbol.for("react.forward_ref"),aS=Symbol.for("react.suspense"),sS=Symbol.for("react.suspense_list"),CE=Symbol.for("react.memo"),Bc=Symbol.for("react.lazy"),t4=Symbol.for("react.offscreen"),VO=Symbol.iterator;function hg(e){return e===null||typeof e!="object"?null:(e=VO&&e[VO]||e["@@iterator"],typeof e=="function"?e:null)}var si=Object.assign,iT;function Cg(e){if(iT===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);iT=t&&t[1]||""}return`
`+iT+e}var oT=!1;function aT(e,t){if(!e||oT)return"";oT=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(L){var a=L}Reflect.construct(e,[],t)}else{try{t.call()}catch(L){a=L}e.call(t.prototype)}else{try{throw Error()}catch(L){a=L}e()}}catch(L){if(L&&a&&typeof L.stack=="string"){for(var f=L.stack.split(`
`),y=a.stack.split(`
`),w=f.length-1,O=y.length-1;1<=w&&0<=O&&f[w]!==y[O];)O--;for(;1<=w&&0<=O;w--,O--)if(f[w]!==y[O]){if(w!==1||O!==1)do if(w--,O--,0>O||f[w]!==y[O]){var o=`
`+f[w].replace(" at new "," at ");return e.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",e.displayName)),o}while(1<=w&&0<=O);break}}}finally{oT=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?Cg(e):""}function $$(e){switch(e.tag){case 5:return Cg(e.type);case 16:return Cg("Lazy");case 13:return Cg("Suspense");case 19:return Cg("SuspenseList");case 0:case 2:case 15:return e=aT(e.type,!1),e;case 11:return e=aT(e.type.render,!1),e;case 1:return e=aT(e.type,!0),e;default:return""}}function lS(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case nd:return"Fragment";case rd:return"Portal";case oS:return"Profiler";case PE:return"StrictMode";case aS:return"Suspense";case sS:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case e4:return(e.displayName||"Context")+".Consumer";case Qz:return(e._context.displayName||"Context")+".Provider";case IE:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case CE:return t=e.displayName||null,t!==null?t:lS(e.type)||"Memo";case Bc:t=e._payload,e=e._init;try{return lS(e(t))}catch{}}return null}function U$(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lS(t);case 8:return t===PE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function tu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function r4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function V$(e){var t=r4(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var f=i.get,y=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return f.call(this)},set:function(w){a=""+w,y.call(this,w)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return a},setValue:function(w){a=""+w},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Jv(e){e._valueTracker||(e._valueTracker=V$(e))}function n4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),a="";return e&&(a=r4(e)?e.checked?"true":"false":e.value),e=a,e!==i?(t.setValue(e),!0):!1}function N0(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function cS(e,t){var i=t.checked;return si({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function GO(e,t){var i=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;i=tu(t.value!=null?t.value:i),e._wrapperState={initialChecked:a,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function i4(e,t){t=t.checked,t!=null&&ME(e,"checked",t,!1)}function uS(e,t){i4(e,t);var i=tu(t.value),a=t.type;if(i!=null)a==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?hS(e,t.type,i):t.hasOwnProperty("defaultValue")&&hS(e,t.type,tu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function qO(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function hS(e,t,i){(t!=="number"||N0(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var Og=Array.isArray;function gd(e,t,i,a){if(e=e.options,t){t={};for(var f=0;f<i.length;f++)t["$"+i[f]]=!0;for(i=0;i<e.length;i++)f=t.hasOwnProperty("$"+e[i].value),e[i].selected!==f&&(e[i].selected=f),f&&a&&(e[i].defaultSelected=!0)}else{for(i=""+tu(i),t=null,f=0;f<e.length;f++){if(e[f].value===i){e[f].selected=!0,a&&(e[f].defaultSelected=!0);return}t!==null||e[f].disabled||(t=e[f])}t!==null&&(t.selected=!0)}}function fS(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(qt(91));return si({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function WO(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(qt(92));if(Og(i)){if(1<i.length)throw Error(qt(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:tu(i)}}function o4(e,t){var i=tu(t.value),a=tu(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),a!=null&&(e.defaultValue=""+a)}function HO(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function a4(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dS(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?a4(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Qv,s4=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,a,f){MSApp.execUnsafeLocalFunction(function(){return e(t,i,a,f)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Qv=Qv||document.createElement("div"),Qv.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Qv.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Kg(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Rg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},G$=["Webkit","ms","Moz","O"];Object.keys(Rg).forEach(function(e){G$.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Rg[t]=Rg[e]})});function l4(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Rg.hasOwnProperty(e)&&Rg[e]?(""+t).trim():t+"px"}function c4(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var a=i.indexOf("--")===0,f=l4(i,t[i],a);i==="float"&&(i="cssFloat"),a?e.setProperty(i,f):e[i]=f}}var q$=si({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pS(e,t){if(t){if(q$[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(qt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(qt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(qt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(qt(62))}}function mS(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gS=null;function OE(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yS=null,yd=null,_d=null;function ZO(e){if(e=Ky(e)){if(typeof yS!="function")throw Error(qt(280));var t=e.stateNode;t&&(t=m1(t),yS(e.stateNode,e.type,t))}}function u4(e){yd?_d?_d.push(e):_d=[e]:yd=e}function h4(){if(yd){var e=yd,t=_d;if(_d=yd=null,ZO(e),t)for(e=0;e<t.length;e++)ZO(t[e])}}function f4(e,t){return e(t)}function d4(){}var sT=!1;function p4(e,t,i){if(sT)return e(t,i);sT=!0;try{return f4(e,t,i)}finally{sT=!1,(yd!==null||_d!==null)&&(d4(),h4())}}function Jg(e,t){var i=e.stateNode;if(i===null)return null;var a=m1(i);if(a===null)return null;i=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(qt(231,t,typeof i));return i}var _S=!1;if(El)try{var fg={};Object.defineProperty(fg,"passive",{get:function(){_S=!0}}),window.addEventListener("test",fg,fg),window.removeEventListener("test",fg,fg)}catch{_S=!1}function W$(e,t,i,a,f,y,w,O,o){var L=Array.prototype.slice.call(arguments,3);try{t.apply(i,L)}catch($){this.onError($)}}var zg=!1,j0=null,$0=!1,vS=null,H$={onError:function(e){zg=!0,j0=e}};function Z$(e,t,i,a,f,y,w,O,o){zg=!1,j0=null,W$.apply(H$,arguments)}function X$(e,t,i,a,f,y,w,O,o){if(Z$.apply(this,arguments),zg){if(zg){var L=j0;zg=!1,j0=null}else throw Error(qt(198));$0||($0=!0,vS=L)}}function Oh(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function m4(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function XO(e){if(Oh(e)!==e)throw Error(qt(188))}function Y$(e){var t=e.alternate;if(!t){if(t=Oh(e),t===null)throw Error(qt(188));return t!==e?null:e}for(var i=e,a=t;;){var f=i.return;if(f===null)break;var y=f.alternate;if(y===null){if(a=f.return,a!==null){i=a;continue}break}if(f.child===y.child){for(y=f.child;y;){if(y===i)return XO(f),e;if(y===a)return XO(f),t;y=y.sibling}throw Error(qt(188))}if(i.return!==a.return)i=f,a=y;else{for(var w=!1,O=f.child;O;){if(O===i){w=!0,i=f,a=y;break}if(O===a){w=!0,a=f,i=y;break}O=O.sibling}if(!w){for(O=y.child;O;){if(O===i){w=!0,i=y,a=f;break}if(O===a){w=!0,a=y,i=f;break}O=O.sibling}if(!w)throw Error(qt(189))}}if(i.alternate!==a)throw Error(qt(190))}if(i.tag!==3)throw Error(qt(188));return i.stateNode.current===i?e:t}function g4(e){return e=Y$(e),e!==null?y4(e):null}function y4(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=y4(e);if(t!==null)return t;e=e.sibling}return null}var _4=ua.unstable_scheduleCallback,YO=ua.unstable_cancelCallback,K$=ua.unstable_shouldYield,J$=ua.unstable_requestPaint,gi=ua.unstable_now,Q$=ua.unstable_getCurrentPriorityLevel,kE=ua.unstable_ImmediatePriority,v4=ua.unstable_UserBlockingPriority,U0=ua.unstable_NormalPriority,eU=ua.unstable_LowPriority,x4=ua.unstable_IdlePriority,h1=null,js=null;function tU(e){if(js&&typeof js.onCommitFiberRoot=="function")try{js.onCommitFiberRoot(h1,e,void 0,(e.current.flags&128)===128)}catch{}}var ms=Math.clz32?Math.clz32:iU,rU=Math.log,nU=Math.LN2;function iU(e){return e>>>=0,e===0?32:31-(rU(e)/nU|0)|0}var e0=64,t0=4194304;function kg(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function V0(e,t){var i=e.pendingLanes;if(i===0)return 0;var a=0,f=e.suspendedLanes,y=e.pingedLanes,w=i&268435455;if(w!==0){var O=w&~f;O!==0?a=kg(O):(y&=w,y!==0&&(a=kg(y)))}else w=i&~f,w!==0?a=kg(w):y!==0&&(a=kg(y));if(a===0)return 0;if(t!==0&&t!==a&&!(t&f)&&(f=a&-a,y=t&-t,f>=y||f===16&&(y&4194240)!==0))return t;if(a&4&&(a|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)i=31-ms(t),f=1<<i,a|=e[i],t&=~f;return a}function oU(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function aU(e,t){for(var i=e.suspendedLanes,a=e.pingedLanes,f=e.expirationTimes,y=e.pendingLanes;0<y;){var w=31-ms(y),O=1<<w,o=f[w];o===-1?(!(O&i)||O&a)&&(f[w]=oU(O,t)):o<=t&&(e.expiredLanes|=O),y&=~O}}function xS(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function b4(){var e=e0;return e0<<=1,!(e0&4194240)&&(e0=64),e}function lT(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Xy(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ms(t),e[t]=i}function sU(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<i;){var f=31-ms(i),y=1<<f;t[f]=0,a[f]=-1,e[f]=-1,i&=~y}}function DE(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var a=31-ms(i),f=1<<a;f&t|e[a]&t&&(e[a]|=t),i&=~f}}var Pn=0;function w4(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var T4,LE,S4,A4,E4,bS=!1,r0=[],Wc=null,Hc=null,Zc=null,Qg=new Map,ey=new Map,jc=[],lU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KO(e,t){switch(e){case"focusin":case"focusout":Wc=null;break;case"dragenter":case"dragleave":Hc=null;break;case"mouseover":case"mouseout":Zc=null;break;case"pointerover":case"pointerout":Qg.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ey.delete(t.pointerId)}}function dg(e,t,i,a,f,y){return e===null||e.nativeEvent!==y?(e={blockedOn:t,domEventName:i,eventSystemFlags:a,nativeEvent:y,targetContainers:[f]},t!==null&&(t=Ky(t),t!==null&&LE(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,f!==null&&t.indexOf(f)===-1&&t.push(f),e)}function cU(e,t,i,a,f){switch(t){case"focusin":return Wc=dg(Wc,e,t,i,a,f),!0;case"dragenter":return Hc=dg(Hc,e,t,i,a,f),!0;case"mouseover":return Zc=dg(Zc,e,t,i,a,f),!0;case"pointerover":var y=f.pointerId;return Qg.set(y,dg(Qg.get(y)||null,e,t,i,a,f)),!0;case"gotpointercapture":return y=f.pointerId,ey.set(y,dg(ey.get(y)||null,e,t,i,a,f)),!0}return!1}function M4(e){var t=ch(e.target);if(t!==null){var i=Oh(t);if(i!==null){if(t=i.tag,t===13){if(t=m4(i),t!==null){e.blockedOn=t,E4(e.priority,function(){S4(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function I0(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=wS(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var a=new i.constructor(i.type,i);gS=a,i.target.dispatchEvent(a),gS=null}else return t=Ky(i),t!==null&&LE(t),e.blockedOn=i,!1;t.shift()}return!0}function JO(e,t,i){I0(e)&&i.delete(t)}function uU(){bS=!1,Wc!==null&&I0(Wc)&&(Wc=null),Hc!==null&&I0(Hc)&&(Hc=null),Zc!==null&&I0(Zc)&&(Zc=null),Qg.forEach(JO),ey.forEach(JO)}function pg(e,t){e.blockedOn===t&&(e.blockedOn=null,bS||(bS=!0,ua.unstable_scheduleCallback(ua.unstable_NormalPriority,uU)))}function ty(e){function t(f){return pg(f,e)}if(0<r0.length){pg(r0[0],e);for(var i=1;i<r0.length;i++){var a=r0[i];a.blockedOn===e&&(a.blockedOn=null)}}for(Wc!==null&&pg(Wc,e),Hc!==null&&pg(Hc,e),Zc!==null&&pg(Zc,e),Qg.forEach(t),ey.forEach(t),i=0;i<jc.length;i++)a=jc[i],a.blockedOn===e&&(a.blockedOn=null);for(;0<jc.length&&(i=jc[0],i.blockedOn===null);)M4(i),i.blockedOn===null&&jc.shift()}var vd=Dl.ReactCurrentBatchConfig,G0=!0;function hU(e,t,i,a){var f=Pn,y=vd.transition;vd.transition=null;try{Pn=1,RE(e,t,i,a)}finally{Pn=f,vd.transition=y}}function fU(e,t,i,a){var f=Pn,y=vd.transition;vd.transition=null;try{Pn=4,RE(e,t,i,a)}finally{Pn=f,vd.transition=y}}function RE(e,t,i,a){if(G0){var f=wS(e,t,i,a);if(f===null)_T(e,t,a,q0,i),KO(e,a);else if(cU(f,e,t,i,a))a.stopPropagation();else if(KO(e,a),t&4&&-1<lU.indexOf(e)){for(;f!==null;){var y=Ky(f);if(y!==null&&T4(y),y=wS(e,t,i,a),y===null&&_T(e,t,a,q0,i),y===f)break;f=y}f!==null&&a.stopPropagation()}else _T(e,t,a,null,i)}}var q0=null;function wS(e,t,i,a){if(q0=null,e=OE(a),e=ch(e),e!==null)if(t=Oh(e),t===null)e=null;else if(i=t.tag,i===13){if(e=m4(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return q0=e,null}function P4(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Q$()){case kE:return 1;case v4:return 4;case U0:case eU:return 16;case x4:return 536870912;default:return 16}default:return 16}}var Uc=null,zE=null,C0=null;function I4(){if(C0)return C0;var e,t=zE,i=t.length,a,f="value"in Uc?Uc.value:Uc.textContent,y=f.length;for(e=0;e<i&&t[e]===f[e];e++);var w=i-e;for(a=1;a<=w&&t[i-a]===f[y-a];a++);return C0=f.slice(e,1<a?1-a:void 0)}function O0(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function n0(){return!0}function QO(){return!1}function fa(e){function t(i,a,f,y,w){this._reactName=i,this._targetInst=f,this.type=a,this.nativeEvent=y,this.target=w,this.currentTarget=null;for(var O in e)e.hasOwnProperty(O)&&(i=e[O],this[O]=i?i(y):y[O]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?n0:QO,this.isPropagationStopped=QO,this}return si(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=n0)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=n0)},persist:function(){},isPersistent:n0}),t}var op={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},BE=fa(op),Yy=si({},op,{view:0,detail:0}),dU=fa(Yy),cT,uT,mg,f1=si({},Yy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:FE,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==mg&&(mg&&e.type==="mousemove"?(cT=e.screenX-mg.screenX,uT=e.screenY-mg.screenY):uT=cT=0,mg=e),cT)},movementY:function(e){return"movementY"in e?e.movementY:uT}}),ek=fa(f1),pU=si({},f1,{dataTransfer:0}),mU=fa(pU),gU=si({},Yy,{relatedTarget:0}),hT=fa(gU),yU=si({},op,{animationName:0,elapsedTime:0,pseudoElement:0}),_U=fa(yU),vU=si({},op,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xU=fa(vU),bU=si({},op,{data:0}),tk=fa(bU),wU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AU(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=SU[e])?!!t[e]:!1}function FE(){return AU}var EU=si({},Yy,{key:function(e){if(e.key){var t=wU[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=O0(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?TU[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:FE,charCode:function(e){return e.type==="keypress"?O0(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?O0(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),MU=fa(EU),PU=si({},f1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rk=fa(PU),IU=si({},Yy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:FE}),CU=fa(IU),OU=si({},op,{propertyName:0,elapsedTime:0,pseudoElement:0}),kU=fa(OU),DU=si({},f1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),LU=fa(DU),RU=[9,13,27,32],NE=El&&"CompositionEvent"in window,Bg=null;El&&"documentMode"in document&&(Bg=document.documentMode);var zU=El&&"TextEvent"in window&&!Bg,C4=El&&(!NE||Bg&&8<Bg&&11>=Bg),nk=" ",ik=!1;function O4(e,t){switch(e){case"keyup":return RU.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function k4(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var id=!1;function BU(e,t){switch(e){case"compositionend":return k4(t);case"keypress":return t.which!==32?null:(ik=!0,nk);case"textInput":return e=t.data,e===nk&&ik?null:e;default:return null}}function FU(e,t){if(id)return e==="compositionend"||!NE&&O4(e,t)?(e=I4(),C0=zE=Uc=null,id=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return C4&&t.locale!=="ko"?null:t.data;default:return null}}var NU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ok(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!NU[e.type]:t==="textarea"}function D4(e,t,i,a){u4(a),t=W0(t,"onChange"),0<t.length&&(i=new BE("onChange","change",null,i,a),e.push({event:i,listeners:t}))}var Fg=null,ry=null;function jU(e){G4(e,0)}function d1(e){var t=sd(e);if(n4(t))return e}function $U(e,t){if(e==="change")return t}var L4=!1;if(El){var fT;if(El){var dT="oninput"in document;if(!dT){var ak=document.createElement("div");ak.setAttribute("oninput","return;"),dT=typeof ak.oninput=="function"}fT=dT}else fT=!1;L4=fT&&(!document.documentMode||9<document.documentMode)}function sk(){Fg&&(Fg.detachEvent("onpropertychange",R4),ry=Fg=null)}function R4(e){if(e.propertyName==="value"&&d1(ry)){var t=[];D4(t,ry,e,OE(e)),p4(jU,t)}}function UU(e,t,i){e==="focusin"?(sk(),Fg=t,ry=i,Fg.attachEvent("onpropertychange",R4)):e==="focusout"&&sk()}function VU(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return d1(ry)}function GU(e,t){if(e==="click")return d1(t)}function qU(e,t){if(e==="input"||e==="change")return d1(t)}function WU(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ys=typeof Object.is=="function"?Object.is:WU;function ny(e,t){if(ys(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(a=0;a<i.length;a++){var f=i[a];if(!iS.call(t,f)||!ys(e[f],t[f]))return!1}return!0}function lk(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ck(e,t){var i=lk(e);e=0;for(var a;i;){if(i.nodeType===3){if(a=e+i.textContent.length,e<=t&&a>=t)return{node:i,offset:t-e};e=a}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=lk(i)}}function z4(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?z4(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function B4(){for(var e=window,t=N0();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=N0(e.document)}return t}function jE(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function HU(e){var t=B4(),i=e.focusedElem,a=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&z4(i.ownerDocument.documentElement,i)){if(a!==null&&jE(i)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var f=i.textContent.length,y=Math.min(a.start,f);a=a.end===void 0?y:Math.min(a.end,f),!e.extend&&y>a&&(f=a,a=y,y=f),f=ck(i,y);var w=ck(i,a);f&&w&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==w.node||e.focusOffset!==w.offset)&&(t=t.createRange(),t.setStart(f.node,f.offset),e.removeAllRanges(),y>a?(e.addRange(t),e.extend(w.node,w.offset)):(t.setEnd(w.node,w.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ZU=El&&"documentMode"in document&&11>=document.documentMode,od=null,TS=null,Ng=null,SS=!1;function uk(e,t,i){var a=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;SS||od==null||od!==N0(a)||(a=od,"selectionStart"in a&&jE(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Ng&&ny(Ng,a)||(Ng=a,a=W0(TS,"onSelect"),0<a.length&&(t=new BE("onSelect","select",null,t,i),e.push({event:t,listeners:a}),t.target=od)))}function i0(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var ad={animationend:i0("Animation","AnimationEnd"),animationiteration:i0("Animation","AnimationIteration"),animationstart:i0("Animation","AnimationStart"),transitionend:i0("Transition","TransitionEnd")},pT={},F4={};El&&(F4=document.createElement("div").style,"AnimationEvent"in window||(delete ad.animationend.animation,delete ad.animationiteration.animation,delete ad.animationstart.animation),"TransitionEvent"in window||delete ad.transitionend.transition);function p1(e){if(pT[e])return pT[e];if(!ad[e])return e;var t=ad[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in F4)return pT[e]=t[i];return e}var N4=p1("animationend"),j4=p1("animationiteration"),$4=p1("animationstart"),U4=p1("transitionend"),V4=new Map,hk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nu(e,t){V4.set(e,t),Ch(t,[e])}for(var mT=0;mT<hk.length;mT++){var gT=hk[mT],XU=gT.toLowerCase(),YU=gT[0].toUpperCase()+gT.slice(1);nu(XU,"on"+YU)}nu(N4,"onAnimationEnd");nu(j4,"onAnimationIteration");nu($4,"onAnimationStart");nu("dblclick","onDoubleClick");nu("focusin","onFocus");nu("focusout","onBlur");nu(U4,"onTransitionEnd");Md("onMouseEnter",["mouseout","mouseover"]);Md("onMouseLeave",["mouseout","mouseover"]);Md("onPointerEnter",["pointerout","pointerover"]);Md("onPointerLeave",["pointerout","pointerover"]);Ch("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ch("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ch("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ch("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ch("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ch("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KU=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dg));function fk(e,t,i){var a=e.type||"unknown-event";e.currentTarget=i,X$(a,t,void 0,e),e.currentTarget=null}function G4(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var a=e[i],f=a.event;a=a.listeners;e:{var y=void 0;if(t)for(var w=a.length-1;0<=w;w--){var O=a[w],o=O.instance,L=O.currentTarget;if(O=O.listener,o!==y&&f.isPropagationStopped())break e;fk(f,O,L),y=o}else for(w=0;w<a.length;w++){if(O=a[w],o=O.instance,L=O.currentTarget,O=O.listener,o!==y&&f.isPropagationStopped())break e;fk(f,O,L),y=o}}}if($0)throw e=vS,$0=!1,vS=null,e}function Hn(e,t){var i=t[IS];i===void 0&&(i=t[IS]=new Set);var a=e+"__bubble";i.has(a)||(q4(t,e,2,!1),i.add(a))}function yT(e,t,i){var a=0;t&&(a|=4),q4(i,e,a,t)}var o0="_reactListening"+Math.random().toString(36).slice(2);function iy(e){if(!e[o0]){e[o0]=!0,Jz.forEach(function(i){i!=="selectionchange"&&(KU.has(i)||yT(i,!1,e),yT(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[o0]||(t[o0]=!0,yT("selectionchange",!1,t))}}function q4(e,t,i,a){switch(P4(t)){case 1:var f=hU;break;case 4:f=fU;break;default:f=RE}i=f.bind(null,t,i,e),f=void 0,!_S||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(f=!0),a?f!==void 0?e.addEventListener(t,i,{capture:!0,passive:f}):e.addEventListener(t,i,!0):f!==void 0?e.addEventListener(t,i,{passive:f}):e.addEventListener(t,i,!1)}function _T(e,t,i,a,f){var y=a;if(!(t&1)&&!(t&2)&&a!==null)e:for(;;){if(a===null)return;var w=a.tag;if(w===3||w===4){var O=a.stateNode.containerInfo;if(O===f||O.nodeType===8&&O.parentNode===f)break;if(w===4)for(w=a.return;w!==null;){var o=w.tag;if((o===3||o===4)&&(o=w.stateNode.containerInfo,o===f||o.nodeType===8&&o.parentNode===f))return;w=w.return}for(;O!==null;){if(w=ch(O),w===null)return;if(o=w.tag,o===5||o===6){a=y=w;continue e}O=O.parentNode}}a=a.return}p4(function(){var L=y,$=OE(i),F=[];e:{var H=V4.get(e);if(H!==void 0){var Y=BE,oe=e;switch(e){case"keypress":if(O0(i)===0)break e;case"keydown":case"keyup":Y=MU;break;case"focusin":oe="focus",Y=hT;break;case"focusout":oe="blur",Y=hT;break;case"beforeblur":case"afterblur":Y=hT;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=ek;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=mU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=CU;break;case N4:case j4:case $4:Y=_U;break;case U4:Y=kU;break;case"scroll":Y=dU;break;case"wheel":Y=LU;break;case"copy":case"cut":case"paste":Y=xU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=rk}var te=(t&4)!==0,ie=!te&&e==="scroll",ae=te?H!==null?H+"Capture":null:H;te=[];for(var J=L,ue;J!==null;){ue=J;var le=ue.stateNode;if(ue.tag===5&&le!==null&&(ue=le,ae!==null&&(le=Jg(J,ae),le!=null&&te.push(oy(J,le,ue)))),ie)break;J=J.return}0<te.length&&(H=new Y(H,oe,null,i,$),F.push({event:H,listeners:te}))}}if(!(t&7)){e:{if(H=e==="mouseover"||e==="pointerover",Y=e==="mouseout"||e==="pointerout",H&&i!==gS&&(oe=i.relatedTarget||i.fromElement)&&(ch(oe)||oe[Ml]))break e;if((Y||H)&&(H=$.window===$?$:(H=$.ownerDocument)?H.defaultView||H.parentWindow:window,Y?(oe=i.relatedTarget||i.toElement,Y=L,oe=oe?ch(oe):null,oe!==null&&(ie=Oh(oe),oe!==ie||oe.tag!==5&&oe.tag!==6)&&(oe=null)):(Y=null,oe=L),Y!==oe)){if(te=ek,le="onMouseLeave",ae="onMouseEnter",J="mouse",(e==="pointerout"||e==="pointerover")&&(te=rk,le="onPointerLeave",ae="onPointerEnter",J="pointer"),ie=Y==null?H:sd(Y),ue=oe==null?H:sd(oe),H=new te(le,J+"leave",Y,i,$),H.target=ie,H.relatedTarget=ue,le=null,ch($)===L&&(te=new te(ae,J+"enter",oe,i,$),te.target=ue,te.relatedTarget=ie,le=te),ie=le,Y&&oe)t:{for(te=Y,ae=oe,J=0,ue=te;ue;ue=Kf(ue))J++;for(ue=0,le=ae;le;le=Kf(le))ue++;for(;0<J-ue;)te=Kf(te),J--;for(;0<ue-J;)ae=Kf(ae),ue--;for(;J--;){if(te===ae||ae!==null&&te===ae.alternate)break t;te=Kf(te),ae=Kf(ae)}te=null}else te=null;Y!==null&&dk(F,H,Y,te,!1),oe!==null&&ie!==null&&dk(F,ie,oe,te,!0)}}e:{if(H=L?sd(L):window,Y=H.nodeName&&H.nodeName.toLowerCase(),Y==="select"||Y==="input"&&H.type==="file")var se=$U;else if(ok(H))if(L4)se=qU;else{se=VU;var be=UU}else(Y=H.nodeName)&&Y.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(se=GU);if(se&&(se=se(e,L))){D4(F,se,i,$);break e}be&&be(e,H,L),e==="focusout"&&(be=H._wrapperState)&&be.controlled&&H.type==="number"&&hS(H,"number",H.value)}switch(be=L?sd(L):window,e){case"focusin":(ok(be)||be.contentEditable==="true")&&(od=be,TS=L,Ng=null);break;case"focusout":Ng=TS=od=null;break;case"mousedown":SS=!0;break;case"contextmenu":case"mouseup":case"dragend":SS=!1,uk(F,i,$);break;case"selectionchange":if(ZU)break;case"keydown":case"keyup":uk(F,i,$)}var Ie;if(NE)e:{switch(e){case"compositionstart":var Ae="onCompositionStart";break e;case"compositionend":Ae="onCompositionEnd";break e;case"compositionupdate":Ae="onCompositionUpdate";break e}Ae=void 0}else id?O4(e,i)&&(Ae="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ae="onCompositionStart");Ae&&(C4&&i.locale!=="ko"&&(id||Ae!=="onCompositionStart"?Ae==="onCompositionEnd"&&id&&(Ie=I4()):(Uc=$,zE="value"in Uc?Uc.value:Uc.textContent,id=!0)),be=W0(L,Ae),0<be.length&&(Ae=new tk(Ae,e,null,i,$),F.push({event:Ae,listeners:be}),Ie?Ae.data=Ie:(Ie=k4(i),Ie!==null&&(Ae.data=Ie)))),(Ie=zU?BU(e,i):FU(e,i))&&(L=W0(L,"onBeforeInput"),0<L.length&&($=new tk("onBeforeInput","beforeinput",null,i,$),F.push({event:$,listeners:L}),$.data=Ie))}G4(F,t)})}function oy(e,t,i){return{instance:e,listener:t,currentTarget:i}}function W0(e,t){for(var i=t+"Capture",a=[];e!==null;){var f=e,y=f.stateNode;f.tag===5&&y!==null&&(f=y,y=Jg(e,i),y!=null&&a.unshift(oy(e,y,f)),y=Jg(e,t),y!=null&&a.push(oy(e,y,f))),e=e.return}return a}function Kf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function dk(e,t,i,a,f){for(var y=t._reactName,w=[];i!==null&&i!==a;){var O=i,o=O.alternate,L=O.stateNode;if(o!==null&&o===a)break;O.tag===5&&L!==null&&(O=L,f?(o=Jg(i,y),o!=null&&w.unshift(oy(i,o,O))):f||(o=Jg(i,y),o!=null&&w.push(oy(i,o,O)))),i=i.return}w.length!==0&&e.push({event:t,listeners:w})}var JU=/\r\n?/g,QU=/\u0000|\uFFFD/g;function pk(e){return(typeof e=="string"?e:""+e).replace(JU,`
`).replace(QU,"")}function a0(e,t,i){if(t=pk(t),pk(e)!==t&&i)throw Error(qt(425))}function H0(){}var AS=null,ES=null;function MS(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var PS=typeof setTimeout=="function"?setTimeout:void 0,eV=typeof clearTimeout=="function"?clearTimeout:void 0,mk=typeof Promise=="function"?Promise:void 0,tV=typeof queueMicrotask=="function"?queueMicrotask:typeof mk<"u"?function(e){return mk.resolve(null).then(e).catch(rV)}:PS;function rV(e){setTimeout(function(){throw e})}function vT(e,t){var i=t,a=0;do{var f=i.nextSibling;if(e.removeChild(i),f&&f.nodeType===8)if(i=f.data,i==="/$"){if(a===0){e.removeChild(f),ty(t);return}a--}else i!=="$"&&i!=="$?"&&i!=="$!"||a++;i=f}while(i);ty(t)}function Xc(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function gk(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var ap=Math.random().toString(36).slice(2),Bs="__reactFiber$"+ap,ay="__reactProps$"+ap,Ml="__reactContainer$"+ap,IS="__reactEvents$"+ap,nV="__reactListeners$"+ap,iV="__reactHandles$"+ap;function ch(e){var t=e[Bs];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Ml]||i[Bs]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=gk(e);e!==null;){if(i=e[Bs])return i;e=gk(e)}return t}e=i,i=e.parentNode}return null}function Ky(e){return e=e[Bs]||e[Ml],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function sd(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(qt(33))}function m1(e){return e[ay]||null}var CS=[],ld=-1;function iu(e){return{current:e}}function Yn(e){0>ld||(e.current=CS[ld],CS[ld]=null,ld--)}function Un(e,t){ld++,CS[ld]=e.current,e.current=t}var ru={},ho=iu(ru),jo=iu(!1),wh=ru;function Pd(e,t){var i=e.type.contextTypes;if(!i)return ru;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var f={},y;for(y in i)f[y]=t[y];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=f),f}function $o(e){return e=e.childContextTypes,e!=null}function Z0(){Yn(jo),Yn(ho)}function yk(e,t,i){if(ho.current!==ru)throw Error(qt(168));Un(ho,t),Un(jo,i)}function W4(e,t,i){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return i;a=a.getChildContext();for(var f in a)if(!(f in t))throw Error(qt(108,U$(e)||"Unknown",f));return si({},i,a)}function X0(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ru,wh=ho.current,Un(ho,e),Un(jo,jo.current),!0}function _k(e,t,i){var a=e.stateNode;if(!a)throw Error(qt(169));i?(e=W4(e,t,wh),a.__reactInternalMemoizedMergedChildContext=e,Yn(jo),Yn(ho),Un(ho,e)):Yn(jo),Un(jo,i)}var yl=null,g1=!1,xT=!1;function H4(e){yl===null?yl=[e]:yl.push(e)}function oV(e){g1=!0,H4(e)}function ou(){if(!xT&&yl!==null){xT=!0;var e=0,t=Pn;try{var i=yl;for(Pn=1;e<i.length;e++){var a=i[e];do a=a(!0);while(a!==null)}yl=null,g1=!1}catch(f){throw yl!==null&&(yl=yl.slice(e+1)),_4(kE,ou),f}finally{Pn=t,xT=!1}}return null}var cd=[],ud=0,Y0=null,K0=0,Ia=[],Ca=0,Th=null,_l=1,vl="";function ih(e,t){cd[ud++]=K0,cd[ud++]=Y0,Y0=e,K0=t}function Z4(e,t,i){Ia[Ca++]=_l,Ia[Ca++]=vl,Ia[Ca++]=Th,Th=e;var a=_l;e=vl;var f=32-ms(a)-1;a&=~(1<<f),i+=1;var y=32-ms(t)+f;if(30<y){var w=f-f%5;y=(a&(1<<w)-1).toString(32),a>>=w,f-=w,_l=1<<32-ms(t)+f|i<<f|a,vl=y+e}else _l=1<<y|i<<f|a,vl=e}function $E(e){e.return!==null&&(ih(e,1),Z4(e,1,0))}function UE(e){for(;e===Y0;)Y0=cd[--ud],cd[ud]=null,K0=cd[--ud],cd[ud]=null;for(;e===Th;)Th=Ia[--Ca],Ia[Ca]=null,vl=Ia[--Ca],Ia[Ca]=null,_l=Ia[--Ca],Ia[Ca]=null}var ca=null,la=null,Qn=!1,fs=null;function X4(e,t){var i=Oa(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function vk(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ca=e,la=Xc(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ca=e,la=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Th!==null?{id:_l,overflow:vl}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Oa(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,ca=e,la=null,!0):!1;default:return!1}}function OS(e){return(e.mode&1)!==0&&(e.flags&128)===0}function kS(e){if(Qn){var t=la;if(t){var i=t;if(!vk(e,t)){if(OS(e))throw Error(qt(418));t=Xc(i.nextSibling);var a=ca;t&&vk(e,t)?X4(a,i):(e.flags=e.flags&-4097|2,Qn=!1,ca=e)}}else{if(OS(e))throw Error(qt(418));e.flags=e.flags&-4097|2,Qn=!1,ca=e}}}function xk(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ca=e}function s0(e){if(e!==ca)return!1;if(!Qn)return xk(e),Qn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!MS(e.type,e.memoizedProps)),t&&(t=la)){if(OS(e))throw Y4(),Error(qt(418));for(;t;)X4(e,t),t=Xc(t.nextSibling)}if(xk(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(qt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){la=Xc(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}la=null}}else la=ca?Xc(e.stateNode.nextSibling):null;return!0}function Y4(){for(var e=la;e;)e=Xc(e.nextSibling)}function Id(){la=ca=null,Qn=!1}function VE(e){fs===null?fs=[e]:fs.push(e)}var aV=Dl.ReactCurrentBatchConfig;function gg(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(qt(309));var a=i.stateNode}if(!a)throw Error(qt(147,e));var f=a,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(w){var O=f.refs;w===null?delete O[y]:O[y]=w},t._stringRef=y,t)}if(typeof e!="string")throw Error(qt(284));if(!i._owner)throw Error(qt(290,e))}return e}function l0(e,t){throw e=Object.prototype.toString.call(t),Error(qt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bk(e){var t=e._init;return t(e._payload)}function K4(e){function t(ae,J){if(e){var ue=ae.deletions;ue===null?(ae.deletions=[J],ae.flags|=16):ue.push(J)}}function i(ae,J){if(!e)return null;for(;J!==null;)t(ae,J),J=J.sibling;return null}function a(ae,J){for(ae=new Map;J!==null;)J.key!==null?ae.set(J.key,J):ae.set(J.index,J),J=J.sibling;return ae}function f(ae,J){return ae=Qc(ae,J),ae.index=0,ae.sibling=null,ae}function y(ae,J,ue){return ae.index=ue,e?(ue=ae.alternate,ue!==null?(ue=ue.index,ue<J?(ae.flags|=2,J):ue):(ae.flags|=2,J)):(ae.flags|=1048576,J)}function w(ae){return e&&ae.alternate===null&&(ae.flags|=2),ae}function O(ae,J,ue,le){return J===null||J.tag!==6?(J=MT(ue,ae.mode,le),J.return=ae,J):(J=f(J,ue),J.return=ae,J)}function o(ae,J,ue,le){var se=ue.type;return se===nd?$(ae,J,ue.props.children,le,ue.key):J!==null&&(J.elementType===se||typeof se=="object"&&se!==null&&se.$$typeof===Bc&&bk(se)===J.type)?(le=f(J,ue.props),le.ref=gg(ae,J,ue),le.return=ae,le):(le=F0(ue.type,ue.key,ue.props,null,ae.mode,le),le.ref=gg(ae,J,ue),le.return=ae,le)}function L(ae,J,ue,le){return J===null||J.tag!==4||J.stateNode.containerInfo!==ue.containerInfo||J.stateNode.implementation!==ue.implementation?(J=PT(ue,ae.mode,le),J.return=ae,J):(J=f(J,ue.children||[]),J.return=ae,J)}function $(ae,J,ue,le,se){return J===null||J.tag!==7?(J=_h(ue,ae.mode,le,se),J.return=ae,J):(J=f(J,ue),J.return=ae,J)}function F(ae,J,ue){if(typeof J=="string"&&J!==""||typeof J=="number")return J=MT(""+J,ae.mode,ue),J.return=ae,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Kv:return ue=F0(J.type,J.key,J.props,null,ae.mode,ue),ue.ref=gg(ae,null,J),ue.return=ae,ue;case rd:return J=PT(J,ae.mode,ue),J.return=ae,J;case Bc:var le=J._init;return F(ae,le(J._payload),ue)}if(Og(J)||hg(J))return J=_h(J,ae.mode,ue,null),J.return=ae,J;l0(ae,J)}return null}function H(ae,J,ue,le){var se=J!==null?J.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return se!==null?null:O(ae,J,""+ue,le);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Kv:return ue.key===se?o(ae,J,ue,le):null;case rd:return ue.key===se?L(ae,J,ue,le):null;case Bc:return se=ue._init,H(ae,J,se(ue._payload),le)}if(Og(ue)||hg(ue))return se!==null?null:$(ae,J,ue,le,null);l0(ae,ue)}return null}function Y(ae,J,ue,le,se){if(typeof le=="string"&&le!==""||typeof le=="number")return ae=ae.get(ue)||null,O(J,ae,""+le,se);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Kv:return ae=ae.get(le.key===null?ue:le.key)||null,o(J,ae,le,se);case rd:return ae=ae.get(le.key===null?ue:le.key)||null,L(J,ae,le,se);case Bc:var be=le._init;return Y(ae,J,ue,be(le._payload),se)}if(Og(le)||hg(le))return ae=ae.get(ue)||null,$(J,ae,le,se,null);l0(J,le)}return null}function oe(ae,J,ue,le){for(var se=null,be=null,Ie=J,Ae=J=0,ht=null;Ie!==null&&Ae<ue.length;Ae++){Ie.index>Ae?(ht=Ie,Ie=null):ht=Ie.sibling;var st=H(ae,Ie,ue[Ae],le);if(st===null){Ie===null&&(Ie=ht);break}e&&Ie&&st.alternate===null&&t(ae,Ie),J=y(st,J,Ae),be===null?se=st:be.sibling=st,be=st,Ie=ht}if(Ae===ue.length)return i(ae,Ie),Qn&&ih(ae,Ae),se;if(Ie===null){for(;Ae<ue.length;Ae++)Ie=F(ae,ue[Ae],le),Ie!==null&&(J=y(Ie,J,Ae),be===null?se=Ie:be.sibling=Ie,be=Ie);return Qn&&ih(ae,Ae),se}for(Ie=a(ae,Ie);Ae<ue.length;Ae++)ht=Y(Ie,ae,Ae,ue[Ae],le),ht!==null&&(e&&ht.alternate!==null&&Ie.delete(ht.key===null?Ae:ht.key),J=y(ht,J,Ae),be===null?se=ht:be.sibling=ht,be=ht);return e&&Ie.forEach(function(We){return t(ae,We)}),Qn&&ih(ae,Ae),se}function te(ae,J,ue,le){var se=hg(ue);if(typeof se!="function")throw Error(qt(150));if(ue=se.call(ue),ue==null)throw Error(qt(151));for(var be=se=null,Ie=J,Ae=J=0,ht=null,st=ue.next();Ie!==null&&!st.done;Ae++,st=ue.next()){Ie.index>Ae?(ht=Ie,Ie=null):ht=Ie.sibling;var We=H(ae,Ie,st.value,le);if(We===null){Ie===null&&(Ie=ht);break}e&&Ie&&We.alternate===null&&t(ae,Ie),J=y(We,J,Ae),be===null?se=We:be.sibling=We,be=We,Ie=ht}if(st.done)return i(ae,Ie),Qn&&ih(ae,Ae),se;if(Ie===null){for(;!st.done;Ae++,st=ue.next())st=F(ae,st.value,le),st!==null&&(J=y(st,J,Ae),be===null?se=st:be.sibling=st,be=st);return Qn&&ih(ae,Ae),se}for(Ie=a(ae,Ie);!st.done;Ae++,st=ue.next())st=Y(Ie,ae,Ae,st.value,le),st!==null&&(e&&st.alternate!==null&&Ie.delete(st.key===null?Ae:st.key),J=y(st,J,Ae),be===null?se=st:be.sibling=st,be=st);return e&&Ie.forEach(function(He){return t(ae,He)}),Qn&&ih(ae,Ae),se}function ie(ae,J,ue,le){if(typeof ue=="object"&&ue!==null&&ue.type===nd&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Kv:e:{for(var se=ue.key,be=J;be!==null;){if(be.key===se){if(se=ue.type,se===nd){if(be.tag===7){i(ae,be.sibling),J=f(be,ue.props.children),J.return=ae,ae=J;break e}}else if(be.elementType===se||typeof se=="object"&&se!==null&&se.$$typeof===Bc&&bk(se)===be.type){i(ae,be.sibling),J=f(be,ue.props),J.ref=gg(ae,be,ue),J.return=ae,ae=J;break e}i(ae,be);break}else t(ae,be);be=be.sibling}ue.type===nd?(J=_h(ue.props.children,ae.mode,le,ue.key),J.return=ae,ae=J):(le=F0(ue.type,ue.key,ue.props,null,ae.mode,le),le.ref=gg(ae,J,ue),le.return=ae,ae=le)}return w(ae);case rd:e:{for(be=ue.key;J!==null;){if(J.key===be)if(J.tag===4&&J.stateNode.containerInfo===ue.containerInfo&&J.stateNode.implementation===ue.implementation){i(ae,J.sibling),J=f(J,ue.children||[]),J.return=ae,ae=J;break e}else{i(ae,J);break}else t(ae,J);J=J.sibling}J=PT(ue,ae.mode,le),J.return=ae,ae=J}return w(ae);case Bc:return be=ue._init,ie(ae,J,be(ue._payload),le)}if(Og(ue))return oe(ae,J,ue,le);if(hg(ue))return te(ae,J,ue,le);l0(ae,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,J!==null&&J.tag===6?(i(ae,J.sibling),J=f(J,ue),J.return=ae,ae=J):(i(ae,J),J=MT(ue,ae.mode,le),J.return=ae,ae=J),w(ae)):i(ae,J)}return ie}var Cd=K4(!0),J4=K4(!1),J0=iu(null),Q0=null,hd=null,GE=null;function qE(){GE=hd=Q0=null}function WE(e){var t=J0.current;Yn(J0),e._currentValue=t}function DS(e,t,i){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===i)break;e=e.return}}function xd(e,t){Q0=e,GE=hd=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fo=!0),e.firstContext=null)}function za(e){var t=e._currentValue;if(GE!==e)if(e={context:e,memoizedValue:t,next:null},hd===null){if(Q0===null)throw Error(qt(308));hd=e,Q0.dependencies={lanes:0,firstContext:e}}else hd=hd.next=e;return t}var uh=null;function HE(e){uh===null?uh=[e]:uh.push(e)}function Q4(e,t,i,a){var f=t.interleaved;return f===null?(i.next=i,HE(t)):(i.next=f.next,f.next=i),t.interleaved=i,Pl(e,a)}function Pl(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Fc=!1;function ZE(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eB(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function wl(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Yc(e,t,i){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,gn&2){var f=a.pending;return f===null?t.next=t:(t.next=f.next,f.next=t),a.pending=t,Pl(e,i)}return f=a.interleaved,f===null?(t.next=t,HE(a)):(t.next=f.next,f.next=t),a.interleaved=t,Pl(e,i)}function k0(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,DE(e,i)}}function wk(e,t){var i=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,i===a)){var f=null,y=null;if(i=i.firstBaseUpdate,i!==null){do{var w={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};y===null?f=y=w:y=y.next=w,i=i.next}while(i!==null);y===null?f=y=t:y=y.next=t}else f=y=t;i={baseState:a.baseState,firstBaseUpdate:f,lastBaseUpdate:y,shared:a.shared,effects:a.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function ex(e,t,i,a){var f=e.updateQueue;Fc=!1;var y=f.firstBaseUpdate,w=f.lastBaseUpdate,O=f.shared.pending;if(O!==null){f.shared.pending=null;var o=O,L=o.next;o.next=null,w===null?y=L:w.next=L,w=o;var $=e.alternate;$!==null&&($=$.updateQueue,O=$.lastBaseUpdate,O!==w&&(O===null?$.firstBaseUpdate=L:O.next=L,$.lastBaseUpdate=o))}if(y!==null){var F=f.baseState;w=0,$=L=o=null,O=y;do{var H=O.lane,Y=O.eventTime;if((a&H)===H){$!==null&&($=$.next={eventTime:Y,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});e:{var oe=e,te=O;switch(H=t,Y=i,te.tag){case 1:if(oe=te.payload,typeof oe=="function"){F=oe.call(Y,F,H);break e}F=oe;break e;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=te.payload,H=typeof oe=="function"?oe.call(Y,F,H):oe,H==null)break e;F=si({},F,H);break e;case 2:Fc=!0}}O.callback!==null&&O.lane!==0&&(e.flags|=64,H=f.effects,H===null?f.effects=[O]:H.push(O))}else Y={eventTime:Y,lane:H,tag:O.tag,payload:O.payload,callback:O.callback,next:null},$===null?(L=$=Y,o=F):$=$.next=Y,w|=H;if(O=O.next,O===null){if(O=f.shared.pending,O===null)break;H=O,O=H.next,H.next=null,f.lastBaseUpdate=H,f.shared.pending=null}}while(!0);if($===null&&(o=F),f.baseState=o,f.firstBaseUpdate=L,f.lastBaseUpdate=$,t=f.shared.interleaved,t!==null){f=t;do w|=f.lane,f=f.next;while(f!==t)}else y===null&&(f.shared.lanes=0);Ah|=w,e.lanes=w,e.memoizedState=F}}function Tk(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],f=a.callback;if(f!==null){if(a.callback=null,a=i,typeof f!="function")throw Error(qt(191,f));f.call(a)}}}var Jy={},$s=iu(Jy),sy=iu(Jy),ly=iu(Jy);function hh(e){if(e===Jy)throw Error(qt(174));return e}function XE(e,t){switch(Un(ly,t),Un(sy,e),Un($s,Jy),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dS(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dS(t,e)}Yn($s),Un($s,t)}function Od(){Yn($s),Yn(sy),Yn(ly)}function tB(e){hh(ly.current);var t=hh($s.current),i=dS(t,e.type);t!==i&&(Un(sy,e),Un($s,i))}function YE(e){sy.current===e&&(Yn($s),Yn(sy))}var oi=iu(0);function tx(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var bT=[];function KE(){for(var e=0;e<bT.length;e++)bT[e]._workInProgressVersionPrimary=null;bT.length=0}var D0=Dl.ReactCurrentDispatcher,wT=Dl.ReactCurrentBatchConfig,Sh=0,ai=null,Ei=null,Bi=null,rx=!1,jg=!1,cy=0,sV=0;function ao(){throw Error(qt(321))}function JE(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!ys(e[i],t[i]))return!1;return!0}function QE(e,t,i,a,f,y){if(Sh=y,ai=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D0.current=e===null||e.memoizedState===null?hV:fV,e=i(a,f),jg){y=0;do{if(jg=!1,cy=0,25<=y)throw Error(qt(301));y+=1,Bi=Ei=null,t.updateQueue=null,D0.current=dV,e=i(a,f)}while(jg)}if(D0.current=nx,t=Ei!==null&&Ei.next!==null,Sh=0,Bi=Ei=ai=null,rx=!1,t)throw Error(qt(300));return e}function eM(){var e=cy!==0;return cy=0,e}function zs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bi===null?ai.memoizedState=Bi=e:Bi=Bi.next=e,Bi}function Ba(){if(Ei===null){var e=ai.alternate;e=e!==null?e.memoizedState:null}else e=Ei.next;var t=Bi===null?ai.memoizedState:Bi.next;if(t!==null)Bi=t,Ei=e;else{if(e===null)throw Error(qt(310));Ei=e,e={memoizedState:Ei.memoizedState,baseState:Ei.baseState,baseQueue:Ei.baseQueue,queue:Ei.queue,next:null},Bi===null?ai.memoizedState=Bi=e:Bi=Bi.next=e}return Bi}function uy(e,t){return typeof t=="function"?t(e):t}function TT(e){var t=Ba(),i=t.queue;if(i===null)throw Error(qt(311));i.lastRenderedReducer=e;var a=Ei,f=a.baseQueue,y=i.pending;if(y!==null){if(f!==null){var w=f.next;f.next=y.next,y.next=w}a.baseQueue=f=y,i.pending=null}if(f!==null){y=f.next,a=a.baseState;var O=w=null,o=null,L=y;do{var $=L.lane;if((Sh&$)===$)o!==null&&(o=o.next={lane:0,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),a=L.hasEagerState?L.eagerState:e(a,L.action);else{var F={lane:$,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null};o===null?(O=o=F,w=a):o=o.next=F,ai.lanes|=$,Ah|=$}L=L.next}while(L!==null&&L!==y);o===null?w=a:o.next=O,ys(a,t.memoizedState)||(Fo=!0),t.memoizedState=a,t.baseState=w,t.baseQueue=o,i.lastRenderedState=a}if(e=i.interleaved,e!==null){f=e;do y=f.lane,ai.lanes|=y,Ah|=y,f=f.next;while(f!==e)}else f===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function ST(e){var t=Ba(),i=t.queue;if(i===null)throw Error(qt(311));i.lastRenderedReducer=e;var a=i.dispatch,f=i.pending,y=t.memoizedState;if(f!==null){i.pending=null;var w=f=f.next;do y=e(y,w.action),w=w.next;while(w!==f);ys(y,t.memoizedState)||(Fo=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),i.lastRenderedState=y}return[y,a]}function rB(){}function nB(e,t){var i=ai,a=Ba(),f=t(),y=!ys(a.memoizedState,f);if(y&&(a.memoizedState=f,Fo=!0),a=a.queue,tM(aB.bind(null,i,a,e),[e]),a.getSnapshot!==t||y||Bi!==null&&Bi.memoizedState.tag&1){if(i.flags|=2048,hy(9,oB.bind(null,i,a,f,t),void 0,null),Fi===null)throw Error(qt(349));Sh&30||iB(i,t,f)}return f}function iB(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=ai.updateQueue,t===null?(t={lastEffect:null,stores:null},ai.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function oB(e,t,i,a){t.value=i,t.getSnapshot=a,sB(t)&&lB(e)}function aB(e,t,i){return i(function(){sB(t)&&lB(e)})}function sB(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!ys(e,i)}catch{return!0}}function lB(e){var t=Pl(e,1);t!==null&&gs(t,e,1,-1)}function Sk(e){var t=zs();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uy,lastRenderedState:e},t.queue=e,e=e.dispatch=uV.bind(null,ai,e),[t.memoizedState,e]}function hy(e,t,i,a){return e={tag:e,create:t,destroy:i,deps:a,next:null},t=ai.updateQueue,t===null?(t={lastEffect:null,stores:null},ai.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(a=i.next,i.next=e,e.next=a,t.lastEffect=e)),e}function cB(){return Ba().memoizedState}function L0(e,t,i,a){var f=zs();ai.flags|=e,f.memoizedState=hy(1|t,i,void 0,a===void 0?null:a)}function y1(e,t,i,a){var f=Ba();a=a===void 0?null:a;var y=void 0;if(Ei!==null){var w=Ei.memoizedState;if(y=w.destroy,a!==null&&JE(a,w.deps)){f.memoizedState=hy(t,i,y,a);return}}ai.flags|=e,f.memoizedState=hy(1|t,i,y,a)}function Ak(e,t){return L0(8390656,8,e,t)}function tM(e,t){return y1(2048,8,e,t)}function uB(e,t){return y1(4,2,e,t)}function hB(e,t){return y1(4,4,e,t)}function fB(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function dB(e,t,i){return i=i!=null?i.concat([e]):null,y1(4,4,fB.bind(null,t,e),i)}function rM(){}function pB(e,t){var i=Ba();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&JE(t,a[1])?a[0]:(i.memoizedState=[e,t],e)}function mB(e,t){var i=Ba();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&JE(t,a[1])?a[0]:(e=e(),i.memoizedState=[e,t],e)}function gB(e,t,i){return Sh&21?(ys(i,t)||(i=b4(),ai.lanes|=i,Ah|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fo=!0),e.memoizedState=i)}function lV(e,t){var i=Pn;Pn=i!==0&&4>i?i:4,e(!0);var a=wT.transition;wT.transition={};try{e(!1),t()}finally{Pn=i,wT.transition=a}}function yB(){return Ba().memoizedState}function cV(e,t,i){var a=Jc(e);if(i={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null},_B(e))vB(t,i);else if(i=Q4(e,t,i,a),i!==null){var f=Eo();gs(i,e,a,f),xB(i,t,a)}}function uV(e,t,i){var a=Jc(e),f={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null};if(_B(e))vB(t,f);else{var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var w=t.lastRenderedState,O=y(w,i);if(f.hasEagerState=!0,f.eagerState=O,ys(O,w)){var o=t.interleaved;o===null?(f.next=f,HE(t)):(f.next=o.next,o.next=f),t.interleaved=f;return}}catch{}finally{}i=Q4(e,t,f,a),i!==null&&(f=Eo(),gs(i,e,a,f),xB(i,t,a))}}function _B(e){var t=e.alternate;return e===ai||t!==null&&t===ai}function vB(e,t){jg=rx=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function xB(e,t,i){if(i&4194240){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,DE(e,i)}}var nx={readContext:za,useCallback:ao,useContext:ao,useEffect:ao,useImperativeHandle:ao,useInsertionEffect:ao,useLayoutEffect:ao,useMemo:ao,useReducer:ao,useRef:ao,useState:ao,useDebugValue:ao,useDeferredValue:ao,useTransition:ao,useMutableSource:ao,useSyncExternalStore:ao,useId:ao,unstable_isNewReconciler:!1},hV={readContext:za,useCallback:function(e,t){return zs().memoizedState=[e,t===void 0?null:t],e},useContext:za,useEffect:Ak,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,L0(4194308,4,fB.bind(null,t,e),i)},useLayoutEffect:function(e,t){return L0(4194308,4,e,t)},useInsertionEffect:function(e,t){return L0(4,2,e,t)},useMemo:function(e,t){var i=zs();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var a=zs();return t=i!==void 0?i(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=cV.bind(null,ai,e),[a.memoizedState,e]},useRef:function(e){var t=zs();return e={current:e},t.memoizedState=e},useState:Sk,useDebugValue:rM,useDeferredValue:function(e){return zs().memoizedState=e},useTransition:function(){var e=Sk(!1),t=e[0];return e=lV.bind(null,e[1]),zs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var a=ai,f=zs();if(Qn){if(i===void 0)throw Error(qt(407));i=i()}else{if(i=t(),Fi===null)throw Error(qt(349));Sh&30||iB(a,t,i)}f.memoizedState=i;var y={value:i,getSnapshot:t};return f.queue=y,Ak(aB.bind(null,a,y,e),[e]),a.flags|=2048,hy(9,oB.bind(null,a,y,i,t),void 0,null),i},useId:function(){var e=zs(),t=Fi.identifierPrefix;if(Qn){var i=vl,a=_l;i=(a&~(1<<32-ms(a)-1)).toString(32)+i,t=":"+t+"R"+i,i=cy++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=sV++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},fV={readContext:za,useCallback:pB,useContext:za,useEffect:tM,useImperativeHandle:dB,useInsertionEffect:uB,useLayoutEffect:hB,useMemo:mB,useReducer:TT,useRef:cB,useState:function(){return TT(uy)},useDebugValue:rM,useDeferredValue:function(e){var t=Ba();return gB(t,Ei.memoizedState,e)},useTransition:function(){var e=TT(uy)[0],t=Ba().memoizedState;return[e,t]},useMutableSource:rB,useSyncExternalStore:nB,useId:yB,unstable_isNewReconciler:!1},dV={readContext:za,useCallback:pB,useContext:za,useEffect:tM,useImperativeHandle:dB,useInsertionEffect:uB,useLayoutEffect:hB,useMemo:mB,useReducer:ST,useRef:cB,useState:function(){return ST(uy)},useDebugValue:rM,useDeferredValue:function(e){var t=Ba();return Ei===null?t.memoizedState=e:gB(t,Ei.memoizedState,e)},useTransition:function(){var e=ST(uy)[0],t=Ba().memoizedState;return[e,t]},useMutableSource:rB,useSyncExternalStore:nB,useId:yB,unstable_isNewReconciler:!1};function ss(e,t){if(e&&e.defaultProps){t=si({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function LS(e,t,i,a){t=e.memoizedState,i=i(a,t),i=i==null?t:si({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var _1={isMounted:function(e){return(e=e._reactInternals)?Oh(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var a=Eo(),f=Jc(e),y=wl(a,f);y.payload=t,i!=null&&(y.callback=i),t=Yc(e,y,f),t!==null&&(gs(t,e,f,a),k0(t,e,f))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var a=Eo(),f=Jc(e),y=wl(a,f);y.tag=1,y.payload=t,i!=null&&(y.callback=i),t=Yc(e,y,f),t!==null&&(gs(t,e,f,a),k0(t,e,f))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Eo(),a=Jc(e),f=wl(i,a);f.tag=2,t!=null&&(f.callback=t),t=Yc(e,f,a),t!==null&&(gs(t,e,a,i),k0(t,e,a))}};function Ek(e,t,i,a,f,y,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,y,w):t.prototype&&t.prototype.isPureReactComponent?!ny(i,a)||!ny(f,y):!0}function bB(e,t,i){var a=!1,f=ru,y=t.contextType;return typeof y=="object"&&y!==null?y=za(y):(f=$o(t)?wh:ho.current,a=t.contextTypes,y=(a=a!=null)?Pd(e,f):ru),t=new t(i,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=_1,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=y),t}function Mk(e,t,i,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,a),t.state!==e&&_1.enqueueReplaceState(t,t.state,null)}function RS(e,t,i,a){var f=e.stateNode;f.props=i,f.state=e.memoizedState,f.refs={},ZE(e);var y=t.contextType;typeof y=="object"&&y!==null?f.context=za(y):(y=$o(t)?wh:ho.current,f.context=Pd(e,y)),f.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(LS(e,t,y,i),f.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(t=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),t!==f.state&&_1.enqueueReplaceState(f,f.state,null),ex(e,i,f,a),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function kd(e,t){try{var i="",a=t;do i+=$$(a),a=a.return;while(a);var f=i}catch(y){f=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:f,digest:null}}function AT(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function zS(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var pV=typeof WeakMap=="function"?WeakMap:Map;function wB(e,t,i){i=wl(-1,i),i.tag=3,i.payload={element:null};var a=t.value;return i.callback=function(){ox||(ox=!0,WS=a),zS(e,t)},i}function TB(e,t,i){i=wl(-1,i),i.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var f=t.value;i.payload=function(){return a(f)},i.callback=function(){zS(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(i.callback=function(){zS(e,t),typeof a!="function"&&(Kc===null?Kc=new Set([this]):Kc.add(this));var w=t.stack;this.componentDidCatch(t.value,{componentStack:w!==null?w:""})}),i}function Pk(e,t,i){var a=e.pingCache;if(a===null){a=e.pingCache=new pV;var f=new Set;a.set(t,f)}else f=a.get(t),f===void 0&&(f=new Set,a.set(t,f));f.has(i)||(f.add(i),e=PV.bind(null,e,t,i),t.then(e,e))}function Ik(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ck(e,t,i,a,f){return e.mode&1?(e.flags|=65536,e.lanes=f,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=wl(-1,1),t.tag=2,Yc(i,t,1))),i.lanes|=1),e)}var mV=Dl.ReactCurrentOwner,Fo=!1;function So(e,t,i,a){t.child=e===null?J4(t,null,i,a):Cd(t,e.child,i,a)}function Ok(e,t,i,a,f){i=i.render;var y=t.ref;return xd(t,f),a=QE(e,t,i,a,y,f),i=eM(),e!==null&&!Fo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Il(e,t,f)):(Qn&&i&&$E(t),t.flags|=1,So(e,t,a,f),t.child)}function kk(e,t,i,a,f){if(e===null){var y=i.type;return typeof y=="function"&&!uM(y)&&y.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=y,SB(e,t,y,a,f)):(e=F0(i.type,null,a,t,t.mode,f),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,!(e.lanes&f)){var w=y.memoizedProps;if(i=i.compare,i=i!==null?i:ny,i(w,a)&&e.ref===t.ref)return Il(e,t,f)}return t.flags|=1,e=Qc(y,a),e.ref=t.ref,e.return=t,t.child=e}function SB(e,t,i,a,f){if(e!==null){var y=e.memoizedProps;if(ny(y,a)&&e.ref===t.ref)if(Fo=!1,t.pendingProps=a=y,(e.lanes&f)!==0)e.flags&131072&&(Fo=!0);else return t.lanes=e.lanes,Il(e,t,f)}return BS(e,t,i,a,f)}function AB(e,t,i){var a=t.pendingProps,f=a.children,y=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Un(dd,oa),oa|=i;else{if(!(i&1073741824))return e=y!==null?y.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Un(dd,oa),oa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=y!==null?y.baseLanes:i,Un(dd,oa),oa|=a}else y!==null?(a=y.baseLanes|i,t.memoizedState=null):a=i,Un(dd,oa),oa|=a;return So(e,t,f,i),t.child}function EB(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function BS(e,t,i,a,f){var y=$o(i)?wh:ho.current;return y=Pd(t,y),xd(t,f),i=QE(e,t,i,a,y,f),a=eM(),e!==null&&!Fo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Il(e,t,f)):(Qn&&a&&$E(t),t.flags|=1,So(e,t,i,f),t.child)}function Dk(e,t,i,a,f){if($o(i)){var y=!0;X0(t)}else y=!1;if(xd(t,f),t.stateNode===null)R0(e,t),bB(t,i,a),RS(t,i,a,f),a=!0;else if(e===null){var w=t.stateNode,O=t.memoizedProps;w.props=O;var o=w.context,L=i.contextType;typeof L=="object"&&L!==null?L=za(L):(L=$o(i)?wh:ho.current,L=Pd(t,L));var $=i.getDerivedStateFromProps,F=typeof $=="function"||typeof w.getSnapshotBeforeUpdate=="function";F||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(O!==a||o!==L)&&Mk(t,w,a,L),Fc=!1;var H=t.memoizedState;w.state=H,ex(t,a,w,f),o=t.memoizedState,O!==a||H!==o||jo.current||Fc?(typeof $=="function"&&(LS(t,i,$,a),o=t.memoizedState),(O=Fc||Ek(t,i,O,a,H,o,L))?(F||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(t.flags|=4194308)):(typeof w.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=o),w.props=a,w.state=o,w.context=L,a=O):(typeof w.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{w=t.stateNode,eB(e,t),O=t.memoizedProps,L=t.type===t.elementType?O:ss(t.type,O),w.props=L,F=t.pendingProps,H=w.context,o=i.contextType,typeof o=="object"&&o!==null?o=za(o):(o=$o(i)?wh:ho.current,o=Pd(t,o));var Y=i.getDerivedStateFromProps;($=typeof Y=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(O!==F||H!==o)&&Mk(t,w,a,o),Fc=!1,H=t.memoizedState,w.state=H,ex(t,a,w,f);var oe=t.memoizedState;O!==F||H!==oe||jo.current||Fc?(typeof Y=="function"&&(LS(t,i,Y,a),oe=t.memoizedState),(L=Fc||Ek(t,i,L,a,H,oe,o)||!1)?($||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(a,oe,o),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(a,oe,o)),typeof w.componentDidUpdate=="function"&&(t.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof w.componentDidUpdate!="function"||O===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||O===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=oe),w.props=a,w.state=oe,w.context=o,a=L):(typeof w.componentDidUpdate!="function"||O===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||O===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),a=!1)}return FS(e,t,i,a,y,f)}function FS(e,t,i,a,f,y){EB(e,t);var w=(t.flags&128)!==0;if(!a&&!w)return f&&_k(t,i,!1),Il(e,t,y);a=t.stateNode,mV.current=t;var O=w&&typeof i.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&w?(t.child=Cd(t,e.child,null,y),t.child=Cd(t,null,O,y)):So(e,t,O,y),t.memoizedState=a.state,f&&_k(t,i,!0),t.child}function MB(e){var t=e.stateNode;t.pendingContext?yk(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yk(e,t.context,!1),XE(e,t.containerInfo)}function Lk(e,t,i,a,f){return Id(),VE(f),t.flags|=256,So(e,t,i,a),t.child}var NS={dehydrated:null,treeContext:null,retryLane:0};function jS(e){return{baseLanes:e,cachePool:null,transitions:null}}function PB(e,t,i){var a=t.pendingProps,f=oi.current,y=!1,w=(t.flags&128)!==0,O;if((O=w)||(O=e!==null&&e.memoizedState===null?!1:(f&2)!==0),O?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),Un(oi,f&1),e===null)return kS(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(w=a.children,e=a.fallback,y?(a=t.mode,y=t.child,w={mode:"hidden",children:w},!(a&1)&&y!==null?(y.childLanes=0,y.pendingProps=w):y=b1(w,a,0,null),e=_h(e,a,i,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=jS(i),t.memoizedState=NS,e):nM(t,w));if(f=e.memoizedState,f!==null&&(O=f.dehydrated,O!==null))return gV(e,t,w,a,O,f,i);if(y){y=a.fallback,w=t.mode,f=e.child,O=f.sibling;var o={mode:"hidden",children:a.children};return!(w&1)&&t.child!==f?(a=t.child,a.childLanes=0,a.pendingProps=o,t.deletions=null):(a=Qc(f,o),a.subtreeFlags=f.subtreeFlags&14680064),O!==null?y=Qc(O,y):(y=_h(y,w,i,null),y.flags|=2),y.return=t,a.return=t,a.sibling=y,t.child=a,a=y,y=t.child,w=e.child.memoizedState,w=w===null?jS(i):{baseLanes:w.baseLanes|i,cachePool:null,transitions:w.transitions},y.memoizedState=w,y.childLanes=e.childLanes&~i,t.memoizedState=NS,a}return y=e.child,e=y.sibling,a=Qc(y,{mode:"visible",children:a.children}),!(t.mode&1)&&(a.lanes=i),a.return=t,a.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=a,t.memoizedState=null,a}function nM(e,t){return t=b1({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function c0(e,t,i,a){return a!==null&&VE(a),Cd(t,e.child,null,i),e=nM(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function gV(e,t,i,a,f,y,w){if(i)return t.flags&256?(t.flags&=-257,a=AT(Error(qt(422))),c0(e,t,w,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=a.fallback,f=t.mode,a=b1({mode:"visible",children:a.children},f,0,null),y=_h(y,f,w,null),y.flags|=2,a.return=t,y.return=t,a.sibling=y,t.child=a,t.mode&1&&Cd(t,e.child,null,w),t.child.memoizedState=jS(w),t.memoizedState=NS,y);if(!(t.mode&1))return c0(e,t,w,null);if(f.data==="$!"){if(a=f.nextSibling&&f.nextSibling.dataset,a)var O=a.dgst;return a=O,y=Error(qt(419)),a=AT(y,a,void 0),c0(e,t,w,a)}if(O=(w&e.childLanes)!==0,Fo||O){if(a=Fi,a!==null){switch(w&-w){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(a.suspendedLanes|w)?0:f,f!==0&&f!==y.retryLane&&(y.retryLane=f,Pl(e,f),gs(a,e,f,-1))}return cM(),a=AT(Error(qt(421))),c0(e,t,w,a)}return f.data==="$?"?(t.flags|=128,t.child=e.child,t=IV.bind(null,e),f._reactRetry=t,null):(e=y.treeContext,la=Xc(f.nextSibling),ca=t,Qn=!0,fs=null,e!==null&&(Ia[Ca++]=_l,Ia[Ca++]=vl,Ia[Ca++]=Th,_l=e.id,vl=e.overflow,Th=t),t=nM(t,a.children),t.flags|=4096,t)}function Rk(e,t,i){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),DS(e.return,t,i)}function ET(e,t,i,a,f){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:i,tailMode:f}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=a,y.tail=i,y.tailMode=f)}function IB(e,t,i){var a=t.pendingProps,f=a.revealOrder,y=a.tail;if(So(e,t,a.children,i),a=oi.current,a&2)a=a&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Rk(e,i,t);else if(e.tag===19)Rk(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(Un(oi,a),!(t.mode&1))t.memoizedState=null;else switch(f){case"forwards":for(i=t.child,f=null;i!==null;)e=i.alternate,e!==null&&tx(e)===null&&(f=i),i=i.sibling;i=f,i===null?(f=t.child,t.child=null):(f=i.sibling,i.sibling=null),ET(t,!1,f,i,y);break;case"backwards":for(i=null,f=t.child,t.child=null;f!==null;){if(e=f.alternate,e!==null&&tx(e)===null){t.child=f;break}e=f.sibling,f.sibling=i,i=f,f=e}ET(t,!0,i,null,y);break;case"together":ET(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function R0(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Il(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Ah|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(qt(153));if(t.child!==null){for(e=t.child,i=Qc(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Qc(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function yV(e,t,i){switch(t.tag){case 3:MB(t),Id();break;case 5:tB(t);break;case 1:$o(t.type)&&X0(t);break;case 4:XE(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,f=t.memoizedProps.value;Un(J0,a._currentValue),a._currentValue=f;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(Un(oi,oi.current&1),t.flags|=128,null):i&t.child.childLanes?PB(e,t,i):(Un(oi,oi.current&1),e=Il(e,t,i),e!==null?e.sibling:null);Un(oi,oi.current&1);break;case 19:if(a=(i&t.childLanes)!==0,e.flags&128){if(a)return IB(e,t,i);t.flags|=128}if(f=t.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Un(oi,oi.current),a)break;return null;case 22:case 23:return t.lanes=0,AB(e,t,i)}return Il(e,t,i)}var CB,$S,OB,kB;CB=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};$S=function(){};OB=function(e,t,i,a){var f=e.memoizedProps;if(f!==a){e=t.stateNode,hh($s.current);var y=null;switch(i){case"input":f=cS(e,f),a=cS(e,a),y=[];break;case"select":f=si({},f,{value:void 0}),a=si({},a,{value:void 0}),y=[];break;case"textarea":f=fS(e,f),a=fS(e,a),y=[];break;default:typeof f.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=H0)}pS(i,a);var w;i=null;for(L in f)if(!a.hasOwnProperty(L)&&f.hasOwnProperty(L)&&f[L]!=null)if(L==="style"){var O=f[L];for(w in O)O.hasOwnProperty(w)&&(i||(i={}),i[w]="")}else L!=="dangerouslySetInnerHTML"&&L!=="children"&&L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(Yg.hasOwnProperty(L)?y||(y=[]):(y=y||[]).push(L,null));for(L in a){var o=a[L];if(O=f!=null?f[L]:void 0,a.hasOwnProperty(L)&&o!==O&&(o!=null||O!=null))if(L==="style")if(O){for(w in O)!O.hasOwnProperty(w)||o&&o.hasOwnProperty(w)||(i||(i={}),i[w]="");for(w in o)o.hasOwnProperty(w)&&O[w]!==o[w]&&(i||(i={}),i[w]=o[w])}else i||(y||(y=[]),y.push(L,i)),i=o;else L==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,O=O?O.__html:void 0,o!=null&&O!==o&&(y=y||[]).push(L,o)):L==="children"?typeof o!="string"&&typeof o!="number"||(y=y||[]).push(L,""+o):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&(Yg.hasOwnProperty(L)?(o!=null&&L==="onScroll"&&Hn("scroll",e),y||O===o||(y=[])):(y=y||[]).push(L,o))}i&&(y=y||[]).push("style",i);var L=y;(t.updateQueue=L)&&(t.flags|=4)}};kB=function(e,t,i,a){i!==a&&(t.flags|=4)};function yg(e,t){if(!Qn)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function so(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,a=0;if(t)for(var f=e.child;f!==null;)i|=f.lanes|f.childLanes,a|=f.subtreeFlags&14680064,a|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)i|=f.lanes|f.childLanes,a|=f.subtreeFlags,a|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=a,e.childLanes=i,t}function _V(e,t,i){var a=t.pendingProps;switch(UE(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return so(t),null;case 1:return $o(t.type)&&Z0(),so(t),null;case 3:return a=t.stateNode,Od(),Yn(jo),Yn(ho),KE(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(s0(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,fs!==null&&(XS(fs),fs=null))),$S(e,t),so(t),null;case 5:YE(t);var f=hh(ly.current);if(i=t.type,e!==null&&t.stateNode!=null)OB(e,t,i,a,f),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(qt(166));return so(t),null}if(e=hh($s.current),s0(t)){a=t.stateNode,i=t.type;var y=t.memoizedProps;switch(a[Bs]=t,a[ay]=y,e=(t.mode&1)!==0,i){case"dialog":Hn("cancel",a),Hn("close",a);break;case"iframe":case"object":case"embed":Hn("load",a);break;case"video":case"audio":for(f=0;f<Dg.length;f++)Hn(Dg[f],a);break;case"source":Hn("error",a);break;case"img":case"image":case"link":Hn("error",a),Hn("load",a);break;case"details":Hn("toggle",a);break;case"input":GO(a,y),Hn("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!y.multiple},Hn("invalid",a);break;case"textarea":WO(a,y),Hn("invalid",a)}pS(i,y),f=null;for(var w in y)if(y.hasOwnProperty(w)){var O=y[w];w==="children"?typeof O=="string"?a.textContent!==O&&(y.suppressHydrationWarning!==!0&&a0(a.textContent,O,e),f=["children",O]):typeof O=="number"&&a.textContent!==""+O&&(y.suppressHydrationWarning!==!0&&a0(a.textContent,O,e),f=["children",""+O]):Yg.hasOwnProperty(w)&&O!=null&&w==="onScroll"&&Hn("scroll",a)}switch(i){case"input":Jv(a),qO(a,y,!0);break;case"textarea":Jv(a),HO(a);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(a.onclick=H0)}a=f,t.updateQueue=a,a!==null&&(t.flags|=4)}else{w=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=a4(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=w.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=w.createElement(i,{is:a.is}):(e=w.createElement(i),i==="select"&&(w=e,a.multiple?w.multiple=!0:a.size&&(w.size=a.size))):e=w.createElementNS(e,i),e[Bs]=t,e[ay]=a,CB(e,t,!1,!1),t.stateNode=e;e:{switch(w=mS(i,a),i){case"dialog":Hn("cancel",e),Hn("close",e),f=a;break;case"iframe":case"object":case"embed":Hn("load",e),f=a;break;case"video":case"audio":for(f=0;f<Dg.length;f++)Hn(Dg[f],e);f=a;break;case"source":Hn("error",e),f=a;break;case"img":case"image":case"link":Hn("error",e),Hn("load",e),f=a;break;case"details":Hn("toggle",e),f=a;break;case"input":GO(e,a),f=cS(e,a),Hn("invalid",e);break;case"option":f=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},f=si({},a,{value:void 0}),Hn("invalid",e);break;case"textarea":WO(e,a),f=fS(e,a),Hn("invalid",e);break;default:f=a}pS(i,f),O=f;for(y in O)if(O.hasOwnProperty(y)){var o=O[y];y==="style"?c4(e,o):y==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&s4(e,o)):y==="children"?typeof o=="string"?(i!=="textarea"||o!=="")&&Kg(e,o):typeof o=="number"&&Kg(e,""+o):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(Yg.hasOwnProperty(y)?o!=null&&y==="onScroll"&&Hn("scroll",e):o!=null&&ME(e,y,o,w))}switch(i){case"input":Jv(e),qO(e,a,!1);break;case"textarea":Jv(e),HO(e);break;case"option":a.value!=null&&e.setAttribute("value",""+tu(a.value));break;case"select":e.multiple=!!a.multiple,y=a.value,y!=null?gd(e,!!a.multiple,y,!1):a.defaultValue!=null&&gd(e,!!a.multiple,a.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=H0)}switch(i){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return so(t),null;case 6:if(e&&t.stateNode!=null)kB(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(qt(166));if(i=hh(ly.current),hh($s.current),s0(t)){if(a=t.stateNode,i=t.memoizedProps,a[Bs]=t,(y=a.nodeValue!==i)&&(e=ca,e!==null))switch(e.tag){case 3:a0(a.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&a0(a.nodeValue,i,(e.mode&1)!==0)}y&&(t.flags|=4)}else a=(i.nodeType===9?i:i.ownerDocument).createTextNode(a),a[Bs]=t,t.stateNode=a}return so(t),null;case 13:if(Yn(oi),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Qn&&la!==null&&t.mode&1&&!(t.flags&128))Y4(),Id(),t.flags|=98560,y=!1;else if(y=s0(t),a!==null&&a.dehydrated!==null){if(e===null){if(!y)throw Error(qt(318));if(y=t.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(qt(317));y[Bs]=t}else Id(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;so(t),y=!1}else fs!==null&&(XS(fs),fs=null),y=!0;if(!y)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,t.mode&1&&(e===null||oi.current&1?Mi===0&&(Mi=3):cM())),t.updateQueue!==null&&(t.flags|=4),so(t),null);case 4:return Od(),$S(e,t),e===null&&iy(t.stateNode.containerInfo),so(t),null;case 10:return WE(t.type._context),so(t),null;case 17:return $o(t.type)&&Z0(),so(t),null;case 19:if(Yn(oi),y=t.memoizedState,y===null)return so(t),null;if(a=(t.flags&128)!==0,w=y.rendering,w===null)if(a)yg(y,!1);else{if(Mi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(w=tx(e),w!==null){for(t.flags|=128,yg(y,!1),a=w.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=i,i=t.child;i!==null;)y=i,e=a,y.flags&=14680066,w=y.alternate,w===null?(y.childLanes=0,y.lanes=e,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=w.childLanes,y.lanes=w.lanes,y.child=w.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=w.memoizedProps,y.memoizedState=w.memoizedState,y.updateQueue=w.updateQueue,y.type=w.type,e=w.dependencies,y.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Un(oi,oi.current&1|2),t.child}e=e.sibling}y.tail!==null&&gi()>Dd&&(t.flags|=128,a=!0,yg(y,!1),t.lanes=4194304)}else{if(!a)if(e=tx(w),e!==null){if(t.flags|=128,a=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),yg(y,!0),y.tail===null&&y.tailMode==="hidden"&&!w.alternate&&!Qn)return so(t),null}else 2*gi()-y.renderingStartTime>Dd&&i!==1073741824&&(t.flags|=128,a=!0,yg(y,!1),t.lanes=4194304);y.isBackwards?(w.sibling=t.child,t.child=w):(i=y.last,i!==null?i.sibling=w:t.child=w,y.last=w)}return y.tail!==null?(t=y.tail,y.rendering=t,y.tail=t.sibling,y.renderingStartTime=gi(),t.sibling=null,i=oi.current,Un(oi,a?i&1|2:i&1),t):(so(t),null);case 22:case 23:return lM(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&t.mode&1?oa&1073741824&&(so(t),t.subtreeFlags&6&&(t.flags|=8192)):so(t),null;case 24:return null;case 25:return null}throw Error(qt(156,t.tag))}function vV(e,t){switch(UE(t),t.tag){case 1:return $o(t.type)&&Z0(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Od(),Yn(jo),Yn(ho),KE(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return YE(t),null;case 13:if(Yn(oi),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(qt(340));Id()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Yn(oi),null;case 4:return Od(),null;case 10:return WE(t.type._context),null;case 22:case 23:return lM(),null;case 24:return null;default:return null}}var u0=!1,co=!1,xV=typeof WeakSet=="function"?WeakSet:Set,fr=null;function fd(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(a){ui(e,t,a)}else i.current=null}function US(e,t,i){try{i()}catch(a){ui(e,t,a)}}var zk=!1;function bV(e,t){if(AS=G0,e=B4(),jE(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var a=i.getSelection&&i.getSelection();if(a&&a.rangeCount!==0){i=a.anchorNode;var f=a.anchorOffset,y=a.focusNode;a=a.focusOffset;try{i.nodeType,y.nodeType}catch{i=null;break e}var w=0,O=-1,o=-1,L=0,$=0,F=e,H=null;t:for(;;){for(var Y;F!==i||f!==0&&F.nodeType!==3||(O=w+f),F!==y||a!==0&&F.nodeType!==3||(o=w+a),F.nodeType===3&&(w+=F.nodeValue.length),(Y=F.firstChild)!==null;)H=F,F=Y;for(;;){if(F===e)break t;if(H===i&&++L===f&&(O=w),H===y&&++$===a&&(o=w),(Y=F.nextSibling)!==null)break;F=H,H=F.parentNode}F=Y}i=O===-1||o===-1?null:{start:O,end:o}}else i=null}i=i||{start:0,end:0}}else i=null;for(ES={focusedElem:e,selectionRange:i},G0=!1,fr=t;fr!==null;)if(t=fr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,fr=e;else for(;fr!==null;){t=fr;try{var oe=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(oe!==null){var te=oe.memoizedProps,ie=oe.memoizedState,ae=t.stateNode,J=ae.getSnapshotBeforeUpdate(t.elementType===t.type?te:ss(t.type,te),ie);ae.__reactInternalSnapshotBeforeUpdate=J}break;case 3:var ue=t.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(qt(163))}}catch(le){ui(t,t.return,le)}if(e=t.sibling,e!==null){e.return=t.return,fr=e;break}fr=t.return}return oe=zk,zk=!1,oe}function $g(e,t,i){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var f=a=a.next;do{if((f.tag&e)===e){var y=f.destroy;f.destroy=void 0,y!==void 0&&US(t,i,y)}f=f.next}while(f!==a)}}function v1(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var a=i.create;i.destroy=a()}i=i.next}while(i!==t)}}function VS(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function DB(e){var t=e.alternate;t!==null&&(e.alternate=null,DB(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Bs],delete t[ay],delete t[IS],delete t[nV],delete t[iV])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function LB(e){return e.tag===5||e.tag===3||e.tag===4}function Bk(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||LB(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function GS(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=H0));else if(a!==4&&(e=e.child,e!==null))for(GS(e,t,i),e=e.sibling;e!==null;)GS(e,t,i),e=e.sibling}function qS(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(qS(e,t,i),e=e.sibling;e!==null;)qS(e,t,i),e=e.sibling}var Zi=null,ls=!1;function Rc(e,t,i){for(i=i.child;i!==null;)RB(e,t,i),i=i.sibling}function RB(e,t,i){if(js&&typeof js.onCommitFiberUnmount=="function")try{js.onCommitFiberUnmount(h1,i)}catch{}switch(i.tag){case 5:co||fd(i,t);case 6:var a=Zi,f=ls;Zi=null,Rc(e,t,i),Zi=a,ls=f,Zi!==null&&(ls?(e=Zi,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Zi.removeChild(i.stateNode));break;case 18:Zi!==null&&(ls?(e=Zi,i=i.stateNode,e.nodeType===8?vT(e.parentNode,i):e.nodeType===1&&vT(e,i),ty(e)):vT(Zi,i.stateNode));break;case 4:a=Zi,f=ls,Zi=i.stateNode.containerInfo,ls=!0,Rc(e,t,i),Zi=a,ls=f;break;case 0:case 11:case 14:case 15:if(!co&&(a=i.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){f=a=a.next;do{var y=f,w=y.destroy;y=y.tag,w!==void 0&&(y&2||y&4)&&US(i,t,w),f=f.next}while(f!==a)}Rc(e,t,i);break;case 1:if(!co&&(fd(i,t),a=i.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=i.memoizedProps,a.state=i.memoizedState,a.componentWillUnmount()}catch(O){ui(i,t,O)}Rc(e,t,i);break;case 21:Rc(e,t,i);break;case 22:i.mode&1?(co=(a=co)||i.memoizedState!==null,Rc(e,t,i),co=a):Rc(e,t,i);break;default:Rc(e,t,i)}}function Fk(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new xV),t.forEach(function(a){var f=CV.bind(null,e,a);i.has(a)||(i.add(a),a.then(f,f))})}}function os(e,t){var i=t.deletions;if(i!==null)for(var a=0;a<i.length;a++){var f=i[a];try{var y=e,w=t,O=w;e:for(;O!==null;){switch(O.tag){case 5:Zi=O.stateNode,ls=!1;break e;case 3:Zi=O.stateNode.containerInfo,ls=!0;break e;case 4:Zi=O.stateNode.containerInfo,ls=!0;break e}O=O.return}if(Zi===null)throw Error(qt(160));RB(y,w,f),Zi=null,ls=!1;var o=f.alternate;o!==null&&(o.return=null),f.return=null}catch(L){ui(f,t,L)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)zB(t,e),t=t.sibling}function zB(e,t){var i=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(os(t,e),Rs(e),a&4){try{$g(3,e,e.return),v1(3,e)}catch(te){ui(e,e.return,te)}try{$g(5,e,e.return)}catch(te){ui(e,e.return,te)}}break;case 1:os(t,e),Rs(e),a&512&&i!==null&&fd(i,i.return);break;case 5:if(os(t,e),Rs(e),a&512&&i!==null&&fd(i,i.return),e.flags&32){var f=e.stateNode;try{Kg(f,"")}catch(te){ui(e,e.return,te)}}if(a&4&&(f=e.stateNode,f!=null)){var y=e.memoizedProps,w=i!==null?i.memoizedProps:y,O=e.type,o=e.updateQueue;if(e.updateQueue=null,o!==null)try{O==="input"&&y.type==="radio"&&y.name!=null&&i4(f,y),mS(O,w);var L=mS(O,y);for(w=0;w<o.length;w+=2){var $=o[w],F=o[w+1];$==="style"?c4(f,F):$==="dangerouslySetInnerHTML"?s4(f,F):$==="children"?Kg(f,F):ME(f,$,F,L)}switch(O){case"input":uS(f,y);break;case"textarea":o4(f,y);break;case"select":var H=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!y.multiple;var Y=y.value;Y!=null?gd(f,!!y.multiple,Y,!1):H!==!!y.multiple&&(y.defaultValue!=null?gd(f,!!y.multiple,y.defaultValue,!0):gd(f,!!y.multiple,y.multiple?[]:"",!1))}f[ay]=y}catch(te){ui(e,e.return,te)}}break;case 6:if(os(t,e),Rs(e),a&4){if(e.stateNode===null)throw Error(qt(162));f=e.stateNode,y=e.memoizedProps;try{f.nodeValue=y}catch(te){ui(e,e.return,te)}}break;case 3:if(os(t,e),Rs(e),a&4&&i!==null&&i.memoizedState.isDehydrated)try{ty(t.containerInfo)}catch(te){ui(e,e.return,te)}break;case 4:os(t,e),Rs(e);break;case 13:os(t,e),Rs(e),f=e.child,f.flags&8192&&(y=f.memoizedState!==null,f.stateNode.isHidden=y,!y||f.alternate!==null&&f.alternate.memoizedState!==null||(aM=gi())),a&4&&Fk(e);break;case 22:if($=i!==null&&i.memoizedState!==null,e.mode&1?(co=(L=co)||$,os(t,e),co=L):os(t,e),Rs(e),a&8192){if(L=e.memoizedState!==null,(e.stateNode.isHidden=L)&&!$&&e.mode&1)for(fr=e,$=e.child;$!==null;){for(F=fr=$;fr!==null;){switch(H=fr,Y=H.child,H.tag){case 0:case 11:case 14:case 15:$g(4,H,H.return);break;case 1:fd(H,H.return);var oe=H.stateNode;if(typeof oe.componentWillUnmount=="function"){a=H,i=H.return;try{t=a,oe.props=t.memoizedProps,oe.state=t.memoizedState,oe.componentWillUnmount()}catch(te){ui(a,i,te)}}break;case 5:fd(H,H.return);break;case 22:if(H.memoizedState!==null){jk(F);continue}}Y!==null?(Y.return=H,fr=Y):jk(F)}$=$.sibling}e:for($=null,F=e;;){if(F.tag===5){if($===null){$=F;try{f=F.stateNode,L?(y=f.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(O=F.stateNode,o=F.memoizedProps.style,w=o!=null&&o.hasOwnProperty("display")?o.display:null,O.style.display=l4("display",w))}catch(te){ui(e,e.return,te)}}}else if(F.tag===6){if($===null)try{F.stateNode.nodeValue=L?"":F.memoizedProps}catch(te){ui(e,e.return,te)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===e)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===e)break e;for(;F.sibling===null;){if(F.return===null||F.return===e)break e;$===F&&($=null),F=F.return}$===F&&($=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:os(t,e),Rs(e),a&4&&Fk(e);break;case 21:break;default:os(t,e),Rs(e)}}function Rs(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(LB(i)){var a=i;break e}i=i.return}throw Error(qt(160))}switch(a.tag){case 5:var f=a.stateNode;a.flags&32&&(Kg(f,""),a.flags&=-33);var y=Bk(e);qS(e,y,f);break;case 3:case 4:var w=a.stateNode.containerInfo,O=Bk(e);GS(e,O,w);break;default:throw Error(qt(161))}}catch(o){ui(e,e.return,o)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function wV(e,t,i){fr=e,BB(e)}function BB(e,t,i){for(var a=(e.mode&1)!==0;fr!==null;){var f=fr,y=f.child;if(f.tag===22&&a){var w=f.memoizedState!==null||u0;if(!w){var O=f.alternate,o=O!==null&&O.memoizedState!==null||co;O=u0;var L=co;if(u0=w,(co=o)&&!L)for(fr=f;fr!==null;)w=fr,o=w.child,w.tag===22&&w.memoizedState!==null?$k(f):o!==null?(o.return=w,fr=o):$k(f);for(;y!==null;)fr=y,BB(y),y=y.sibling;fr=f,u0=O,co=L}Nk(e)}else f.subtreeFlags&8772&&y!==null?(y.return=f,fr=y):Nk(e)}}function Nk(e){for(;fr!==null;){var t=fr;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:co||v1(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!co)if(i===null)a.componentDidMount();else{var f=t.elementType===t.type?i.memoizedProps:ss(t.type,i.memoizedProps);a.componentDidUpdate(f,i.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&Tk(t,y,a);break;case 3:var w=t.updateQueue;if(w!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}Tk(t,w,i)}break;case 5:var O=t.stateNode;if(i===null&&t.flags&4){i=O;var o=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&i.focus();break;case"img":o.src&&(i.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var L=t.alternate;if(L!==null){var $=L.memoizedState;if($!==null){var F=$.dehydrated;F!==null&&ty(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(qt(163))}co||t.flags&512&&VS(t)}catch(H){ui(t,t.return,H)}}if(t===e){fr=null;break}if(i=t.sibling,i!==null){i.return=t.return,fr=i;break}fr=t.return}}function jk(e){for(;fr!==null;){var t=fr;if(t===e){fr=null;break}var i=t.sibling;if(i!==null){i.return=t.return,fr=i;break}fr=t.return}}function $k(e){for(;fr!==null;){var t=fr;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{v1(4,t)}catch(o){ui(t,i,o)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var f=t.return;try{a.componentDidMount()}catch(o){ui(t,f,o)}}var y=t.return;try{VS(t)}catch(o){ui(t,y,o)}break;case 5:var w=t.return;try{VS(t)}catch(o){ui(t,w,o)}}}catch(o){ui(t,t.return,o)}if(t===e){fr=null;break}var O=t.sibling;if(O!==null){O.return=t.return,fr=O;break}fr=t.return}}var TV=Math.ceil,ix=Dl.ReactCurrentDispatcher,iM=Dl.ReactCurrentOwner,Da=Dl.ReactCurrentBatchConfig,gn=0,Fi=null,xi=null,Ki=0,oa=0,dd=iu(0),Mi=0,fy=null,Ah=0,x1=0,oM=0,Ug=null,Bo=null,aM=0,Dd=1/0,gl=null,ox=!1,WS=null,Kc=null,h0=!1,Vc=null,ax=0,Vg=0,HS=null,z0=-1,B0=0;function Eo(){return gn&6?gi():z0!==-1?z0:z0=gi()}function Jc(e){return e.mode&1?gn&2&&Ki!==0?Ki&-Ki:aV.transition!==null?(B0===0&&(B0=b4()),B0):(e=Pn,e!==0||(e=window.event,e=e===void 0?16:P4(e.type)),e):1}function gs(e,t,i,a){if(50<Vg)throw Vg=0,HS=null,Error(qt(185));Xy(e,i,a),(!(gn&2)||e!==Fi)&&(e===Fi&&(!(gn&2)&&(x1|=i),Mi===4&&$c(e,Ki)),Uo(e,a),i===1&&gn===0&&!(t.mode&1)&&(Dd=gi()+500,g1&&ou()))}function Uo(e,t){var i=e.callbackNode;aU(e,t);var a=V0(e,e===Fi?Ki:0);if(a===0)i!==null&&YO(i),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(i!=null&&YO(i),t===1)e.tag===0?oV(Uk.bind(null,e)):H4(Uk.bind(null,e)),tV(function(){!(gn&6)&&ou()}),i=null;else{switch(w4(a)){case 1:i=kE;break;case 4:i=v4;break;case 16:i=U0;break;case 536870912:i=x4;break;default:i=U0}i=qB(i,FB.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function FB(e,t){if(z0=-1,B0=0,gn&6)throw Error(qt(327));var i=e.callbackNode;if(bd()&&e.callbackNode!==i)return null;var a=V0(e,e===Fi?Ki:0);if(a===0)return null;if(a&30||a&e.expiredLanes||t)t=sx(e,a);else{t=a;var f=gn;gn|=2;var y=jB();(Fi!==e||Ki!==t)&&(gl=null,Dd=gi()+500,yh(e,t));do try{EV();break}catch(O){NB(e,O)}while(!0);qE(),ix.current=y,gn=f,xi!==null?t=0:(Fi=null,Ki=0,t=Mi)}if(t!==0){if(t===2&&(f=xS(e),f!==0&&(a=f,t=ZS(e,f))),t===1)throw i=fy,yh(e,0),$c(e,a),Uo(e,gi()),i;if(t===6)$c(e,a);else{if(f=e.current.alternate,!(a&30)&&!SV(f)&&(t=sx(e,a),t===2&&(y=xS(e),y!==0&&(a=y,t=ZS(e,y))),t===1))throw i=fy,yh(e,0),$c(e,a),Uo(e,gi()),i;switch(e.finishedWork=f,e.finishedLanes=a,t){case 0:case 1:throw Error(qt(345));case 2:oh(e,Bo,gl);break;case 3:if($c(e,a),(a&130023424)===a&&(t=aM+500-gi(),10<t)){if(V0(e,0)!==0)break;if(f=e.suspendedLanes,(f&a)!==a){Eo(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=PS(oh.bind(null,e,Bo,gl),t);break}oh(e,Bo,gl);break;case 4:if($c(e,a),(a&4194240)===a)break;for(t=e.eventTimes,f=-1;0<a;){var w=31-ms(a);y=1<<w,w=t[w],w>f&&(f=w),a&=~y}if(a=f,a=gi()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*TV(a/1960))-a,10<a){e.timeoutHandle=PS(oh.bind(null,e,Bo,gl),a);break}oh(e,Bo,gl);break;case 5:oh(e,Bo,gl);break;default:throw Error(qt(329))}}}return Uo(e,gi()),e.callbackNode===i?FB.bind(null,e):null}function ZS(e,t){var i=Ug;return e.current.memoizedState.isDehydrated&&(yh(e,t).flags|=256),e=sx(e,t),e!==2&&(t=Bo,Bo=i,t!==null&&XS(t)),e}function XS(e){Bo===null?Bo=e:Bo.push.apply(Bo,e)}function SV(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var a=0;a<i.length;a++){var f=i[a],y=f.getSnapshot;f=f.value;try{if(!ys(y(),f))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function $c(e,t){for(t&=~oM,t&=~x1,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ms(t),a=1<<i;e[i]=-1,t&=~a}}function Uk(e){if(gn&6)throw Error(qt(327));bd();var t=V0(e,0);if(!(t&1))return Uo(e,gi()),null;var i=sx(e,t);if(e.tag!==0&&i===2){var a=xS(e);a!==0&&(t=a,i=ZS(e,a))}if(i===1)throw i=fy,yh(e,0),$c(e,t),Uo(e,gi()),i;if(i===6)throw Error(qt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,oh(e,Bo,gl),Uo(e,gi()),null}function sM(e,t){var i=gn;gn|=1;try{return e(t)}finally{gn=i,gn===0&&(Dd=gi()+500,g1&&ou())}}function Eh(e){Vc!==null&&Vc.tag===0&&!(gn&6)&&bd();var t=gn;gn|=1;var i=Da.transition,a=Pn;try{if(Da.transition=null,Pn=1,e)return e()}finally{Pn=a,Da.transition=i,gn=t,!(gn&6)&&ou()}}function lM(){oa=dd.current,Yn(dd)}function yh(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,eV(i)),xi!==null)for(i=xi.return;i!==null;){var a=i;switch(UE(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Z0();break;case 3:Od(),Yn(jo),Yn(ho),KE();break;case 5:YE(a);break;case 4:Od();break;case 13:Yn(oi);break;case 19:Yn(oi);break;case 10:WE(a.type._context);break;case 22:case 23:lM()}i=i.return}if(Fi=e,xi=e=Qc(e.current,null),Ki=oa=t,Mi=0,fy=null,oM=x1=Ah=0,Bo=Ug=null,uh!==null){for(t=0;t<uh.length;t++)if(i=uh[t],a=i.interleaved,a!==null){i.interleaved=null;var f=a.next,y=i.pending;if(y!==null){var w=y.next;y.next=f,a.next=w}i.pending=a}uh=null}return e}function NB(e,t){do{var i=xi;try{if(qE(),D0.current=nx,rx){for(var a=ai.memoizedState;a!==null;){var f=a.queue;f!==null&&(f.pending=null),a=a.next}rx=!1}if(Sh=0,Bi=Ei=ai=null,jg=!1,cy=0,iM.current=null,i===null||i.return===null){Mi=1,fy=t,xi=null;break}e:{var y=e,w=i.return,O=i,o=t;if(t=Ki,O.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var L=o,$=O,F=$.tag;if(!($.mode&1)&&(F===0||F===11||F===15)){var H=$.alternate;H?($.updateQueue=H.updateQueue,$.memoizedState=H.memoizedState,$.lanes=H.lanes):($.updateQueue=null,$.memoizedState=null)}var Y=Ik(w);if(Y!==null){Y.flags&=-257,Ck(Y,w,O,y,t),Y.mode&1&&Pk(y,L,t),t=Y,o=L;var oe=t.updateQueue;if(oe===null){var te=new Set;te.add(o),t.updateQueue=te}else oe.add(o);break e}else{if(!(t&1)){Pk(y,L,t),cM();break e}o=Error(qt(426))}}else if(Qn&&O.mode&1){var ie=Ik(w);if(ie!==null){!(ie.flags&65536)&&(ie.flags|=256),Ck(ie,w,O,y,t),VE(kd(o,O));break e}}y=o=kd(o,O),Mi!==4&&(Mi=2),Ug===null?Ug=[y]:Ug.push(y),y=w;do{switch(y.tag){case 3:y.flags|=65536,t&=-t,y.lanes|=t;var ae=wB(y,o,t);wk(y,ae);break e;case 1:O=o;var J=y.type,ue=y.stateNode;if(!(y.flags&128)&&(typeof J.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Kc===null||!Kc.has(ue)))){y.flags|=65536,t&=-t,y.lanes|=t;var le=TB(y,O,t);wk(y,le);break e}}y=y.return}while(y!==null)}UB(i)}catch(se){t=se,xi===i&&i!==null&&(xi=i=i.return);continue}break}while(!0)}function jB(){var e=ix.current;return ix.current=nx,e===null?nx:e}function cM(){(Mi===0||Mi===3||Mi===2)&&(Mi=4),Fi===null||!(Ah&268435455)&&!(x1&268435455)||$c(Fi,Ki)}function sx(e,t){var i=gn;gn|=2;var a=jB();(Fi!==e||Ki!==t)&&(gl=null,yh(e,t));do try{AV();break}catch(f){NB(e,f)}while(!0);if(qE(),gn=i,ix.current=a,xi!==null)throw Error(qt(261));return Fi=null,Ki=0,Mi}function AV(){for(;xi!==null;)$B(xi)}function EV(){for(;xi!==null&&!K$();)$B(xi)}function $B(e){var t=GB(e.alternate,e,oa);e.memoizedProps=e.pendingProps,t===null?UB(e):xi=t,iM.current=null}function UB(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=vV(i,t),i!==null){i.flags&=32767,xi=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mi=6,xi=null;return}}else if(i=_V(i,t,oa),i!==null){xi=i;return}if(t=t.sibling,t!==null){xi=t;return}xi=t=e}while(t!==null);Mi===0&&(Mi=5)}function oh(e,t,i){var a=Pn,f=Da.transition;try{Da.transition=null,Pn=1,MV(e,t,i,a)}finally{Da.transition=f,Pn=a}return null}function MV(e,t,i,a){do bd();while(Vc!==null);if(gn&6)throw Error(qt(327));i=e.finishedWork;var f=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(qt(177));e.callbackNode=null,e.callbackPriority=0;var y=i.lanes|i.childLanes;if(sU(e,y),e===Fi&&(xi=Fi=null,Ki=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||h0||(h0=!0,qB(U0,function(){return bd(),null})),y=(i.flags&15990)!==0,i.subtreeFlags&15990||y){y=Da.transition,Da.transition=null;var w=Pn;Pn=1;var O=gn;gn|=4,iM.current=null,bV(e,i),zB(i,e),HU(ES),G0=!!AS,ES=AS=null,e.current=i,wV(i),J$(),gn=O,Pn=w,Da.transition=y}else e.current=i;if(h0&&(h0=!1,Vc=e,ax=f),y=e.pendingLanes,y===0&&(Kc=null),tU(i.stateNode),Uo(e,gi()),t!==null)for(a=e.onRecoverableError,i=0;i<t.length;i++)f=t[i],a(f.value,{componentStack:f.stack,digest:f.digest});if(ox)throw ox=!1,e=WS,WS=null,e;return ax&1&&e.tag!==0&&bd(),y=e.pendingLanes,y&1?e===HS?Vg++:(Vg=0,HS=e):Vg=0,ou(),null}function bd(){if(Vc!==null){var e=w4(ax),t=Da.transition,i=Pn;try{if(Da.transition=null,Pn=16>e?16:e,Vc===null)var a=!1;else{if(e=Vc,Vc=null,ax=0,gn&6)throw Error(qt(331));var f=gn;for(gn|=4,fr=e.current;fr!==null;){var y=fr,w=y.child;if(fr.flags&16){var O=y.deletions;if(O!==null){for(var o=0;o<O.length;o++){var L=O[o];for(fr=L;fr!==null;){var $=fr;switch($.tag){case 0:case 11:case 15:$g(8,$,y)}var F=$.child;if(F!==null)F.return=$,fr=F;else for(;fr!==null;){$=fr;var H=$.sibling,Y=$.return;if(DB($),$===L){fr=null;break}if(H!==null){H.return=Y,fr=H;break}fr=Y}}}var oe=y.alternate;if(oe!==null){var te=oe.child;if(te!==null){oe.child=null;do{var ie=te.sibling;te.sibling=null,te=ie}while(te!==null)}}fr=y}}if(y.subtreeFlags&2064&&w!==null)w.return=y,fr=w;else e:for(;fr!==null;){if(y=fr,y.flags&2048)switch(y.tag){case 0:case 11:case 15:$g(9,y,y.return)}var ae=y.sibling;if(ae!==null){ae.return=y.return,fr=ae;break e}fr=y.return}}var J=e.current;for(fr=J;fr!==null;){w=fr;var ue=w.child;if(w.subtreeFlags&2064&&ue!==null)ue.return=w,fr=ue;else e:for(w=J;fr!==null;){if(O=fr,O.flags&2048)try{switch(O.tag){case 0:case 11:case 15:v1(9,O)}}catch(se){ui(O,O.return,se)}if(O===w){fr=null;break e}var le=O.sibling;if(le!==null){le.return=O.return,fr=le;break e}fr=O.return}}if(gn=f,ou(),js&&typeof js.onPostCommitFiberRoot=="function")try{js.onPostCommitFiberRoot(h1,e)}catch{}a=!0}return a}finally{Pn=i,Da.transition=t}}return!1}function Vk(e,t,i){t=kd(i,t),t=wB(e,t,1),e=Yc(e,t,1),t=Eo(),e!==null&&(Xy(e,1,t),Uo(e,t))}function ui(e,t,i){if(e.tag===3)Vk(e,e,i);else for(;t!==null;){if(t.tag===3){Vk(t,e,i);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Kc===null||!Kc.has(a))){e=kd(i,e),e=TB(t,e,1),t=Yc(t,e,1),e=Eo(),t!==null&&(Xy(t,1,e),Uo(t,e));break}}t=t.return}}function PV(e,t,i){var a=e.pingCache;a!==null&&a.delete(t),t=Eo(),e.pingedLanes|=e.suspendedLanes&i,Fi===e&&(Ki&i)===i&&(Mi===4||Mi===3&&(Ki&130023424)===Ki&&500>gi()-aM?yh(e,0):oM|=i),Uo(e,t)}function VB(e,t){t===0&&(e.mode&1?(t=t0,t0<<=1,!(t0&130023424)&&(t0=4194304)):t=1);var i=Eo();e=Pl(e,t),e!==null&&(Xy(e,t,i),Uo(e,i))}function IV(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),VB(e,i)}function CV(e,t){var i=0;switch(e.tag){case 13:var a=e.stateNode,f=e.memoizedState;f!==null&&(i=f.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(qt(314))}a!==null&&a.delete(t),VB(e,i)}var GB;GB=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||jo.current)Fo=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Fo=!1,yV(e,t,i);Fo=!!(e.flags&131072)}else Fo=!1,Qn&&t.flags&1048576&&Z4(t,K0,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;R0(e,t),e=t.pendingProps;var f=Pd(t,ho.current);xd(t,i),f=QE(null,t,a,e,f,i);var y=eM();return t.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,$o(a)?(y=!0,X0(t)):y=!1,t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,ZE(t),f.updater=_1,t.stateNode=f,f._reactInternals=t,RS(t,a,e,i),t=FS(null,t,a,!0,y,i)):(t.tag=0,Qn&&y&&$E(t),So(null,t,f,i),t=t.child),t;case 16:a=t.elementType;e:{switch(R0(e,t),e=t.pendingProps,f=a._init,a=f(a._payload),t.type=a,f=t.tag=kV(a),e=ss(a,e),f){case 0:t=BS(null,t,a,e,i);break e;case 1:t=Dk(null,t,a,e,i);break e;case 11:t=Ok(null,t,a,e,i);break e;case 14:t=kk(null,t,a,ss(a.type,e),i);break e}throw Error(qt(306,a,""))}return t;case 0:return a=t.type,f=t.pendingProps,f=t.elementType===a?f:ss(a,f),BS(e,t,a,f,i);case 1:return a=t.type,f=t.pendingProps,f=t.elementType===a?f:ss(a,f),Dk(e,t,a,f,i);case 3:e:{if(MB(t),e===null)throw Error(qt(387));a=t.pendingProps,y=t.memoizedState,f=y.element,eB(e,t),ex(t,a,null,i);var w=t.memoizedState;if(a=w.element,y.isDehydrated)if(y={element:a,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){f=kd(Error(qt(423)),t),t=Lk(e,t,a,i,f);break e}else if(a!==f){f=kd(Error(qt(424)),t),t=Lk(e,t,a,i,f);break e}else for(la=Xc(t.stateNode.containerInfo.firstChild),ca=t,Qn=!0,fs=null,i=J4(t,null,a,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Id(),a===f){t=Il(e,t,i);break e}So(e,t,a,i)}t=t.child}return t;case 5:return tB(t),e===null&&kS(t),a=t.type,f=t.pendingProps,y=e!==null?e.memoizedProps:null,w=f.children,MS(a,f)?w=null:y!==null&&MS(a,y)&&(t.flags|=32),EB(e,t),So(e,t,w,i),t.child;case 6:return e===null&&kS(t),null;case 13:return PB(e,t,i);case 4:return XE(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=Cd(t,null,a,i):So(e,t,a,i),t.child;case 11:return a=t.type,f=t.pendingProps,f=t.elementType===a?f:ss(a,f),Ok(e,t,a,f,i);case 7:return So(e,t,t.pendingProps,i),t.child;case 8:return So(e,t,t.pendingProps.children,i),t.child;case 12:return So(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(a=t.type._context,f=t.pendingProps,y=t.memoizedProps,w=f.value,Un(J0,a._currentValue),a._currentValue=w,y!==null)if(ys(y.value,w)){if(y.children===f.children&&!jo.current){t=Il(e,t,i);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var O=y.dependencies;if(O!==null){w=y.child;for(var o=O.firstContext;o!==null;){if(o.context===a){if(y.tag===1){o=wl(-1,i&-i),o.tag=2;var L=y.updateQueue;if(L!==null){L=L.shared;var $=L.pending;$===null?o.next=o:(o.next=$.next,$.next=o),L.pending=o}}y.lanes|=i,o=y.alternate,o!==null&&(o.lanes|=i),DS(y.return,i,t),O.lanes|=i;break}o=o.next}}else if(y.tag===10)w=y.type===t.type?null:y.child;else if(y.tag===18){if(w=y.return,w===null)throw Error(qt(341));w.lanes|=i,O=w.alternate,O!==null&&(O.lanes|=i),DS(w,i,t),w=y.sibling}else w=y.child;if(w!==null)w.return=y;else for(w=y;w!==null;){if(w===t){w=null;break}if(y=w.sibling,y!==null){y.return=w.return,w=y;break}w=w.return}y=w}So(e,t,f.children,i),t=t.child}return t;case 9:return f=t.type,a=t.pendingProps.children,xd(t,i),f=za(f),a=a(f),t.flags|=1,So(e,t,a,i),t.child;case 14:return a=t.type,f=ss(a,t.pendingProps),f=ss(a.type,f),kk(e,t,a,f,i);case 15:return SB(e,t,t.type,t.pendingProps,i);case 17:return a=t.type,f=t.pendingProps,f=t.elementType===a?f:ss(a,f),R0(e,t),t.tag=1,$o(a)?(e=!0,X0(t)):e=!1,xd(t,i),bB(t,a,f),RS(t,a,f,i),FS(null,t,a,!0,e,i);case 19:return IB(e,t,i);case 22:return AB(e,t,i)}throw Error(qt(156,t.tag))};function qB(e,t){return _4(e,t)}function OV(e,t,i,a){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(e,t,i,a){return new OV(e,t,i,a)}function uM(e){return e=e.prototype,!(!e||!e.isReactComponent)}function kV(e){if(typeof e=="function")return uM(e)?1:0;if(e!=null){if(e=e.$$typeof,e===IE)return 11;if(e===CE)return 14}return 2}function Qc(e,t){var i=e.alternate;return i===null?(i=Oa(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function F0(e,t,i,a,f,y){var w=2;if(a=e,typeof e=="function")uM(e)&&(w=1);else if(typeof e=="string")w=5;else e:switch(e){case nd:return _h(i.children,f,y,t);case PE:w=8,f|=8;break;case oS:return e=Oa(12,i,t,f|2),e.elementType=oS,e.lanes=y,e;case aS:return e=Oa(13,i,t,f),e.elementType=aS,e.lanes=y,e;case sS:return e=Oa(19,i,t,f),e.elementType=sS,e.lanes=y,e;case t4:return b1(i,f,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Qz:w=10;break e;case e4:w=9;break e;case IE:w=11;break e;case CE:w=14;break e;case Bc:w=16,a=null;break e}throw Error(qt(130,e==null?e:typeof e,""))}return t=Oa(w,i,t,f),t.elementType=e,t.type=a,t.lanes=y,t}function _h(e,t,i,a){return e=Oa(7,e,a,t),e.lanes=i,e}function b1(e,t,i,a){return e=Oa(22,e,a,t),e.elementType=t4,e.lanes=i,e.stateNode={isHidden:!1},e}function MT(e,t,i){return e=Oa(6,e,null,t),e.lanes=i,e}function PT(e,t,i){return t=Oa(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function DV(e,t,i,a,f){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lT(0),this.expirationTimes=lT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lT(0),this.identifierPrefix=a,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function hM(e,t,i,a,f,y,w,O,o){return e=new DV(e,t,i,O,o),t===1?(t=1,y===!0&&(t|=8)):t=0,y=Oa(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:a,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZE(y),e}function LV(e,t,i){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rd,key:a==null?null:""+a,children:e,containerInfo:t,implementation:i}}function WB(e){if(!e)return ru;e=e._reactInternals;e:{if(Oh(e)!==e||e.tag!==1)throw Error(qt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if($o(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(qt(171))}if(e.tag===1){var i=e.type;if($o(i))return W4(e,i,t)}return t}function HB(e,t,i,a,f,y,w,O,o){return e=hM(i,a,!0,e,f,y,w,O,o),e.context=WB(null),i=e.current,a=Eo(),f=Jc(i),y=wl(a,f),y.callback=t??null,Yc(i,y,f),e.current.lanes=f,Xy(e,f,a),Uo(e,a),e}function w1(e,t,i,a){var f=t.current,y=Eo(),w=Jc(f);return i=WB(i),t.context===null?t.context=i:t.pendingContext=i,t=wl(y,w),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=Yc(f,t,w),e!==null&&(gs(e,f,w,y),k0(e,f,w)),w}function lx(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Gk(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function fM(e,t){Gk(e,t),(e=e.alternate)&&Gk(e,t)}function RV(){return null}var ZB=typeof reportError=="function"?reportError:function(e){console.error(e)};function dM(e){this._internalRoot=e}T1.prototype.render=dM.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(qt(409));w1(e,t,null,null)};T1.prototype.unmount=dM.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Eh(function(){w1(null,e,null,null)}),t[Ml]=null}};function T1(e){this._internalRoot=e}T1.prototype.unstable_scheduleHydration=function(e){if(e){var t=A4();e={blockedOn:null,target:e,priority:t};for(var i=0;i<jc.length&&t!==0&&t<jc[i].priority;i++);jc.splice(i,0,e),i===0&&M4(e)}};function pM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function S1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function qk(){}function zV(e,t,i,a,f){if(f){if(typeof a=="function"){var y=a;a=function(){var L=lx(w);y.call(L)}}var w=HB(t,a,e,0,null,!1,!1,"",qk);return e._reactRootContainer=w,e[Ml]=w.current,iy(e.nodeType===8?e.parentNode:e),Eh(),w}for(;f=e.lastChild;)e.removeChild(f);if(typeof a=="function"){var O=a;a=function(){var L=lx(o);O.call(L)}}var o=hM(e,0,!1,null,null,!1,!1,"",qk);return e._reactRootContainer=o,e[Ml]=o.current,iy(e.nodeType===8?e.parentNode:e),Eh(function(){w1(t,o,i,a)}),o}function A1(e,t,i,a,f){var y=i._reactRootContainer;if(y){var w=y;if(typeof f=="function"){var O=f;f=function(){var o=lx(w);O.call(o)}}w1(t,w,e,f)}else w=zV(i,t,e,f,a);return lx(w)}T4=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=kg(t.pendingLanes);i!==0&&(DE(t,i|1),Uo(t,gi()),!(gn&6)&&(Dd=gi()+500,ou()))}break;case 13:Eh(function(){var a=Pl(e,1);if(a!==null){var f=Eo();gs(a,e,1,f)}}),fM(e,1)}};LE=function(e){if(e.tag===13){var t=Pl(e,134217728);if(t!==null){var i=Eo();gs(t,e,134217728,i)}fM(e,134217728)}};S4=function(e){if(e.tag===13){var t=Jc(e),i=Pl(e,t);if(i!==null){var a=Eo();gs(i,e,t,a)}fM(e,t)}};A4=function(){return Pn};E4=function(e,t){var i=Pn;try{return Pn=e,t()}finally{Pn=i}};yS=function(e,t,i){switch(t){case"input":if(uS(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var a=i[t];if(a!==e&&a.form===e.form){var f=m1(a);if(!f)throw Error(qt(90));n4(a),uS(a,f)}}}break;case"textarea":o4(e,i);break;case"select":t=i.value,t!=null&&gd(e,!!i.multiple,t,!1)}};f4=sM;d4=Eh;var BV={usingClientEntryPoint:!1,Events:[Ky,sd,m1,u4,h4,sM]},_g={findFiberByHostInstance:ch,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FV={bundleType:_g.bundleType,version:_g.version,rendererPackageName:_g.rendererPackageName,rendererConfig:_g.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dl.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=g4(e),e===null?null:e.stateNode},findFiberByHostInstance:_g.findFiberByHostInstance||RV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var f0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!f0.isDisabled&&f0.supportsFiber)try{h1=f0.inject(FV),js=f0}catch{}}ha.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BV;ha.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pM(t))throw Error(qt(200));return LV(e,t,null,i)};ha.createRoot=function(e,t){if(!pM(e))throw Error(qt(299));var i=!1,a="",f=ZB;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=hM(e,1,!1,null,null,i,!1,a,f),e[Ml]=t.current,iy(e.nodeType===8?e.parentNode:e),new dM(t)};ha.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(qt(188)):(e=Object.keys(e).join(","),Error(qt(268,e)));return e=g4(t),e=e===null?null:e.stateNode,e};ha.flushSync=function(e){return Eh(e)};ha.hydrate=function(e,t,i){if(!S1(t))throw Error(qt(200));return A1(null,e,t,!0,i)};ha.hydrateRoot=function(e,t,i){if(!pM(e))throw Error(qt(405));var a=i!=null&&i.hydratedSources||null,f=!1,y="",w=ZB;if(i!=null&&(i.unstable_strictMode===!0&&(f=!0),i.identifierPrefix!==void 0&&(y=i.identifierPrefix),i.onRecoverableError!==void 0&&(w=i.onRecoverableError)),t=HB(t,null,e,1,i??null,f,!1,y,w),e[Ml]=t.current,iy(e),a)for(e=0;e<a.length;e++)i=a[e],f=i._getVersion,f=f(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,f]:t.mutableSourceEagerHydrationData.push(i,f);return new T1(t)};ha.render=function(e,t,i){if(!S1(t))throw Error(qt(200));return A1(null,e,t,!1,i)};ha.unmountComponentAtNode=function(e){if(!S1(e))throw Error(qt(40));return e._reactRootContainer?(Eh(function(){A1(null,null,e,!1,function(){e._reactRootContainer=null,e[Ml]=null})}),!0):!1};ha.unstable_batchedUpdates=sM;ha.unstable_renderSubtreeIntoContainer=function(e,t,i,a){if(!S1(i))throw Error(qt(200));if(e==null||e._reactInternals===void 0)throw Error(qt(38));return A1(e,t,i,!1,a)};ha.version="18.3.1-next-f1338f8080-20240426";function XB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(XB)}catch(e){console.error(e)}}XB(),Xz.exports=ha;var NV=Xz.exports,YB,Wk=NV;YB=Wk.createRoot,Wk.hydrateRoot;function KB(e){var t,i,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var f=e.length;for(t=0;t<f;t++)e[t]&&(i=KB(e[t]))&&(a&&(a+=" "),a+=i)}else for(i in e)e[i]&&(a&&(a+=" "),a+=i);return a}function pn(){for(var e,t,i=0,a="",f=arguments.length;i<f;i++)(e=arguments[i])&&(t=KB(e))&&(a&&(a+=" "),a+=t);return a}var jV=Array.isArray,Vo=jV,$V=typeof Ig=="object"&&Ig&&Ig.Object===Object&&Ig,JB=$V,UV=JB,VV=typeof self=="object"&&self&&self.Object===Object&&self,GV=UV||VV||Function("return this")(),Zs=GV,qV=Zs,WV=qV.Symbol,Qy=WV,Hk=Qy,QB=Object.prototype,HV=QB.hasOwnProperty,ZV=QB.toString,vg=Hk?Hk.toStringTag:void 0;function XV(e){var t=HV.call(e,vg),i=e[vg];try{e[vg]=void 0;var a=!0}catch{}var f=ZV.call(e);return a&&(t?e[vg]=i:delete e[vg]),f}var YV=XV,KV=Object.prototype,JV=KV.toString;function QV(e){return JV.call(e)}var e3=QV,Zk=Qy,t3=YV,r3=e3,n3="[object Null]",i3="[object Undefined]",Xk=Zk?Zk.toStringTag:void 0;function o3(e){return e==null?e===void 0?i3:n3:Xk&&Xk in Object(e)?t3(e):r3(e)}var Ll=o3;function a3(e){return e!=null&&typeof e=="object"}var Rl=a3,s3=Ll,l3=Rl,c3="[object Symbol]";function u3(e){return typeof e=="symbol"||l3(e)&&s3(e)==c3}var sp=u3,h3=Vo,f3=sp,d3=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p3=/^\w*$/;function m3(e,t){if(h3(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||f3(e)?!0:p3.test(e)||!d3.test(e)||t!=null&&e in Object(t)}var mM=m3;function g3(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var au=g3;const lp=Fn(au);var y3=Ll,_3=au,v3="[object AsyncFunction]",x3="[object Function]",b3="[object GeneratorFunction]",w3="[object Proxy]";function T3(e){if(!_3(e))return!1;var t=y3(e);return t==x3||t==b3||t==v3||t==w3}var gM=T3;const on=Fn(gM);var S3=Zs,A3=S3["__core-js_shared__"],E3=A3,IT=E3,Yk=function(){var e=/[^.]+$/.exec(IT&&IT.keys&&IT.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function M3(e){return!!Yk&&Yk in e}var P3=M3,I3=Function.prototype,C3=I3.toString;function O3(e){if(e!=null){try{return C3.call(e)}catch{}try{return e+""}catch{}}return""}var eF=O3,k3=gM,D3=P3,L3=au,R3=eF,z3=/[\\^$.*+?()[\]{}|]/g,B3=/^\[object .+?Constructor\]$/,F3=Function.prototype,N3=Object.prototype,j3=F3.toString,$3=N3.hasOwnProperty,U3=RegExp("^"+j3.call($3).replace(z3,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function V3(e){if(!L3(e)||D3(e))return!1;var t=k3(e)?U3:B3;return t.test(R3(e))}var G3=V3;function q3(e,t){return e==null?void 0:e[t]}var W3=q3,H3=G3,Z3=W3;function X3(e,t){var i=Z3(e,t);return H3(i)?i:void 0}var kh=X3,Y3=kh,K3=Y3(Object,"create"),E1=K3,Kk=E1;function J3(){this.__data__=Kk?Kk(null):{},this.size=0}var Q3=J3;function e8(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var t8=e8,r8=E1,n8="__lodash_hash_undefined__",i8=Object.prototype,o8=i8.hasOwnProperty;function a8(e){var t=this.__data__;if(r8){var i=t[e];return i===n8?void 0:i}return o8.call(t,e)?t[e]:void 0}var s8=a8,l8=E1,c8=Object.prototype,u8=c8.hasOwnProperty;function h8(e){var t=this.__data__;return l8?t[e]!==void 0:u8.call(t,e)}var f8=h8,d8=E1,p8="__lodash_hash_undefined__";function m8(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=d8&&t===void 0?p8:t,this}var g8=m8,y8=Q3,_8=t8,v8=s8,x8=f8,b8=g8;function cp(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}cp.prototype.clear=y8;cp.prototype.delete=_8;cp.prototype.get=v8;cp.prototype.has=x8;cp.prototype.set=b8;var w8=cp;function T8(){this.__data__=[],this.size=0}var S8=T8;function A8(e,t){return e===t||e!==e&&t!==t}var yM=A8,E8=yM;function M8(e,t){for(var i=e.length;i--;)if(E8(e[i][0],t))return i;return-1}var M1=M8,P8=M1,I8=Array.prototype,C8=I8.splice;function O8(e){var t=this.__data__,i=P8(t,e);if(i<0)return!1;var a=t.length-1;return i==a?t.pop():C8.call(t,i,1),--this.size,!0}var k8=O8,D8=M1;function L8(e){var t=this.__data__,i=D8(t,e);return i<0?void 0:t[i][1]}var R8=L8,z8=M1;function B8(e){return z8(this.__data__,e)>-1}var F8=B8,N8=M1;function j8(e,t){var i=this.__data__,a=N8(i,e);return a<0?(++this.size,i.push([e,t])):i[a][1]=t,this}var $8=j8,U8=S8,V8=k8,G8=R8,q8=F8,W8=$8;function up(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}up.prototype.clear=U8;up.prototype.delete=V8;up.prototype.get=G8;up.prototype.has=q8;up.prototype.set=W8;var P1=up,H8=kh,Z8=Zs,X8=H8(Z8,"Map"),_M=X8,Jk=w8,Y8=P1,K8=_M;function J8(){this.size=0,this.__data__={hash:new Jk,map:new(K8||Y8),string:new Jk}}var Q8=J8;function eG(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var tG=eG,rG=tG;function nG(e,t){var i=e.__data__;return rG(t)?i[typeof t=="string"?"string":"hash"]:i.map}var I1=nG,iG=I1;function oG(e){var t=iG(this,e).delete(e);return this.size-=t?1:0,t}var aG=oG,sG=I1;function lG(e){return sG(this,e).get(e)}var cG=lG,uG=I1;function hG(e){return uG(this,e).has(e)}var fG=hG,dG=I1;function pG(e,t){var i=dG(this,e),a=i.size;return i.set(e,t),this.size+=i.size==a?0:1,this}var mG=pG,gG=Q8,yG=aG,_G=cG,vG=fG,xG=mG;function hp(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}hp.prototype.clear=gG;hp.prototype.delete=yG;hp.prototype.get=_G;hp.prototype.has=vG;hp.prototype.set=xG;var vM=hp,tF=vM,bG="Expected a function";function xM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(bG);var i=function(){var a=arguments,f=t?t.apply(this,a):a[0],y=i.cache;if(y.has(f))return y.get(f);var w=e.apply(this,a);return i.cache=y.set(f,w)||y,w};return i.cache=new(xM.Cache||tF),i}xM.Cache=tF;var rF=xM;const wG=Fn(rF);var TG=rF,SG=500;function AG(e){var t=TG(e,function(a){return i.size===SG&&i.clear(),a}),i=t.cache;return t}var EG=AG,MG=EG,PG=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,IG=/\\(\\)?/g,CG=MG(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(PG,function(i,a,f,y){t.push(f?y.replace(IG,"$1"):a||i)}),t}),OG=CG;function kG(e,t){for(var i=-1,a=e==null?0:e.length,f=Array(a);++i<a;)f[i]=t(e[i],i,e);return f}var bM=kG,Qk=Qy,DG=bM,LG=Vo,RG=sp,zG=1/0,eD=Qk?Qk.prototype:void 0,tD=eD?eD.toString:void 0;function nF(e){if(typeof e=="string")return e;if(LG(e))return DG(e,nF)+"";if(RG(e))return tD?tD.call(e):"";var t=e+"";return t=="0"&&1/e==-zG?"-0":t}var BG=nF,FG=BG;function NG(e){return e==null?"":FG(e)}var iF=NG,jG=Vo,$G=mM,UG=OG,VG=iF;function GG(e,t){return jG(e)?e:$G(e,t)?[e]:UG(VG(e))}var oF=GG,qG=sp,WG=1/0;function HG(e){if(typeof e=="string"||qG(e))return e;var t=e+"";return t=="0"&&1/e==-WG?"-0":t}var C1=HG,ZG=oF,XG=C1;function YG(e,t){t=ZG(t,e);for(var i=0,a=t.length;e!=null&&i<a;)e=e[XG(t[i++])];return i&&i==a?e:void 0}var wM=YG,KG=wM;function JG(e,t,i){var a=e==null?void 0:KG(e,t);return a===void 0?i:a}var aF=JG;const La=Fn(aF);function QG(e){return e==null}var eq=QG;const en=Fn(eq);var tq=Ll,rq=Vo,nq=Rl,iq="[object String]";function oq(e){return typeof e=="string"||!rq(e)&&nq(e)&&tq(e)==iq}var aq=oq;const e_=Fn(aq);var sF={exports:{}},In={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TM=Symbol.for("react.element"),SM=Symbol.for("react.portal"),O1=Symbol.for("react.fragment"),k1=Symbol.for("react.strict_mode"),D1=Symbol.for("react.profiler"),L1=Symbol.for("react.provider"),R1=Symbol.for("react.context"),sq=Symbol.for("react.server_context"),z1=Symbol.for("react.forward_ref"),B1=Symbol.for("react.suspense"),F1=Symbol.for("react.suspense_list"),N1=Symbol.for("react.memo"),j1=Symbol.for("react.lazy"),lq=Symbol.for("react.offscreen"),lF;lF=Symbol.for("react.module.reference");function Na(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case TM:switch(e=e.type,e){case O1:case D1:case k1:case B1:case F1:return e;default:switch(e=e&&e.$$typeof,e){case sq:case R1:case z1:case j1:case N1:case L1:return e;default:return t}}case SM:return t}}}In.ContextConsumer=R1;In.ContextProvider=L1;In.Element=TM;In.ForwardRef=z1;In.Fragment=O1;In.Lazy=j1;In.Memo=N1;In.Portal=SM;In.Profiler=D1;In.StrictMode=k1;In.Suspense=B1;In.SuspenseList=F1;In.isAsyncMode=function(){return!1};In.isConcurrentMode=function(){return!1};In.isContextConsumer=function(e){return Na(e)===R1};In.isContextProvider=function(e){return Na(e)===L1};In.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===TM};In.isForwardRef=function(e){return Na(e)===z1};In.isFragment=function(e){return Na(e)===O1};In.isLazy=function(e){return Na(e)===j1};In.isMemo=function(e){return Na(e)===N1};In.isPortal=function(e){return Na(e)===SM};In.isProfiler=function(e){return Na(e)===D1};In.isStrictMode=function(e){return Na(e)===k1};In.isSuspense=function(e){return Na(e)===B1};In.isSuspenseList=function(e){return Na(e)===F1};In.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===O1||e===D1||e===k1||e===B1||e===F1||e===lq||typeof e=="object"&&e!==null&&(e.$$typeof===j1||e.$$typeof===N1||e.$$typeof===L1||e.$$typeof===R1||e.$$typeof===z1||e.$$typeof===lF||e.getModuleId!==void 0)};In.typeOf=Na;sF.exports=In;var cF=sF.exports,cq=Ll,uq=Rl,hq="[object Number]";function fq(e){return typeof e=="number"||uq(e)&&cq(e)==hq}var uF=fq;const dq=Fn(uF);var pq=uF;function mq(e){return pq(e)&&e!=+e}var gq=mq;const fp=Fn(gq);var ps=function(t){return t===0?0:t>0?1:-1},fh=function(t){return e_(t)&&t.indexOf("%")===t.length-1},tr=function(t){return dq(t)&&!fp(t)},Pi=function(t){return tr(t)||e_(t)},yq=0,dp=function(t){var i=++yq;return"".concat(t||"").concat(i)},Mh=function(t,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!tr(t)&&!e_(t))return a;var y;if(fh(t)){var w=t.indexOf("%");y=i*parseFloat(t.slice(0,w))/100}else y=+t;return fp(y)&&(y=a),f&&y>i&&(y=i),y},td=function(t){if(!t)return null;var i=Object.keys(t);return i&&i.length?t[i[0]]:null},_q=function(t){if(!Array.isArray(t))return!1;for(var i=t.length,a={},f=0;f<i;f++)if(!a[t[f]])a[t[f]]=!0;else return!0;return!1},Xi=function(t,i){return tr(t)&&tr(i)?function(a){return t+a*(i-t)}:function(){return i}};function cx(e,t,i){return!e||!e.length?null:e.find(function(a){return a&&(typeof t=="function"?t(a):La(a,t))===i})}function wd(e,t){for(var i in e)if({}.hasOwnProperty.call(e,i)&&(!{}.hasOwnProperty.call(t,i)||e[i]!==t[i]))return!1;for(var a in t)if({}.hasOwnProperty.call(t,a)&&!{}.hasOwnProperty.call(e,a))return!1;return!0}function YS(e){"@babel/helpers - typeof";return YS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YS(e)}var vq=["viewBox","children"],xq=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],rD=["points","pathLength"],CT={svg:vq,polygon:rD,polyline:rD},AM=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],ux=function(t,i){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(Wt.isValidElement(t)&&(a=t.props),!lp(a))return null;var f={};return Object.keys(a).forEach(function(y){AM.includes(y)&&(f[y]=i||function(w){return a[y](a,w)})}),f},bq=function(t,i,a){return function(f){return t(i,a,f),null}},hx=function(t,i,a){if(!lp(t)||YS(t)!=="object")return null;var f=null;return Object.keys(t).forEach(function(y){var w=t[y];AM.includes(y)&&typeof w=="function"&&(f||(f={}),f[y]=bq(w,i,a))}),f},wq=["children"],Tq=["children"];function nD(e,t){if(e==null)return{};var i=Sq(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Sq(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function KS(e){"@babel/helpers - typeof";return KS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KS(e)}var iD={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"},Tl=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},oD=null,OT=null,EM=function e(t){if(t===oD&&Array.isArray(OT))return OT;var i=[];return Wt.Children.forEach(t,function(a){en(a)||(cF.isFragment(a)?i=i.concat(e(a.props.children)):i.push(a))}),OT=i,oD=t,i};function Ra(e,t){var i=[],a=[];return Array.isArray(t)?a=t.map(function(f){return Tl(f)}):a=[Tl(t)],EM(e).forEach(function(f){var y=La(f,"type.displayName")||La(f,"type.name");a.indexOf(y)!==-1&&i.push(f)}),i}function aa(e,t){var i=Ra(e,t);return i&&i[0]}var aD=function(t){if(!t||!t.props)return!1;var i=t.props,a=i.width,f=i.height;return!(!tr(a)||a<=0||!tr(f)||f<=0)},Aq=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],Eq=function(t){return t&&t.type&&e_(t.type)&&Aq.indexOf(t.type)>=0},hF=function(t){return t&&KS(t)==="object"&&"clipDot"in t},Mq=function(t,i,a,f){var y,w=(y=CT==null?void 0:CT[f])!==null&&y!==void 0?y:[];return!on(t)&&(f&&w.includes(i)||xq.includes(i))||a&&AM.includes(i)},Yr=function(t,i,a){if(!t||typeof t=="function"||typeof t=="boolean")return null;var f=t;if(Wt.isValidElement(t)&&(f=t.props),!lp(f))return null;var y={};return Object.keys(f).forEach(function(w){var O;Mq((O=f)===null||O===void 0?void 0:O[w],w,i,a)&&(y[w]=f[w])}),y},JS=function e(t,i){if(t===i)return!0;var a=Wt.Children.count(t);if(a!==Wt.Children.count(i))return!1;if(a===0)return!0;if(a===1)return sD(Array.isArray(t)?t[0]:t,Array.isArray(i)?i[0]:i);for(var f=0;f<a;f++){var y=t[f],w=i[f];if(Array.isArray(y)||Array.isArray(w)){if(!e(y,w))return!1}else if(!sD(y,w))return!1}return!0},sD=function(t,i){if(en(t)&&en(i))return!0;if(!en(t)&&!en(i)){var a=t.props||{},f=a.children,y=nD(a,wq),w=i.props||{},O=w.children,o=nD(w,Tq);return f&&O?wd(y,o)&&JS(f,O):!f&&!O?wd(y,o):!1}return!1},lD=function(t,i){var a=[],f={};return EM(t).forEach(function(y,w){if(Eq(y))a.push(y);else if(y){var O=Tl(y.type),o=i[O]||{},L=o.handler,$=o.once;if(L&&(!$||!f[O])){var F=L(y,O,w);a.push(F),f[O]=!0}}}),a},Pq=function(t){var i=t&&t.type;return i&&iD[i]?iD[i]:null},Iq=function(t,i){return EM(i).indexOf(t)},Cq=["children","width","height","viewBox","className","style","title","desc"];function QS(){return QS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},QS.apply(this,arguments)}function Oq(e,t){if(e==null)return{};var i=kq(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function kq(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function eA(e){var t=e.children,i=e.width,a=e.height,f=e.viewBox,y=e.className,w=e.style,O=e.title,o=e.desc,L=Oq(e,Cq),$=f||{width:i,height:a,x:0,y:0},F=pn("recharts-surface",y);return tt.createElement("svg",QS({},Yr(L,!0,"svg"),{className:F,width:i,height:a,style:w,viewBox:"".concat($.x," ").concat($.y," ").concat($.width," ").concat($.height)}),tt.createElement("title",null,O),tt.createElement("desc",null,o),t)}var Dq=["children","className"];function tA(){return tA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},tA.apply(this,arguments)}function Lq(e,t){if(e==null)return{};var i=Rq(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Rq(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}var Vn=tt.forwardRef(function(e,t){var i=e.children,a=e.className,f=Lq(e,Dq),y=pn("recharts-layer",a);return tt.createElement("g",tA({className:y},Yr(f,!0),{ref:t}),i)}),vh=function(t,i){for(var a=arguments.length,f=new Array(a>2?a-2:0),y=2;y<a;y++)f[y-2]=arguments[y]};function zq(e,t,i){var a=-1,f=e.length;t<0&&(t=-t>f?0:f+t),i=i>f?f:i,i<0&&(i+=f),f=t>i?0:i-t>>>0,t>>>=0;for(var y=Array(f);++a<f;)y[a]=e[a+t];return y}var Bq=zq,Fq=Bq;function Nq(e,t,i){var a=e.length;return i=i===void 0?a:i,!t&&i>=a?e:Fq(e,t,i)}var jq=Nq,$q="\\ud800-\\udfff",Uq="\\u0300-\\u036f",Vq="\\ufe20-\\ufe2f",Gq="\\u20d0-\\u20ff",qq=Uq+Vq+Gq,Wq="\\ufe0e\\ufe0f",Hq="\\u200d",Zq=RegExp("["+Hq+$q+qq+Wq+"]");function Xq(e){return Zq.test(e)}var fF=Xq;function Yq(e){return e.split("")}var Kq=Yq,dF="\\ud800-\\udfff",Jq="\\u0300-\\u036f",Qq="\\ufe20-\\ufe2f",eW="\\u20d0-\\u20ff",tW=Jq+Qq+eW,rW="\\ufe0e\\ufe0f",nW="["+dF+"]",rA="["+tW+"]",nA="\\ud83c[\\udffb-\\udfff]",iW="(?:"+rA+"|"+nA+")",pF="[^"+dF+"]",mF="(?:\\ud83c[\\udde6-\\uddff]){2}",gF="[\\ud800-\\udbff][\\udc00-\\udfff]",oW="\\u200d",yF=iW+"?",_F="["+rW+"]?",aW="(?:"+oW+"(?:"+[pF,mF,gF].join("|")+")"+_F+yF+")*",sW=_F+yF+aW,lW="(?:"+[pF+rA+"?",rA,mF,gF,nW].join("|")+")",cW=RegExp(nA+"(?="+nA+")|"+lW+sW,"g");function uW(e){return e.match(cW)||[]}var hW=uW,fW=Kq,dW=fF,pW=hW;function mW(e){return dW(e)?pW(e):fW(e)}var gW=mW,yW=jq,_W=fF,vW=gW,xW=iF;function bW(e){return function(t){t=xW(t);var i=_W(t)?vW(t):void 0,a=i?i[0]:t.charAt(0),f=i?yW(i,1).join(""):t.slice(1);return a[e]()+f}}var wW=bW,TW=wW,SW=TW("toUpperCase"),AW=SW;const $1=Fn(AW);function $n(e){return function(){return e}}const vF=Math.cos,fx=Math.sin,_s=Math.sqrt,dx=Math.PI,U1=2*dx,iA=Math.PI,oA=2*iA,ah=1e-6,EW=oA-ah;function xF(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=arguments[t]+e[t]}function MW(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return xF;const i=10**t;return function(a){this._+=a[0];for(let f=1,y=a.length;f<y;++f)this._+=Math.round(arguments[f]*i)/i+a[f]}}class PW{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?xF:MW(t)}moveTo(t,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,i){this._append`L${this._x1=+t},${this._y1=+i}`}quadraticCurveTo(t,i,a,f){this._append`Q${+t},${+i},${this._x1=+a},${this._y1=+f}`}bezierCurveTo(t,i,a,f,y,w){this._append`C${+t},${+i},${+a},${+f},${this._x1=+y},${this._y1=+w}`}arcTo(t,i,a,f,y){if(t=+t,i=+i,a=+a,f=+f,y=+y,y<0)throw new Error(`negative radius: ${y}`);let w=this._x1,O=this._y1,o=a-t,L=f-i,$=w-t,F=O-i,H=$*$+F*F;if(this._x1===null)this._append`M${this._x1=t},${this._y1=i}`;else if(H>ah)if(!(Math.abs(F*o-L*$)>ah)||!y)this._append`L${this._x1=t},${this._y1=i}`;else{let Y=a-w,oe=f-O,te=o*o+L*L,ie=Y*Y+oe*oe,ae=Math.sqrt(te),J=Math.sqrt(H),ue=y*Math.tan((iA-Math.acos((te+H-ie)/(2*ae*J)))/2),le=ue/J,se=ue/ae;Math.abs(le-1)>ah&&this._append`L${t+le*$},${i+le*F}`,this._append`A${y},${y},0,0,${+(F*Y>$*oe)},${this._x1=t+se*o},${this._y1=i+se*L}`}}arc(t,i,a,f,y,w){if(t=+t,i=+i,a=+a,w=!!w,a<0)throw new Error(`negative radius: ${a}`);let O=a*Math.cos(f),o=a*Math.sin(f),L=t+O,$=i+o,F=1^w,H=w?f-y:y-f;this._x1===null?this._append`M${L},${$}`:(Math.abs(this._x1-L)>ah||Math.abs(this._y1-$)>ah)&&this._append`L${L},${$}`,a&&(H<0&&(H=H%oA+oA),H>EW?this._append`A${a},${a},0,1,${F},${t-O},${i-o}A${a},${a},0,1,${F},${this._x1=L},${this._y1=$}`:H>ah&&this._append`A${a},${a},0,${+(H>=iA)},${F},${this._x1=t+a*Math.cos(y)},${this._y1=i+a*Math.sin(y)}`)}rect(t,i,a,f){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${a=+a}v${+f}h${-a}Z`}toString(){return this._}}function MM(e){let t=3;return e.digits=function(i){if(!arguments.length)return t;if(i==null)t=null;else{const a=Math.floor(i);if(!(a>=0))throw new RangeError(`invalid digits: ${i}`);t=a}return e},()=>new PW(t)}function PM(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function bF(e){this._context=e}bF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function V1(e){return new bF(e)}function wF(e){return e[0]}function TF(e){return e[1]}function SF(e,t){var i=$n(!0),a=null,f=V1,y=null,w=MM(O);e=typeof e=="function"?e:e===void 0?wF:$n(e),t=typeof t=="function"?t:t===void 0?TF:$n(t);function O(o){var L,$=(o=PM(o)).length,F,H=!1,Y;for(a==null&&(y=f(Y=w())),L=0;L<=$;++L)!(L<$&&i(F=o[L],L,o))===H&&((H=!H)?y.lineStart():y.lineEnd()),H&&y.point(+e(F,L,o),+t(F,L,o));if(Y)return y=null,Y+""||null}return O.x=function(o){return arguments.length?(e=typeof o=="function"?o:$n(+o),O):e},O.y=function(o){return arguments.length?(t=typeof o=="function"?o:$n(+o),O):t},O.defined=function(o){return arguments.length?(i=typeof o=="function"?o:$n(!!o),O):i},O.curve=function(o){return arguments.length?(f=o,a!=null&&(y=f(a)),O):f},O.context=function(o){return arguments.length?(o==null?a=y=null:y=f(a=o),O):a},O}function d0(e,t,i){var a=null,f=$n(!0),y=null,w=V1,O=null,o=MM(L);e=typeof e=="function"?e:e===void 0?wF:$n(+e),t=typeof t=="function"?t:$n(t===void 0?0:+t),i=typeof i=="function"?i:i===void 0?TF:$n(+i);function L(F){var H,Y,oe,te=(F=PM(F)).length,ie,ae=!1,J,ue=new Array(te),le=new Array(te);for(y==null&&(O=w(J=o())),H=0;H<=te;++H){if(!(H<te&&f(ie=F[H],H,F))===ae)if(ae=!ae)Y=H,O.areaStart(),O.lineStart();else{for(O.lineEnd(),O.lineStart(),oe=H-1;oe>=Y;--oe)O.point(ue[oe],le[oe]);O.lineEnd(),O.areaEnd()}ae&&(ue[H]=+e(ie,H,F),le[H]=+t(ie,H,F),O.point(a?+a(ie,H,F):ue[H],i?+i(ie,H,F):le[H]))}if(J)return O=null,J+""||null}function $(){return SF().defined(f).curve(w).context(y)}return L.x=function(F){return arguments.length?(e=typeof F=="function"?F:$n(+F),a=null,L):e},L.x0=function(F){return arguments.length?(e=typeof F=="function"?F:$n(+F),L):e},L.x1=function(F){return arguments.length?(a=F==null?null:typeof F=="function"?F:$n(+F),L):a},L.y=function(F){return arguments.length?(t=typeof F=="function"?F:$n(+F),i=null,L):t},L.y0=function(F){return arguments.length?(t=typeof F=="function"?F:$n(+F),L):t},L.y1=function(F){return arguments.length?(i=F==null?null:typeof F=="function"?F:$n(+F),L):i},L.lineX0=L.lineY0=function(){return $().x(e).y(t)},L.lineY1=function(){return $().x(e).y(i)},L.lineX1=function(){return $().x(a).y(t)},L.defined=function(F){return arguments.length?(f=typeof F=="function"?F:$n(!!F),L):f},L.curve=function(F){return arguments.length?(w=F,y!=null&&(O=w(y)),L):w},L.context=function(F){return arguments.length?(F==null?y=O=null:O=w(y=F),L):y},L}class AF{constructor(t,i){this._context=t,this._x=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,i){switch(t=+t,i=+i,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,i,t,i):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+i)/2,t,this._y0,t,i);break}}this._x0=t,this._y0=i}}function IW(e){return new AF(e,!0)}function CW(e){return new AF(e,!1)}const IM={draw(e,t){const i=_s(t/dx);e.moveTo(i,0),e.arc(0,0,i,0,U1)}},OW={draw(e,t){const i=_s(t/5)/2;e.moveTo(-3*i,-i),e.lineTo(-i,-i),e.lineTo(-i,-3*i),e.lineTo(i,-3*i),e.lineTo(i,-i),e.lineTo(3*i,-i),e.lineTo(3*i,i),e.lineTo(i,i),e.lineTo(i,3*i),e.lineTo(-i,3*i),e.lineTo(-i,i),e.lineTo(-3*i,i),e.closePath()}},EF=_s(1/3),kW=EF*2,DW={draw(e,t){const i=_s(t/kW),a=i*EF;e.moveTo(0,-i),e.lineTo(a,0),e.lineTo(0,i),e.lineTo(-a,0),e.closePath()}},LW={draw(e,t){const i=_s(t),a=-i/2;e.rect(a,a,i,i)}},RW=.8908130915292852,MF=fx(dx/10)/fx(7*dx/10),zW=fx(U1/10)*MF,BW=-vF(U1/10)*MF,FW={draw(e,t){const i=_s(t*RW),a=zW*i,f=BW*i;e.moveTo(0,-i),e.lineTo(a,f);for(let y=1;y<5;++y){const w=U1*y/5,O=vF(w),o=fx(w);e.lineTo(o*i,-O*i),e.lineTo(O*a-o*f,o*a+O*f)}e.closePath()}},kT=_s(3),NW={draw(e,t){const i=-_s(t/(kT*3));e.moveTo(0,i*2),e.lineTo(-kT*i,-i),e.lineTo(kT*i,-i),e.closePath()}},Ea=-.5,Ma=_s(3)/2,aA=1/_s(12),jW=(aA/2+1)*3,$W={draw(e,t){const i=_s(t/jW),a=i/2,f=i*aA,y=a,w=i*aA+i,O=-y,o=w;e.moveTo(a,f),e.lineTo(y,w),e.lineTo(O,o),e.lineTo(Ea*a-Ma*f,Ma*a+Ea*f),e.lineTo(Ea*y-Ma*w,Ma*y+Ea*w),e.lineTo(Ea*O-Ma*o,Ma*O+Ea*o),e.lineTo(Ea*a+Ma*f,Ea*f-Ma*a),e.lineTo(Ea*y+Ma*w,Ea*w-Ma*y),e.lineTo(Ea*O+Ma*o,Ea*o-Ma*O),e.closePath()}};function UW(e,t){let i=null,a=MM(f);e=typeof e=="function"?e:$n(e||IM),t=typeof t=="function"?t:$n(t===void 0?64:+t);function f(){let y;if(i||(i=y=a()),e.apply(this,arguments).draw(i,+t.apply(this,arguments)),y)return i=null,y+""||null}return f.type=function(y){return arguments.length?(e=typeof y=="function"?y:$n(y),f):e},f.size=function(y){return arguments.length?(t=typeof y=="function"?y:$n(+y),f):t},f.context=function(y){return arguments.length?(i=y??null,f):i},f}function px(){}function mx(e,t,i){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+i)/6)}function PF(e){this._context=e}PF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:mx(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:mx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function VW(e){return new PF(e)}function IF(e){this._context=e}IF.prototype={areaStart:px,areaEnd:px,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:mx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function GW(e){return new IF(e)}function CF(e){this._context=e}CF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var i=(this._x0+4*this._x1+e)/6,a=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(i,a):this._context.moveTo(i,a);break;case 3:this._point=4;default:mx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function qW(e){return new CF(e)}function OF(e){this._context=e}OF.prototype={areaStart:px,areaEnd:px,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function WW(e){return new OF(e)}function cD(e){return e<0?-1:1}function uD(e,t,i){var a=e._x1-e._x0,f=t-e._x1,y=(e._y1-e._y0)/(a||f<0&&-0),w=(i-e._y1)/(f||a<0&&-0),O=(y*f+w*a)/(a+f);return(cD(y)+cD(w))*Math.min(Math.abs(y),Math.abs(w),.5*Math.abs(O))||0}function hD(e,t){var i=e._x1-e._x0;return i?(3*(e._y1-e._y0)/i-t)/2:t}function DT(e,t,i){var a=e._x0,f=e._y0,y=e._x1,w=e._y1,O=(y-a)/3;e._context.bezierCurveTo(a+O,f+O*t,y-O,w-O*i,y,w)}function gx(e){this._context=e}gx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:DT(this,this._t0,hD(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var i=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,DT(this,hD(this,i=uD(this,e,t)),i);break;default:DT(this,this._t0,i=uD(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=i}}};function kF(e){this._context=new DF(e)}(kF.prototype=Object.create(gx.prototype)).point=function(e,t){gx.prototype.point.call(this,t,e)};function DF(e){this._context=e}DF.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,i,a,f,y){this._context.bezierCurveTo(t,e,a,i,y,f)}};function HW(e){return new gx(e)}function ZW(e){return new kF(e)}function LF(e){this._context=e}LF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,i=e.length;if(i)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),i===2)this._context.lineTo(e[1],t[1]);else for(var a=fD(e),f=fD(t),y=0,w=1;w<i;++y,++w)this._context.bezierCurveTo(a[0][y],f[0][y],a[1][y],f[1][y],e[w],t[w]);(this._line||this._line!==0&&i===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function fD(e){var t,i=e.length-1,a,f=new Array(i),y=new Array(i),w=new Array(i);for(f[0]=0,y[0]=2,w[0]=e[0]+2*e[1],t=1;t<i-1;++t)f[t]=1,y[t]=4,w[t]=4*e[t]+2*e[t+1];for(f[i-1]=2,y[i-1]=7,w[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)a=f[t]/y[t-1],y[t]-=a,w[t]-=a*w[t-1];for(f[i-1]=w[i-1]/y[i-1],t=i-2;t>=0;--t)f[t]=(w[t]-f[t+1])/y[t];for(y[i-1]=(e[i]+f[i-1])/2,t=0;t<i-1;++t)y[t]=2*e[t+1]-f[t+1];return[f,y]}function XW(e){return new LF(e)}function G1(e,t){this._context=e,this._t=t}G1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var i=this._x*(1-this._t)+e*this._t;this._context.lineTo(i,this._y),this._context.lineTo(i,t)}break}}this._x=e,this._y=t}};function YW(e){return new G1(e,.5)}function KW(e){return new G1(e,0)}function JW(e){return new G1(e,1)}function Ld(e,t){if((w=e.length)>1)for(var i=1,a,f,y=e[t[0]],w,O=y.length;i<w;++i)for(f=y,y=e[t[i]],a=0;a<O;++a)y[a][1]+=y[a][0]=isNaN(f[a][1])?f[a][0]:f[a][1]}function sA(e){for(var t=e.length,i=new Array(t);--t>=0;)i[t]=t;return i}function QW(e,t){return e[t]}function e7(e){const t=[];return t.key=e,t}function t7(){var e=$n([]),t=sA,i=Ld,a=QW;function f(y){var w=Array.from(e.apply(this,arguments),e7),O,o=w.length,L=-1,$;for(const F of y)for(O=0,++L;O<o;++O)(w[O][L]=[0,+a(F,w[O].key,L,y)]).data=F;for(O=0,$=PM(t(w));O<o;++O)w[$[O]].index=O;return i(w,$),w}return f.keys=function(y){return arguments.length?(e=typeof y=="function"?y:$n(Array.from(y)),f):e},f.value=function(y){return arguments.length?(a=typeof y=="function"?y:$n(+y),f):a},f.order=function(y){return arguments.length?(t=y==null?sA:typeof y=="function"?y:$n(Array.from(y)),f):t},f.offset=function(y){return arguments.length?(i=y??Ld,f):i},f}function r7(e,t){if((a=e.length)>0){for(var i,a,f=0,y=e[0].length,w;f<y;++f){for(w=i=0;i<a;++i)w+=e[i][f][1]||0;if(w)for(i=0;i<a;++i)e[i][f][1]/=w}Ld(e,t)}}function n7(e,t){if((f=e.length)>0){for(var i=0,a=e[t[0]],f,y=a.length;i<y;++i){for(var w=0,O=0;w<f;++w)O+=e[w][i][1]||0;a[i][1]+=a[i][0]=-O/2}Ld(e,t)}}function i7(e,t){if(!(!((w=e.length)>0)||!((y=(f=e[t[0]]).length)>0))){for(var i=0,a=1,f,y,w;a<y;++a){for(var O=0,o=0,L=0;O<w;++O){for(var $=e[t[O]],F=$[a][1]||0,H=$[a-1][1]||0,Y=(F-H)/2,oe=0;oe<O;++oe){var te=e[t[oe]],ie=te[a][1]||0,ae=te[a-1][1]||0;Y+=ie-ae}o+=F,L+=Y*F}f[a-1][1]+=f[a-1][0]=i,o&&(i-=L/o)}f[a-1][1]+=f[a-1][0]=i,Ld(e,t)}}function dy(e){"@babel/helpers - typeof";return dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dy(e)}var o7=["type","size","sizeType"];function lA(){return lA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},lA.apply(this,arguments)}function dD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function pD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dD(Object(i),!0).forEach(function(a){a7(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function a7(e,t,i){return t=s7(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s7(e){var t=l7(e,"string");return dy(t)=="symbol"?t:t+""}function l7(e,t){if(dy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(dy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c7(e,t){if(e==null)return{};var i=u7(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function u7(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}var RF={symbolCircle:IM,symbolCross:OW,symbolDiamond:DW,symbolSquare:LW,symbolStar:FW,symbolTriangle:NW,symbolWye:$W},h7=Math.PI/180,f7=function(t){var i="symbol".concat($1(t));return RF[i]||IM},d7=function(t,i,a){if(i==="area")return t;switch(a){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var f=18*h7;return 1.25*t*t*(Math.tan(f)-Math.tan(f*2)*Math.pow(Math.tan(f),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},p7=function(t,i){RF["symbol".concat($1(t))]=i},CM=function(t){var i=t.type,a=i===void 0?"circle":i,f=t.size,y=f===void 0?64:f,w=t.sizeType,O=w===void 0?"area":w,o=c7(t,o7),L=pD(pD({},o),{},{type:a,size:y,sizeType:O}),$=function(){var ie=f7(a),ae=UW().type(ie).size(d7(y,O,a));return ae()},F=L.className,H=L.cx,Y=L.cy,oe=Yr(L,!0);return H===+H&&Y===+Y&&y===+y?tt.createElement("path",lA({},oe,{className:pn("recharts-symbols",F),transform:"translate(".concat(H,", ").concat(Y,")"),d:$()})):null};CM.registerSymbol=p7;function Rd(e){"@babel/helpers - typeof";return Rd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rd(e)}function cA(){return cA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},cA.apply(this,arguments)}function mD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function m7(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mD(Object(i),!0).forEach(function(a){py(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function g7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y7(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,BF(a.key),a)}}function _7(e,t,i){return t&&y7(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function v7(e,t,i){return t=yx(t),x7(e,zF()?Reflect.construct(t,i||[],yx(e).constructor):t.apply(e,i))}function x7(e,t){if(t&&(Rd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return b7(e)}function b7(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zF(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zF=function(){return!!e})()}function yx(e){return yx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},yx(e)}function w7(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uA(e,t)}function uA(e,t){return uA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},uA(e,t)}function py(e,t,i){return t=BF(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function BF(e){var t=T7(e,"string");return Rd(t)=="symbol"?t:t+""}function T7(e,t){if(Rd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Rd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Pa=32,OM=function(e){function t(){return g7(this,t),v7(this,t,arguments)}return w7(t,e),_7(t,[{key:"renderIcon",value:function(a){var f=this.props.inactiveColor,y=Pa/2,w=Pa/6,O=Pa/3,o=a.inactive?f:a.color;if(a.type==="plainline")return tt.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:a.payload.strokeDasharray,x1:0,y1:y,x2:Pa,y2:y,className:"recharts-legend-icon"});if(a.type==="line")return tt.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(y,"h").concat(O,`
            A`).concat(w,",").concat(w,",0,1,1,").concat(2*O,",").concat(y,`
            H`).concat(Pa,"M").concat(2*O,",").concat(y,`
            A`).concat(w,",").concat(w,",0,1,1,").concat(O,",").concat(y),className:"recharts-legend-icon"});if(a.type==="rect")return tt.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(Pa/8,"h").concat(Pa,"v").concat(Pa*3/4,"h").concat(-Pa,"z"),className:"recharts-legend-icon"});if(tt.isValidElement(a.legendIcon)){var L=m7({},a);return delete L.legendIcon,tt.cloneElement(a.legendIcon,L)}return tt.createElement(CM,{fill:o,cx:y,cy:y,size:Pa,sizeType:"diameter",type:a.type})}},{key:"renderItems",value:function(){var a=this,f=this.props,y=f.payload,w=f.iconSize,O=f.layout,o=f.formatter,L=f.inactiveColor,$={x:0,y:0,width:Pa,height:Pa},F={display:O==="horizontal"?"inline-block":"block",marginRight:10},H={display:"inline-block",verticalAlign:"middle",marginRight:4};return y.map(function(Y,oe){var te=Y.formatter||o,ie=pn(py(py({"recharts-legend-item":!0},"legend-item-".concat(oe),!0),"inactive",Y.inactive));if(Y.type==="none")return null;var ae=on(Y.value)?null:Y.value;vh(!on(Y.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var J=Y.inactive?L:Y.color;return tt.createElement("li",cA({className:ie,style:F,key:"legend-item-".concat(oe)},hx(a.props,Y,oe)),tt.createElement(eA,{width:w,height:w,viewBox:$,style:H},a.renderIcon(Y)),tt.createElement("span",{className:"recharts-legend-item-text",style:{color:J}},te?te(ae,Y,oe):ae))})}},{key:"render",value:function(){var a=this.props,f=a.payload,y=a.layout,w=a.align;if(!f||!f.length)return null;var O={padding:0,margin:0,textAlign:y==="horizontal"?w:"left"};return tt.createElement("ul",{className:"recharts-default-legend",style:O},this.renderItems())}}])}(Wt.PureComponent);py(OM,"displayName","Legend");py(OM,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var S7=P1;function A7(){this.__data__=new S7,this.size=0}var E7=A7;function M7(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var P7=M7;function I7(e){return this.__data__.get(e)}var C7=I7;function O7(e){return this.__data__.has(e)}var k7=O7,D7=P1,L7=_M,R7=vM,z7=200;function B7(e,t){var i=this.__data__;if(i instanceof D7){var a=i.__data__;if(!L7||a.length<z7-1)return a.push([e,t]),this.size=++i.size,this;i=this.__data__=new R7(a)}return i.set(e,t),this.size=i.size,this}var F7=B7,N7=P1,j7=E7,$7=P7,U7=C7,V7=k7,G7=F7;function pp(e){var t=this.__data__=new N7(e);this.size=t.size}pp.prototype.clear=j7;pp.prototype.delete=$7;pp.prototype.get=U7;pp.prototype.has=V7;pp.prototype.set=G7;var FF=pp,q7="__lodash_hash_undefined__";function W7(e){return this.__data__.set(e,q7),this}var H7=W7;function Z7(e){return this.__data__.has(e)}var X7=Z7,Y7=vM,K7=H7,J7=X7;function _x(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new Y7;++t<i;)this.add(e[t])}_x.prototype.add=_x.prototype.push=K7;_x.prototype.has=J7;var NF=_x;function Q7(e,t){for(var i=-1,a=e==null?0:e.length;++i<a;)if(t(e[i],i,e))return!0;return!1}var jF=Q7;function e9(e,t){return e.has(t)}var $F=e9,t9=NF,r9=jF,n9=$F,i9=1,o9=2;function a9(e,t,i,a,f,y){var w=i&i9,O=e.length,o=t.length;if(O!=o&&!(w&&o>O))return!1;var L=y.get(e),$=y.get(t);if(L&&$)return L==t&&$==e;var F=-1,H=!0,Y=i&o9?new t9:void 0;for(y.set(e,t),y.set(t,e);++F<O;){var oe=e[F],te=t[F];if(a)var ie=w?a(te,oe,F,t,e,y):a(oe,te,F,e,t,y);if(ie!==void 0){if(ie)continue;H=!1;break}if(Y){if(!r9(t,function(ae,J){if(!n9(Y,J)&&(oe===ae||f(oe,ae,i,a,y)))return Y.push(J)})){H=!1;break}}else if(!(oe===te||f(oe,te,i,a,y))){H=!1;break}}return y.delete(e),y.delete(t),H}var UF=a9,s9=Zs,l9=s9.Uint8Array,c9=l9;function u9(e){var t=-1,i=Array(e.size);return e.forEach(function(a,f){i[++t]=[f,a]}),i}var h9=u9;function f9(e){var t=-1,i=Array(e.size);return e.forEach(function(a){i[++t]=a}),i}var kM=f9,gD=Qy,yD=c9,d9=yM,p9=UF,m9=h9,g9=kM,y9=1,_9=2,v9="[object Boolean]",x9="[object Date]",b9="[object Error]",w9="[object Map]",T9="[object Number]",S9="[object RegExp]",A9="[object Set]",E9="[object String]",M9="[object Symbol]",P9="[object ArrayBuffer]",I9="[object DataView]",_D=gD?gD.prototype:void 0,LT=_D?_D.valueOf:void 0;function C9(e,t,i,a,f,y,w){switch(i){case I9:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case P9:return!(e.byteLength!=t.byteLength||!y(new yD(e),new yD(t)));case v9:case x9:case T9:return d9(+e,+t);case b9:return e.name==t.name&&e.message==t.message;case S9:case E9:return e==t+"";case w9:var O=m9;case A9:var o=a&y9;if(O||(O=g9),e.size!=t.size&&!o)return!1;var L=w.get(e);if(L)return L==t;a|=_9,w.set(e,t);var $=p9(O(e),O(t),a,f,y,w);return w.delete(e),$;case M9:if(LT)return LT.call(e)==LT.call(t)}return!1}var O9=C9;function k9(e,t){for(var i=-1,a=t.length,f=e.length;++i<a;)e[f+i]=t[i];return e}var VF=k9,D9=VF,L9=Vo;function R9(e,t,i){var a=t(e);return L9(e)?a:D9(a,i(e))}var z9=R9;function B9(e,t){for(var i=-1,a=e==null?0:e.length,f=0,y=[];++i<a;){var w=e[i];t(w,i,e)&&(y[f++]=w)}return y}var F9=B9;function N9(){return[]}var j9=N9,$9=F9,U9=j9,V9=Object.prototype,G9=V9.propertyIsEnumerable,vD=Object.getOwnPropertySymbols,q9=vD?function(e){return e==null?[]:(e=Object(e),$9(vD(e),function(t){return G9.call(e,t)}))}:U9,W9=q9;function H9(e,t){for(var i=-1,a=Array(e);++i<e;)a[i]=t(i);return a}var Z9=H9,X9=Ll,Y9=Rl,K9="[object Arguments]";function J9(e){return Y9(e)&&X9(e)==K9}var Q9=J9,xD=Q9,eH=Rl,GF=Object.prototype,tH=GF.hasOwnProperty,rH=GF.propertyIsEnumerable,nH=xD(function(){return arguments}())?xD:function(e){return eH(e)&&tH.call(e,"callee")&&!rH.call(e,"callee")},DM=nH,vx={exports:{}};function iH(){return!1}var oH=iH;vx.exports;(function(e,t){var i=Zs,a=oH,f=t&&!t.nodeType&&t,y=f&&!0&&e&&!e.nodeType&&e,w=y&&y.exports===f,O=w?i.Buffer:void 0,o=O?O.isBuffer:void 0,L=o||a;e.exports=L})(vx,vx.exports);var qF=vx.exports,aH=9007199254740991,sH=/^(?:0|[1-9]\d*)$/;function lH(e,t){var i=typeof e;return t=t??aH,!!t&&(i=="number"||i!="symbol"&&sH.test(e))&&e>-1&&e%1==0&&e<t}var LM=lH,cH=9007199254740991;function uH(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=cH}var RM=uH,hH=Ll,fH=RM,dH=Rl,pH="[object Arguments]",mH="[object Array]",gH="[object Boolean]",yH="[object Date]",_H="[object Error]",vH="[object Function]",xH="[object Map]",bH="[object Number]",wH="[object Object]",TH="[object RegExp]",SH="[object Set]",AH="[object String]",EH="[object WeakMap]",MH="[object ArrayBuffer]",PH="[object DataView]",IH="[object Float32Array]",CH="[object Float64Array]",OH="[object Int8Array]",kH="[object Int16Array]",DH="[object Int32Array]",LH="[object Uint8Array]",RH="[object Uint8ClampedArray]",zH="[object Uint16Array]",BH="[object Uint32Array]",Zn={};Zn[IH]=Zn[CH]=Zn[OH]=Zn[kH]=Zn[DH]=Zn[LH]=Zn[RH]=Zn[zH]=Zn[BH]=!0;Zn[pH]=Zn[mH]=Zn[MH]=Zn[gH]=Zn[PH]=Zn[yH]=Zn[_H]=Zn[vH]=Zn[xH]=Zn[bH]=Zn[wH]=Zn[TH]=Zn[SH]=Zn[AH]=Zn[EH]=!1;function FH(e){return dH(e)&&fH(e.length)&&!!Zn[hH(e)]}var NH=FH;function jH(e){return function(t){return e(t)}}var WF=jH,xx={exports:{}};xx.exports;(function(e,t){var i=JB,a=t&&!t.nodeType&&t,f=a&&!0&&e&&!e.nodeType&&e,y=f&&f.exports===a,w=y&&i.process,O=function(){try{var o=f&&f.require&&f.require("util").types;return o||w&&w.binding&&w.binding("util")}catch{}}();e.exports=O})(xx,xx.exports);var $H=xx.exports,UH=NH,VH=WF,bD=$H,wD=bD&&bD.isTypedArray,GH=wD?VH(wD):UH,HF=GH,qH=Z9,WH=DM,HH=Vo,ZH=qF,XH=LM,YH=HF,KH=Object.prototype,JH=KH.hasOwnProperty;function QH(e,t){var i=HH(e),a=!i&&WH(e),f=!i&&!a&&ZH(e),y=!i&&!a&&!f&&YH(e),w=i||a||f||y,O=w?qH(e.length,String):[],o=O.length;for(var L in e)(t||JH.call(e,L))&&!(w&&(L=="length"||f&&(L=="offset"||L=="parent")||y&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||XH(L,o)))&&O.push(L);return O}var eZ=QH,tZ=Object.prototype;function rZ(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||tZ;return e===i}var nZ=rZ;function iZ(e,t){return function(i){return e(t(i))}}var ZF=iZ,oZ=ZF,aZ=oZ(Object.keys,Object),sZ=aZ,lZ=nZ,cZ=sZ,uZ=Object.prototype,hZ=uZ.hasOwnProperty;function fZ(e){if(!lZ(e))return cZ(e);var t=[];for(var i in Object(e))hZ.call(e,i)&&i!="constructor"&&t.push(i);return t}var dZ=fZ,pZ=gM,mZ=RM;function gZ(e){return e!=null&&mZ(e.length)&&!pZ(e)}var q1=gZ,yZ=eZ,_Z=dZ,vZ=q1;function xZ(e){return vZ(e)?yZ(e):_Z(e)}var zM=xZ,bZ=z9,wZ=W9,TZ=zM;function SZ(e){return bZ(e,TZ,wZ)}var AZ=SZ,TD=AZ,EZ=1,MZ=Object.prototype,PZ=MZ.hasOwnProperty;function IZ(e,t,i,a,f,y){var w=i&EZ,O=TD(e),o=O.length,L=TD(t),$=L.length;if(o!=$&&!w)return!1;for(var F=o;F--;){var H=O[F];if(!(w?H in t:PZ.call(t,H)))return!1}var Y=y.get(e),oe=y.get(t);if(Y&&oe)return Y==t&&oe==e;var te=!0;y.set(e,t),y.set(t,e);for(var ie=w;++F<o;){H=O[F];var ae=e[H],J=t[H];if(a)var ue=w?a(J,ae,H,t,e,y):a(ae,J,H,e,t,y);if(!(ue===void 0?ae===J||f(ae,J,i,a,y):ue)){te=!1;break}ie||(ie=H=="constructor")}if(te&&!ie){var le=e.constructor,se=t.constructor;le!=se&&"constructor"in e&&"constructor"in t&&!(typeof le=="function"&&le instanceof le&&typeof se=="function"&&se instanceof se)&&(te=!1)}return y.delete(e),y.delete(t),te}var CZ=IZ,OZ=kh,kZ=Zs,DZ=OZ(kZ,"DataView"),LZ=DZ,RZ=kh,zZ=Zs,BZ=RZ(zZ,"Promise"),FZ=BZ,NZ=kh,jZ=Zs,$Z=NZ(jZ,"Set"),XF=$Z,UZ=kh,VZ=Zs,GZ=UZ(VZ,"WeakMap"),qZ=GZ,hA=LZ,fA=_M,dA=FZ,pA=XF,mA=qZ,YF=Ll,mp=eF,SD="[object Map]",WZ="[object Object]",AD="[object Promise]",ED="[object Set]",MD="[object WeakMap]",PD="[object DataView]",HZ=mp(hA),ZZ=mp(fA),XZ=mp(dA),YZ=mp(pA),KZ=mp(mA),sh=YF;(hA&&sh(new hA(new ArrayBuffer(1)))!=PD||fA&&sh(new fA)!=SD||dA&&sh(dA.resolve())!=AD||pA&&sh(new pA)!=ED||mA&&sh(new mA)!=MD)&&(sh=function(e){var t=YF(e),i=t==WZ?e.constructor:void 0,a=i?mp(i):"";if(a)switch(a){case HZ:return PD;case ZZ:return SD;case XZ:return AD;case YZ:return ED;case KZ:return MD}return t});var JZ=sh,RT=FF,QZ=UF,eX=O9,tX=CZ,ID=JZ,CD=Vo,OD=qF,rX=HF,nX=1,kD="[object Arguments]",DD="[object Array]",p0="[object Object]",iX=Object.prototype,LD=iX.hasOwnProperty;function oX(e,t,i,a,f,y){var w=CD(e),O=CD(t),o=w?DD:ID(e),L=O?DD:ID(t);o=o==kD?p0:o,L=L==kD?p0:L;var $=o==p0,F=L==p0,H=o==L;if(H&&OD(e)){if(!OD(t))return!1;w=!0,$=!1}if(H&&!$)return y||(y=new RT),w||rX(e)?QZ(e,t,i,a,f,y):eX(e,t,o,i,a,f,y);if(!(i&nX)){var Y=$&&LD.call(e,"__wrapped__"),oe=F&&LD.call(t,"__wrapped__");if(Y||oe){var te=Y?e.value():e,ie=oe?t.value():t;return y||(y=new RT),f(te,ie,i,a,y)}}return H?(y||(y=new RT),tX(e,t,i,a,f,y)):!1}var aX=oX,sX=aX,RD=Rl;function KF(e,t,i,a,f){return e===t?!0:e==null||t==null||!RD(e)&&!RD(t)?e!==e&&t!==t:sX(e,t,i,a,KF,f)}var BM=KF,lX=FF,cX=BM,uX=1,hX=2;function fX(e,t,i,a){var f=i.length,y=f,w=!a;if(e==null)return!y;for(e=Object(e);f--;){var O=i[f];if(w&&O[2]?O[1]!==e[O[0]]:!(O[0]in e))return!1}for(;++f<y;){O=i[f];var o=O[0],L=e[o],$=O[1];if(w&&O[2]){if(L===void 0&&!(o in e))return!1}else{var F=new lX;if(a)var H=a(L,$,o,e,t,F);if(!(H===void 0?cX($,L,uX|hX,a,F):H))return!1}}return!0}var dX=fX,pX=au;function mX(e){return e===e&&!pX(e)}var JF=mX,gX=JF,yX=zM;function _X(e){for(var t=yX(e),i=t.length;i--;){var a=t[i],f=e[a];t[i]=[a,f,gX(f)]}return t}var vX=_X;function xX(e,t){return function(i){return i==null?!1:i[e]===t&&(t!==void 0||e in Object(i))}}var QF=xX,bX=dX,wX=vX,TX=QF;function SX(e){var t=wX(e);return t.length==1&&t[0][2]?TX(t[0][0],t[0][1]):function(i){return i===e||bX(i,e,t)}}var AX=SX;function EX(e,t){return e!=null&&t in Object(e)}var MX=EX,PX=oF,IX=DM,CX=Vo,OX=LM,kX=RM,DX=C1;function LX(e,t,i){t=PX(t,e);for(var a=-1,f=t.length,y=!1;++a<f;){var w=DX(t[a]);if(!(y=e!=null&&i(e,w)))break;e=e[w]}return y||++a!=f?y:(f=e==null?0:e.length,!!f&&kX(f)&&OX(w,f)&&(CX(e)||IX(e)))}var RX=LX,zX=MX,BX=RX;function FX(e,t){return e!=null&&BX(e,t,zX)}var NX=FX,jX=BM,$X=aF,UX=NX,VX=mM,GX=JF,qX=QF,WX=C1,HX=1,ZX=2;function XX(e,t){return VX(e)&&GX(t)?qX(WX(e),t):function(i){var a=$X(i,e);return a===void 0&&a===t?UX(i,e):jX(t,a,HX|ZX)}}var YX=XX;function KX(e){return e}var gp=KX;function JX(e){return function(t){return t==null?void 0:t[e]}}var QX=JX,eY=wM;function tY(e){return function(t){return eY(t,e)}}var rY=tY,nY=QX,iY=rY,oY=mM,aY=C1;function sY(e){return oY(e)?nY(aY(e)):iY(e)}var lY=sY,cY=AX,uY=YX,hY=gp,fY=Vo,dY=lY;function pY(e){return typeof e=="function"?e:e==null?hY:typeof e=="object"?fY(e)?uY(e[0],e[1]):cY(e):dY(e)}var yp=pY;function mY(e,t,i,a){for(var f=e.length,y=i+(a?1:-1);a?y--:++y<f;)if(t(e[y],y,e))return y;return-1}var gY=mY;function yY(e){return e!==e}var _Y=yY;function vY(e,t,i){for(var a=i-1,f=e.length;++a<f;)if(e[a]===t)return a;return-1}var xY=vY,bY=gY,wY=_Y,TY=xY;function SY(e,t,i){return t===t?TY(e,t,i):bY(e,wY,i)}var AY=SY,EY=AY;function MY(e,t){var i=e==null?0:e.length;return!!i&&EY(e,t,0)>-1}var PY=MY;function IY(e,t,i){for(var a=-1,f=e==null?0:e.length;++a<f;)if(i(t,e[a]))return!0;return!1}var CY=IY;function OY(){}var kY=OY,zT=XF,DY=kY,LY=kM,RY=1/0,zY=zT&&1/LY(new zT([,-0]))[1]==RY?function(e){return new zT(e)}:DY,BY=zY,FY=NF,NY=PY,jY=CY,$Y=$F,UY=BY,VY=kM,GY=200;function qY(e,t,i){var a=-1,f=NY,y=e.length,w=!0,O=[],o=O;if(i)w=!1,f=jY;else if(y>=GY){var L=t?null:UY(e);if(L)return VY(L);w=!1,f=$Y,o=new FY}else o=t?[]:O;e:for(;++a<y;){var $=e[a],F=t?t($):$;if($=i||$!==0?$:0,w&&F===F){for(var H=o.length;H--;)if(o[H]===F)continue e;t&&o.push(F),O.push($)}else f(o,F,i)||(o!==O&&o.push(F),O.push($))}return O}var WY=qY,HY=yp,ZY=WY;function XY(e,t){return e&&e.length?ZY(e,HY(t)):[]}var YY=XY;const zD=Fn(YY);function eN(e,t,i){return t===!0?zD(e,i):on(t)?zD(e,t):e}function zd(e){"@babel/helpers - typeof";return zd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zd(e)}var KY=["ref"];function BD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function ml(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?BD(Object(i),!0).forEach(function(a){W1(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function JY(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FD(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,rN(a.key),a)}}function QY(e,t,i){return t&&FD(e.prototype,t),i&&FD(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function eK(e,t,i){return t=bx(t),tK(e,tN()?Reflect.construct(t,i||[],bx(e).constructor):t.apply(e,i))}function tK(e,t){if(t&&(zd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rK(e)}function rK(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tN=function(){return!!e})()}function bx(e){return bx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},bx(e)}function nK(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gA(e,t)}function gA(e,t){return gA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},gA(e,t)}function W1(e,t,i){return t=rN(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function rN(e){var t=iK(e,"string");return zd(t)=="symbol"?t:t+""}function iK(e,t){if(zd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(zd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function oK(e,t){if(e==null)return{};var i=aK(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function aK(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function sK(e){return e.value}function lK(e,t){if(tt.isValidElement(e))return tt.cloneElement(e,t);if(typeof e=="function")return tt.createElement(e,t);t.ref;var i=oK(t,KY);return tt.createElement(OM,i)}var ND=1,Td=function(e){function t(){var i;JY(this,t);for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];return i=eK(this,t,[].concat(f)),W1(i,"lastBoundingBox",{width:-1,height:-1}),i}return nK(t,e),QY(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var a=this.wrapperNode.getBoundingClientRect();return a.height=this.wrapperNode.offsetHeight,a.width=this.wrapperNode.offsetWidth,a}return null}},{key:"updateBBox",value:function(){var a=this.props.onBBoxUpdate,f=this.getBBox();f?(Math.abs(f.width-this.lastBoundingBox.width)>ND||Math.abs(f.height-this.lastBoundingBox.height)>ND)&&(this.lastBoundingBox.width=f.width,this.lastBoundingBox.height=f.height,a&&a(f)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,a&&a(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?ml({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(a){var f=this.props,y=f.layout,w=f.align,O=f.verticalAlign,o=f.margin,L=f.chartWidth,$=f.chartHeight,F,H;if(!a||(a.left===void 0||a.left===null)&&(a.right===void 0||a.right===null))if(w==="center"&&y==="vertical"){var Y=this.getBBoxSnapshot();F={left:((L||0)-Y.width)/2}}else F=w==="right"?{right:o&&o.right||0}:{left:o&&o.left||0};if(!a||(a.top===void 0||a.top===null)&&(a.bottom===void 0||a.bottom===null))if(O==="middle"){var oe=this.getBBoxSnapshot();H={top:(($||0)-oe.height)/2}}else H=O==="bottom"?{bottom:o&&o.bottom||0}:{top:o&&o.top||0};return ml(ml({},F),H)}},{key:"render",value:function(){var a=this,f=this.props,y=f.content,w=f.width,O=f.height,o=f.wrapperStyle,L=f.payloadUniqBy,$=f.payload,F=ml(ml({position:"absolute",width:w||"auto",height:O||"auto"},this.getDefaultPosition(o)),o);return tt.createElement("div",{className:"recharts-legend-wrapper",style:F,ref:function(Y){a.wrapperNode=Y}},lK(y,ml(ml({},this.props),{},{payload:eN($,L,sK)})))}}],[{key:"getWithHeight",value:function(a,f){var y=ml(ml({},this.defaultProps),a.props),w=y.layout;return w==="vertical"&&tr(a.props.height)?{height:a.props.height}:w==="horizontal"?{width:a.props.width||f}:null}}])}(Wt.PureComponent);W1(Td,"displayName","Legend");W1(Td,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var jD=Qy,cK=DM,uK=Vo,$D=jD?jD.isConcatSpreadable:void 0;function hK(e){return uK(e)||cK(e)||!!($D&&e&&e[$D])}var fK=hK,dK=VF,pK=fK;function nN(e,t,i,a,f){var y=-1,w=e.length;for(i||(i=pK),f||(f=[]);++y<w;){var O=e[y];t>0&&i(O)?t>1?nN(O,t-1,i,a,f):dK(f,O):a||(f[f.length]=O)}return f}var iN=nN;function mK(e){return function(t,i,a){for(var f=-1,y=Object(t),w=a(t),O=w.length;O--;){var o=w[e?O:++f];if(i(y[o],o,y)===!1)break}return t}}var gK=mK,yK=gK,_K=yK(),vK=_K,xK=vK,bK=zM;function wK(e,t){return e&&xK(e,t,bK)}var oN=wK,TK=q1;function SK(e,t){return function(i,a){if(i==null)return i;if(!TK(i))return e(i,a);for(var f=i.length,y=t?f:-1,w=Object(i);(t?y--:++y<f)&&a(w[y],y,w)!==!1;);return i}}var AK=SK,EK=oN,MK=AK,PK=MK(EK),FM=PK,IK=FM,CK=q1;function OK(e,t){var i=-1,a=CK(e)?Array(e.length):[];return IK(e,function(f,y,w){a[++i]=t(f,y,w)}),a}var aN=OK;function kK(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}var DK=kK,UD=sp;function LK(e,t){if(e!==t){var i=e!==void 0,a=e===null,f=e===e,y=UD(e),w=t!==void 0,O=t===null,o=t===t,L=UD(t);if(!O&&!L&&!y&&e>t||y&&w&&o&&!O&&!L||a&&w&&o||!i&&o||!f)return 1;if(!a&&!y&&!L&&e<t||L&&i&&f&&!a&&!y||O&&i&&f||!w&&f||!o)return-1}return 0}var RK=LK,zK=RK;function BK(e,t,i){for(var a=-1,f=e.criteria,y=t.criteria,w=f.length,O=i.length;++a<w;){var o=zK(f[a],y[a]);if(o){if(a>=O)return o;var L=i[a];return o*(L=="desc"?-1:1)}}return e.index-t.index}var FK=BK,BT=bM,NK=wM,jK=yp,$K=aN,UK=DK,VK=WF,GK=FK,qK=gp,WK=Vo;function HK(e,t,i){t.length?t=BT(t,function(y){return WK(y)?function(w){return NK(w,y.length===1?y[0]:y)}:y}):t=[qK];var a=-1;t=BT(t,VK(jK));var f=$K(e,function(y,w,O){var o=BT(t,function(L){return L(y)});return{criteria:o,index:++a,value:y}});return UK(f,function(y,w){return GK(y,w,i)})}var ZK=HK;function XK(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var YK=XK,KK=YK,VD=Math.max;function JK(e,t,i){return t=VD(t===void 0?e.length-1:t,0),function(){for(var a=arguments,f=-1,y=VD(a.length-t,0),w=Array(y);++f<y;)w[f]=a[t+f];f=-1;for(var O=Array(t+1);++f<t;)O[f]=a[f];return O[t]=i(w),KK(e,this,O)}}var QK=JK;function eJ(e){return function(){return e}}var tJ=eJ,rJ=kh,nJ=function(){try{var e=rJ(Object,"defineProperty");return e({},"",{}),e}catch{}}(),sN=nJ,iJ=tJ,GD=sN,oJ=gp,aJ=GD?function(e,t){return GD(e,"toString",{configurable:!0,enumerable:!1,value:iJ(t),writable:!0})}:oJ,sJ=aJ,lJ=800,cJ=16,uJ=Date.now;function hJ(e){var t=0,i=0;return function(){var a=uJ(),f=cJ-(a-i);if(i=a,f>0){if(++t>=lJ)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var fJ=hJ,dJ=sJ,pJ=fJ,mJ=pJ(dJ),gJ=mJ,yJ=gp,_J=QK,vJ=gJ;function xJ(e,t){return vJ(_J(e,t,yJ),e+"")}var bJ=xJ,wJ=yM,TJ=q1,SJ=LM,AJ=au;function EJ(e,t,i){if(!AJ(i))return!1;var a=typeof t;return(a=="number"?TJ(i)&&SJ(t,i.length):a=="string"&&t in i)?wJ(i[t],e):!1}var H1=EJ,MJ=iN,PJ=ZK,IJ=bJ,qD=H1,CJ=IJ(function(e,t){if(e==null)return[];var i=t.length;return i>1&&qD(e,t[0],t[1])?t=[]:i>2&&qD(t[0],t[1],t[2])&&(t=[t[0]]),PJ(e,MJ(t,1),[])}),OJ=CJ;const NM=Fn(OJ);function my(e){"@babel/helpers - typeof";return my=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},my(e)}function yA(){return yA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},yA.apply(this,arguments)}function kJ(e,t){return zJ(e)||RJ(e,t)||LJ(e,t)||DJ()}function DJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LJ(e,t){if(e){if(typeof e=="string")return WD(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return WD(e,t)}}function WD(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function RJ(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function zJ(e){if(Array.isArray(e))return e}function HD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function FT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HD(Object(i),!0).forEach(function(a){BJ(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function BJ(e,t,i){return t=FJ(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function FJ(e){var t=NJ(e,"string");return my(t)=="symbol"?t:t+""}function NJ(e,t){if(my(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(my(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function jJ(e){return Array.isArray(e)&&Pi(e[0])&&Pi(e[1])?e.join(" ~ "):e}var $J=function(t){var i=t.separator,a=i===void 0?" : ":i,f=t.contentStyle,y=f===void 0?{}:f,w=t.itemStyle,O=w===void 0?{}:w,o=t.labelStyle,L=o===void 0?{}:o,$=t.payload,F=t.formatter,H=t.itemSorter,Y=t.wrapperClassName,oe=t.labelClassName,te=t.label,ie=t.labelFormatter,ae=t.accessibilityLayer,J=ae===void 0?!1:ae,ue=function(){if($&&$.length){var He={padding:0,margin:0},At=(H?NM($,H):$).map(function(Tt,kt){if(Tt.type==="none")return null;var ct=FT({display:"block",paddingTop:4,paddingBottom:4,color:Tt.color||"#000"},O),Ot=Tt.formatter||F||jJ,mt=Tt.value,Lt=Tt.name,yt=mt,Zt=Lt;if(Ot&&yt!=null&&Zt!=null){var Yt=Ot(mt,Lt,Tt,kt,$);if(Array.isArray(Yt)){var xr=kJ(Yt,2);yt=xr[0],Zt=xr[1]}else yt=Yt}return tt.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(kt),style:ct},Pi(Zt)?tt.createElement("span",{className:"recharts-tooltip-item-name"},Zt):null,Pi(Zt)?tt.createElement("span",{className:"recharts-tooltip-item-separator"},a):null,tt.createElement("span",{className:"recharts-tooltip-item-value"},yt),tt.createElement("span",{className:"recharts-tooltip-item-unit"},Tt.unit||""))});return tt.createElement("ul",{className:"recharts-tooltip-item-list",style:He},At)}return null},le=FT({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},y),se=FT({margin:0},L),be=!en(te),Ie=be?te:"",Ae=pn("recharts-default-tooltip",Y),ht=pn("recharts-tooltip-label",oe);be&&ie&&$!==void 0&&$!==null&&(Ie=ie(te,$));var st=J?{role:"status","aria-live":"assertive"}:{};return tt.createElement("div",yA({className:Ae,style:le},st),tt.createElement("p",{className:ht,style:se},tt.isValidElement(Ie)?Ie:"".concat(Ie)),ue())};function gy(e){"@babel/helpers - typeof";return gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gy(e)}function m0(e,t,i){return t=UJ(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function UJ(e){var t=VJ(e,"string");return gy(t)=="symbol"?t:t+""}function VJ(e,t){if(gy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(gy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xg="recharts-tooltip-wrapper",GJ={visibility:"hidden"};function qJ(e){var t=e.coordinate,i=e.translateX,a=e.translateY;return pn(xg,m0(m0(m0(m0({},"".concat(xg,"-right"),tr(i)&&t&&tr(t.x)&&i>=t.x),"".concat(xg,"-left"),tr(i)&&t&&tr(t.x)&&i<t.x),"".concat(xg,"-bottom"),tr(a)&&t&&tr(t.y)&&a>=t.y),"".concat(xg,"-top"),tr(a)&&t&&tr(t.y)&&a<t.y))}function ZD(e){var t=e.allowEscapeViewBox,i=e.coordinate,a=e.key,f=e.offsetTopLeft,y=e.position,w=e.reverseDirection,O=e.tooltipDimension,o=e.viewBox,L=e.viewBoxDimension;if(y&&tr(y[a]))return y[a];var $=i[a]-O-f,F=i[a]+f;if(t[a])return w[a]?$:F;if(w[a]){var H=$,Y=o[a];return H<Y?Math.max(F,o[a]):Math.max($,o[a])}var oe=F+O,te=o[a]+L;return oe>te?Math.max($,o[a]):Math.max(F,o[a])}function WJ(e){var t=e.translateX,i=e.translateY,a=e.useTranslate3d;return{transform:a?"translate3d(".concat(t,"px, ").concat(i,"px, 0)"):"translate(".concat(t,"px, ").concat(i,"px)")}}function HJ(e){var t=e.allowEscapeViewBox,i=e.coordinate,a=e.offsetTopLeft,f=e.position,y=e.reverseDirection,w=e.tooltipBox,O=e.useTranslate3d,o=e.viewBox,L,$,F;return w.height>0&&w.width>0&&i?($=ZD({allowEscapeViewBox:t,coordinate:i,key:"x",offsetTopLeft:a,position:f,reverseDirection:y,tooltipDimension:w.width,viewBox:o,viewBoxDimension:o.width}),F=ZD({allowEscapeViewBox:t,coordinate:i,key:"y",offsetTopLeft:a,position:f,reverseDirection:y,tooltipDimension:w.height,viewBox:o,viewBoxDimension:o.height}),L=WJ({translateX:$,translateY:F,useTranslate3d:O})):L=GJ,{cssProperties:L,cssClasses:qJ({translateX:$,translateY:F,coordinate:i})}}function Bd(e){"@babel/helpers - typeof";return Bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bd(e)}function XD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function YD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XD(Object(i),!0).forEach(function(a){vA(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function ZJ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XJ(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,cN(a.key),a)}}function YJ(e,t,i){return t&&XJ(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function KJ(e,t,i){return t=wx(t),JJ(e,lN()?Reflect.construct(t,i||[],wx(e).constructor):t.apply(e,i))}function JJ(e,t){if(t&&(Bd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QJ(e)}function QJ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lN=function(){return!!e})()}function wx(e){return wx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},wx(e)}function eQ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_A(e,t)}function _A(e,t){return _A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},_A(e,t)}function vA(e,t,i){return t=cN(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function cN(e){var t=tQ(e,"string");return Bd(t)=="symbol"?t:t+""}function tQ(e,t){if(Bd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Bd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KD=1,rQ=function(e){function t(){var i;ZJ(this,t);for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];return i=KJ(this,t,[].concat(f)),vA(i,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),vA(i,"handleKeyDown",function(w){if(w.key==="Escape"){var O,o,L,$;i.setState({dismissed:!0,dismissedAtCoordinate:{x:(O=(o=i.props.coordinate)===null||o===void 0?void 0:o.x)!==null&&O!==void 0?O:0,y:(L=($=i.props.coordinate)===null||$===void 0?void 0:$.y)!==null&&L!==void 0?L:0}})}}),i}return eQ(t,e),YJ(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var a=this.wrapperNode.getBoundingClientRect();(Math.abs(a.width-this.state.lastBoundingBox.width)>KD||Math.abs(a.height-this.state.lastBoundingBox.height)>KD)&&this.setState({lastBoundingBox:{width:a.width,height:a.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var a,f;this.props.active&&this.updateBBox(),this.state.dismissed&&(((a=this.props.coordinate)===null||a===void 0?void 0:a.x)!==this.state.dismissedAtCoordinate.x||((f=this.props.coordinate)===null||f===void 0?void 0:f.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var a=this,f=this.props,y=f.active,w=f.allowEscapeViewBox,O=f.animationDuration,o=f.animationEasing,L=f.children,$=f.coordinate,F=f.hasPayload,H=f.isAnimationActive,Y=f.offset,oe=f.position,te=f.reverseDirection,ie=f.useTranslate3d,ae=f.viewBox,J=f.wrapperStyle,ue=HJ({allowEscapeViewBox:w,coordinate:$,offsetTopLeft:Y,position:oe,reverseDirection:te,tooltipBox:this.state.lastBoundingBox,useTranslate3d:ie,viewBox:ae}),le=ue.cssClasses,se=ue.cssProperties,be=YD(YD({transition:H&&y?"transform ".concat(O,"ms ").concat(o):void 0},se),{},{pointerEvents:"none",visibility:!this.state.dismissed&&y&&F?"visible":"hidden",position:"absolute",top:0,left:0},J);return tt.createElement("div",{tabIndex:-1,className:le,style:be,ref:function(Ae){a.wrapperNode=Ae}},L)}}])}(Wt.PureComponent),nQ=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Us={isSsr:nQ(),get:function(t){return Us[t]},set:function(t,i){if(typeof t=="string")Us[t]=i;else{var a=Object.keys(t);a&&a.length&&a.forEach(function(f){Us[f]=t[f]})}}};function Fd(e){"@babel/helpers - typeof";return Fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fd(e)}function JD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function QD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JD(Object(i),!0).forEach(function(a){jM(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JD(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function iQ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oQ(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,hN(a.key),a)}}function aQ(e,t,i){return t&&oQ(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function sQ(e,t,i){return t=Tx(t),lQ(e,uN()?Reflect.construct(t,i||[],Tx(e).constructor):t.apply(e,i))}function lQ(e,t){if(t&&(Fd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cQ(e)}function cQ(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uN=function(){return!!e})()}function Tx(e){return Tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Tx(e)}function uQ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xA(e,t)}function xA(e,t){return xA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},xA(e,t)}function jM(e,t,i){return t=hN(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function hN(e){var t=hQ(e,"string");return Fd(t)=="symbol"?t:t+""}function hQ(e,t){if(Fd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Fd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fQ(e){return e.dataKey}function dQ(e,t){return tt.isValidElement(e)?tt.cloneElement(e,t):typeof e=="function"?tt.createElement(e,t):tt.createElement($J,t)}var cs=function(e){function t(){return iQ(this,t),sQ(this,t,arguments)}return uQ(t,e),aQ(t,[{key:"render",value:function(){var a=this,f=this.props,y=f.active,w=f.allowEscapeViewBox,O=f.animationDuration,o=f.animationEasing,L=f.content,$=f.coordinate,F=f.filterNull,H=f.isAnimationActive,Y=f.offset,oe=f.payload,te=f.payloadUniqBy,ie=f.position,ae=f.reverseDirection,J=f.useTranslate3d,ue=f.viewBox,le=f.wrapperStyle,se=oe??[];F&&se.length&&(se=eN(oe.filter(function(Ie){return Ie.value!=null&&(Ie.hide!==!0||a.props.includeHidden)}),te,fQ));var be=se.length>0;return tt.createElement(rQ,{allowEscapeViewBox:w,animationDuration:O,animationEasing:o,isAnimationActive:H,active:y,coordinate:$,hasPayload:be,offset:Y,position:ie,reverseDirection:ae,useTranslate3d:J,viewBox:ue,wrapperStyle:le},dQ(L,QD(QD({},this.props),{},{payload:se})))}}])}(Wt.PureComponent);jM(cs,"displayName","Tooltip");jM(cs,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Us.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var pQ=Zs,mQ=function(){return pQ.Date.now()},gQ=mQ,yQ=/\s/;function _Q(e){for(var t=e.length;t--&&yQ.test(e.charAt(t)););return t}var vQ=_Q,xQ=vQ,bQ=/^\s+/;function wQ(e){return e&&e.slice(0,xQ(e)+1).replace(bQ,"")}var TQ=wQ,SQ=TQ,eL=au,AQ=sp,tL=NaN,EQ=/^[-+]0x[0-9a-f]+$/i,MQ=/^0b[01]+$/i,PQ=/^0o[0-7]+$/i,IQ=parseInt;function CQ(e){if(typeof e=="number")return e;if(AQ(e))return tL;if(eL(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=eL(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=SQ(e);var i=MQ.test(e);return i||PQ.test(e)?IQ(e.slice(2),i?2:8):EQ.test(e)?tL:+e}var fN=CQ,OQ=au,NT=gQ,rL=fN,kQ="Expected a function",DQ=Math.max,LQ=Math.min;function RQ(e,t,i){var a,f,y,w,O,o,L=0,$=!1,F=!1,H=!0;if(typeof e!="function")throw new TypeError(kQ);t=rL(t)||0,OQ(i)&&($=!!i.leading,F="maxWait"in i,y=F?DQ(rL(i.maxWait)||0,t):y,H="trailing"in i?!!i.trailing:H);function Y(be){var Ie=a,Ae=f;return a=f=void 0,L=be,w=e.apply(Ae,Ie),w}function oe(be){return L=be,O=setTimeout(ae,t),$?Y(be):w}function te(be){var Ie=be-o,Ae=be-L,ht=t-Ie;return F?LQ(ht,y-Ae):ht}function ie(be){var Ie=be-o,Ae=be-L;return o===void 0||Ie>=t||Ie<0||F&&Ae>=y}function ae(){var be=NT();if(ie(be))return J(be);O=setTimeout(ae,te(be))}function J(be){return O=void 0,H&&a?Y(be):(a=f=void 0,w)}function ue(){O!==void 0&&clearTimeout(O),L=0,a=o=f=O=void 0}function le(){return O===void 0?w:J(NT())}function se(){var be=NT(),Ie=ie(be);if(a=arguments,f=this,o=be,Ie){if(O===void 0)return oe(o);if(F)return clearTimeout(O),O=setTimeout(ae,t),Y(o)}return O===void 0&&(O=setTimeout(ae,t)),w}return se.cancel=ue,se.flush=le,se}var zQ=RQ,BQ=zQ,FQ=au,NQ="Expected a function";function jQ(e,t,i){var a=!0,f=!0;if(typeof e!="function")throw new TypeError(NQ);return FQ(i)&&(a="leading"in i?!!i.leading:a,f="trailing"in i?!!i.trailing:f),BQ(e,t,{leading:a,maxWait:t,trailing:f})}var $Q=jQ;const dN=Fn($Q);function yy(e){"@babel/helpers - typeof";return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yy(e)}function nL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function g0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nL(Object(i),!0).forEach(function(a){UQ(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nL(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function UQ(e,t,i){return t=VQ(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function VQ(e){var t=GQ(e,"string");return yy(t)=="symbol"?t:t+""}function GQ(e,t){if(yy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(yy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qQ(e,t){return XQ(e)||ZQ(e,t)||HQ(e,t)||WQ()}function WQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HQ(e,t){if(e){if(typeof e=="string")return iL(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return iL(e,t)}}function iL(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function ZQ(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function XQ(e){if(Array.isArray(e))return e}var $M=Wt.forwardRef(function(e,t){var i=e.aspect,a=e.initialDimension,f=a===void 0?{width:-1,height:-1}:a,y=e.width,w=y===void 0?"100%":y,O=e.height,o=O===void 0?"100%":O,L=e.minWidth,$=L===void 0?0:L,F=e.minHeight,H=e.maxHeight,Y=e.children,oe=e.debounce,te=oe===void 0?0:oe,ie=e.id,ae=e.className,J=e.onResize,ue=e.style,le=ue===void 0?{}:ue,se=Wt.useRef(null),be=Wt.useRef();be.current=J,Wt.useImperativeHandle(t,function(){return Object.defineProperty(se.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),se.current},configurable:!0})});var Ie=Wt.useState({containerWidth:f.width,containerHeight:f.height}),Ae=qQ(Ie,2),ht=Ae[0],st=Ae[1],We=Wt.useCallback(function(At,Tt){st(function(kt){var ct=Math.round(At),Ot=Math.round(Tt);return kt.containerWidth===ct&&kt.containerHeight===Ot?kt:{containerWidth:ct,containerHeight:Ot}})},[]);Wt.useEffect(function(){var At=function(Lt){var yt,Zt=Lt[0].contentRect,Yt=Zt.width,xr=Zt.height;We(Yt,xr),(yt=be.current)===null||yt===void 0||yt.call(be,Yt,xr)};te>0&&(At=dN(At,te,{trailing:!0,leading:!1}));var Tt=new ResizeObserver(At),kt=se.current.getBoundingClientRect(),ct=kt.width,Ot=kt.height;return We(ct,Ot),Tt.observe(se.current),function(){Tt.disconnect()}},[We,te]);var He=Wt.useMemo(function(){var At=ht.containerWidth,Tt=ht.containerHeight;if(At<0||Tt<0)return null;vh(fh(w)||fh(o),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,w,o),vh(!i||i>0,"The aspect(%s) must be greater than zero.",i);var kt=fh(w)?At:w,ct=fh(o)?Tt:o;i&&i>0&&(kt?ct=kt/i:ct&&(kt=ct*i),H&&ct>H&&(ct=H)),vh(kt>0||ct>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,kt,ct,w,o,$,F,i);var Ot=!Array.isArray(Y)&&Tl(Y.type).endsWith("Chart");return tt.Children.map(Y,function(mt){return cF.isElement(mt)?Wt.cloneElement(mt,g0({width:kt,height:ct},Ot?{style:g0({height:"100%",width:"100%",maxHeight:ct,maxWidth:kt},mt.props.style)}:{})):mt})},[i,Y,o,H,F,$,ht,w]);return tt.createElement("div",{id:ie?"".concat(ie):void 0,className:pn("recharts-responsive-container",ae),style:g0(g0({},le),{},{width:w,height:o,minWidth:$,minHeight:F,maxHeight:H}),ref:se},He)}),pN=function(t){return null};pN.displayName="Cell";function _y(e){"@babel/helpers - typeof";return _y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_y(e)}function oL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function bA(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?oL(Object(i),!0).forEach(function(a){YQ(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oL(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function YQ(e,t,i){return t=KQ(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function KQ(e){var t=JQ(e,"string");return _y(t)=="symbol"?t:t+""}function JQ(e,t){if(_y(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(_y(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Jf={widthCache:{},cacheCount:0},QQ=2e3,eee={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},aL="recharts_measurement_span";function tee(e){var t=bA({},e);return Object.keys(t).forEach(function(i){t[i]||delete t[i]}),t}var Gg=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Us.isSsr)return{width:0,height:0};var a=tee(i),f=JSON.stringify({text:t,copyStyle:a});if(Jf.widthCache[f])return Jf.widthCache[f];try{var y=document.getElementById(aL);y||(y=document.createElement("span"),y.setAttribute("id",aL),y.setAttribute("aria-hidden","true"),document.body.appendChild(y));var w=bA(bA({},eee),a);Object.assign(y.style,w),y.textContent="".concat(t);var O=y.getBoundingClientRect(),o={width:O.width,height:O.height};return Jf.widthCache[f]=o,++Jf.cacheCount>QQ&&(Jf.cacheCount=0,Jf.widthCache={}),o}catch{return{width:0,height:0}}},ree=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function vy(e){"@babel/helpers - typeof";return vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vy(e)}function Sx(e,t){return aee(e)||oee(e,t)||iee(e,t)||nee()}function nee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iee(e,t){if(e){if(typeof e=="string")return sL(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return sL(e,t)}}function sL(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function oee(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t===0){if(Object(i)!==i)return;o=!1}else for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function aee(e){if(Array.isArray(e))return e}function see(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lL(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,cee(a.key),a)}}function lee(e,t,i){return t&&lL(e.prototype,t),i&&lL(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function cee(e){var t=uee(e,"string");return vy(t)=="symbol"?t:t+""}function uee(e,t){if(vy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t);if(vy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var cL=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,uL=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,hee=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,fee=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,mN={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},dee=Object.keys(mN),pd="NaN";function pee(e,t){return e*mN[t]}var y0=function(){function e(t,i){see(this,e),this.num=t,this.unit=i,this.num=t,this.unit=i,Number.isNaN(t)&&(this.unit=""),i!==""&&!hee.test(i)&&(this.num=NaN,this.unit=""),dee.includes(i)&&(this.num=pee(t,i),this.unit="px")}return lee(e,[{key:"add",value:function(i){return this.unit!==i.unit?new e(NaN,""):new e(this.num+i.num,this.unit)}},{key:"subtract",value:function(i){return this.unit!==i.unit?new e(NaN,""):new e(this.num-i.num,this.unit)}},{key:"multiply",value:function(i){return this.unit!==""&&i.unit!==""&&this.unit!==i.unit?new e(NaN,""):new e(this.num*i.num,this.unit||i.unit)}},{key:"divide",value:function(i){return this.unit!==""&&i.unit!==""&&this.unit!==i.unit?new e(NaN,""):new e(this.num/i.num,this.unit||i.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(i){var a,f=(a=fee.exec(i))!==null&&a!==void 0?a:[],y=Sx(f,3),w=y[1],O=y[2];return new e(parseFloat(w),O??"")}}])}();function gN(e){if(e.includes(pd))return pd;for(var t=e;t.includes("*")||t.includes("/");){var i,a=(i=cL.exec(t))!==null&&i!==void 0?i:[],f=Sx(a,4),y=f[1],w=f[2],O=f[3],o=y0.parse(y??""),L=y0.parse(O??""),$=w==="*"?o.multiply(L):o.divide(L);if($.isNaN())return pd;t=t.replace(cL,$.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var F,H=(F=uL.exec(t))!==null&&F!==void 0?F:[],Y=Sx(H,4),oe=Y[1],te=Y[2],ie=Y[3],ae=y0.parse(oe??""),J=y0.parse(ie??""),ue=te==="+"?ae.add(J):ae.subtract(J);if(ue.isNaN())return pd;t=t.replace(uL,ue.toString())}return t}var hL=/\(([^()]*)\)/;function mee(e){for(var t=e;t.includes("(");){var i=hL.exec(t),a=Sx(i,2),f=a[1];t=t.replace(hL,gN(f))}return t}function gee(e){var t=e.replace(/\s+/g,"");return t=mee(t),t=gN(t),t}function yee(e){try{return gee(e)}catch{return pd}}function jT(e){var t=yee(e.slice(5,-1));return t===pd?"":t}var _ee=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],vee=["dx","dy","angle","className","breakAll"];function wA(){return wA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},wA.apply(this,arguments)}function fL(e,t){if(e==null)return{};var i=xee(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function xee(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function dL(e,t){return See(e)||Tee(e,t)||wee(e,t)||bee()}function bee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wee(e,t){if(e){if(typeof e=="string")return pL(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return pL(e,t)}}function pL(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Tee(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t===0){if(Object(i)!==i)return;o=!1}else for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function See(e){if(Array.isArray(e))return e}var yN=/[ \f\n\r\t\v\u2028\u2029]+/,_N=function(t){var i=t.children,a=t.breakAll,f=t.style;try{var y=[];en(i)||(a?y=i.toString().split(""):y=i.toString().split(yN));var w=y.map(function(o){return{word:o,width:Gg(o,f).width}}),O=a?0:Gg(" ",f).width;return{wordsWithComputedWidth:w,spaceWidth:O}}catch{return null}},Aee=function(t,i,a,f,y){var w=t.maxLines,O=t.children,o=t.style,L=t.breakAll,$=tr(w),F=O,H=function(){var kt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return kt.reduce(function(ct,Ot){var mt=Ot.word,Lt=Ot.width,yt=ct[ct.length-1];if(yt&&(f==null||y||yt.width+Lt+a<Number(f)))yt.words.push(mt),yt.width+=Lt+a;else{var Zt={words:[mt],width:Lt};ct.push(Zt)}return ct},[])},Y=H(i),oe=function(kt){return kt.reduce(function(ct,Ot){return ct.width>Ot.width?ct:Ot})};if(!$)return Y;for(var te="…",ie=function(kt){var ct=F.slice(0,kt),Ot=_N({breakAll:L,style:o,children:ct+te}).wordsWithComputedWidth,mt=H(Ot),Lt=mt.length>w||oe(mt).width>Number(f);return[Lt,mt]},ae=0,J=F.length-1,ue=0,le;ae<=J&&ue<=F.length-1;){var se=Math.floor((ae+J)/2),be=se-1,Ie=ie(be),Ae=dL(Ie,2),ht=Ae[0],st=Ae[1],We=ie(se),He=dL(We,1),At=He[0];if(!ht&&!At&&(ae=se+1),ht&&At&&(J=se-1),!ht&&At){le=st;break}ue++}return le||Y},mL=function(t){var i=en(t)?[]:t.toString().split(yN);return[{words:i}]},Eee=function(t){var i=t.width,a=t.scaleToFit,f=t.children,y=t.style,w=t.breakAll,O=t.maxLines;if((i||a)&&!Us.isSsr){var o,L,$=_N({breakAll:w,children:f,style:y});if($){var F=$.wordsWithComputedWidth,H=$.spaceWidth;o=F,L=H}else return mL(f);return Aee({breakAll:w,children:f,maxLines:O,style:y},o,L,i,a)}return mL(f)},gL="#808080",Ax=function(t){var i=t.x,a=i===void 0?0:i,f=t.y,y=f===void 0?0:f,w=t.lineHeight,O=w===void 0?"1em":w,o=t.capHeight,L=o===void 0?"0.71em":o,$=t.scaleToFit,F=$===void 0?!1:$,H=t.textAnchor,Y=H===void 0?"start":H,oe=t.verticalAnchor,te=oe===void 0?"end":oe,ie=t.fill,ae=ie===void 0?gL:ie,J=fL(t,_ee),ue=Wt.useMemo(function(){return Eee({breakAll:J.breakAll,children:J.children,maxLines:J.maxLines,scaleToFit:F,style:J.style,width:J.width})},[J.breakAll,J.children,J.maxLines,F,J.style,J.width]),le=J.dx,se=J.dy,be=J.angle,Ie=J.className,Ae=J.breakAll,ht=fL(J,vee);if(!Pi(a)||!Pi(y))return null;var st=a+(tr(le)?le:0),We=y+(tr(se)?se:0),He;switch(te){case"start":He=jT("calc(".concat(L,")"));break;case"middle":He=jT("calc(".concat((ue.length-1)/2," * -").concat(O," + (").concat(L," / 2))"));break;default:He=jT("calc(".concat(ue.length-1," * -").concat(O,")"));break}var At=[];if(F){var Tt=ue[0].width,kt=J.width;At.push("scale(".concat((tr(kt)?kt/Tt:1)/Tt,")"))}return be&&At.push("rotate(".concat(be,", ").concat(st,", ").concat(We,")")),At.length&&(ht.transform=At.join(" ")),tt.createElement("text",wA({},Yr(ht,!0),{x:st,y:We,className:pn("recharts-text",Ie),textAnchor:Y,fill:ae.includes("url")?gL:ae}),ue.map(function(ct,Ot){var mt=ct.words.join(Ae?"":" ");return tt.createElement("tspan",{x:st,dy:Ot===0?He:O,key:"".concat(mt,"-").concat(Ot)},mt)}))};function eu(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Mee(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function UM(e){let t,i,a;e.length!==2?(t=eu,i=(O,o)=>eu(e(O),o),a=(O,o)=>e(O)-o):(t=e===eu||e===Mee?e:Pee,i=e,a=e);function f(O,o,L=0,$=O.length){if(L<$){if(t(o,o)!==0)return $;do{const F=L+$>>>1;i(O[F],o)<0?L=F+1:$=F}while(L<$)}return L}function y(O,o,L=0,$=O.length){if(L<$){if(t(o,o)!==0)return $;do{const F=L+$>>>1;i(O[F],o)<=0?L=F+1:$=F}while(L<$)}return L}function w(O,o,L=0,$=O.length){const F=f(O,o,L,$-1);return F>L&&a(O[F-1],o)>-a(O[F],o)?F-1:F}return{left:f,center:w,right:y}}function Pee(){return 0}function vN(e){return e===null?NaN:+e}function*Iee(e,t){for(let i of e)i!=null&&(i=+i)>=i&&(yield i)}const Cee=UM(eu),t_=Cee.right;UM(vN).center;class yL extends Map{constructor(t,i=Dee){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:i}}),t!=null)for(const[a,f]of t)this.set(a,f)}get(t){return super.get(_L(this,t))}has(t){return super.has(_L(this,t))}set(t,i){return super.set(Oee(this,t),i)}delete(t){return super.delete(kee(this,t))}}function _L({_intern:e,_key:t},i){const a=t(i);return e.has(a)?e.get(a):i}function Oee({_intern:e,_key:t},i){const a=t(i);return e.has(a)?e.get(a):(e.set(a,i),i)}function kee({_intern:e,_key:t},i){const a=t(i);return e.has(a)&&(i=e.get(a),e.delete(a)),i}function Dee(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Lee(e=eu){if(e===eu)return xN;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,i)=>{const a=e(t,i);return a||a===0?a:(e(i,i)===0)-(e(t,t)===0)}}function xN(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const Ree=Math.sqrt(50),zee=Math.sqrt(10),Bee=Math.sqrt(2);function Ex(e,t,i){const a=(t-e)/Math.max(0,i),f=Math.floor(Math.log10(a)),y=a/Math.pow(10,f),w=y>=Ree?10:y>=zee?5:y>=Bee?2:1;let O,o,L;return f<0?(L=Math.pow(10,-f)/w,O=Math.round(e*L),o=Math.round(t*L),O/L<e&&++O,o/L>t&&--o,L=-L):(L=Math.pow(10,f)*w,O=Math.round(e/L),o=Math.round(t/L),O*L<e&&++O,o*L>t&&--o),o<O&&.5<=i&&i<2?Ex(e,t,i*2):[O,o,L]}function TA(e,t,i){if(t=+t,e=+e,i=+i,!(i>0))return[];if(e===t)return[e];const a=t<e,[f,y,w]=a?Ex(t,e,i):Ex(e,t,i);if(!(y>=f))return[];const O=y-f+1,o=new Array(O);if(a)if(w<0)for(let L=0;L<O;++L)o[L]=(y-L)/-w;else for(let L=0;L<O;++L)o[L]=(y-L)*w;else if(w<0)for(let L=0;L<O;++L)o[L]=(f+L)/-w;else for(let L=0;L<O;++L)o[L]=(f+L)*w;return o}function SA(e,t,i){return t=+t,e=+e,i=+i,Ex(e,t,i)[2]}function AA(e,t,i){t=+t,e=+e,i=+i;const a=t<e,f=a?SA(t,e,i):SA(e,t,i);return(a?-1:1)*(f<0?1/-f:f)}function vL(e,t){let i;for(const a of e)a!=null&&(i<a||i===void 0&&a>=a)&&(i=a);return i}function xL(e,t){let i;for(const a of e)a!=null&&(i>a||i===void 0&&a>=a)&&(i=a);return i}function bN(e,t,i=0,a=1/0,f){if(t=Math.floor(t),i=Math.floor(Math.max(0,i)),a=Math.floor(Math.min(e.length-1,a)),!(i<=t&&t<=a))return e;for(f=f===void 0?xN:Lee(f);a>i;){if(a-i>600){const o=a-i+1,L=t-i+1,$=Math.log(o),F=.5*Math.exp(2*$/3),H=.5*Math.sqrt($*F*(o-F)/o)*(L-o/2<0?-1:1),Y=Math.max(i,Math.floor(t-L*F/o+H)),oe=Math.min(a,Math.floor(t+(o-L)*F/o+H));bN(e,t,Y,oe,f)}const y=e[t];let w=i,O=a;for(bg(e,i,t),f(e[a],y)>0&&bg(e,i,a);w<O;){for(bg(e,w,O),++w,--O;f(e[w],y)<0;)++w;for(;f(e[O],y)>0;)--O}f(e[i],y)===0?bg(e,i,O):(++O,bg(e,O,a)),O<=t&&(i=O+1),t<=O&&(a=O-1)}return e}function bg(e,t,i){const a=e[t];e[t]=e[i],e[i]=a}function Fee(e,t,i){if(e=Float64Array.from(Iee(e)),!(!(a=e.length)||isNaN(t=+t))){if(t<=0||a<2)return xL(e);if(t>=1)return vL(e);var a,f=(a-1)*t,y=Math.floor(f),w=vL(bN(e,y).subarray(0,y+1)),O=xL(e.subarray(y+1));return w+(O-w)*(f-y)}}function Nee(e,t,i=vN){if(!(!(a=e.length)||isNaN(t=+t))){if(t<=0||a<2)return+i(e[0],0,e);if(t>=1)return+i(e[a-1],a-1,e);var a,f=(a-1)*t,y=Math.floor(f),w=+i(e[y],y,e),O=+i(e[y+1],y+1,e);return w+(O-w)*(f-y)}}function jee(e,t,i){e=+e,t=+t,i=(f=arguments.length)<2?(t=e,e=0,1):f<3?1:+i;for(var a=-1,f=Math.max(0,Math.ceil((t-e)/i))|0,y=new Array(f);++a<f;)y[a]=e+a*i;return y}function ja(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function zl(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const EA=Symbol("implicit");function VM(){var e=new yL,t=[],i=[],a=EA;function f(y){let w=e.get(y);if(w===void 0){if(a!==EA)return a;e.set(y,w=t.push(y)-1)}return i[w%i.length]}return f.domain=function(y){if(!arguments.length)return t.slice();t=[],e=new yL;for(const w of y)e.has(w)||e.set(w,t.push(w)-1);return f},f.range=function(y){return arguments.length?(i=Array.from(y),f):i.slice()},f.unknown=function(y){return arguments.length?(a=y,f):a},f.copy=function(){return VM(t,i).unknown(a)},ja.apply(f,arguments),f}function xy(){var e=VM().unknown(void 0),t=e.domain,i=e.range,a=0,f=1,y,w,O=!1,o=0,L=0,$=.5;delete e.unknown;function F(){var H=t().length,Y=f<a,oe=Y?f:a,te=Y?a:f;y=(te-oe)/Math.max(1,H-o+L*2),O&&(y=Math.floor(y)),oe+=(te-oe-y*(H-o))*$,w=y*(1-o),O&&(oe=Math.round(oe),w=Math.round(w));var ie=jee(H).map(function(ae){return oe+y*ae});return i(Y?ie.reverse():ie)}return e.domain=function(H){return arguments.length?(t(H),F()):t()},e.range=function(H){return arguments.length?([a,f]=H,a=+a,f=+f,F()):[a,f]},e.rangeRound=function(H){return[a,f]=H,a=+a,f=+f,O=!0,F()},e.bandwidth=function(){return w},e.step=function(){return y},e.round=function(H){return arguments.length?(O=!!H,F()):O},e.padding=function(H){return arguments.length?(o=Math.min(1,L=+H),F()):o},e.paddingInner=function(H){return arguments.length?(o=Math.min(1,H),F()):o},e.paddingOuter=function(H){return arguments.length?(L=+H,F()):L},e.align=function(H){return arguments.length?($=Math.max(0,Math.min(1,H)),F()):$},e.copy=function(){return xy(t(),[a,f]).round(O).paddingInner(o).paddingOuter(L).align($)},ja.apply(F(),arguments)}function wN(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return wN(t())},e}function qg(){return wN(xy.apply(null,arguments).paddingInner(1))}function GM(e,t,i){e.prototype=t.prototype=i,i.constructor=e}function TN(e,t){var i=Object.create(e.prototype);for(var a in t)i[a]=t[a];return i}function r_(){}var by=.7,Mx=1/by,Sd="\\s*([+-]?\\d+)\\s*",wy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$ee=/^#([0-9a-f]{3,8})$/,Uee=new RegExp(`^rgb\\(${Sd},${Sd},${Sd}\\)$`),Vee=new RegExp(`^rgb\\(${Vs},${Vs},${Vs}\\)$`),Gee=new RegExp(`^rgba\\(${Sd},${Sd},${Sd},${wy}\\)$`),qee=new RegExp(`^rgba\\(${Vs},${Vs},${Vs},${wy}\\)$`),Wee=new RegExp(`^hsl\\(${wy},${Vs},${Vs}\\)$`),Hee=new RegExp(`^hsla\\(${wy},${Vs},${Vs},${wy}\\)$`),bL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};GM(r_,Ty,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:wL,formatHex:wL,formatHex8:Zee,formatHsl:Xee,formatRgb:TL,toString:TL});function wL(){return this.rgb().formatHex()}function Zee(){return this.rgb().formatHex8()}function Xee(){return SN(this).formatHsl()}function TL(){return this.rgb().formatRgb()}function Ty(e){var t,i;return e=(e+"").trim().toLowerCase(),(t=$ee.exec(e))?(i=t[1].length,t=parseInt(t[1],16),i===6?SL(t):i===3?new No(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):i===8?_0(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):i===4?_0(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Uee.exec(e))?new No(t[1],t[2],t[3],1):(t=Vee.exec(e))?new No(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Gee.exec(e))?_0(t[1],t[2],t[3],t[4]):(t=qee.exec(e))?_0(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Wee.exec(e))?ML(t[1],t[2]/100,t[3]/100,1):(t=Hee.exec(e))?ML(t[1],t[2]/100,t[3]/100,t[4]):bL.hasOwnProperty(e)?SL(bL[e]):e==="transparent"?new No(NaN,NaN,NaN,0):null}function SL(e){return new No(e>>16&255,e>>8&255,e&255,1)}function _0(e,t,i,a){return a<=0&&(e=t=i=NaN),new No(e,t,i,a)}function Yee(e){return e instanceof r_||(e=Ty(e)),e?(e=e.rgb(),new No(e.r,e.g,e.b,e.opacity)):new No}function MA(e,t,i,a){return arguments.length===1?Yee(e):new No(e,t,i,a??1)}function No(e,t,i,a){this.r=+e,this.g=+t,this.b=+i,this.opacity=+a}GM(No,MA,TN(r_,{brighter(e){return e=e==null?Mx:Math.pow(Mx,e),new No(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?by:Math.pow(by,e),new No(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new No(xh(this.r),xh(this.g),xh(this.b),Px(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:AL,formatHex:AL,formatHex8:Kee,formatRgb:EL,toString:EL}));function AL(){return`#${dh(this.r)}${dh(this.g)}${dh(this.b)}`}function Kee(){return`#${dh(this.r)}${dh(this.g)}${dh(this.b)}${dh((isNaN(this.opacity)?1:this.opacity)*255)}`}function EL(){const e=Px(this.opacity);return`${e===1?"rgb(":"rgba("}${xh(this.r)}, ${xh(this.g)}, ${xh(this.b)}${e===1?")":`, ${e})`}`}function Px(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function xh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function dh(e){return e=xh(e),(e<16?"0":"")+e.toString(16)}function ML(e,t,i,a){return a<=0?e=t=i=NaN:i<=0||i>=1?e=t=NaN:t<=0&&(e=NaN),new ds(e,t,i,a)}function SN(e){if(e instanceof ds)return new ds(e.h,e.s,e.l,e.opacity);if(e instanceof r_||(e=Ty(e)),!e)return new ds;if(e instanceof ds)return e;e=e.rgb();var t=e.r/255,i=e.g/255,a=e.b/255,f=Math.min(t,i,a),y=Math.max(t,i,a),w=NaN,O=y-f,o=(y+f)/2;return O?(t===y?w=(i-a)/O+(i<a)*6:i===y?w=(a-t)/O+2:w=(t-i)/O+4,O/=o<.5?y+f:2-y-f,w*=60):O=o>0&&o<1?0:w,new ds(w,O,o,e.opacity)}function Jee(e,t,i,a){return arguments.length===1?SN(e):new ds(e,t,i,a??1)}function ds(e,t,i,a){this.h=+e,this.s=+t,this.l=+i,this.opacity=+a}GM(ds,Jee,TN(r_,{brighter(e){return e=e==null?Mx:Math.pow(Mx,e),new ds(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?by:Math.pow(by,e),new ds(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,a=i+(i<.5?i:1-i)*t,f=2*i-a;return new No($T(e>=240?e-240:e+120,f,a),$T(e,f,a),$T(e<120?e+240:e-120,f,a),this.opacity)},clamp(){return new ds(PL(this.h),v0(this.s),v0(this.l),Px(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Px(this.opacity);return`${e===1?"hsl(":"hsla("}${PL(this.h)}, ${v0(this.s)*100}%, ${v0(this.l)*100}%${e===1?")":`, ${e})`}`}}));function PL(e){return e=(e||0)%360,e<0?e+360:e}function v0(e){return Math.max(0,Math.min(1,e||0))}function $T(e,t,i){return(e<60?t+(i-t)*e/60:e<180?i:e<240?t+(i-t)*(240-e)/60:t)*255}const qM=e=>()=>e;function Qee(e,t){return function(i){return e+i*t}}function ete(e,t,i){return e=Math.pow(e,i),t=Math.pow(t,i)-e,i=1/i,function(a){return Math.pow(e+a*t,i)}}function tte(e){return(e=+e)==1?AN:function(t,i){return i-t?ete(t,i,e):qM(isNaN(t)?i:t)}}function AN(e,t){var i=t-e;return i?Qee(e,i):qM(isNaN(e)?t:e)}const IL=function e(t){var i=tte(t);function a(f,y){var w=i((f=MA(f)).r,(y=MA(y)).r),O=i(f.g,y.g),o=i(f.b,y.b),L=AN(f.opacity,y.opacity);return function($){return f.r=w($),f.g=O($),f.b=o($),f.opacity=L($),f+""}}return a.gamma=e,a}(1);function rte(e,t){t||(t=[]);var i=e?Math.min(t.length,e.length):0,a=t.slice(),f;return function(y){for(f=0;f<i;++f)a[f]=e[f]*(1-y)+t[f]*y;return a}}function nte(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ite(e,t){var i=t?t.length:0,a=e?Math.min(i,e.length):0,f=new Array(a),y=new Array(i),w;for(w=0;w<a;++w)f[w]=_p(e[w],t[w]);for(;w<i;++w)y[w]=t[w];return function(O){for(w=0;w<a;++w)y[w]=f[w](O);return y}}function ote(e,t){var i=new Date;return e=+e,t=+t,function(a){return i.setTime(e*(1-a)+t*a),i}}function Ix(e,t){return e=+e,t=+t,function(i){return e*(1-i)+t*i}}function ate(e,t){var i={},a={},f;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(f in t)f in e?i[f]=_p(e[f],t[f]):a[f]=t[f];return function(y){for(f in i)a[f]=i[f](y);return a}}var PA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,UT=new RegExp(PA.source,"g");function ste(e){return function(){return e}}function lte(e){return function(t){return e(t)+""}}function cte(e,t){var i=PA.lastIndex=UT.lastIndex=0,a,f,y,w=-1,O=[],o=[];for(e=e+"",t=t+"";(a=PA.exec(e))&&(f=UT.exec(t));)(y=f.index)>i&&(y=t.slice(i,y),O[w]?O[w]+=y:O[++w]=y),(a=a[0])===(f=f[0])?O[w]?O[w]+=f:O[++w]=f:(O[++w]=null,o.push({i:w,x:Ix(a,f)})),i=UT.lastIndex;return i<t.length&&(y=t.slice(i),O[w]?O[w]+=y:O[++w]=y),O.length<2?o[0]?lte(o[0].x):ste(t):(t=o.length,function(L){for(var $=0,F;$<t;++$)O[(F=o[$]).i]=F.x(L);return O.join("")})}function _p(e,t){var i=typeof t,a;return t==null||i==="boolean"?qM(t):(i==="number"?Ix:i==="string"?(a=Ty(t))?(t=a,IL):cte:t instanceof Ty?IL:t instanceof Date?ote:nte(t)?rte:Array.isArray(t)?ite:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ate:Ix)(e,t)}function WM(e,t){return e=+e,t=+t,function(i){return Math.round(e*(1-i)+t*i)}}function ute(e,t){t===void 0&&(t=e,e=_p);for(var i=0,a=t.length-1,f=t[0],y=new Array(a<0?0:a);i<a;)y[i]=e(f,f=t[++i]);return function(w){var O=Math.max(0,Math.min(a-1,Math.floor(w*=a)));return y[O](w-O)}}function hte(e){return function(){return e}}function Cx(e){return+e}var CL=[0,1];function Ao(e){return e}function IA(e,t){return(t-=e=+e)?function(i){return(i-e)/t}:hte(isNaN(t)?NaN:.5)}function fte(e,t){var i;return e>t&&(i=e,e=t,t=i),function(a){return Math.max(e,Math.min(t,a))}}function dte(e,t,i){var a=e[0],f=e[1],y=t[0],w=t[1];return f<a?(a=IA(f,a),y=i(w,y)):(a=IA(a,f),y=i(y,w)),function(O){return y(a(O))}}function pte(e,t,i){var a=Math.min(e.length,t.length)-1,f=new Array(a),y=new Array(a),w=-1;for(e[a]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++w<a;)f[w]=IA(e[w],e[w+1]),y[w]=i(t[w],t[w+1]);return function(O){var o=t_(e,O,1,a)-1;return y[o](f[o](O))}}function n_(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Z1(){var e=CL,t=CL,i=_p,a,f,y,w=Ao,O,o,L;function $(){var H=Math.min(e.length,t.length);return w!==Ao&&(w=fte(e[0],e[H-1])),O=H>2?pte:dte,o=L=null,F}function F(H){return H==null||isNaN(H=+H)?y:(o||(o=O(e.map(a),t,i)))(a(w(H)))}return F.invert=function(H){return w(f((L||(L=O(t,e.map(a),Ix)))(H)))},F.domain=function(H){return arguments.length?(e=Array.from(H,Cx),$()):e.slice()},F.range=function(H){return arguments.length?(t=Array.from(H),$()):t.slice()},F.rangeRound=function(H){return t=Array.from(H),i=WM,$()},F.clamp=function(H){return arguments.length?(w=H?!0:Ao,$()):w!==Ao},F.interpolate=function(H){return arguments.length?(i=H,$()):i},F.unknown=function(H){return arguments.length?(y=H,F):y},function(H,Y){return a=H,f=Y,$()}}function HM(){return Z1()(Ao,Ao)}function mte(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ox(e,t){if((i=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var i,a=e.slice(0,i);return[a.length>1?a[0]+a.slice(2):a,+e.slice(i+1)]}function Nd(e){return e=Ox(Math.abs(e)),e?e[1]:NaN}function gte(e,t){return function(i,a){for(var f=i.length,y=[],w=0,O=e[0],o=0;f>0&&O>0&&(o+O+1>a&&(O=Math.max(1,a-o)),y.push(i.substring(f-=O,f+O)),!((o+=O+1)>a));)O=e[w=(w+1)%e.length];return y.reverse().join(t)}}function yte(e){return function(t){return t.replace(/[0-9]/g,function(i){return e[+i]})}}var _te=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sy(e){if(!(t=_te.exec(e)))throw new Error("invalid format: "+e);var t;return new ZM({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Sy.prototype=ZM.prototype;function ZM(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ZM.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function vte(e){e:for(var t=e.length,i=1,a=-1,f;i<t;++i)switch(e[i]){case".":a=f=i;break;case"0":a===0&&(a=i),f=i;break;default:if(!+e[i])break e;a>0&&(a=0);break}return a>0?e.slice(0,a)+e.slice(f+1):e}var EN;function xte(e,t){var i=Ox(e,t);if(!i)return e+"";var a=i[0],f=i[1],y=f-(EN=Math.max(-8,Math.min(8,Math.floor(f/3)))*3)+1,w=a.length;return y===w?a:y>w?a+new Array(y-w+1).join("0"):y>0?a.slice(0,y)+"."+a.slice(y):"0."+new Array(1-y).join("0")+Ox(e,Math.max(0,t+y-1))[0]}function OL(e,t){var i=Ox(e,t);if(!i)return e+"";var a=i[0],f=i[1];return f<0?"0."+new Array(-f).join("0")+a:a.length>f+1?a.slice(0,f+1)+"."+a.slice(f+1):a+new Array(f-a.length+2).join("0")}const kL={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:mte,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>OL(e*100,t),r:OL,s:xte,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function DL(e){return e}var LL=Array.prototype.map,RL=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bte(e){var t=e.grouping===void 0||e.thousands===void 0?DL:gte(LL.call(e.grouping,Number),e.thousands+""),i=e.currency===void 0?"":e.currency[0]+"",a=e.currency===void 0?"":e.currency[1]+"",f=e.decimal===void 0?".":e.decimal+"",y=e.numerals===void 0?DL:yte(LL.call(e.numerals,String)),w=e.percent===void 0?"%":e.percent+"",O=e.minus===void 0?"−":e.minus+"",o=e.nan===void 0?"NaN":e.nan+"";function L(F){F=Sy(F);var H=F.fill,Y=F.align,oe=F.sign,te=F.symbol,ie=F.zero,ae=F.width,J=F.comma,ue=F.precision,le=F.trim,se=F.type;se==="n"?(J=!0,se="g"):kL[se]||(ue===void 0&&(ue=12),le=!0,se="g"),(ie||H==="0"&&Y==="=")&&(ie=!0,H="0",Y="=");var be=te==="$"?i:te==="#"&&/[boxX]/.test(se)?"0"+se.toLowerCase():"",Ie=te==="$"?a:/[%p]/.test(se)?w:"",Ae=kL[se],ht=/[defgprs%]/.test(se);ue=ue===void 0?6:/[gprs]/.test(se)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function st(We){var He=be,At=Ie,Tt,kt,ct;if(se==="c")At=Ae(We)+At,We="";else{We=+We;var Ot=We<0||1/We<0;if(We=isNaN(We)?o:Ae(Math.abs(We),ue),le&&(We=vte(We)),Ot&&+We==0&&oe!=="+"&&(Ot=!1),He=(Ot?oe==="("?oe:O:oe==="-"||oe==="("?"":oe)+He,At=(se==="s"?RL[8+EN/3]:"")+At+(Ot&&oe==="("?")":""),ht){for(Tt=-1,kt=We.length;++Tt<kt;)if(ct=We.charCodeAt(Tt),48>ct||ct>57){At=(ct===46?f+We.slice(Tt+1):We.slice(Tt))+At,We=We.slice(0,Tt);break}}}J&&!ie&&(We=t(We,1/0));var mt=He.length+We.length+At.length,Lt=mt<ae?new Array(ae-mt+1).join(H):"";switch(J&&ie&&(We=t(Lt+We,Lt.length?ae-At.length:1/0),Lt=""),Y){case"<":We=He+We+At+Lt;break;case"=":We=He+Lt+We+At;break;case"^":We=Lt.slice(0,mt=Lt.length>>1)+He+We+At+Lt.slice(mt);break;default:We=Lt+He+We+At;break}return y(We)}return st.toString=function(){return F+""},st}function $(F,H){var Y=L((F=Sy(F),F.type="f",F)),oe=Math.max(-8,Math.min(8,Math.floor(Nd(H)/3)))*3,te=Math.pow(10,-oe),ie=RL[8+oe/3];return function(ae){return Y(te*ae)+ie}}return{format:L,formatPrefix:$}}var x0,XM,MN;wte({thousands:",",grouping:[3],currency:["$",""]});function wte(e){return x0=bte(e),XM=x0.format,MN=x0.formatPrefix,x0}function Tte(e){return Math.max(0,-Nd(Math.abs(e)))}function Ste(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Nd(t)/3)))*3-Nd(Math.abs(e)))}function Ate(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Nd(t)-Nd(e))+1}function PN(e,t,i,a){var f=AA(e,t,i),y;switch(a=Sy(a??",f"),a.type){case"s":{var w=Math.max(Math.abs(e),Math.abs(t));return a.precision==null&&!isNaN(y=Ste(f,w))&&(a.precision=y),MN(a,w)}case"":case"e":case"g":case"p":case"r":{a.precision==null&&!isNaN(y=Ate(f,Math.max(Math.abs(e),Math.abs(t))))&&(a.precision=y-(a.type==="e"));break}case"f":case"%":{a.precision==null&&!isNaN(y=Tte(f))&&(a.precision=y-(a.type==="%")*2);break}}return XM(a)}function su(e){var t=e.domain;return e.ticks=function(i){var a=t();return TA(a[0],a[a.length-1],i??10)},e.tickFormat=function(i,a){var f=t();return PN(f[0],f[f.length-1],i??10,a)},e.nice=function(i){i==null&&(i=10);var a=t(),f=0,y=a.length-1,w=a[f],O=a[y],o,L,$=10;for(O<w&&(L=w,w=O,O=L,L=f,f=y,y=L);$-- >0;){if(L=SA(w,O,i),L===o)return a[f]=w,a[y]=O,t(a);if(L>0)w=Math.floor(w/L)*L,O=Math.ceil(O/L)*L;else if(L<0)w=Math.ceil(w*L)/L,O=Math.floor(O*L)/L;else break;o=L}return e},e}function kx(){var e=HM();return e.copy=function(){return n_(e,kx())},ja.apply(e,arguments),su(e)}function IN(e){var t;function i(a){return a==null||isNaN(a=+a)?t:a}return i.invert=i,i.domain=i.range=function(a){return arguments.length?(e=Array.from(a,Cx),i):e.slice()},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return IN(e).unknown(t)},e=arguments.length?Array.from(e,Cx):[0,1],su(i)}function CN(e,t){e=e.slice();var i=0,a=e.length-1,f=e[i],y=e[a],w;return y<f&&(w=i,i=a,a=w,w=f,f=y,y=w),e[i]=t.floor(f),e[a]=t.ceil(y),e}function zL(e){return Math.log(e)}function BL(e){return Math.exp(e)}function Ete(e){return-Math.log(-e)}function Mte(e){return-Math.exp(-e)}function Pte(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Ite(e){return e===10?Pte:e===Math.E?Math.exp:t=>Math.pow(e,t)}function Cte(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function FL(e){return(t,i)=>-e(-t,i)}function YM(e){const t=e(zL,BL),i=t.domain;let a=10,f,y;function w(){return f=Cte(a),y=Ite(a),i()[0]<0?(f=FL(f),y=FL(y),e(Ete,Mte)):e(zL,BL),t}return t.base=function(O){return arguments.length?(a=+O,w()):a},t.domain=function(O){return arguments.length?(i(O),w()):i()},t.ticks=O=>{const o=i();let L=o[0],$=o[o.length-1];const F=$<L;F&&([L,$]=[$,L]);let H=f(L),Y=f($),oe,te;const ie=O==null?10:+O;let ae=[];if(!(a%1)&&Y-H<ie){if(H=Math.floor(H),Y=Math.ceil(Y),L>0){for(;H<=Y;++H)for(oe=1;oe<a;++oe)if(te=H<0?oe/y(-H):oe*y(H),!(te<L)){if(te>$)break;ae.push(te)}}else for(;H<=Y;++H)for(oe=a-1;oe>=1;--oe)if(te=H>0?oe/y(-H):oe*y(H),!(te<L)){if(te>$)break;ae.push(te)}ae.length*2<ie&&(ae=TA(L,$,ie))}else ae=TA(H,Y,Math.min(Y-H,ie)).map(y);return F?ae.reverse():ae},t.tickFormat=(O,o)=>{if(O==null&&(O=10),o==null&&(o=a===10?"s":","),typeof o!="function"&&(!(a%1)&&(o=Sy(o)).precision==null&&(o.trim=!0),o=XM(o)),O===1/0)return o;const L=Math.max(1,a*O/t.ticks().length);return $=>{let F=$/y(Math.round(f($)));return F*a<a-.5&&(F*=a),F<=L?o($):""}},t.nice=()=>i(CN(i(),{floor:O=>y(Math.floor(f(O))),ceil:O=>y(Math.ceil(f(O)))})),t}function ON(){const e=YM(Z1()).domain([1,10]);return e.copy=()=>n_(e,ON()).base(e.base()),ja.apply(e,arguments),e}function NL(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function jL(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function KM(e){var t=1,i=e(NL(t),jL(t));return i.constant=function(a){return arguments.length?e(NL(t=+a),jL(t)):t},su(i)}function kN(){var e=KM(Z1());return e.copy=function(){return n_(e,kN()).constant(e.constant())},ja.apply(e,arguments)}function $L(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Ote(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function kte(e){return e<0?-e*e:e*e}function JM(e){var t=e(Ao,Ao),i=1;function a(){return i===1?e(Ao,Ao):i===.5?e(Ote,kte):e($L(i),$L(1/i))}return t.exponent=function(f){return arguments.length?(i=+f,a()):i},su(t)}function QM(){var e=JM(Z1());return e.copy=function(){return n_(e,QM()).exponent(e.exponent())},ja.apply(e,arguments),e}function Dte(){return QM.apply(null,arguments).exponent(.5)}function UL(e){return Math.sign(e)*e*e}function Lte(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function DN(){var e=HM(),t=[0,1],i=!1,a;function f(y){var w=Lte(e(y));return isNaN(w)?a:i?Math.round(w):w}return f.invert=function(y){return e.invert(UL(y))},f.domain=function(y){return arguments.length?(e.domain(y),f):e.domain()},f.range=function(y){return arguments.length?(e.range((t=Array.from(y,Cx)).map(UL)),f):t.slice()},f.rangeRound=function(y){return f.range(y).round(!0)},f.round=function(y){return arguments.length?(i=!!y,f):i},f.clamp=function(y){return arguments.length?(e.clamp(y),f):e.clamp()},f.unknown=function(y){return arguments.length?(a=y,f):a},f.copy=function(){return DN(e.domain(),t).round(i).clamp(e.clamp()).unknown(a)},ja.apply(f,arguments),su(f)}function LN(){var e=[],t=[],i=[],a;function f(){var w=0,O=Math.max(1,t.length);for(i=new Array(O-1);++w<O;)i[w-1]=Nee(e,w/O);return y}function y(w){return w==null||isNaN(w=+w)?a:t[t_(i,w)]}return y.invertExtent=function(w){var O=t.indexOf(w);return O<0?[NaN,NaN]:[O>0?i[O-1]:e[0],O<i.length?i[O]:e[e.length-1]]},y.domain=function(w){if(!arguments.length)return e.slice();e=[];for(let O of w)O!=null&&!isNaN(O=+O)&&e.push(O);return e.sort(eu),f()},y.range=function(w){return arguments.length?(t=Array.from(w),f()):t.slice()},y.unknown=function(w){return arguments.length?(a=w,y):a},y.quantiles=function(){return i.slice()},y.copy=function(){return LN().domain(e).range(t).unknown(a)},ja.apply(y,arguments)}function RN(){var e=0,t=1,i=1,a=[.5],f=[0,1],y;function w(o){return o!=null&&o<=o?f[t_(a,o,0,i)]:y}function O(){var o=-1;for(a=new Array(i);++o<i;)a[o]=((o+1)*t-(o-i)*e)/(i+1);return w}return w.domain=function(o){return arguments.length?([e,t]=o,e=+e,t=+t,O()):[e,t]},w.range=function(o){return arguments.length?(i=(f=Array.from(o)).length-1,O()):f.slice()},w.invertExtent=function(o){var L=f.indexOf(o);return L<0?[NaN,NaN]:L<1?[e,a[0]]:L>=i?[a[i-1],t]:[a[L-1],a[L]]},w.unknown=function(o){return arguments.length&&(y=o),w},w.thresholds=function(){return a.slice()},w.copy=function(){return RN().domain([e,t]).range(f).unknown(y)},ja.apply(su(w),arguments)}function zN(){var e=[.5],t=[0,1],i,a=1;function f(y){return y!=null&&y<=y?t[t_(e,y,0,a)]:i}return f.domain=function(y){return arguments.length?(e=Array.from(y),a=Math.min(e.length,t.length-1),f):e.slice()},f.range=function(y){return arguments.length?(t=Array.from(y),a=Math.min(e.length,t.length-1),f):t.slice()},f.invertExtent=function(y){var w=t.indexOf(y);return[e[w-1],e[w]]},f.unknown=function(y){return arguments.length?(i=y,f):i},f.copy=function(){return zN().domain(e).range(t).unknown(i)},ja.apply(f,arguments)}const VT=new Date,GT=new Date;function Ii(e,t,i,a){function f(y){return e(y=arguments.length===0?new Date:new Date(+y)),y}return f.floor=y=>(e(y=new Date(+y)),y),f.ceil=y=>(e(y=new Date(y-1)),t(y,1),e(y),y),f.round=y=>{const w=f(y),O=f.ceil(y);return y-w<O-y?w:O},f.offset=(y,w)=>(t(y=new Date(+y),w==null?1:Math.floor(w)),y),f.range=(y,w,O)=>{const o=[];if(y=f.ceil(y),O=O==null?1:Math.floor(O),!(y<w)||!(O>0))return o;let L;do o.push(L=new Date(+y)),t(y,O),e(y);while(L<y&&y<w);return o},f.filter=y=>Ii(w=>{if(w>=w)for(;e(w),!y(w);)w.setTime(w-1)},(w,O)=>{if(w>=w)if(O<0)for(;++O<=0;)for(;t(w,-1),!y(w););else for(;--O>=0;)for(;t(w,1),!y(w););}),i&&(f.count=(y,w)=>(VT.setTime(+y),GT.setTime(+w),e(VT),e(GT),Math.floor(i(VT,GT))),f.every=y=>(y=Math.floor(y),!isFinite(y)||!(y>0)?null:y>1?f.filter(a?w=>a(w)%y===0:w=>f.count(0,w)%y===0):f)),f}const Dx=Ii(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Dx.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ii(t=>{t.setTime(Math.floor(t/e)*e)},(t,i)=>{t.setTime(+t+i*e)},(t,i)=>(i-t)/e):Dx);Dx.range;const xl=1e3,ka=xl*60,bl=ka*60,Cl=bl*24,eP=Cl*7,VL=Cl*30,qT=Cl*365,ph=Ii(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*xl)},(e,t)=>(t-e)/xl,e=>e.getUTCSeconds());ph.range;const tP=Ii(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*xl)},(e,t)=>{e.setTime(+e+t*ka)},(e,t)=>(t-e)/ka,e=>e.getMinutes());tP.range;const rP=Ii(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*ka)},(e,t)=>(t-e)/ka,e=>e.getUTCMinutes());rP.range;const nP=Ii(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*xl-e.getMinutes()*ka)},(e,t)=>{e.setTime(+e+t*bl)},(e,t)=>(t-e)/bl,e=>e.getHours());nP.range;const iP=Ii(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*bl)},(e,t)=>(t-e)/bl,e=>e.getUTCHours());iP.range;const i_=Ii(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ka)/Cl,e=>e.getDate()-1);i_.range;const X1=Ii(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Cl,e=>e.getUTCDate()-1);X1.range;const BN=Ii(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Cl,e=>Math.floor(e/Cl));BN.range;function Dh(e){return Ii(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,i)=>{t.setDate(t.getDate()+i*7)},(t,i)=>(i-t-(i.getTimezoneOffset()-t.getTimezoneOffset())*ka)/eP)}const Y1=Dh(0),Lx=Dh(1),Rte=Dh(2),zte=Dh(3),jd=Dh(4),Bte=Dh(5),Fte=Dh(6);Y1.range;Lx.range;Rte.range;zte.range;jd.range;Bte.range;Fte.range;function Lh(e){return Ii(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,i)=>{t.setUTCDate(t.getUTCDate()+i*7)},(t,i)=>(i-t)/eP)}const K1=Lh(0),Rx=Lh(1),Nte=Lh(2),jte=Lh(3),$d=Lh(4),$te=Lh(5),Ute=Lh(6);K1.range;Rx.range;Nte.range;jte.range;$d.range;$te.range;Ute.range;const oP=Ii(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());oP.range;const aP=Ii(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());aP.range;const Ol=Ii(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ol.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ii(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,i)=>{t.setFullYear(t.getFullYear()+i*e)});Ol.range;const kl=Ii(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());kl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ii(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,i)=>{t.setUTCFullYear(t.getUTCFullYear()+i*e)});kl.range;function FN(e,t,i,a,f,y){const w=[[ph,1,xl],[ph,5,5*xl],[ph,15,15*xl],[ph,30,30*xl],[y,1,ka],[y,5,5*ka],[y,15,15*ka],[y,30,30*ka],[f,1,bl],[f,3,3*bl],[f,6,6*bl],[f,12,12*bl],[a,1,Cl],[a,2,2*Cl],[i,1,eP],[t,1,VL],[t,3,3*VL],[e,1,qT]];function O(L,$,F){const H=$<L;H&&([L,$]=[$,L]);const Y=F&&typeof F.range=="function"?F:o(L,$,F),oe=Y?Y.range(L,+$+1):[];return H?oe.reverse():oe}function o(L,$,F){const H=Math.abs($-L)/F,Y=UM(([,,ie])=>ie).right(w,H);if(Y===w.length)return e.every(AA(L/qT,$/qT,F));if(Y===0)return Dx.every(Math.max(AA(L,$,F),1));const[oe,te]=w[H/w[Y-1][2]<w[Y][2]/H?Y-1:Y];return oe.every(te)}return[O,o]}const[Vte,Gte]=FN(kl,aP,K1,BN,iP,rP),[qte,Wte]=FN(Ol,oP,Y1,i_,nP,tP);function WT(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function HT(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function wg(e,t,i){return{y:e,m:t,d:i,H:0,M:0,S:0,L:0}}function Hte(e){var t=e.dateTime,i=e.date,a=e.time,f=e.periods,y=e.days,w=e.shortDays,O=e.months,o=e.shortMonths,L=Tg(f),$=Sg(f),F=Tg(y),H=Sg(y),Y=Tg(w),oe=Sg(w),te=Tg(O),ie=Sg(O),ae=Tg(o),J=Sg(o),ue={a:Ot,A:mt,b:Lt,B:yt,c:null,d:XL,e:XL,f:gre,g:Ere,G:Pre,H:dre,I:pre,j:mre,L:NN,m:yre,M:_re,p:Zt,q:Yt,Q:JL,s:QL,S:vre,u:xre,U:bre,V:wre,w:Tre,W:Sre,x:null,X:null,y:Are,Y:Mre,Z:Ire,"%":KL},le={a:xr,A:Vt,b:Sn,B:vn,c:null,d:YL,e:YL,f:Dre,g:Vre,G:qre,H:Cre,I:Ore,j:kre,L:$N,m:Lre,M:Rre,p:sn,q:Ci,Q:JL,s:QL,S:zre,u:Bre,U:Fre,V:Nre,w:jre,W:$re,x:null,X:null,y:Ure,Y:Gre,Z:Wre,"%":KL},se={a:st,A:We,b:He,B:At,c:Tt,d:HL,e:HL,f:cre,g:WL,G:qL,H:ZL,I:ZL,j:ore,L:lre,m:ire,M:are,p:ht,q:nre,Q:hre,s:fre,S:sre,u:Jte,U:Qte,V:ere,w:Kte,W:tre,x:kt,X:ct,y:WL,Y:qL,Z:rre,"%":ure};ue.x=be(i,ue),ue.X=be(a,ue),ue.c=be(t,ue),le.x=be(i,le),le.X=be(a,le),le.c=be(t,le);function be(rr,Pr){return function(Me){var Bt=[],yn=-1,Hr=0,_t=rr.length,wn,hn,fi;for(Me instanceof Date||(Me=new Date(+Me));++yn<_t;)rr.charCodeAt(yn)===37&&(Bt.push(rr.slice(Hr,yn)),(hn=GL[wn=rr.charAt(++yn)])!=null?wn=rr.charAt(++yn):hn=wn==="e"?" ":"0",(fi=Pr[wn])&&(wn=fi(Me,hn)),Bt.push(wn),Hr=yn+1);return Bt.push(rr.slice(Hr,yn)),Bt.join("")}}function Ie(rr,Pr){return function(Me){var Bt=wg(1900,void 0,1),yn=Ae(Bt,rr,Me+="",0),Hr,_t;if(yn!=Me.length)return null;if("Q"in Bt)return new Date(Bt.Q);if("s"in Bt)return new Date(Bt.s*1e3+("L"in Bt?Bt.L:0));if(Pr&&!("Z"in Bt)&&(Bt.Z=0),"p"in Bt&&(Bt.H=Bt.H%12+Bt.p*12),Bt.m===void 0&&(Bt.m="q"in Bt?Bt.q:0),"V"in Bt){if(Bt.V<1||Bt.V>53)return null;"w"in Bt||(Bt.w=1),"Z"in Bt?(Hr=HT(wg(Bt.y,0,1)),_t=Hr.getUTCDay(),Hr=_t>4||_t===0?Rx.ceil(Hr):Rx(Hr),Hr=X1.offset(Hr,(Bt.V-1)*7),Bt.y=Hr.getUTCFullYear(),Bt.m=Hr.getUTCMonth(),Bt.d=Hr.getUTCDate()+(Bt.w+6)%7):(Hr=WT(wg(Bt.y,0,1)),_t=Hr.getDay(),Hr=_t>4||_t===0?Lx.ceil(Hr):Lx(Hr),Hr=i_.offset(Hr,(Bt.V-1)*7),Bt.y=Hr.getFullYear(),Bt.m=Hr.getMonth(),Bt.d=Hr.getDate()+(Bt.w+6)%7)}else("W"in Bt||"U"in Bt)&&("w"in Bt||(Bt.w="u"in Bt?Bt.u%7:"W"in Bt?1:0),_t="Z"in Bt?HT(wg(Bt.y,0,1)).getUTCDay():WT(wg(Bt.y,0,1)).getDay(),Bt.m=0,Bt.d="W"in Bt?(Bt.w+6)%7+Bt.W*7-(_t+5)%7:Bt.w+Bt.U*7-(_t+6)%7);return"Z"in Bt?(Bt.H+=Bt.Z/100|0,Bt.M+=Bt.Z%100,HT(Bt)):WT(Bt)}}function Ae(rr,Pr,Me,Bt){for(var yn=0,Hr=Pr.length,_t=Me.length,wn,hn;yn<Hr;){if(Bt>=_t)return-1;if(wn=Pr.charCodeAt(yn++),wn===37){if(wn=Pr.charAt(yn++),hn=se[wn in GL?Pr.charAt(yn++):wn],!hn||(Bt=hn(rr,Me,Bt))<0)return-1}else if(wn!=Me.charCodeAt(Bt++))return-1}return Bt}function ht(rr,Pr,Me){var Bt=L.exec(Pr.slice(Me));return Bt?(rr.p=$.get(Bt[0].toLowerCase()),Me+Bt[0].length):-1}function st(rr,Pr,Me){var Bt=Y.exec(Pr.slice(Me));return Bt?(rr.w=oe.get(Bt[0].toLowerCase()),Me+Bt[0].length):-1}function We(rr,Pr,Me){var Bt=F.exec(Pr.slice(Me));return Bt?(rr.w=H.get(Bt[0].toLowerCase()),Me+Bt[0].length):-1}function He(rr,Pr,Me){var Bt=ae.exec(Pr.slice(Me));return Bt?(rr.m=J.get(Bt[0].toLowerCase()),Me+Bt[0].length):-1}function At(rr,Pr,Me){var Bt=te.exec(Pr.slice(Me));return Bt?(rr.m=ie.get(Bt[0].toLowerCase()),Me+Bt[0].length):-1}function Tt(rr,Pr,Me){return Ae(rr,t,Pr,Me)}function kt(rr,Pr,Me){return Ae(rr,i,Pr,Me)}function ct(rr,Pr,Me){return Ae(rr,a,Pr,Me)}function Ot(rr){return w[rr.getDay()]}function mt(rr){return y[rr.getDay()]}function Lt(rr){return o[rr.getMonth()]}function yt(rr){return O[rr.getMonth()]}function Zt(rr){return f[+(rr.getHours()>=12)]}function Yt(rr){return 1+~~(rr.getMonth()/3)}function xr(rr){return w[rr.getUTCDay()]}function Vt(rr){return y[rr.getUTCDay()]}function Sn(rr){return o[rr.getUTCMonth()]}function vn(rr){return O[rr.getUTCMonth()]}function sn(rr){return f[+(rr.getUTCHours()>=12)]}function Ci(rr){return 1+~~(rr.getUTCMonth()/3)}return{format:function(rr){var Pr=be(rr+="",ue);return Pr.toString=function(){return rr},Pr},parse:function(rr){var Pr=Ie(rr+="",!1);return Pr.toString=function(){return rr},Pr},utcFormat:function(rr){var Pr=be(rr+="",le);return Pr.toString=function(){return rr},Pr},utcParse:function(rr){var Pr=Ie(rr+="",!0);return Pr.toString=function(){return rr},Pr}}}var GL={"-":"",_:" ",0:"0"},Ni=/^\s*\d+/,Zte=/^%/,Xte=/[\\^$*+?|[\]().{}]/g;function _n(e,t,i){var a=e<0?"-":"",f=(a?-e:e)+"",y=f.length;return a+(y<i?new Array(i-y+1).join(t)+f:f)}function Yte(e){return e.replace(Xte,"\\$&")}function Tg(e){return new RegExp("^(?:"+e.map(Yte).join("|")+")","i")}function Sg(e){return new Map(e.map((t,i)=>[t.toLowerCase(),i]))}function Kte(e,t,i){var a=Ni.exec(t.slice(i,i+1));return a?(e.w=+a[0],i+a[0].length):-1}function Jte(e,t,i){var a=Ni.exec(t.slice(i,i+1));return a?(e.u=+a[0],i+a[0].length):-1}function Qte(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.U=+a[0],i+a[0].length):-1}function ere(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.V=+a[0],i+a[0].length):-1}function tre(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.W=+a[0],i+a[0].length):-1}function qL(e,t,i){var a=Ni.exec(t.slice(i,i+4));return a?(e.y=+a[0],i+a[0].length):-1}function WL(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.y=+a[0]+(+a[0]>68?1900:2e3),i+a[0].length):-1}function rre(e,t,i){var a=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(i,i+6));return a?(e.Z=a[1]?0:-(a[2]+(a[3]||"00")),i+a[0].length):-1}function nre(e,t,i){var a=Ni.exec(t.slice(i,i+1));return a?(e.q=a[0]*3-3,i+a[0].length):-1}function ire(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.m=a[0]-1,i+a[0].length):-1}function HL(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.d=+a[0],i+a[0].length):-1}function ore(e,t,i){var a=Ni.exec(t.slice(i,i+3));return a?(e.m=0,e.d=+a[0],i+a[0].length):-1}function ZL(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.H=+a[0],i+a[0].length):-1}function are(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.M=+a[0],i+a[0].length):-1}function sre(e,t,i){var a=Ni.exec(t.slice(i,i+2));return a?(e.S=+a[0],i+a[0].length):-1}function lre(e,t,i){var a=Ni.exec(t.slice(i,i+3));return a?(e.L=+a[0],i+a[0].length):-1}function cre(e,t,i){var a=Ni.exec(t.slice(i,i+6));return a?(e.L=Math.floor(a[0]/1e3),i+a[0].length):-1}function ure(e,t,i){var a=Zte.exec(t.slice(i,i+1));return a?i+a[0].length:-1}function hre(e,t,i){var a=Ni.exec(t.slice(i));return a?(e.Q=+a[0],i+a[0].length):-1}function fre(e,t,i){var a=Ni.exec(t.slice(i));return a?(e.s=+a[0],i+a[0].length):-1}function XL(e,t){return _n(e.getDate(),t,2)}function dre(e,t){return _n(e.getHours(),t,2)}function pre(e,t){return _n(e.getHours()%12||12,t,2)}function mre(e,t){return _n(1+i_.count(Ol(e),e),t,3)}function NN(e,t){return _n(e.getMilliseconds(),t,3)}function gre(e,t){return NN(e,t)+"000"}function yre(e,t){return _n(e.getMonth()+1,t,2)}function _re(e,t){return _n(e.getMinutes(),t,2)}function vre(e,t){return _n(e.getSeconds(),t,2)}function xre(e){var t=e.getDay();return t===0?7:t}function bre(e,t){return _n(Y1.count(Ol(e)-1,e),t,2)}function jN(e){var t=e.getDay();return t>=4||t===0?jd(e):jd.ceil(e)}function wre(e,t){return e=jN(e),_n(jd.count(Ol(e),e)+(Ol(e).getDay()===4),t,2)}function Tre(e){return e.getDay()}function Sre(e,t){return _n(Lx.count(Ol(e)-1,e),t,2)}function Are(e,t){return _n(e.getFullYear()%100,t,2)}function Ere(e,t){return e=jN(e),_n(e.getFullYear()%100,t,2)}function Mre(e,t){return _n(e.getFullYear()%1e4,t,4)}function Pre(e,t){var i=e.getDay();return e=i>=4||i===0?jd(e):jd.ceil(e),_n(e.getFullYear()%1e4,t,4)}function Ire(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+_n(t/60|0,"0",2)+_n(t%60,"0",2)}function YL(e,t){return _n(e.getUTCDate(),t,2)}function Cre(e,t){return _n(e.getUTCHours(),t,2)}function Ore(e,t){return _n(e.getUTCHours()%12||12,t,2)}function kre(e,t){return _n(1+X1.count(kl(e),e),t,3)}function $N(e,t){return _n(e.getUTCMilliseconds(),t,3)}function Dre(e,t){return $N(e,t)+"000"}function Lre(e,t){return _n(e.getUTCMonth()+1,t,2)}function Rre(e,t){return _n(e.getUTCMinutes(),t,2)}function zre(e,t){return _n(e.getUTCSeconds(),t,2)}function Bre(e){var t=e.getUTCDay();return t===0?7:t}function Fre(e,t){return _n(K1.count(kl(e)-1,e),t,2)}function UN(e){var t=e.getUTCDay();return t>=4||t===0?$d(e):$d.ceil(e)}function Nre(e,t){return e=UN(e),_n($d.count(kl(e),e)+(kl(e).getUTCDay()===4),t,2)}function jre(e){return e.getUTCDay()}function $re(e,t){return _n(Rx.count(kl(e)-1,e),t,2)}function Ure(e,t){return _n(e.getUTCFullYear()%100,t,2)}function Vre(e,t){return e=UN(e),_n(e.getUTCFullYear()%100,t,2)}function Gre(e,t){return _n(e.getUTCFullYear()%1e4,t,4)}function qre(e,t){var i=e.getUTCDay();return e=i>=4||i===0?$d(e):$d.ceil(e),_n(e.getUTCFullYear()%1e4,t,4)}function Wre(){return"+0000"}function KL(){return"%"}function JL(e){return+e}function QL(e){return Math.floor(+e/1e3)}var Qf,VN,GN;Hre({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Hre(e){return Qf=Hte(e),VN=Qf.format,Qf.parse,GN=Qf.utcFormat,Qf.utcParse,Qf}function Zre(e){return new Date(e)}function Xre(e){return e instanceof Date?+e:+new Date(+e)}function sP(e,t,i,a,f,y,w,O,o,L){var $=HM(),F=$.invert,H=$.domain,Y=L(".%L"),oe=L(":%S"),te=L("%I:%M"),ie=L("%I %p"),ae=L("%a %d"),J=L("%b %d"),ue=L("%B"),le=L("%Y");function se(be){return(o(be)<be?Y:O(be)<be?oe:w(be)<be?te:y(be)<be?ie:a(be)<be?f(be)<be?ae:J:i(be)<be?ue:le)(be)}return $.invert=function(be){return new Date(F(be))},$.domain=function(be){return arguments.length?H(Array.from(be,Xre)):H().map(Zre)},$.ticks=function(be){var Ie=H();return e(Ie[0],Ie[Ie.length-1],be??10)},$.tickFormat=function(be,Ie){return Ie==null?se:L(Ie)},$.nice=function(be){var Ie=H();return(!be||typeof be.range!="function")&&(be=t(Ie[0],Ie[Ie.length-1],be??10)),be?H(CN(Ie,be)):$},$.copy=function(){return n_($,sP(e,t,i,a,f,y,w,O,o,L))},$}function Yre(){return ja.apply(sP(qte,Wte,Ol,oP,Y1,i_,nP,tP,ph,VN).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Kre(){return ja.apply(sP(Vte,Gte,kl,aP,K1,X1,iP,rP,ph,GN).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function J1(){var e=0,t=1,i,a,f,y,w=Ao,O=!1,o;function L(F){return F==null||isNaN(F=+F)?o:w(f===0?.5:(F=(y(F)-i)*f,O?Math.max(0,Math.min(1,F)):F))}L.domain=function(F){return arguments.length?([e,t]=F,i=y(e=+e),a=y(t=+t),f=i===a?0:1/(a-i),L):[e,t]},L.clamp=function(F){return arguments.length?(O=!!F,L):O},L.interpolator=function(F){return arguments.length?(w=F,L):w};function $(F){return function(H){var Y,oe;return arguments.length?([Y,oe]=H,w=F(Y,oe),L):[w(0),w(1)]}}return L.range=$(_p),L.rangeRound=$(WM),L.unknown=function(F){return arguments.length?(o=F,L):o},function(F){return y=F,i=F(e),a=F(t),f=i===a?0:1/(a-i),L}}function lu(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function qN(){var e=su(J1()(Ao));return e.copy=function(){return lu(e,qN())},zl.apply(e,arguments)}function WN(){var e=YM(J1()).domain([1,10]);return e.copy=function(){return lu(e,WN()).base(e.base())},zl.apply(e,arguments)}function HN(){var e=KM(J1());return e.copy=function(){return lu(e,HN()).constant(e.constant())},zl.apply(e,arguments)}function lP(){var e=JM(J1());return e.copy=function(){return lu(e,lP()).exponent(e.exponent())},zl.apply(e,arguments)}function Jre(){return lP.apply(null,arguments).exponent(.5)}function ZN(){var e=[],t=Ao;function i(a){if(a!=null&&!isNaN(a=+a))return t((t_(e,a,1)-1)/(e.length-1))}return i.domain=function(a){if(!arguments.length)return e.slice();e=[];for(let f of a)f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(eu),i},i.interpolator=function(a){return arguments.length?(t=a,i):t},i.range=function(){return e.map((a,f)=>t(f/(e.length-1)))},i.quantiles=function(a){return Array.from({length:a+1},(f,y)=>Fee(e,y/a))},i.copy=function(){return ZN(t).domain(e)},zl.apply(i,arguments)}function Q1(){var e=0,t=.5,i=1,a=1,f,y,w,O,o,L=Ao,$,F=!1,H;function Y(te){return isNaN(te=+te)?H:(te=.5+((te=+$(te))-y)*(a*te<a*y?O:o),L(F?Math.max(0,Math.min(1,te)):te))}Y.domain=function(te){return arguments.length?([e,t,i]=te,f=$(e=+e),y=$(t=+t),w=$(i=+i),O=f===y?0:.5/(y-f),o=y===w?0:.5/(w-y),a=y<f?-1:1,Y):[e,t,i]},Y.clamp=function(te){return arguments.length?(F=!!te,Y):F},Y.interpolator=function(te){return arguments.length?(L=te,Y):L};function oe(te){return function(ie){var ae,J,ue;return arguments.length?([ae,J,ue]=ie,L=ute(te,[ae,J,ue]),Y):[L(0),L(.5),L(1)]}}return Y.range=oe(_p),Y.rangeRound=oe(WM),Y.unknown=function(te){return arguments.length?(H=te,Y):H},function(te){return $=te,f=te(e),y=te(t),w=te(i),O=f===y?0:.5/(y-f),o=y===w?0:.5/(w-y),a=y<f?-1:1,Y}}function XN(){var e=su(Q1()(Ao));return e.copy=function(){return lu(e,XN())},zl.apply(e,arguments)}function YN(){var e=YM(Q1()).domain([.1,1,10]);return e.copy=function(){return lu(e,YN()).base(e.base())},zl.apply(e,arguments)}function KN(){var e=KM(Q1());return e.copy=function(){return lu(e,KN()).constant(e.constant())},zl.apply(e,arguments)}function cP(){var e=JM(Q1());return e.copy=function(){return lu(e,cP()).exponent(e.exponent())},zl.apply(e,arguments)}function Qre(){return cP.apply(null,arguments).exponent(.5)}const eR=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:xy,scaleDiverging:XN,scaleDivergingLog:YN,scaleDivergingPow:cP,scaleDivergingSqrt:Qre,scaleDivergingSymlog:KN,scaleIdentity:IN,scaleImplicit:EA,scaleLinear:kx,scaleLog:ON,scaleOrdinal:VM,scalePoint:qg,scalePow:QM,scaleQuantile:LN,scaleQuantize:RN,scaleRadial:DN,scaleSequential:qN,scaleSequentialLog:WN,scaleSequentialPow:lP,scaleSequentialQuantile:ZN,scaleSequentialSqrt:Jre,scaleSequentialSymlog:HN,scaleSqrt:Dte,scaleSymlog:kN,scaleThreshold:zN,scaleTime:Yre,scaleUtc:Kre,tickFormat:PN},Symbol.toStringTag,{value:"Module"}));var ene=sp;function tne(e,t,i){for(var a=-1,f=e.length;++a<f;){var y=e[a],w=t(y);if(w!=null&&(O===void 0?w===w&&!ene(w):i(w,O)))var O=w,o=y}return o}var JN=tne;function rne(e,t){return e>t}var nne=rne,ine=JN,one=nne,ane=gp;function sne(e){return e&&e.length?ine(e,ane,one):void 0}var lne=sne;const Gc=Fn(lne);function cne(e,t){return e<t}var une=cne,hne=JN,fne=une,dne=gp;function pne(e){return e&&e.length?hne(e,dne,fne):void 0}var mne=pne;const eb=Fn(mne);var gne=bM,yne=yp,_ne=aN,vne=Vo;function xne(e,t){var i=vne(e)?gne:_ne;return i(e,yne(t))}var bne=xne,wne=iN,Tne=bne;function Sne(e,t){return wne(Tne(e,t),1)}var Ane=Sne;const Ene=Fn(Ane);var Mne=BM;function Pne(e,t){return Mne(e,t)}var Ine=Pne;const Ud=Fn(Ine);var vp=1e9,Cne={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},hP,ei=!0,Fa="[DecimalError] ",bh=Fa+"Invalid argument: ",uP=Fa+"Exponent out of range: ",xp=Math.floor,lh=Math.pow,One=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,sa,zi=1e7,Xn=7,QN=9007199254740991,zx=xp(QN/Xn),dr={};dr.absoluteValue=dr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};dr.comparedTo=dr.cmp=function(e){var t,i,a,f,y=this;if(e=new y.constructor(e),y.s!==e.s)return y.s||-e.s;if(y.e!==e.e)return y.e>e.e^y.s<0?1:-1;for(a=y.d.length,f=e.d.length,t=0,i=a<f?a:f;t<i;++t)if(y.d[t]!==e.d[t])return y.d[t]>e.d[t]^y.s<0?1:-1;return a===f?0:a>f^y.s<0?1:-1};dr.decimalPlaces=dr.dp=function(){var e=this,t=e.d.length-1,i=(t-e.e)*Xn;if(t=e.d[t],t)for(;t%10==0;t/=10)i--;return i<0?0:i};dr.dividedBy=dr.div=function(e){return Sl(this,new this.constructor(e))};dr.dividedToIntegerBy=dr.idiv=function(e){var t=this,i=t.constructor;return Bn(Sl(t,new i(e),0,1),i.precision)};dr.equals=dr.eq=function(e){return!this.cmp(e)};dr.exponent=function(){return bi(this)};dr.greaterThan=dr.gt=function(e){return this.cmp(e)>0};dr.greaterThanOrEqualTo=dr.gte=function(e){return this.cmp(e)>=0};dr.isInteger=dr.isint=function(){return this.e>this.d.length-2};dr.isNegative=dr.isneg=function(){return this.s<0};dr.isPositive=dr.ispos=function(){return this.s>0};dr.isZero=function(){return this.s===0};dr.lessThan=dr.lt=function(e){return this.cmp(e)<0};dr.lessThanOrEqualTo=dr.lte=function(e){return this.cmp(e)<1};dr.logarithm=dr.log=function(e){var t,i=this,a=i.constructor,f=a.precision,y=f+5;if(e===void 0)e=new a(10);else if(e=new a(e),e.s<1||e.eq(sa))throw Error(Fa+"NaN");if(i.s<1)throw Error(Fa+(i.s?"NaN":"-Infinity"));return i.eq(sa)?new a(0):(ei=!1,t=Sl(Ay(i,y),Ay(e,y),y),ei=!0,Bn(t,f))};dr.minus=dr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?r5(t,e):e5(t,(e.s=-e.s,e))};dr.modulo=dr.mod=function(e){var t,i=this,a=i.constructor,f=a.precision;if(e=new a(e),!e.s)throw Error(Fa+"NaN");return i.s?(ei=!1,t=Sl(i,e,0,1).times(e),ei=!0,i.minus(t)):Bn(new a(i),f)};dr.naturalExponential=dr.exp=function(){return t5(this)};dr.naturalLogarithm=dr.ln=function(){return Ay(this)};dr.negated=dr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};dr.plus=dr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?e5(t,e):r5(t,(e.s=-e.s,e))};dr.precision=dr.sd=function(e){var t,i,a,f=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(bh+e);if(t=bi(f)+1,a=f.d.length-1,i=a*Xn+1,a=f.d[a],a){for(;a%10==0;a/=10)i--;for(a=f.d[0];a>=10;a/=10)i++}return e&&t>i?t:i};dr.squareRoot=dr.sqrt=function(){var e,t,i,a,f,y,w,O=this,o=O.constructor;if(O.s<1){if(!O.s)return new o(0);throw Error(Fa+"NaN")}for(e=bi(O),ei=!1,f=Math.sqrt(+O),f==0||f==1/0?(t=Fs(O.d),(t.length+e)%2==0&&(t+="0"),f=Math.sqrt(t),e=xp((e+1)/2)-(e<0||e%2),f==1/0?t="5e"+e:(t=f.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),a=new o(t)):a=new o(f.toString()),i=o.precision,f=w=i+3;;)if(y=a,a=y.plus(Sl(O,y,w+2)).times(.5),Fs(y.d).slice(0,w)===(t=Fs(a.d)).slice(0,w)){if(t=t.slice(w-3,w+1),f==w&&t=="4999"){if(Bn(y,i+1,0),y.times(y).eq(O)){a=y;break}}else if(t!="9999")break;w+=4}return ei=!0,Bn(a,i)};dr.times=dr.mul=function(e){var t,i,a,f,y,w,O,o,L,$=this,F=$.constructor,H=$.d,Y=(e=new F(e)).d;if(!$.s||!e.s)return new F(0);for(e.s*=$.s,i=$.e+e.e,o=H.length,L=Y.length,o<L&&(y=H,H=Y,Y=y,w=o,o=L,L=w),y=[],w=o+L,a=w;a--;)y.push(0);for(a=L;--a>=0;){for(t=0,f=o+a;f>a;)O=y[f]+Y[a]*H[f-a-1]+t,y[f--]=O%zi|0,t=O/zi|0;y[f]=(y[f]+t)%zi|0}for(;!y[--w];)y.pop();return t?++i:y.shift(),e.d=y,e.e=i,ei?Bn(e,F.precision):e};dr.toDecimalPlaces=dr.todp=function(e,t){var i=this,a=i.constructor;return i=new a(i),e===void 0?i:(Ws(e,0,vp),t===void 0?t=a.rounding:Ws(t,0,8),Bn(i,e+bi(i)+1,t))};dr.toExponential=function(e,t){var i,a=this,f=a.constructor;return e===void 0?i=Ph(a,!0):(Ws(e,0,vp),t===void 0?t=f.rounding:Ws(t,0,8),a=Bn(new f(a),e+1,t),i=Ph(a,!0,e+1)),i};dr.toFixed=function(e,t){var i,a,f=this,y=f.constructor;return e===void 0?Ph(f):(Ws(e,0,vp),t===void 0?t=y.rounding:Ws(t,0,8),a=Bn(new y(f),e+bi(f)+1,t),i=Ph(a.abs(),!1,e+bi(a)+1),f.isneg()&&!f.isZero()?"-"+i:i)};dr.toInteger=dr.toint=function(){var e=this,t=e.constructor;return Bn(new t(e),bi(e)+1,t.rounding)};dr.toNumber=function(){return+this};dr.toPower=dr.pow=function(e){var t,i,a,f,y,w,O=this,o=O.constructor,L=12,$=+(e=new o(e));if(!e.s)return new o(sa);if(O=new o(O),!O.s){if(e.s<1)throw Error(Fa+"Infinity");return O}if(O.eq(sa))return O;if(a=o.precision,e.eq(sa))return Bn(O,a);if(t=e.e,i=e.d.length-1,w=t>=i,y=O.s,w){if((i=$<0?-$:$)<=QN){for(f=new o(sa),t=Math.ceil(a/Xn+4),ei=!1;i%2&&(f=f.times(O),rR(f.d,t)),i=xp(i/2),i!==0;)O=O.times(O),rR(O.d,t);return ei=!0,e.s<0?new o(sa).div(f):Bn(f,a)}}else if(y<0)throw Error(Fa+"NaN");return y=y<0&&e.d[Math.max(t,i)]&1?-1:1,O.s=1,ei=!1,f=e.times(Ay(O,a+L)),ei=!0,f=t5(f),f.s=y,f};dr.toPrecision=function(e,t){var i,a,f=this,y=f.constructor;return e===void 0?(i=bi(f),a=Ph(f,i<=y.toExpNeg||i>=y.toExpPos)):(Ws(e,1,vp),t===void 0?t=y.rounding:Ws(t,0,8),f=Bn(new y(f),e,t),i=bi(f),a=Ph(f,e<=i||i<=y.toExpNeg,e)),a};dr.toSignificantDigits=dr.tosd=function(e,t){var i=this,a=i.constructor;return e===void 0?(e=a.precision,t=a.rounding):(Ws(e,1,vp),t===void 0?t=a.rounding:Ws(t,0,8)),Bn(new a(i),e,t)};dr.toString=dr.valueOf=dr.val=dr.toJSON=dr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=bi(e),i=e.constructor;return Ph(e,t<=i.toExpNeg||t>=i.toExpPos)};function e5(e,t){var i,a,f,y,w,O,o,L,$=e.constructor,F=$.precision;if(!e.s||!t.s)return t.s||(t=new $(e)),ei?Bn(t,F):t;if(o=e.d,L=t.d,w=e.e,f=t.e,o=o.slice(),y=w-f,y){for(y<0?(a=o,y=-y,O=L.length):(a=L,f=w,O=o.length),w=Math.ceil(F/Xn),O=w>O?w+1:O+1,y>O&&(y=O,a.length=1),a.reverse();y--;)a.push(0);a.reverse()}for(O=o.length,y=L.length,O-y<0&&(y=O,a=L,L=o,o=a),i=0;y;)i=(o[--y]=o[y]+L[y]+i)/zi|0,o[y]%=zi;for(i&&(o.unshift(i),++f),O=o.length;o[--O]==0;)o.pop();return t.d=o,t.e=f,ei?Bn(t,F):t}function Ws(e,t,i){if(e!==~~e||e<t||e>i)throw Error(bh+e)}function Fs(e){var t,i,a,f=e.length-1,y="",w=e[0];if(f>0){for(y+=w,t=1;t<f;t++)a=e[t]+"",i=Xn-a.length,i&&(y+=Nc(i)),y+=a;w=e[t],a=w+"",i=Xn-a.length,i&&(y+=Nc(i))}else if(w===0)return"0";for(;w%10===0;)w/=10;return y+w}var Sl=function(){function e(a,f){var y,w=0,O=a.length;for(a=a.slice();O--;)y=a[O]*f+w,a[O]=y%zi|0,w=y/zi|0;return w&&a.unshift(w),a}function t(a,f,y,w){var O,o;if(y!=w)o=y>w?1:-1;else for(O=o=0;O<y;O++)if(a[O]!=f[O]){o=a[O]>f[O]?1:-1;break}return o}function i(a,f,y){for(var w=0;y--;)a[y]-=w,w=a[y]<f[y]?1:0,a[y]=w*zi+a[y]-f[y];for(;!a[0]&&a.length>1;)a.shift()}return function(a,f,y,w){var O,o,L,$,F,H,Y,oe,te,ie,ae,J,ue,le,se,be,Ie,Ae,ht=a.constructor,st=a.s==f.s?1:-1,We=a.d,He=f.d;if(!a.s)return new ht(a);if(!f.s)throw Error(Fa+"Division by zero");for(o=a.e-f.e,Ie=He.length,se=We.length,Y=new ht(st),oe=Y.d=[],L=0;He[L]==(We[L]||0);)++L;if(He[L]>(We[L]||0)&&--o,y==null?J=y=ht.precision:w?J=y+(bi(a)-bi(f))+1:J=y,J<0)return new ht(0);if(J=J/Xn+2|0,L=0,Ie==1)for($=0,He=He[0],J++;(L<se||$)&&J--;L++)ue=$*zi+(We[L]||0),oe[L]=ue/He|0,$=ue%He|0;else{for($=zi/(He[0]+1)|0,$>1&&(He=e(He,$),We=e(We,$),Ie=He.length,se=We.length),le=Ie,te=We.slice(0,Ie),ie=te.length;ie<Ie;)te[ie++]=0;Ae=He.slice(),Ae.unshift(0),be=He[0],He[1]>=zi/2&&++be;do $=0,O=t(He,te,Ie,ie),O<0?(ae=te[0],Ie!=ie&&(ae=ae*zi+(te[1]||0)),$=ae/be|0,$>1?($>=zi&&($=zi-1),F=e(He,$),H=F.length,ie=te.length,O=t(F,te,H,ie),O==1&&($--,i(F,Ie<H?Ae:He,H))):($==0&&(O=$=1),F=He.slice()),H=F.length,H<ie&&F.unshift(0),i(te,F,ie),O==-1&&(ie=te.length,O=t(He,te,Ie,ie),O<1&&($++,i(te,Ie<ie?Ae:He,ie))),ie=te.length):O===0&&($++,te=[0]),oe[L++]=$,O&&te[0]?te[ie++]=We[le]||0:(te=[We[le]],ie=1);while((le++<se||te[0]!==void 0)&&J--)}return oe[0]||oe.shift(),Y.e=o,Bn(Y,w?y+bi(Y)+1:y)}}();function t5(e,t){var i,a,f,y,w,O,o=0,L=0,$=e.constructor,F=$.precision;if(bi(e)>16)throw Error(uP+bi(e));if(!e.s)return new $(sa);for(t==null?(ei=!1,O=F):O=t,w=new $(.03125);e.abs().gte(.1);)e=e.times(w),L+=5;for(a=Math.log(lh(2,L))/Math.LN10*2+5|0,O+=a,i=f=y=new $(sa),$.precision=O;;){if(f=Bn(f.times(e),O),i=i.times(++o),w=y.plus(Sl(f,i,O)),Fs(w.d).slice(0,O)===Fs(y.d).slice(0,O)){for(;L--;)y=Bn(y.times(y),O);return $.precision=F,t==null?(ei=!0,Bn(y,F)):y}y=w}}function bi(e){for(var t=e.e*Xn,i=e.d[0];i>=10;i/=10)t++;return t}function ZT(e,t,i){if(t>e.LN10.sd())throw ei=!0,i&&(e.precision=i),Error(Fa+"LN10 precision limit exceeded");return Bn(new e(e.LN10),t)}function Nc(e){for(var t="";e--;)t+="0";return t}function Ay(e,t){var i,a,f,y,w,O,o,L,$,F=1,H=10,Y=e,oe=Y.d,te=Y.constructor,ie=te.precision;if(Y.s<1)throw Error(Fa+(Y.s?"NaN":"-Infinity"));if(Y.eq(sa))return new te(0);if(t==null?(ei=!1,L=ie):L=t,Y.eq(10))return t==null&&(ei=!0),ZT(te,L);if(L+=H,te.precision=L,i=Fs(oe),a=i.charAt(0),y=bi(Y),Math.abs(y)<15e14){for(;a<7&&a!=1||a==1&&i.charAt(1)>3;)Y=Y.times(e),i=Fs(Y.d),a=i.charAt(0),F++;y=bi(Y),a>1?(Y=new te("0."+i),y++):Y=new te(a+"."+i.slice(1))}else return o=ZT(te,L+2,ie).times(y+""),Y=Ay(new te(a+"."+i.slice(1)),L-H).plus(o),te.precision=ie,t==null?(ei=!0,Bn(Y,ie)):Y;for(O=w=Y=Sl(Y.minus(sa),Y.plus(sa),L),$=Bn(Y.times(Y),L),f=3;;){if(w=Bn(w.times($),L),o=O.plus(Sl(w,new te(f),L)),Fs(o.d).slice(0,L)===Fs(O.d).slice(0,L))return O=O.times(2),y!==0&&(O=O.plus(ZT(te,L+2,ie).times(y+""))),O=Sl(O,new te(F),L),te.precision=ie,t==null?(ei=!0,Bn(O,ie)):O;O=o,f+=2}}function tR(e,t){var i,a,f;for((i=t.indexOf("."))>-1&&(t=t.replace(".","")),(a=t.search(/e/i))>0?(i<0&&(i=a),i+=+t.slice(a+1),t=t.substring(0,a)):i<0&&(i=t.length),a=0;t.charCodeAt(a)===48;)++a;for(f=t.length;t.charCodeAt(f-1)===48;)--f;if(t=t.slice(a,f),t){if(f-=a,i=i-a-1,e.e=xp(i/Xn),e.d=[],a=(i+1)%Xn,i<0&&(a+=Xn),a<f){for(a&&e.d.push(+t.slice(0,a)),f-=Xn;a<f;)e.d.push(+t.slice(a,a+=Xn));t=t.slice(a),a=Xn-t.length}else a-=f;for(;a--;)t+="0";if(e.d.push(+t),ei&&(e.e>zx||e.e<-zx))throw Error(uP+i)}else e.s=0,e.e=0,e.d=[0];return e}function Bn(e,t,i){var a,f,y,w,O,o,L,$,F=e.d;for(w=1,y=F[0];y>=10;y/=10)w++;if(a=t-w,a<0)a+=Xn,f=t,L=F[$=0];else{if($=Math.ceil((a+1)/Xn),y=F.length,$>=y)return e;for(L=y=F[$],w=1;y>=10;y/=10)w++;a%=Xn,f=a-Xn+w}if(i!==void 0&&(y=lh(10,w-f-1),O=L/y%10|0,o=t<0||F[$+1]!==void 0||L%y,o=i<4?(O||o)&&(i==0||i==(e.s<0?3:2)):O>5||O==5&&(i==4||o||i==6&&(a>0?f>0?L/lh(10,w-f):0:F[$-1])%10&1||i==(e.s<0?8:7))),t<1||!F[0])return o?(y=bi(e),F.length=1,t=t-y-1,F[0]=lh(10,(Xn-t%Xn)%Xn),e.e=xp(-t/Xn)||0):(F.length=1,F[0]=e.e=e.s=0),e;if(a==0?(F.length=$,y=1,$--):(F.length=$+1,y=lh(10,Xn-a),F[$]=f>0?(L/lh(10,w-f)%lh(10,f)|0)*y:0),o)for(;;)if($==0){(F[0]+=y)==zi&&(F[0]=1,++e.e);break}else{if(F[$]+=y,F[$]!=zi)break;F[$--]=0,y=1}for(a=F.length;F[--a]===0;)F.pop();if(ei&&(e.e>zx||e.e<-zx))throw Error(uP+bi(e));return e}function r5(e,t){var i,a,f,y,w,O,o,L,$,F,H=e.constructor,Y=H.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new H(e),ei?Bn(t,Y):t;if(o=e.d,F=t.d,a=t.e,L=e.e,o=o.slice(),w=L-a,w){for($=w<0,$?(i=o,w=-w,O=F.length):(i=F,a=L,O=o.length),f=Math.max(Math.ceil(Y/Xn),O)+2,w>f&&(w=f,i.length=1),i.reverse(),f=w;f--;)i.push(0);i.reverse()}else{for(f=o.length,O=F.length,$=f<O,$&&(O=f),f=0;f<O;f++)if(o[f]!=F[f]){$=o[f]<F[f];break}w=0}for($&&(i=o,o=F,F=i,t.s=-t.s),O=o.length,f=F.length-O;f>0;--f)o[O++]=0;for(f=F.length;f>w;){if(o[--f]<F[f]){for(y=f;y&&o[--y]===0;)o[y]=zi-1;--o[y],o[f]+=zi}o[f]-=F[f]}for(;o[--O]===0;)o.pop();for(;o[0]===0;o.shift())--a;return o[0]?(t.d=o,t.e=a,ei?Bn(t,Y):t):new H(0)}function Ph(e,t,i){var a,f=bi(e),y=Fs(e.d),w=y.length;return t?(i&&(a=i-w)>0?y=y.charAt(0)+"."+y.slice(1)+Nc(a):w>1&&(y=y.charAt(0)+"."+y.slice(1)),y=y+(f<0?"e":"e+")+f):f<0?(y="0."+Nc(-f-1)+y,i&&(a=i-w)>0&&(y+=Nc(a))):f>=w?(y+=Nc(f+1-w),i&&(a=i-f-1)>0&&(y=y+"."+Nc(a))):((a=f+1)<w&&(y=y.slice(0,a)+"."+y.slice(a)),i&&(a=i-w)>0&&(f+1===w&&(y+="."),y+=Nc(a))),e.s<0?"-"+y:y}function rR(e,t){if(e.length>t)return e.length=t,!0}function n5(e){var t,i,a;function f(y){var w=this;if(!(w instanceof f))return new f(y);if(w.constructor=f,y instanceof f){w.s=y.s,w.e=y.e,w.d=(y=y.d)?y.slice():y;return}if(typeof y=="number"){if(y*0!==0)throw Error(bh+y);if(y>0)w.s=1;else if(y<0)y=-y,w.s=-1;else{w.s=0,w.e=0,w.d=[0];return}if(y===~~y&&y<1e7){w.e=0,w.d=[y];return}return tR(w,y.toString())}else if(typeof y!="string")throw Error(bh+y);if(y.charCodeAt(0)===45?(y=y.slice(1),w.s=-1):w.s=1,One.test(y))tR(w,y);else throw Error(bh+y)}if(f.prototype=dr,f.ROUND_UP=0,f.ROUND_DOWN=1,f.ROUND_CEIL=2,f.ROUND_FLOOR=3,f.ROUND_HALF_UP=4,f.ROUND_HALF_DOWN=5,f.ROUND_HALF_EVEN=6,f.ROUND_HALF_CEIL=7,f.ROUND_HALF_FLOOR=8,f.clone=n5,f.config=f.set=kne,e===void 0&&(e={}),e)for(a=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<a.length;)e.hasOwnProperty(i=a[t++])||(e[i]=this[i]);return f.config(e),f}function kne(e){if(!e||typeof e!="object")throw Error(Fa+"Object expected");var t,i,a,f=["precision",1,vp,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<f.length;t+=3)if((a=e[i=f[t]])!==void 0)if(xp(a)===a&&a>=f[t+1]&&a<=f[t+2])this[i]=a;else throw Error(bh+i+": "+a);if((a=e[i="LN10"])!==void 0)if(a==Math.LN10)this[i]=new this(a);else throw Error(bh+i+": "+a);return this}var hP=n5(Cne);sa=new hP(1);const Dn=hP;function Dne(e){return Bne(e)||zne(e)||Rne(e)||Lne()}function Lne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rne(e,t){if(e){if(typeof e=="string")return CA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return CA(e,t)}}function zne(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Bne(e){if(Array.isArray(e))return CA(e)}function CA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Fne=function(t){return t},i5={"@@functional/placeholder":!0},o5=function(t){return t===i5},nR=function(t){return function i(){return arguments.length===0||arguments.length===1&&o5(arguments.length<=0?void 0:arguments[0])?i:t.apply(void 0,arguments)}},Nne=function e(t,i){return t===1?i:nR(function(){for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];var w=f.filter(function(O){return O!==i5}).length;return w>=t?i.apply(void 0,f):e(t-w,nR(function(){for(var O=arguments.length,o=new Array(O),L=0;L<O;L++)o[L]=arguments[L];var $=f.map(function(F){return o5(F)?o.shift():F});return i.apply(void 0,Dne($).concat(o))}))})},tb=function(t){return Nne(t.length,t)},OA=function(t,i){for(var a=[],f=t;f<i;++f)a[f-t]=f;return a},jne=tb(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(i){return t[i]}).map(e)}),$ne=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];if(!i.length)return Fne;var f=i.reverse(),y=f[0],w=f.slice(1);return function(){return w.reduce(function(O,o){return o(O)},y.apply(void 0,arguments))}},kA=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},a5=function(t){var i=null,a=null;return function(){for(var f=arguments.length,y=new Array(f),w=0;w<f;w++)y[w]=arguments[w];return i&&y.every(function(O,o){return O===i[o]})||(i=y,a=t.apply(void 0,y)),a}};function Une(e){var t;return e===0?t=1:t=Math.floor(new Dn(e).abs().log(10).toNumber())+1,t}function Vne(e,t,i){for(var a=new Dn(e),f=0,y=[];a.lt(t)&&f<1e5;)y.push(a.toNumber()),a=a.add(i),f++;return y}var Gne=tb(function(e,t,i){var a=+e,f=+t;return a+i*(f-a)}),qne=tb(function(e,t,i){var a=t-+e;return a=a||1/0,(i-e)/a}),Wne=tb(function(e,t,i){var a=t-+e;return a=a||1/0,Math.max(0,Math.min(1,(i-e)/a))});const rb={rangeStep:Vne,getDigitCount:Une,interpolateNumber:Gne,uninterpolateNumber:qne,uninterpolateTruncation:Wne};function DA(e){return Xne(e)||Zne(e)||s5(e)||Hne()}function Hne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zne(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Xne(e){if(Array.isArray(e))return LA(e)}function Ey(e,t){return Jne(e)||Kne(e,t)||s5(e,t)||Yne()}function Yne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s5(e,t){if(e){if(typeof e=="string")return LA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return LA(e,t)}}function LA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Kne(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var i=[],a=!0,f=!1,y=void 0;try{for(var w=e[Symbol.iterator](),O;!(a=(O=w.next()).done)&&(i.push(O.value),!(t&&i.length===t));a=!0);}catch(o){f=!0,y=o}finally{try{!a&&w.return!=null&&w.return()}finally{if(f)throw y}}return i}}function Jne(e){if(Array.isArray(e))return e}function l5(e){var t=Ey(e,2),i=t[0],a=t[1],f=i,y=a;return i>a&&(f=a,y=i),[f,y]}function c5(e,t,i){if(e.lte(0))return new Dn(0);var a=rb.getDigitCount(e.toNumber()),f=new Dn(10).pow(a),y=e.div(f),w=a!==1?.05:.1,O=new Dn(Math.ceil(y.div(w).toNumber())).add(i).mul(w),o=O.mul(f);return t?o:new Dn(Math.ceil(o))}function Qne(e,t,i){var a=1,f=new Dn(e);if(!f.isint()&&i){var y=Math.abs(e);y<1?(a=new Dn(10).pow(rb.getDigitCount(e)-1),f=new Dn(Math.floor(f.div(a).toNumber())).mul(a)):y>1&&(f=new Dn(Math.floor(e)))}else e===0?f=new Dn(Math.floor((t-1)/2)):i||(f=new Dn(Math.floor(e)));var w=Math.floor((t-1)/2),O=$ne(jne(function(o){return f.add(new Dn(o-w).mul(a)).toNumber()}),OA);return O(0,t)}function u5(e,t,i,a){var f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(i-1)))return{step:new Dn(0),tickMin:new Dn(0),tickMax:new Dn(0)};var y=c5(new Dn(t).sub(e).div(i-1),a,f),w;e<=0&&t>=0?w=new Dn(0):(w=new Dn(e).add(t).div(2),w=w.sub(new Dn(w).mod(y)));var O=Math.ceil(w.sub(e).div(y).toNumber()),o=Math.ceil(new Dn(t).sub(w).div(y).toNumber()),L=O+o+1;return L>i?u5(e,t,i,a,f+1):(L<i&&(o=t>0?o+(i-L):o,O=t>0?O:O+(i-L)),{step:y,tickMin:w.sub(new Dn(O).mul(y)),tickMax:w.add(new Dn(o).mul(y))})}function eie(e){var t=Ey(e,2),i=t[0],a=t[1],f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,w=Math.max(f,2),O=l5([i,a]),o=Ey(O,2),L=o[0],$=o[1];if(L===-1/0||$===1/0){var F=$===1/0?[L].concat(DA(OA(0,f-1).map(function(){return 1/0}))):[].concat(DA(OA(0,f-1).map(function(){return-1/0})),[$]);return i>a?kA(F):F}if(L===$)return Qne(L,f,y);var H=u5(L,$,w,y),Y=H.step,oe=H.tickMin,te=H.tickMax,ie=rb.rangeStep(oe,te.add(new Dn(.1).mul(Y)),Y);return i>a?kA(ie):ie}function tie(e,t){var i=Ey(e,2),a=i[0],f=i[1],y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,w=l5([a,f]),O=Ey(w,2),o=O[0],L=O[1];if(o===-1/0||L===1/0)return[a,f];if(o===L)return[o];var $=Math.max(t,2),F=c5(new Dn(L).sub(o).div($-1),y,0),H=[].concat(DA(rb.rangeStep(new Dn(o),new Dn(L).sub(new Dn(.99).mul(F)),F)),[L]);return a>f?kA(H):H}var rie=a5(eie),nie=a5(tie),iie="Invariant failed";function Ih(e,t){throw new Error(iie)}var oie=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Vd(e){"@babel/helpers - typeof";return Vd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vd(e)}function Bx(){return Bx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Bx.apply(this,arguments)}function aie(e,t){return uie(e)||cie(e,t)||lie(e,t)||sie()}function sie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lie(e,t){if(e){if(typeof e=="string")return iR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return iR(e,t)}}function iR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function cie(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function uie(e){if(Array.isArray(e))return e}function hie(e,t){if(e==null)return{};var i=fie(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function fie(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function die(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pie(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d5(a.key),a)}}function mie(e,t,i){return t&&pie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gie(e,t,i){return t=Fx(t),yie(e,h5()?Reflect.construct(t,i||[],Fx(e).constructor):t.apply(e,i))}function yie(e,t){if(t&&(Vd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _ie(e)}function _ie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(h5=function(){return!!e})()}function Fx(e){return Fx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Fx(e)}function vie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&RA(e,t)}function RA(e,t){return RA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},RA(e,t)}function f5(e,t,i){return t=d5(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d5(e){var t=xie(e,"string");return Vd(t)=="symbol"?t:t+""}function xie(e,t){if(Vd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Vd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var o_=function(e){function t(){return die(this,t),gie(this,t,arguments)}return vie(t,e),mie(t,[{key:"render",value:function(){var a=this.props,f=a.offset,y=a.layout,w=a.width,O=a.dataKey,o=a.data,L=a.dataPointFormatter,$=a.xAxis,F=a.yAxis,H=hie(a,oie),Y=Yr(H,!1);this.props.direction==="x"&&$.type!=="number"&&Ih();var oe=o.map(function(te){var ie=L(te,O),ae=ie.x,J=ie.y,ue=ie.value,le=ie.errorVal;if(!le)return null;var se=[],be,Ie;if(Array.isArray(le)){var Ae=aie(le,2);be=Ae[0],Ie=Ae[1]}else be=Ie=le;if(y==="vertical"){var ht=$.scale,st=J+f,We=st+w,He=st-w,At=ht(ue-be),Tt=ht(ue+Ie);se.push({x1:Tt,y1:We,x2:Tt,y2:He}),se.push({x1:At,y1:st,x2:Tt,y2:st}),se.push({x1:At,y1:We,x2:At,y2:He})}else if(y==="horizontal"){var kt=F.scale,ct=ae+f,Ot=ct-w,mt=ct+w,Lt=kt(ue-be),yt=kt(ue+Ie);se.push({x1:Ot,y1:yt,x2:mt,y2:yt}),se.push({x1:ct,y1:Lt,x2:ct,y2:yt}),se.push({x1:Ot,y1:Lt,x2:mt,y2:Lt})}return tt.createElement(Vn,Bx({className:"recharts-errorBar",key:"bar-".concat(se.map(function(Zt){return"".concat(Zt.x1,"-").concat(Zt.x2,"-").concat(Zt.y1,"-").concat(Zt.y2)}))},Y),se.map(function(Zt){return tt.createElement("line",Bx({},Zt,{key:"line-".concat(Zt.x1,"-").concat(Zt.x2,"-").concat(Zt.y1,"-").concat(Zt.y2)}))}))});return tt.createElement(Vn,{className:"recharts-errorBars"},oe)}}])}(tt.Component);f5(o_,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});f5(o_,"displayName","ErrorBar");function My(e){"@babel/helpers - typeof";return My=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},My(e)}function oR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function nh(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?oR(Object(i),!0).forEach(function(a){bie(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function bie(e,t,i){return t=wie(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function wie(e){var t=Tie(e,"string");return My(t)=="symbol"?t:t+""}function Tie(e,t){if(My(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(My(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var p5=function(t){var i=t.children,a=t.formattedGraphicalItems,f=t.legendWidth,y=t.legendContent,w=aa(i,Td);if(!w)return null;var O=Td.defaultProps,o=O!==void 0?nh(nh({},O),w.props):{},L;return w.props&&w.props.payload?L=w.props&&w.props.payload:y==="children"?L=(a||[]).reduce(function($,F){var H=F.item,Y=F.props,oe=Y.sectors||Y.data||[];return $.concat(oe.map(function(te){return{type:w.props.iconType||H.props.legendType,value:te.name,color:te.fill,payload:te}}))},[]):L=(a||[]).map(function($){var F=$.item,H=F.type.defaultProps,Y=H!==void 0?nh(nh({},H),F.props):{},oe=Y.dataKey,te=Y.name,ie=Y.legendType,ae=Y.hide;return{inactive:ae,dataKey:oe,type:o.iconType||ie||"square",color:fP(F),value:te||oe,payload:Y}}),nh(nh(nh({},o),Td.getWithHeight(w,f)),{},{payload:L,item:w})};function Py(e){"@babel/helpers - typeof";return Py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Py(e)}function aR(e){return Mie(e)||Eie(e)||Aie(e)||Sie()}function Sie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Aie(e,t){if(e){if(typeof e=="string")return zA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return zA(e,t)}}function Eie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Mie(e){if(Array.isArray(e))return zA(e)}function zA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function sR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function hi(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?sR(Object(i),!0).forEach(function(a){Ad(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Ad(e,t,i){return t=Pie(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Pie(e){var t=Iie(e,"string");return Py(t)=="symbol"?t:t+""}function Iie(e,t){if(Py(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Py(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Mo(e,t,i){return en(e)||en(t)?i:Pi(t)?La(e,t,i):on(t)?t(e):i}function Wg(e,t,i,a){var f=Ene(e,function(O){return Mo(O,t)});if(i==="number"){var y=f.filter(function(O){return tr(O)||parseFloat(O)});return y.length?[eb(y),Gc(y)]:[1/0,-1/0]}var w=a?f.filter(function(O){return!en(O)}):f;return w.map(function(O){return Pi(O)||O instanceof Date?O:""})}var Cie=function(t){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],f=arguments.length>2?arguments[2]:void 0,y=arguments.length>3?arguments[3]:void 0,w=-1,O=(i=a==null?void 0:a.length)!==null&&i!==void 0?i:0;if(O<=1)return 0;if(y&&y.axisType==="angleAxis"&&Math.abs(Math.abs(y.range[1]-y.range[0])-360)<=1e-6)for(var o=y.range,L=0;L<O;L++){var $=L>0?f[L-1].coordinate:f[O-1].coordinate,F=f[L].coordinate,H=L>=O-1?f[0].coordinate:f[L+1].coordinate,Y=void 0;if(ps(F-$)!==ps(H-F)){var oe=[];if(ps(H-F)===ps(o[1]-o[0])){Y=H;var te=F+o[1]-o[0];oe[0]=Math.min(te,(te+$)/2),oe[1]=Math.max(te,(te+$)/2)}else{Y=$;var ie=H+o[1]-o[0];oe[0]=Math.min(F,(ie+F)/2),oe[1]=Math.max(F,(ie+F)/2)}var ae=[Math.min(F,(Y+F)/2),Math.max(F,(Y+F)/2)];if(t>ae[0]&&t<=ae[1]||t>=oe[0]&&t<=oe[1]){w=f[L].index;break}}else{var J=Math.min($,H),ue=Math.max($,H);if(t>(J+F)/2&&t<=(ue+F)/2){w=f[L].index;break}}}else for(var le=0;le<O;le++)if(le===0&&t<=(a[le].coordinate+a[le+1].coordinate)/2||le>0&&le<O-1&&t>(a[le].coordinate+a[le-1].coordinate)/2&&t<=(a[le].coordinate+a[le+1].coordinate)/2||le===O-1&&t>(a[le].coordinate+a[le-1].coordinate)/2){w=a[le].index;break}return w},fP=function(t){var i,a=t,f=a.type.displayName,y=(i=t.type)!==null&&i!==void 0&&i.defaultProps?hi(hi({},t.type.defaultProps),t.props):t.props,w=y.stroke,O=y.fill,o;switch(f){case"Line":o=w;break;case"Area":case"Radar":o=w&&w!=="none"?w:O;break;default:o=O;break}return o},Oie=function(t){var i=t.barSize,a=t.totalSize,f=t.stackGroups,y=f===void 0?{}:f;if(!y)return{};for(var w={},O=Object.keys(y),o=0,L=O.length;o<L;o++)for(var $=y[O[o]].stackGroups,F=Object.keys($),H=0,Y=F.length;H<Y;H++){var oe=$[F[H]],te=oe.items,ie=oe.cateAxisId,ae=te.filter(function(Ie){return Tl(Ie.type).indexOf("Bar")>=0});if(ae&&ae.length){var J=ae[0].type.defaultProps,ue=J!==void 0?hi(hi({},J),ae[0].props):ae[0].props,le=ue.barSize,se=ue[ie];w[se]||(w[se]=[]);var be=en(le)?i:le;w[se].push({item:ae[0],stackList:ae.slice(1),barSize:en(be)?void 0:Mh(be,a,0)})}}return w},kie=function(t){var i=t.barGap,a=t.barCategoryGap,f=t.bandSize,y=t.sizeList,w=y===void 0?[]:y,O=t.maxBarSize,o=w.length;if(o<1)return null;var L=Mh(i,f,0,!0),$,F=[];if(w[0].barSize===+w[0].barSize){var H=!1,Y=f/o,oe=w.reduce(function(le,se){return le+se.barSize||0},0);oe+=(o-1)*L,oe>=f&&(oe-=(o-1)*L,L=0),oe>=f&&Y>0&&(H=!0,Y*=.9,oe=o*Y);var te=(f-oe)/2>>0,ie={offset:te-L,size:0};$=w.reduce(function(le,se){var be={item:se.item,position:{offset:ie.offset+ie.size+L,size:H?Y:se.barSize}},Ie=[].concat(aR(le),[be]);return ie=Ie[Ie.length-1].position,se.stackList&&se.stackList.length&&se.stackList.forEach(function(Ae){Ie.push({item:Ae,position:ie})}),Ie},F)}else{var ae=Mh(a,f,0,!0);f-2*ae-(o-1)*L<=0&&(L=0);var J=(f-2*ae-(o-1)*L)/o;J>1&&(J>>=0);var ue=O===+O?Math.min(J,O):J;$=w.reduce(function(le,se,be){var Ie=[].concat(aR(le),[{item:se.item,position:{offset:ae+(J+L)*be+(J-ue)/2,size:ue}}]);return se.stackList&&se.stackList.length&&se.stackList.forEach(function(Ae){Ie.push({item:Ae,position:Ie[Ie.length-1].position})}),Ie},F)}return $},Die=function(t,i,a,f){var y=a.children,w=a.width,O=a.margin,o=w-(O.left||0)-(O.right||0),L=p5({children:y,legendWidth:o});if(L){var $=f||{},F=$.width,H=$.height,Y=L.align,oe=L.verticalAlign,te=L.layout;if((te==="vertical"||te==="horizontal"&&oe==="middle")&&Y!=="center"&&tr(t[Y]))return hi(hi({},t),{},Ad({},Y,t[Y]+(F||0)));if((te==="horizontal"||te==="vertical"&&Y==="center")&&oe!=="middle"&&tr(t[oe]))return hi(hi({},t),{},Ad({},oe,t[oe]+(H||0)))}return t},Lie=function(t,i,a){return en(i)?!0:t==="horizontal"?i==="yAxis":t==="vertical"||a==="x"?i==="xAxis":a==="y"?i==="yAxis":!0},m5=function(t,i,a,f,y){var w=i.props.children,O=Ra(w,o_).filter(function(L){return Lie(f,y,L.props.direction)});if(O&&O.length){var o=O.map(function(L){return L.props.dataKey});return t.reduce(function(L,$){var F=Mo($,a);if(en(F))return L;var H=Array.isArray(F)?[eb(F),Gc(F)]:[F,F],Y=o.reduce(function(oe,te){var ie=Mo($,te,0),ae=H[0]-Math.abs(Array.isArray(ie)?ie[0]:ie),J=H[1]+Math.abs(Array.isArray(ie)?ie[1]:ie);return[Math.min(ae,oe[0]),Math.max(J,oe[1])]},[1/0,-1/0]);return[Math.min(Y[0],L[0]),Math.max(Y[1],L[1])]},[1/0,-1/0])}return null},Rie=function(t,i,a,f,y){var w=i.map(function(O){return m5(t,O,a,y,f)}).filter(function(O){return!en(O)});return w&&w.length?w.reduce(function(O,o){return[Math.min(O[0],o[0]),Math.max(O[1],o[1])]},[1/0,-1/0]):null},g5=function(t,i,a,f,y){var w=i.map(function(o){var L=o.props.dataKey;return a==="number"&&L&&m5(t,o,L,f)||Wg(t,L,a,y)});if(a==="number")return w.reduce(function(o,L){return[Math.min(o[0],L[0]),Math.max(o[1],L[1])]},[1/0,-1/0]);var O={};return w.reduce(function(o,L){for(var $=0,F=L.length;$<F;$++)O[L[$]]||(O[L[$]]=!0,o.push(L[$]));return o},[])},y5=function(t,i){return t==="horizontal"&&i==="xAxis"||t==="vertical"&&i==="yAxis"||t==="centric"&&i==="angleAxis"||t==="radial"&&i==="radiusAxis"},mh=function(t,i,a){if(!t)return null;var f=t.scale,y=t.duplicateDomain,w=t.type,O=t.range,o=t.realScaleType==="scaleBand"?f.bandwidth()/2:2,L=(i||a)&&w==="category"&&f.bandwidth?f.bandwidth()/o:0;if(L=t.axisType==="angleAxis"&&(O==null?void 0:O.length)>=2?ps(O[0]-O[1])*2*L:L,i&&(t.ticks||t.niceTicks)){var $=(t.ticks||t.niceTicks).map(function(F){var H=y?y.indexOf(F):F;return{coordinate:f(H)+L,value:F,offset:L}});return $.filter(function(F){return!fp(F.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(F,H){return{coordinate:f(F)+L,value:F,index:H,offset:L}}):f.ticks&&!a?f.ticks(t.tickCount).map(function(F){return{coordinate:f(F)+L,value:F,offset:L}}):f.domain().map(function(F,H){return{coordinate:f(F)+L,value:y?y[F]:F,index:H,offset:L}})},XT=new WeakMap,b0=function(t,i){if(typeof i!="function")return t;XT.has(t)||XT.set(t,new WeakMap);var a=XT.get(t);if(a.has(i))return a.get(i);var f=function(){t.apply(void 0,arguments),i.apply(void 0,arguments)};return a.set(i,f),f},zie=function(t,i,a){var f=t.scale,y=t.type,w=t.layout,O=t.axisType;if(f==="auto")return w==="radial"&&O==="radiusAxis"?{scale:xy(),realScaleType:"band"}:w==="radial"&&O==="angleAxis"?{scale:kx(),realScaleType:"linear"}:y==="category"&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!a)?{scale:qg(),realScaleType:"point"}:y==="category"?{scale:xy(),realScaleType:"band"}:{scale:kx(),realScaleType:"linear"};if(e_(f)){var o="scale".concat($1(f));return{scale:(eR[o]||qg)(),realScaleType:eR[o]?o:"point"}}return on(f)?{scale:f}:{scale:qg(),realScaleType:"point"}},lR=1e-4,Bie=function(t){var i=t.domain();if(!(!i||i.length<=2)){var a=i.length,f=t.range(),y=Math.min(f[0],f[1])-lR,w=Math.max(f[0],f[1])+lR,O=t(i[0]),o=t(i[a-1]);(O<y||O>w||o<y||o>w)&&t.domain([i[0],i[a-1]])}},Fie=function(t,i){if(!t)return null;for(var a=0,f=t.length;a<f;a++)if(t[a].item===i)return t[a].position;return null},Nie=function(t,i){if(!i||i.length!==2||!tr(i[0])||!tr(i[1]))return t;var a=Math.min(i[0],i[1]),f=Math.max(i[0],i[1]),y=[t[0],t[1]];return(!tr(t[0])||t[0]<a)&&(y[0]=a),(!tr(t[1])||t[1]>f)&&(y[1]=f),y[0]>f&&(y[0]=f),y[1]<a&&(y[1]=a),y},jie=function(t){var i=t.length;if(!(i<=0))for(var a=0,f=t[0].length;a<f;++a)for(var y=0,w=0,O=0;O<i;++O){var o=fp(t[O][a][1])?t[O][a][0]:t[O][a][1];o>=0?(t[O][a][0]=y,t[O][a][1]=y+o,y=t[O][a][1]):(t[O][a][0]=w,t[O][a][1]=w+o,w=t[O][a][1])}},$ie=function(t){var i=t.length;if(!(i<=0))for(var a=0,f=t[0].length;a<f;++a)for(var y=0,w=0;w<i;++w){var O=fp(t[w][a][1])?t[w][a][0]:t[w][a][1];O>=0?(t[w][a][0]=y,t[w][a][1]=y+O,y=t[w][a][1]):(t[w][a][0]=0,t[w][a][1]=0)}},Uie={sign:jie,expand:r7,none:Ld,silhouette:n7,wiggle:i7,positive:$ie},Vie=function(t,i,a){var f=i.map(function(O){return O.props.dataKey}),y=Uie[a],w=t7().keys(f).value(function(O,o){return+Mo(O,o,0)}).order(sA).offset(y);return w(t)},Gie=function(t,i,a,f,y,w){if(!t)return null;var O=w?i.reverse():i,o={},L=O.reduce(function(F,H){var Y,oe=(Y=H.type)!==null&&Y!==void 0&&Y.defaultProps?hi(hi({},H.type.defaultProps),H.props):H.props,te=oe.stackId,ie=oe.hide;if(ie)return F;var ae=oe[a],J=F[ae]||{hasStack:!1,stackGroups:{}};if(Pi(te)){var ue=J.stackGroups[te]||{numericAxisId:a,cateAxisId:f,items:[]};ue.items.push(H),J.hasStack=!0,J.stackGroups[te]=ue}else J.stackGroups[dp("_stackId_")]={numericAxisId:a,cateAxisId:f,items:[H]};return hi(hi({},F),{},Ad({},ae,J))},o),$={};return Object.keys(L).reduce(function(F,H){var Y=L[H];if(Y.hasStack){var oe={};Y.stackGroups=Object.keys(Y.stackGroups).reduce(function(te,ie){var ae=Y.stackGroups[ie];return hi(hi({},te),{},Ad({},ie,{numericAxisId:a,cateAxisId:f,items:ae.items,stackedData:Vie(t,ae.items,y)}))},oe)}return hi(hi({},F),{},Ad({},H,Y))},$)},qie=function(t,i){var a=i.realScaleType,f=i.type,y=i.tickCount,w=i.originalDomain,O=i.allowDecimals,o=a||i.scale;if(o!=="auto"&&o!=="linear")return null;if(y&&f==="number"&&w&&(w[0]==="auto"||w[1]==="auto")){var L=t.domain();if(!L.length)return null;var $=rie(L,y,O);return t.domain([eb($),Gc($)]),{niceTicks:$}}if(y&&f==="number"){var F=t.domain(),H=nie(F,y,O);return{niceTicks:H}}return null};function Nx(e){var t=e.axis,i=e.ticks,a=e.bandSize,f=e.entry,y=e.index,w=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!en(f[t.dataKey])){var O=cx(i,"value",f[t.dataKey]);if(O)return O.coordinate+a/2}return i[y]?i[y].coordinate+a/2:null}var o=Mo(f,en(w)?t.dataKey:w);return en(o)?null:t.scale(o)}var cR=function(t){var i=t.axis,a=t.ticks,f=t.offset,y=t.bandSize,w=t.entry,O=t.index;if(i.type==="category")return a[O]?a[O].coordinate+f:null;var o=Mo(w,i.dataKey,i.domain[O]);return en(o)?null:i.scale(o)-y/2+f},Wie=function(t){var i=t.numericAxis,a=i.scale.domain();if(i.type==="number"){var f=Math.min(a[0],a[1]),y=Math.max(a[0],a[1]);return f<=0&&y>=0?0:y<0?y:f}return a[0]},Hie=function(t,i){var a,f=(a=t.type)!==null&&a!==void 0&&a.defaultProps?hi(hi({},t.type.defaultProps),t.props):t.props,y=f.stackId;if(Pi(y)){var w=i[y];if(w){var O=w.items.indexOf(t);return O>=0?w.stackedData[O]:null}}return null},Zie=function(t){return t.reduce(function(i,a){return[eb(a.concat([i[0]]).filter(tr)),Gc(a.concat([i[1]]).filter(tr))]},[1/0,-1/0])},_5=function(t,i,a){return Object.keys(t).reduce(function(f,y){var w=t[y],O=w.stackedData,o=O.reduce(function(L,$){var F=Zie($.slice(i,a+1));return[Math.min(L[0],F[0]),Math.max(L[1],F[1])]},[1/0,-1/0]);return[Math.min(o[0],f[0]),Math.max(o[1],f[1])]},[1/0,-1/0]).map(function(f){return f===1/0||f===-1/0?0:f})},uR=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,hR=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,BA=function(t,i,a){if(on(t))return t(i,a);if(!Array.isArray(t))return i;var f=[];if(tr(t[0]))f[0]=a?t[0]:Math.min(t[0],i[0]);else if(uR.test(t[0])){var y=+uR.exec(t[0])[1];f[0]=i[0]-y}else on(t[0])?f[0]=t[0](i[0]):f[0]=i[0];if(tr(t[1]))f[1]=a?t[1]:Math.max(t[1],i[1]);else if(hR.test(t[1])){var w=+hR.exec(t[1])[1];f[1]=i[1]+w}else on(t[1])?f[1]=t[1](i[1]):f[1]=i[1];return f},jx=function(t,i,a){if(t&&t.scale&&t.scale.bandwidth){var f=t.scale.bandwidth();if(!a||f>0)return f}if(t&&i&&i.length>=2){for(var y=NM(i,function(F){return F.coordinate}),w=1/0,O=1,o=y.length;O<o;O++){var L=y[O],$=y[O-1];w=Math.min((L.coordinate||0)-($.coordinate||0),w)}return w===1/0?0:w}return a?void 0:0},fR=function(t,i,a){return!t||!t.length||Ud(t,La(a,"type.defaultProps.domain"))?i:t},v5=function(t,i){var a=t.type.defaultProps?hi(hi({},t.type.defaultProps),t.props):t.props,f=a.dataKey,y=a.name,w=a.unit,O=a.formatter,o=a.tooltipType,L=a.chartType,$=a.hide;return hi(hi({},Yr(t,!1)),{},{dataKey:f,unit:w,formatter:O,name:y||f,color:fP(t),value:Mo(i,f),type:o,payload:i,chartType:L,hide:$})};function Iy(e){"@babel/helpers - typeof";return Iy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Iy(e)}function dR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function pR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dR(Object(i),!0).forEach(function(a){Xie(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Xie(e,t,i){return t=Yie(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Yie(e){var t=Kie(e,"string");return Iy(t)=="symbol"?t:t+""}function Kie(e,t){if(Iy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Iy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $x=Math.PI/180,Jie=function(t){return t*180/Math.PI},Yi=function(t,i,a,f){return{x:t+Math.cos(-$x*f)*a,y:i+Math.sin(-$x*f)*a}},Qie=function(t,i){var a=t.x,f=t.y,y=i.x,w=i.y;return Math.sqrt(Math.pow(a-y,2)+Math.pow(f-w,2))},eoe=function(t,i){var a=t.x,f=t.y,y=i.cx,w=i.cy,O=Qie({x:a,y:f},{x:y,y:w});if(O<=0)return{radius:O};var o=(a-y)/O,L=Math.acos(o);return f>w&&(L=2*Math.PI-L),{radius:O,angle:Jie(L),angleInRadian:L}},toe=function(t){var i=t.startAngle,a=t.endAngle,f=Math.floor(i/360),y=Math.floor(a/360),w=Math.min(f,y);return{startAngle:i-w*360,endAngle:a-w*360}},roe=function(t,i){var a=i.startAngle,f=i.endAngle,y=Math.floor(a/360),w=Math.floor(f/360),O=Math.min(y,w);return t+O*360},mR=function(t,i){var a=t.x,f=t.y,y=eoe({x:a,y:f},i),w=y.radius,O=y.angle,o=i.innerRadius,L=i.outerRadius;if(w<o||w>L)return!1;if(w===0)return!0;var $=toe(i),F=$.startAngle,H=$.endAngle,Y=O,oe;if(F<=H){for(;Y>H;)Y-=360;for(;Y<F;)Y+=360;oe=Y>=F&&Y<=H}else{for(;Y>F;)Y-=360;for(;Y<H;)Y+=360;oe=Y>=H&&Y<=F}return oe?pR(pR({},i),{},{radius:w,angle:roe(Y,i)}):null};function Cy(e){"@babel/helpers - typeof";return Cy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cy(e)}var noe=["offset"];function ioe(e){return loe(e)||soe(e)||aoe(e)||ooe()}function ooe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aoe(e,t){if(e){if(typeof e=="string")return FA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return FA(e,t)}}function soe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function loe(e){if(Array.isArray(e))return FA(e)}function FA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function coe(e,t){if(e==null)return{};var i=uoe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function uoe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function gR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function Ai(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?gR(Object(i),!0).forEach(function(a){hoe(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function hoe(e,t,i){return t=foe(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function foe(e){var t=doe(e,"string");return Cy(t)=="symbol"?t:t+""}function doe(e,t){if(Cy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Cy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Oy(){return Oy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Oy.apply(this,arguments)}var poe=function(t){var i=t.value,a=t.formatter,f=en(t.children)?i:t.children;return on(a)?a(f):f},moe=function(t,i){var a=ps(i-t),f=Math.min(Math.abs(i-t),360);return a*f},goe=function(t,i,a){var f=t.position,y=t.viewBox,w=t.offset,O=t.className,o=y,L=o.cx,$=o.cy,F=o.innerRadius,H=o.outerRadius,Y=o.startAngle,oe=o.endAngle,te=o.clockWise,ie=(F+H)/2,ae=moe(Y,oe),J=ae>=0?1:-1,ue,le;f==="insideStart"?(ue=Y+J*w,le=te):f==="insideEnd"?(ue=oe-J*w,le=!te):f==="end"&&(ue=oe+J*w,le=te),le=ae<=0?le:!le;var se=Yi(L,$,ie,ue),be=Yi(L,$,ie,ue+(le?1:-1)*359),Ie="M".concat(se.x,",").concat(se.y,`
    A`).concat(ie,",").concat(ie,",0,1,").concat(le?0:1,`,
    `).concat(be.x,",").concat(be.y),Ae=en(t.id)?dp("recharts-radial-line-"):t.id;return tt.createElement("text",Oy({},a,{dominantBaseline:"central",className:pn("recharts-radial-bar-label",O)}),tt.createElement("defs",null,tt.createElement("path",{id:Ae,d:Ie})),tt.createElement("textPath",{xlinkHref:"#".concat(Ae)},i))},yoe=function(t){var i=t.viewBox,a=t.offset,f=t.position,y=i,w=y.cx,O=y.cy,o=y.innerRadius,L=y.outerRadius,$=y.startAngle,F=y.endAngle,H=($+F)/2;if(f==="outside"){var Y=Yi(w,O,L+a,H),oe=Y.x,te=Y.y;return{x:oe,y:te,textAnchor:oe>=w?"start":"end",verticalAnchor:"middle"}}if(f==="center")return{x:w,y:O,textAnchor:"middle",verticalAnchor:"middle"};if(f==="centerTop")return{x:w,y:O,textAnchor:"middle",verticalAnchor:"start"};if(f==="centerBottom")return{x:w,y:O,textAnchor:"middle",verticalAnchor:"end"};var ie=(o+L)/2,ae=Yi(w,O,ie,H),J=ae.x,ue=ae.y;return{x:J,y:ue,textAnchor:"middle",verticalAnchor:"middle"}},_oe=function(t){var i=t.viewBox,a=t.parentViewBox,f=t.offset,y=t.position,w=i,O=w.x,o=w.y,L=w.width,$=w.height,F=$>=0?1:-1,H=F*f,Y=F>0?"end":"start",oe=F>0?"start":"end",te=L>=0?1:-1,ie=te*f,ae=te>0?"end":"start",J=te>0?"start":"end";if(y==="top"){var ue={x:O+L/2,y:o-F*f,textAnchor:"middle",verticalAnchor:Y};return Ai(Ai({},ue),a?{height:Math.max(o-a.y,0),width:L}:{})}if(y==="bottom"){var le={x:O+L/2,y:o+$+H,textAnchor:"middle",verticalAnchor:oe};return Ai(Ai({},le),a?{height:Math.max(a.y+a.height-(o+$),0),width:L}:{})}if(y==="left"){var se={x:O-ie,y:o+$/2,textAnchor:ae,verticalAnchor:"middle"};return Ai(Ai({},se),a?{width:Math.max(se.x-a.x,0),height:$}:{})}if(y==="right"){var be={x:O+L+ie,y:o+$/2,textAnchor:J,verticalAnchor:"middle"};return Ai(Ai({},be),a?{width:Math.max(a.x+a.width-be.x,0),height:$}:{})}var Ie=a?{width:L,height:$}:{};return y==="insideLeft"?Ai({x:O+ie,y:o+$/2,textAnchor:J,verticalAnchor:"middle"},Ie):y==="insideRight"?Ai({x:O+L-ie,y:o+$/2,textAnchor:ae,verticalAnchor:"middle"},Ie):y==="insideTop"?Ai({x:O+L/2,y:o+H,textAnchor:"middle",verticalAnchor:oe},Ie):y==="insideBottom"?Ai({x:O+L/2,y:o+$-H,textAnchor:"middle",verticalAnchor:Y},Ie):y==="insideTopLeft"?Ai({x:O+ie,y:o+H,textAnchor:J,verticalAnchor:oe},Ie):y==="insideTopRight"?Ai({x:O+L-ie,y:o+H,textAnchor:ae,verticalAnchor:oe},Ie):y==="insideBottomLeft"?Ai({x:O+ie,y:o+$-H,textAnchor:J,verticalAnchor:Y},Ie):y==="insideBottomRight"?Ai({x:O+L-ie,y:o+$-H,textAnchor:ae,verticalAnchor:Y},Ie):lp(y)&&(tr(y.x)||fh(y.x))&&(tr(y.y)||fh(y.y))?Ai({x:O+Mh(y.x,L),y:o+Mh(y.y,$),textAnchor:"end",verticalAnchor:"end"},Ie):Ai({x:O+L/2,y:o+$/2,textAnchor:"middle",verticalAnchor:"middle"},Ie)},voe=function(t){return"cx"in t&&tr(t.cx)};function uo(e){var t=e.offset,i=t===void 0?5:t,a=coe(e,noe),f=Ai({offset:i},a),y=f.viewBox,w=f.position,O=f.value,o=f.children,L=f.content,$=f.className,F=$===void 0?"":$,H=f.textBreakAll;if(!y||en(O)&&en(o)&&!Wt.isValidElement(L)&&!on(L))return null;if(Wt.isValidElement(L))return Wt.cloneElement(L,f);var Y;if(on(L)){if(Y=Wt.createElement(L,f),Wt.isValidElement(Y))return Y}else Y=poe(f);var oe=voe(y),te=Yr(f,!0);if(oe&&(w==="insideStart"||w==="insideEnd"||w==="end"))return goe(f,Y,te);var ie=oe?yoe(f):_oe(f);return tt.createElement(Ax,Oy({className:pn("recharts-label",F)},te,ie,{breakAll:H}),Y)}uo.displayName="Label";var x5=function(t){var i=t.cx,a=t.cy,f=t.angle,y=t.startAngle,w=t.endAngle,O=t.r,o=t.radius,L=t.innerRadius,$=t.outerRadius,F=t.x,H=t.y,Y=t.top,oe=t.left,te=t.width,ie=t.height,ae=t.clockWise,J=t.labelViewBox;if(J)return J;if(tr(te)&&tr(ie)){if(tr(F)&&tr(H))return{x:F,y:H,width:te,height:ie};if(tr(Y)&&tr(oe))return{x:Y,y:oe,width:te,height:ie}}return tr(F)&&tr(H)?{x:F,y:H,width:0,height:0}:tr(i)&&tr(a)?{cx:i,cy:a,startAngle:y||f||0,endAngle:w||f||0,innerRadius:L||0,outerRadius:$||o||O||0,clockWise:ae}:t.viewBox?t.viewBox:{}},xoe=function(t,i){return t?t===!0?tt.createElement(uo,{key:"label-implicit",viewBox:i}):Pi(t)?tt.createElement(uo,{key:"label-implicit",viewBox:i,value:t}):Wt.isValidElement(t)?t.type===uo?Wt.cloneElement(t,{key:"label-implicit",viewBox:i}):tt.createElement(uo,{key:"label-implicit",content:t,viewBox:i}):on(t)?tt.createElement(uo,{key:"label-implicit",content:t,viewBox:i}):lp(t)?tt.createElement(uo,Oy({viewBox:i},t,{key:"label-implicit"})):null:null},boe=function(t,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&a&&!t.label)return null;var f=t.children,y=x5(t),w=Ra(f,uo).map(function(o,L){return Wt.cloneElement(o,{viewBox:i||y,key:"label-".concat(L)})});if(!a)return w;var O=xoe(t.label,i||y);return[O].concat(ioe(w))};uo.parseViewBox=x5;uo.renderCallByParent=boe;function woe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Toe=woe;const Soe=Fn(Toe);function ky(e){"@babel/helpers - typeof";return ky=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ky(e)}var Aoe=["valueAccessor"],Eoe=["data","dataKey","clockWise","id","textBreakAll"];function Moe(e){return Ooe(e)||Coe(e)||Ioe(e)||Poe()}function Poe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ioe(e,t){if(e){if(typeof e=="string")return NA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return NA(e,t)}}function Coe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ooe(e){if(Array.isArray(e))return NA(e)}function NA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Ux(){return Ux=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ux.apply(this,arguments)}function yR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function _R(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yR(Object(i),!0).forEach(function(a){koe(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function koe(e,t,i){return t=Doe(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Doe(e){var t=Loe(e,"string");return ky(t)=="symbol"?t:t+""}function Loe(e,t){if(ky(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(ky(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vR(e,t){if(e==null)return{};var i=Roe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Roe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}var zoe=function(t){return Array.isArray(t.value)?Soe(t.value):t.value};function Al(e){var t=e.valueAccessor,i=t===void 0?zoe:t,a=vR(e,Aoe),f=a.data,y=a.dataKey,w=a.clockWise,O=a.id,o=a.textBreakAll,L=vR(a,Eoe);return!f||!f.length?null:tt.createElement(Vn,{className:"recharts-label-list"},f.map(function($,F){var H=en(y)?i($,F):Mo($&&$.payload,y),Y=en(O)?{}:{id:"".concat(O,"-").concat(F)};return tt.createElement(uo,Ux({},Yr($,!0),L,Y,{parentViewBox:$.parentViewBox,value:H,textBreakAll:o,viewBox:uo.parseViewBox(en(w)?$:_R(_R({},$),{},{clockWise:w})),key:"label-".concat(F),index:F}))}))}Al.displayName="LabelList";function Boe(e,t){return e?e===!0?tt.createElement(Al,{key:"labelList-implicit",data:t}):tt.isValidElement(e)||on(e)?tt.createElement(Al,{key:"labelList-implicit",data:t,content:e}):lp(e)?tt.createElement(Al,Ux({data:t},e,{key:"labelList-implicit"})):null:null}function Foe(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&i&&!e.label)return null;var a=e.children,f=Ra(a,Al).map(function(w,O){return Wt.cloneElement(w,{data:t,key:"labelList-".concat(O)})});if(!i)return f;var y=Boe(e.label,t);return[y].concat(Moe(f))}Al.renderCallByParent=Foe;function Dy(e){"@babel/helpers - typeof";return Dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dy(e)}function jA(){return jA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},jA.apply(this,arguments)}function xR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function bR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?xR(Object(i),!0).forEach(function(a){Noe(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Noe(e,t,i){return t=joe(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function joe(e){var t=$oe(e,"string");return Dy(t)=="symbol"?t:t+""}function $oe(e,t){if(Dy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Dy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Uoe=function(t,i){var a=ps(i-t),f=Math.min(Math.abs(i-t),359.999);return a*f},w0=function(t){var i=t.cx,a=t.cy,f=t.radius,y=t.angle,w=t.sign,O=t.isExternal,o=t.cornerRadius,L=t.cornerIsExternal,$=o*(O?1:-1)+f,F=Math.asin(o/$)/$x,H=L?y:y+w*F,Y=Yi(i,a,$,H),oe=Yi(i,a,f,H),te=L?y-w*F:y,ie=Yi(i,a,$*Math.cos(F*$x),te);return{center:Y,circleTangency:oe,lineTangency:ie,theta:F}},b5=function(t){var i=t.cx,a=t.cy,f=t.innerRadius,y=t.outerRadius,w=t.startAngle,O=t.endAngle,o=Uoe(w,O),L=w+o,$=Yi(i,a,y,w),F=Yi(i,a,y,L),H="M ".concat($.x,",").concat($.y,`
    A `).concat(y,",").concat(y,`,0,
    `).concat(+(Math.abs(o)>180),",").concat(+(w>L),`,
    `).concat(F.x,",").concat(F.y,`
  `);if(f>0){var Y=Yi(i,a,f,w),oe=Yi(i,a,f,L);H+="L ".concat(oe.x,",").concat(oe.y,`
            A `).concat(f,",").concat(f,`,0,
            `).concat(+(Math.abs(o)>180),",").concat(+(w<=L),`,
            `).concat(Y.x,",").concat(Y.y," Z")}else H+="L ".concat(i,",").concat(a," Z");return H},Voe=function(t){var i=t.cx,a=t.cy,f=t.innerRadius,y=t.outerRadius,w=t.cornerRadius,O=t.forceCornerRadius,o=t.cornerIsExternal,L=t.startAngle,$=t.endAngle,F=ps($-L),H=w0({cx:i,cy:a,radius:y,angle:L,sign:F,cornerRadius:w,cornerIsExternal:o}),Y=H.circleTangency,oe=H.lineTangency,te=H.theta,ie=w0({cx:i,cy:a,radius:y,angle:$,sign:-F,cornerRadius:w,cornerIsExternal:o}),ae=ie.circleTangency,J=ie.lineTangency,ue=ie.theta,le=o?Math.abs(L-$):Math.abs(L-$)-te-ue;if(le<0)return O?"M ".concat(oe.x,",").concat(oe.y,`
        a`).concat(w,",").concat(w,",0,0,1,").concat(w*2,`,0
        a`).concat(w,",").concat(w,",0,0,1,").concat(-w*2,`,0
      `):b5({cx:i,cy:a,innerRadius:f,outerRadius:y,startAngle:L,endAngle:$});var se="M ".concat(oe.x,",").concat(oe.y,`
    A`).concat(w,",").concat(w,",0,0,").concat(+(F<0),",").concat(Y.x,",").concat(Y.y,`
    A`).concat(y,",").concat(y,",0,").concat(+(le>180),",").concat(+(F<0),",").concat(ae.x,",").concat(ae.y,`
    A`).concat(w,",").concat(w,",0,0,").concat(+(F<0),",").concat(J.x,",").concat(J.y,`
  `);if(f>0){var be=w0({cx:i,cy:a,radius:f,angle:L,sign:F,isExternal:!0,cornerRadius:w,cornerIsExternal:o}),Ie=be.circleTangency,Ae=be.lineTangency,ht=be.theta,st=w0({cx:i,cy:a,radius:f,angle:$,sign:-F,isExternal:!0,cornerRadius:w,cornerIsExternal:o}),We=st.circleTangency,He=st.lineTangency,At=st.theta,Tt=o?Math.abs(L-$):Math.abs(L-$)-ht-At;if(Tt<0&&w===0)return"".concat(se,"L").concat(i,",").concat(a,"Z");se+="L".concat(He.x,",").concat(He.y,`
      A`).concat(w,",").concat(w,",0,0,").concat(+(F<0),",").concat(We.x,",").concat(We.y,`
      A`).concat(f,",").concat(f,",0,").concat(+(Tt>180),",").concat(+(F>0),",").concat(Ie.x,",").concat(Ie.y,`
      A`).concat(w,",").concat(w,",0,0,").concat(+(F<0),",").concat(Ae.x,",").concat(Ae.y,"Z")}else se+="L".concat(i,",").concat(a,"Z");return se},Goe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},w5=function(t){var i=bR(bR({},Goe),t),a=i.cx,f=i.cy,y=i.innerRadius,w=i.outerRadius,O=i.cornerRadius,o=i.forceCornerRadius,L=i.cornerIsExternal,$=i.startAngle,F=i.endAngle,H=i.className;if(w<y||$===F)return null;var Y=pn("recharts-sector",H),oe=w-y,te=Mh(O,oe,0,!0),ie;return te>0&&Math.abs($-F)<360?ie=Voe({cx:a,cy:f,innerRadius:y,outerRadius:w,cornerRadius:Math.min(te,oe/2),forceCornerRadius:o,cornerIsExternal:L,startAngle:$,endAngle:F}):ie=b5({cx:a,cy:f,innerRadius:y,outerRadius:w,startAngle:$,endAngle:F}),tt.createElement("path",jA({},Yr(i,!0),{className:Y,d:ie,role:"img"}))};function Ly(e){"@babel/helpers - typeof";return Ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ly(e)}function $A(){return $A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},$A.apply(this,arguments)}function wR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function TR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?wR(Object(i),!0).forEach(function(a){qoe(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function qoe(e,t,i){return t=Woe(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Woe(e){var t=Hoe(e,"string");return Ly(t)=="symbol"?t:t+""}function Hoe(e,t){if(Ly(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Ly(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SR={curveBasisClosed:GW,curveBasisOpen:qW,curveBasis:VW,curveBumpX:IW,curveBumpY:CW,curveLinearClosed:WW,curveLinear:V1,curveMonotoneX:HW,curveMonotoneY:ZW,curveNatural:XW,curveStep:YW,curveStepAfter:JW,curveStepBefore:KW},T0=function(t){return t.x===+t.x&&t.y===+t.y},Ag=function(t){return t.x},Eg=function(t){return t.y},Zoe=function(t,i){if(on(t))return t;var a="curve".concat($1(t));return(a==="curveMonotone"||a==="curveBump")&&i?SR["".concat(a).concat(i==="vertical"?"Y":"X")]:SR[a]||V1},Xoe=function(t){var i=t.type,a=i===void 0?"linear":i,f=t.points,y=f===void 0?[]:f,w=t.baseLine,O=t.layout,o=t.connectNulls,L=o===void 0?!1:o,$=Zoe(a,O),F=L?y.filter(function(te){return T0(te)}):y,H;if(Array.isArray(w)){var Y=L?w.filter(function(te){return T0(te)}):w,oe=F.map(function(te,ie){return TR(TR({},te),{},{base:Y[ie]})});return O==="vertical"?H=d0().y(Eg).x1(Ag).x0(function(te){return te.base.x}):H=d0().x(Ag).y1(Eg).y0(function(te){return te.base.y}),H.defined(T0).curve($),H(oe)}return O==="vertical"&&tr(w)?H=d0().y(Eg).x1(Ag).x0(w):tr(w)?H=d0().x(Ag).y1(Eg).y0(w):H=SF().x(Ag).y(Eg),H.defined(T0).curve($),H(F)},Ed=function(t){var i=t.className,a=t.points,f=t.path,y=t.pathRef;if((!a||!a.length)&&!f)return null;var w=a&&a.length?Xoe(t):f;return tt.createElement("path",$A({},Yr(t,!1),ux(t),{className:pn("recharts-curve",i),d:w,ref:y}))},T5={exports:{}},Yoe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Koe=Yoe,Joe=Koe;function S5(){}function A5(){}A5.resetWarningCache=S5;var Qoe=function(){function e(a,f,y,w,O,o){if(o!==Joe){var L=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw L.name="Invariant Violation",L}}e.isRequired=e;function t(){return e}var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:A5,resetWarningCache:S5};return i.PropTypes=i,i};T5.exports=Qoe();var eae=T5.exports;const Wr=Fn(eae);var tae=Object.getOwnPropertyNames,rae=Object.getOwnPropertySymbols,nae=Object.prototype.hasOwnProperty;function AR(e,t){return function(a,f,y){return e(a,f,y)&&t(a,f,y)}}function S0(e){return function(i,a,f){if(!i||!a||typeof i!="object"||typeof a!="object")return e(i,a,f);var y=f.cache,w=y.get(i),O=y.get(a);if(w&&O)return w===a&&O===i;y.set(i,a),y.set(a,i);var o=e(i,a,f);return y.delete(i),y.delete(a),o}}function ER(e){return tae(e).concat(rae(e))}var E5=Object.hasOwn||function(e,t){return nae.call(e,t)};function bp(e,t){return e||t?e===t:e===t||e!==e&&t!==t}var M5="_owner",MR=Object.getOwnPropertyDescriptor,PR=Object.keys;function iae(e,t,i){var a=e.length;if(t.length!==a)return!1;for(;a-- >0;)if(!i.equals(e[a],t[a],a,a,e,t,i))return!1;return!0}function oae(e,t){return bp(e.getTime(),t.getTime())}function IR(e,t,i){if(e.size!==t.size)return!1;for(var a={},f=e.entries(),y=0,w,O;(w=f.next())&&!w.done;){for(var o=t.entries(),L=!1,$=0;(O=o.next())&&!O.done;){var F=w.value,H=F[0],Y=F[1],oe=O.value,te=oe[0],ie=oe[1];!L&&!a[$]&&(L=i.equals(H,te,y,$,e,t,i)&&i.equals(Y,ie,H,te,e,t,i))&&(a[$]=!0),$++}if(!L)return!1;y++}return!0}function aae(e,t,i){var a=PR(e),f=a.length;if(PR(t).length!==f)return!1;for(var y;f-- >0;)if(y=a[f],y===M5&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!E5(t,y)||!i.equals(e[y],t[y],y,y,e,t,i))return!1;return!0}function Mg(e,t,i){var a=ER(e),f=a.length;if(ER(t).length!==f)return!1;for(var y,w,O;f-- >0;)if(y=a[f],y===M5&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!E5(t,y)||!i.equals(e[y],t[y],y,y,e,t,i)||(w=MR(e,y),O=MR(t,y),(w||O)&&(!w||!O||w.configurable!==O.configurable||w.enumerable!==O.enumerable||w.writable!==O.writable)))return!1;return!0}function sae(e,t){return bp(e.valueOf(),t.valueOf())}function lae(e,t){return e.source===t.source&&e.flags===t.flags}function CR(e,t,i){if(e.size!==t.size)return!1;for(var a={},f=e.values(),y,w;(y=f.next())&&!y.done;){for(var O=t.values(),o=!1,L=0;(w=O.next())&&!w.done;)!o&&!a[L]&&(o=i.equals(y.value,w.value,y.value,w.value,e,t,i))&&(a[L]=!0),L++;if(!o)return!1}return!0}function cae(e,t){var i=e.length;if(t.length!==i)return!1;for(;i-- >0;)if(e[i]!==t[i])return!1;return!0}var uae="[object Arguments]",hae="[object Boolean]",fae="[object Date]",dae="[object Map]",pae="[object Number]",mae="[object Object]",gae="[object RegExp]",yae="[object Set]",_ae="[object String]",vae=Array.isArray,OR=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,kR=Object.assign,xae=Object.prototype.toString.call.bind(Object.prototype.toString);function bae(e){var t=e.areArraysEqual,i=e.areDatesEqual,a=e.areMapsEqual,f=e.areObjectsEqual,y=e.arePrimitiveWrappersEqual,w=e.areRegExpsEqual,O=e.areSetsEqual,o=e.areTypedArraysEqual;return function($,F,H){if($===F)return!0;if($==null||F==null||typeof $!="object"||typeof F!="object")return $!==$&&F!==F;var Y=$.constructor;if(Y!==F.constructor)return!1;if(Y===Object)return f($,F,H);if(vae($))return t($,F,H);if(OR!=null&&OR($))return o($,F,H);if(Y===Date)return i($,F,H);if(Y===RegExp)return w($,F,H);if(Y===Map)return a($,F,H);if(Y===Set)return O($,F,H);var oe=xae($);return oe===fae?i($,F,H):oe===gae?w($,F,H):oe===dae?a($,F,H):oe===yae?O($,F,H):oe===mae?typeof $.then!="function"&&typeof F.then!="function"&&f($,F,H):oe===uae?f($,F,H):oe===hae||oe===pae||oe===_ae?y($,F,H):!1}}function wae(e){var t=e.circular,i=e.createCustomConfig,a=e.strict,f={areArraysEqual:a?Mg:iae,areDatesEqual:oae,areMapsEqual:a?AR(IR,Mg):IR,areObjectsEqual:a?Mg:aae,arePrimitiveWrappersEqual:sae,areRegExpsEqual:lae,areSetsEqual:a?AR(CR,Mg):CR,areTypedArraysEqual:a?Mg:cae};if(i&&(f=kR({},f,i(f))),t){var y=S0(f.areArraysEqual),w=S0(f.areMapsEqual),O=S0(f.areObjectsEqual),o=S0(f.areSetsEqual);f=kR({},f,{areArraysEqual:y,areMapsEqual:w,areObjectsEqual:O,areSetsEqual:o})}return f}function Tae(e){return function(t,i,a,f,y,w,O){return e(t,i,O)}}function Sae(e){var t=e.circular,i=e.comparator,a=e.createState,f=e.equals,y=e.strict;if(a)return function(o,L){var $=a(),F=$.cache,H=F===void 0?t?new WeakMap:void 0:F,Y=$.meta;return i(o,L,{cache:H,equals:f,meta:Y,strict:y})};if(t)return function(o,L){return i(o,L,{cache:new WeakMap,equals:f,meta:void 0,strict:y})};var w={cache:void 0,equals:f,meta:void 0,strict:y};return function(o,L){return i(o,L,w)}}var Aae=cu();cu({strict:!0});cu({circular:!0});cu({circular:!0,strict:!0});cu({createInternalComparator:function(){return bp}});cu({strict:!0,createInternalComparator:function(){return bp}});cu({circular:!0,createInternalComparator:function(){return bp}});cu({circular:!0,createInternalComparator:function(){return bp},strict:!0});function cu(e){e===void 0&&(e={});var t=e.circular,i=t===void 0?!1:t,a=e.createInternalComparator,f=e.createState,y=e.strict,w=y===void 0?!1:y,O=wae(e),o=bae(O),L=a?a(o):Tae(o);return Sae({circular:i,comparator:o,createState:f,equals:L,strict:w})}function Eae(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function DR(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=-1,a=function f(y){i<0&&(i=y),y-i>t?(e(y),i=-1):Eae(f)};requestAnimationFrame(a)}function UA(e){"@babel/helpers - typeof";return UA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UA(e)}function Mae(e){return Oae(e)||Cae(e)||Iae(e)||Pae()}function Pae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Iae(e,t){if(e){if(typeof e=="string")return LR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return LR(e,t)}}function LR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Cae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Oae(e){if(Array.isArray(e))return e}function kae(){var e={},t=function(){return null},i=!1,a=function f(y){if(!i){if(Array.isArray(y)){if(!y.length)return;var w=y,O=Mae(w),o=O[0],L=O.slice(1);if(typeof o=="number"){DR(f.bind(null,L),o);return}f(o),DR(f.bind(null,L));return}UA(y)==="object"&&(e=y,t(e)),typeof y=="function"&&y()}};return{stop:function(){i=!0},start:function(y){i=!1,a(y)},subscribe:function(y){return t=y,function(){t=function(){return null}}}}}function Ry(e){"@babel/helpers - typeof";return Ry=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ry(e)}function RR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function zR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?RR(Object(i),!0).forEach(function(a){P5(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):RR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function P5(e,t,i){return t=Dae(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Dae(e){var t=Lae(e,"string");return Ry(t)==="symbol"?t:String(t)}function Lae(e,t){if(Ry(e)!=="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Ry(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Rae=function(t,i){return[Object.keys(t),Object.keys(i)].reduce(function(a,f){return a.filter(function(y){return f.includes(y)})})},zae=function(t){return t},Bae=function(t){return t.replace(/([A-Z])/g,function(i){return"-".concat(i.toLowerCase())})},Hg=function(t,i){return Object.keys(i).reduce(function(a,f){return zR(zR({},a),{},P5({},f,t(f,i[f])))},{})},BR=function(t,i,a){return t.map(function(f){return"".concat(Bae(f)," ").concat(i,"ms ").concat(a)}).join(",")};function Fae(e,t){return $ae(e)||jae(e,t)||I5(e,t)||Nae()}function Nae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jae(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function $ae(e){if(Array.isArray(e))return e}function Uae(e){return qae(e)||Gae(e)||I5(e)||Vae()}function Vae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I5(e,t){if(e){if(typeof e=="string")return VA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return VA(e,t)}}function Gae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qae(e){if(Array.isArray(e))return VA(e)}function VA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Vx=1e-4,C5=function(t,i){return[0,3*t,3*i-6*t,3*t-3*i+1]},O5=function(t,i){return t.map(function(a,f){return a*Math.pow(i,f)}).reduce(function(a,f){return a+f})},FR=function(t,i){return function(a){var f=C5(t,i);return O5(f,a)}},Wae=function(t,i){return function(a){var f=C5(t,i),y=[].concat(Uae(f.map(function(w,O){return w*O}).slice(1)),[0]);return O5(y,a)}},NR=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var f=i[0],y=i[1],w=i[2],O=i[3];if(i.length===1)switch(i[0]){case"linear":f=0,y=0,w=1,O=1;break;case"ease":f=.25,y=.1,w=.25,O=1;break;case"ease-in":f=.42,y=0,w=1,O=1;break;case"ease-out":f=.42,y=0,w=.58,O=1;break;case"ease-in-out":f=0,y=0,w=.58,O=1;break;default:{var o=i[0].split("(");if(o[0]==="cubic-bezier"&&o[1].split(")")[0].split(",").length===4){var L=o[1].split(")")[0].split(",").map(function(ie){return parseFloat(ie)}),$=Fae(L,4);f=$[0],y=$[1],w=$[2],O=$[3]}}}var F=FR(f,w),H=FR(y,O),Y=Wae(f,w),oe=function(ae){return ae>1?1:ae<0?0:ae},te=function(ae){for(var J=ae>1?1:ae,ue=J,le=0;le<8;++le){var se=F(ue)-J,be=Y(ue);if(Math.abs(se-J)<Vx||be<Vx)return H(ue);ue=oe(ue-se/be)}return H(ue)};return te.isStepper=!1,te},Hae=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=t.stiff,a=i===void 0?100:i,f=t.damping,y=f===void 0?8:f,w=t.dt,O=w===void 0?17:w,o=function($,F,H){var Y=-($-F)*a,oe=H*y,te=H+(Y-oe)*O/1e3,ie=H*O/1e3+$;return Math.abs(ie-F)<Vx&&Math.abs(te)<Vx?[F,0]:[ie,te]};return o.isStepper=!0,o.dt=O,o},Zae=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var f=i[0];if(typeof f=="string")switch(f){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return NR(f);case"spring":return Hae();default:if(f.split("(")[0]==="cubic-bezier")return NR(f)}return typeof f=="function"?f:null};function zy(e){"@babel/helpers - typeof";return zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zy(e)}function jR(e){return Kae(e)||Yae(e)||k5(e)||Xae()}function Xae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Kae(e){if(Array.isArray(e))return qA(e)}function $R(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function Hi(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?$R(Object(i),!0).forEach(function(a){GA(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$R(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function GA(e,t,i){return t=Jae(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Jae(e){var t=Qae(e,"string");return zy(t)==="symbol"?t:String(t)}function Qae(e,t){if(zy(e)!=="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(zy(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ese(e,t){return nse(e)||rse(e,t)||k5(e,t)||tse()}function tse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k5(e,t){if(e){if(typeof e=="string")return qA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return qA(e,t)}}function qA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function rse(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function nse(e){if(Array.isArray(e))return e}var Gx=function(t,i,a){return t+(i-t)*a},WA=function(t){var i=t.from,a=t.to;return i!==a},ise=function e(t,i,a){var f=Hg(function(y,w){if(WA(w)){var O=t(w.from,w.to,w.velocity),o=ese(O,2),L=o[0],$=o[1];return Hi(Hi({},w),{},{from:L,velocity:$})}return w},i);return a<1?Hg(function(y,w){return WA(w)?Hi(Hi({},w),{},{velocity:Gx(w.velocity,f[y].velocity,a),from:Gx(w.from,f[y].from,a)}):w},i):e(t,f,a-1)};const ose=function(e,t,i,a,f){var y=Rae(e,t),w=y.reduce(function(ie,ae){return Hi(Hi({},ie),{},GA({},ae,[e[ae],t[ae]]))},{}),O=y.reduce(function(ie,ae){return Hi(Hi({},ie),{},GA({},ae,{from:e[ae],velocity:0,to:t[ae]}))},{}),o=-1,L,$,F=function(){return null},H=function(){return Hg(function(ae,J){return J.from},O)},Y=function(){return!Object.values(O).filter(WA).length},oe=function(ae){L||(L=ae);var J=ae-L,ue=J/i.dt;O=ise(i,O,ue),f(Hi(Hi(Hi({},e),t),H())),L=ae,Y()||(o=requestAnimationFrame(F))},te=function(ae){$||($=ae);var J=(ae-$)/a,ue=Hg(function(se,be){return Gx.apply(void 0,jR(be).concat([i(J)]))},w);if(f(Hi(Hi(Hi({},e),t),ue)),J<1)o=requestAnimationFrame(F);else{var le=Hg(function(se,be){return Gx.apply(void 0,jR(be).concat([i(1)]))},w);f(Hi(Hi(Hi({},e),t),le))}};return F=i.isStepper?oe:te,function(){return requestAnimationFrame(F),function(){cancelAnimationFrame(o)}}};function Gd(e){"@babel/helpers - typeof";return Gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gd(e)}var ase=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function sse(e,t){if(e==null)return{};var i=lse(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function lse(e,t){if(e==null)return{};var i={},a=Object.keys(e),f,y;for(y=0;y<a.length;y++)f=a[y],!(t.indexOf(f)>=0)&&(i[f]=e[f]);return i}function YT(e){return fse(e)||hse(e)||use(e)||cse()}function cse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function use(e,t){if(e){if(typeof e=="string")return HA(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return HA(e,t)}}function hse(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function fse(e){if(Array.isArray(e))return HA(e)}function HA(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function UR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function as(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UR(Object(i),!0).forEach(function(a){Lg(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Lg(e,t,i){return t=D5(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function dse(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pse(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,D5(a.key),a)}}function mse(e,t,i){return t&&pse(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function D5(e){var t=gse(e,"string");return Gd(t)==="symbol"?t:String(t)}function gse(e,t){if(Gd(e)!=="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Gd(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yse(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ZA(e,t)}function ZA(e,t){return ZA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},ZA(e,t)}function _se(e){var t=vse();return function(){var a=qx(e),f;if(t){var y=qx(this).constructor;f=Reflect.construct(a,arguments,y)}else f=a.apply(this,arguments);return XA(this,f)}}function XA(e,t){if(t&&(Gd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YA(e)}function YA(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vse(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qx(e){return qx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},qx(e)}var Hs=function(e){yse(i,e);var t=_se(i);function i(a,f){var y;dse(this,i),y=t.call(this,a,f);var w=y.props,O=w.isActive,o=w.attributeName,L=w.from,$=w.to,F=w.steps,H=w.children,Y=w.duration;if(y.handleStyleChange=y.handleStyleChange.bind(YA(y)),y.changeStyle=y.changeStyle.bind(YA(y)),!O||Y<=0)return y.state={style:{}},typeof H=="function"&&(y.state={style:$}),XA(y);if(F&&F.length)y.state={style:F[0].style};else if(L){if(typeof H=="function")return y.state={style:L},XA(y);y.state={style:o?Lg({},o,L):L}}else y.state={style:{}};return y}return mse(i,[{key:"componentDidMount",value:function(){var f=this.props,y=f.isActive,w=f.canBegin;this.mounted=!0,!(!y||!w)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(f){var y=this.props,w=y.isActive,O=y.canBegin,o=y.attributeName,L=y.shouldReAnimate,$=y.to,F=y.from,H=this.state.style;if(O){if(!w){var Y={style:o?Lg({},o,$):$};this.state&&H&&(o&&H[o]!==$||!o&&H!==$)&&this.setState(Y);return}if(!(Aae(f.to,$)&&f.canBegin&&f.isActive)){var oe=!f.canBegin||!f.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var te=oe||L?F:f.to;if(this.state&&H){var ie={style:o?Lg({},o,te):te};(o&&H[o]!==te||!o&&H!==te)&&this.setState(ie)}this.runAnimation(as(as({},this.props),{},{from:te,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var f=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),f&&f()}},{key:"handleStyleChange",value:function(f){this.changeStyle(f)}},{key:"changeStyle",value:function(f){this.mounted&&this.setState({style:f})}},{key:"runJSAnimation",value:function(f){var y=this,w=f.from,O=f.to,o=f.duration,L=f.easing,$=f.begin,F=f.onAnimationEnd,H=f.onAnimationStart,Y=ose(w,O,Zae(L),o,this.changeStyle),oe=function(){y.stopJSAnimation=Y()};this.manager.start([H,$,oe,o,F])}},{key:"runStepAnimation",value:function(f){var y=this,w=f.steps,O=f.begin,o=f.onAnimationStart,L=w[0],$=L.style,F=L.duration,H=F===void 0?0:F,Y=function(te,ie,ae){if(ae===0)return te;var J=ie.duration,ue=ie.easing,le=ue===void 0?"ease":ue,se=ie.style,be=ie.properties,Ie=ie.onAnimationEnd,Ae=ae>0?w[ae-1]:ie,ht=be||Object.keys(se);if(typeof le=="function"||le==="spring")return[].concat(YT(te),[y.runJSAnimation.bind(y,{from:Ae.style,to:se,duration:J,easing:le}),J]);var st=BR(ht,J,le),We=as(as(as({},Ae.style),se),{},{transition:st});return[].concat(YT(te),[We,J,Ie]).filter(zae)};return this.manager.start([o].concat(YT(w.reduce(Y,[$,Math.max(H,O)])),[f.onAnimationEnd]))}},{key:"runAnimation",value:function(f){this.manager||(this.manager=kae());var y=f.begin,w=f.duration,O=f.attributeName,o=f.to,L=f.easing,$=f.onAnimationStart,F=f.onAnimationEnd,H=f.steps,Y=f.children,oe=this.manager;if(this.unSubscribe=oe.subscribe(this.handleStyleChange),typeof L=="function"||typeof Y=="function"||L==="spring"){this.runJSAnimation(f);return}if(H.length>1){this.runStepAnimation(f);return}var te=O?Lg({},O,o):o,ie=BR(Object.keys(te),w,L);oe.start([$,y,as(as({},te),{},{transition:ie}),w,F])}},{key:"render",value:function(){var f=this.props,y=f.children;f.begin;var w=f.duration;f.attributeName,f.easing;var O=f.isActive;f.steps,f.from,f.to,f.canBegin,f.onAnimationEnd,f.shouldReAnimate,f.onAnimationReStart;var o=sse(f,ase),L=Wt.Children.count(y),$=this.state.style;if(typeof y=="function")return y($);if(!O||L===0||w<=0)return y;var F=function(Y){var oe=Y.props,te=oe.style,ie=te===void 0?{}:te,ae=oe.className,J=Wt.cloneElement(Y,as(as({},o),{},{style:as(as({},ie),$),className:ae}));return J};return L===1?F(Wt.Children.only(y)):tt.createElement("div",null,Wt.Children.map(y,function(H){return F(H)}))}}]),i}(Wt.PureComponent);Hs.displayName="Animate";Hs.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Hs.propTypes={from:Wr.oneOfType([Wr.object,Wr.string]),to:Wr.oneOfType([Wr.object,Wr.string]),attributeName:Wr.string,duration:Wr.number,begin:Wr.number,easing:Wr.oneOfType([Wr.string,Wr.func]),steps:Wr.arrayOf(Wr.shape({duration:Wr.number.isRequired,style:Wr.object.isRequired,easing:Wr.oneOfType([Wr.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Wr.func]),properties:Wr.arrayOf("string"),onAnimationEnd:Wr.func})),children:Wr.oneOfType([Wr.node,Wr.func]),isActive:Wr.bool,canBegin:Wr.bool,onAnimationEnd:Wr.func,shouldReAnimate:Wr.bool,onAnimationStart:Wr.func,onAnimationReStart:Wr.func};Wr.object,Wr.object,Wr.object,Wr.element;Wr.object,Wr.object,Wr.object,Wr.oneOfType([Wr.array,Wr.element]),Wr.any;function By(e){"@babel/helpers - typeof";return By=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},By(e)}function Wx(){return Wx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Wx.apply(this,arguments)}function xse(e,t){return Sse(e)||Tse(e,t)||wse(e,t)||bse()}function bse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wse(e,t){if(e){if(typeof e=="string")return VR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return VR(e,t)}}function VR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Tse(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function Sse(e){if(Array.isArray(e))return e}function GR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function qR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?GR(Object(i),!0).forEach(function(a){Ase(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Ase(e,t,i){return t=Ese(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ese(e){var t=Mse(e,"string");return By(t)=="symbol"?t:t+""}function Mse(e,t){if(By(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(By(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var WR=function(t,i,a,f,y){var w=Math.min(Math.abs(a)/2,Math.abs(f)/2),O=f>=0?1:-1,o=a>=0?1:-1,L=f>=0&&a>=0||f<0&&a<0?1:0,$;if(w>0&&y instanceof Array){for(var F=[0,0,0,0],H=0,Y=4;H<Y;H++)F[H]=y[H]>w?w:y[H];$="M".concat(t,",").concat(i+O*F[0]),F[0]>0&&($+="A ".concat(F[0],",").concat(F[0],",0,0,").concat(L,",").concat(t+o*F[0],",").concat(i)),$+="L ".concat(t+a-o*F[1],",").concat(i),F[1]>0&&($+="A ".concat(F[1],",").concat(F[1],",0,0,").concat(L,`,
        `).concat(t+a,",").concat(i+O*F[1])),$+="L ".concat(t+a,",").concat(i+f-O*F[2]),F[2]>0&&($+="A ".concat(F[2],",").concat(F[2],",0,0,").concat(L,`,
        `).concat(t+a-o*F[2],",").concat(i+f)),$+="L ".concat(t+o*F[3],",").concat(i+f),F[3]>0&&($+="A ".concat(F[3],",").concat(F[3],",0,0,").concat(L,`,
        `).concat(t,",").concat(i+f-O*F[3])),$+="Z"}else if(w>0&&y===+y&&y>0){var oe=Math.min(w,y);$="M ".concat(t,",").concat(i+O*oe,`
            A `).concat(oe,",").concat(oe,",0,0,").concat(L,",").concat(t+o*oe,",").concat(i,`
            L `).concat(t+a-o*oe,",").concat(i,`
            A `).concat(oe,",").concat(oe,",0,0,").concat(L,",").concat(t+a,",").concat(i+O*oe,`
            L `).concat(t+a,",").concat(i+f-O*oe,`
            A `).concat(oe,",").concat(oe,",0,0,").concat(L,",").concat(t+a-o*oe,",").concat(i+f,`
            L `).concat(t+o*oe,",").concat(i+f,`
            A `).concat(oe,",").concat(oe,",0,0,").concat(L,",").concat(t,",").concat(i+f-O*oe," Z")}else $="M ".concat(t,",").concat(i," h ").concat(a," v ").concat(f," h ").concat(-a," Z");return $},Pse=function(t,i){if(!t||!i)return!1;var a=t.x,f=t.y,y=i.x,w=i.y,O=i.width,o=i.height;if(Math.abs(O)>0&&Math.abs(o)>0){var L=Math.min(y,y+O),$=Math.max(y,y+O),F=Math.min(w,w+o),H=Math.max(w,w+o);return a>=L&&a<=$&&f>=F&&f<=H}return!1},Ise={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},dP=function(t){var i=qR(qR({},Ise),t),a=Wt.useRef(),f=Wt.useState(-1),y=xse(f,2),w=y[0],O=y[1];Wt.useEffect(function(){if(a.current&&a.current.getTotalLength)try{var le=a.current.getTotalLength();le&&O(le)}catch{}},[]);var o=i.x,L=i.y,$=i.width,F=i.height,H=i.radius,Y=i.className,oe=i.animationEasing,te=i.animationDuration,ie=i.animationBegin,ae=i.isAnimationActive,J=i.isUpdateAnimationActive;if(o!==+o||L!==+L||$!==+$||F!==+F||$===0||F===0)return null;var ue=pn("recharts-rectangle",Y);return J?tt.createElement(Hs,{canBegin:w>0,from:{width:$,height:F,x:o,y:L},to:{width:$,height:F,x:o,y:L},duration:te,animationEasing:oe,isActive:J},function(le){var se=le.width,be=le.height,Ie=le.x,Ae=le.y;return tt.createElement(Hs,{canBegin:w>0,from:"0px ".concat(w===-1?1:w,"px"),to:"".concat(w,"px 0px"),attributeName:"strokeDasharray",begin:ie,duration:te,isActive:ae,easing:oe},tt.createElement("path",Wx({},Yr(i,!0),{className:ue,d:WR(Ie,Ae,se,be,H),ref:a})))}):tt.createElement("path",Wx({},Yr(i,!0),{className:ue,d:WR(o,L,$,F,H)}))};function KA(){return KA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},KA.apply(this,arguments)}var nb=function(t){var i=t.cx,a=t.cy,f=t.r,y=t.className,w=pn("recharts-dot",y);return i===+i&&a===+a&&f===+f?tt.createElement("circle",KA({},Yr(t,!1),ux(t),{className:w,cx:i,cy:a,r:f})):null};function Fy(e){"@babel/helpers - typeof";return Fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fy(e)}var Cse=["x","y","top","left","width","height","className"];function JA(){return JA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},JA.apply(this,arguments)}function HR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function Ose(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HR(Object(i),!0).forEach(function(a){kse(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function kse(e,t,i){return t=Dse(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Dse(e){var t=Lse(e,"string");return Fy(t)=="symbol"?t:t+""}function Lse(e,t){if(Fy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Fy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Rse(e,t){if(e==null)return{};var i=zse(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function zse(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}var Bse=function(t,i,a,f,y,w){return"M".concat(t,",").concat(y,"v").concat(f,"M").concat(w,",").concat(i,"h").concat(a)},Fse=function(t){var i=t.x,a=i===void 0?0:i,f=t.y,y=f===void 0?0:f,w=t.top,O=w===void 0?0:w,o=t.left,L=o===void 0?0:o,$=t.width,F=$===void 0?0:$,H=t.height,Y=H===void 0?0:H,oe=t.className,te=Rse(t,Cse),ie=Ose({x:a,y,top:O,left:L,width:F,height:Y},te);return!tr(a)||!tr(y)||!tr(F)||!tr(Y)||!tr(O)||!tr(L)?null:tt.createElement("path",JA({},Yr(ie,!0),{className:pn("recharts-cross",oe),d:Bse(a,y,F,Y,O,L)}))},Nse=ZF,jse=Nse(Object.getPrototypeOf,Object),$se=jse,Use=Ll,Vse=$se,Gse=Rl,qse="[object Object]",Wse=Function.prototype,Hse=Object.prototype,L5=Wse.toString,Zse=Hse.hasOwnProperty,Xse=L5.call(Object);function Yse(e){if(!Gse(e)||Use(e)!=qse)return!1;var t=Vse(e);if(t===null)return!0;var i=Zse.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&L5.call(i)==Xse}var Kse=Yse;const Jse=Fn(Kse);var Qse=Ll,ele=Rl,tle="[object Boolean]";function rle(e){return e===!0||e===!1||ele(e)&&Qse(e)==tle}var nle=rle;const ile=Fn(nle);function Ny(e){"@babel/helpers - typeof";return Ny=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ny(e)}function Hx(){return Hx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Hx.apply(this,arguments)}function ole(e,t){return cle(e)||lle(e,t)||sle(e,t)||ale()}function ale(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sle(e,t){if(e){if(typeof e=="string")return ZR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ZR(e,t)}}function ZR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function lle(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function cle(e){if(Array.isArray(e))return e}function XR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function YR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XR(Object(i),!0).forEach(function(a){ule(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function ule(e,t,i){return t=hle(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function hle(e){var t=fle(e,"string");return Ny(t)=="symbol"?t:t+""}function fle(e,t){if(Ny(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Ny(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KR=function(t,i,a,f,y){var w=a-f,O;return O="M ".concat(t,",").concat(i),O+="L ".concat(t+a,",").concat(i),O+="L ".concat(t+a-w/2,",").concat(i+y),O+="L ".concat(t+a-w/2-f,",").concat(i+y),O+="L ".concat(t,",").concat(i," Z"),O},dle={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},ple=function(t){var i=YR(YR({},dle),t),a=Wt.useRef(),f=Wt.useState(-1),y=ole(f,2),w=y[0],O=y[1];Wt.useEffect(function(){if(a.current&&a.current.getTotalLength)try{var ue=a.current.getTotalLength();ue&&O(ue)}catch{}},[]);var o=i.x,L=i.y,$=i.upperWidth,F=i.lowerWidth,H=i.height,Y=i.className,oe=i.animationEasing,te=i.animationDuration,ie=i.animationBegin,ae=i.isUpdateAnimationActive;if(o!==+o||L!==+L||$!==+$||F!==+F||H!==+H||$===0&&F===0||H===0)return null;var J=pn("recharts-trapezoid",Y);return ae?tt.createElement(Hs,{canBegin:w>0,from:{upperWidth:0,lowerWidth:0,height:H,x:o,y:L},to:{upperWidth:$,lowerWidth:F,height:H,x:o,y:L},duration:te,animationEasing:oe,isActive:ae},function(ue){var le=ue.upperWidth,se=ue.lowerWidth,be=ue.height,Ie=ue.x,Ae=ue.y;return tt.createElement(Hs,{canBegin:w>0,from:"0px ".concat(w===-1?1:w,"px"),to:"".concat(w,"px 0px"),attributeName:"strokeDasharray",begin:ie,duration:te,easing:oe},tt.createElement("path",Hx({},Yr(i,!0),{className:J,d:KR(Ie,Ae,le,se,be),ref:a})))}):tt.createElement("g",null,tt.createElement("path",Hx({},Yr(i,!0),{className:J,d:KR(o,L,$,F,H)})))},mle=["option","shapeType","propTransformer","activeClassName","isActive"];function jy(e){"@babel/helpers - typeof";return jy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jy(e)}function gle(e,t){if(e==null)return{};var i=yle(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function yle(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function JR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function Zx(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JR(Object(i),!0).forEach(function(a){_le(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JR(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function _le(e,t,i){return t=vle(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function vle(e){var t=xle(e,"string");return jy(t)=="symbol"?t:t+""}function xle(e,t){if(jy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(jy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ble(e,t){return Zx(Zx({},t),e)}function wle(e,t){return e==="symbols"}function QR(e){var t=e.shapeType,i=e.elementProps;switch(t){case"rectangle":return tt.createElement(dP,i);case"trapezoid":return tt.createElement(ple,i);case"sector":return tt.createElement(w5,i);case"symbols":if(wle(t))return tt.createElement(CM,i);break;default:return null}}function Tle(e){return Wt.isValidElement(e)?e.props:e}function Sle(e){var t=e.option,i=e.shapeType,a=e.propTransformer,f=a===void 0?ble:a,y=e.activeClassName,w=y===void 0?"recharts-active-shape":y,O=e.isActive,o=gle(e,mle),L;if(Wt.isValidElement(t))L=Wt.cloneElement(t,Zx(Zx({},o),Tle(t)));else if(on(t))L=t(o);else if(Jse(t)&&!ile(t)){var $=f(t,o);L=tt.createElement(QR,{shapeType:i,elementProps:$})}else{var F=o;L=tt.createElement(QR,{shapeType:i,elementProps:F})}return O?tt.createElement(Vn,{className:w},L):L}function ib(e,t){return t!=null&&"trapezoids"in e.props}function ob(e,t){return t!=null&&"sectors"in e.props}function $y(e,t){return t!=null&&"points"in e.props}function Ale(e,t){var i,a,f=e.x===(t==null||(i=t.labelViewBox)===null||i===void 0?void 0:i.x)||e.x===t.x,y=e.y===(t==null||(a=t.labelViewBox)===null||a===void 0?void 0:a.y)||e.y===t.y;return f&&y}function Ele(e,t){var i=e.endAngle===t.endAngle,a=e.startAngle===t.startAngle;return i&&a}function Mle(e,t){var i=e.x===t.x,a=e.y===t.y,f=e.z===t.z;return i&&a&&f}function Ple(e,t){var i;return ib(e,t)?i=Ale:ob(e,t)?i=Ele:$y(e,t)&&(i=Mle),i}function Ile(e,t){var i;return ib(e,t)?i="trapezoids":ob(e,t)?i="sectors":$y(e,t)&&(i="points"),i}function Cle(e,t){if(ib(e,t)){var i;return(i=t.tooltipPayload)===null||i===void 0||(i=i[0])===null||i===void 0||(i=i.payload)===null||i===void 0?void 0:i.payload}if(ob(e,t)){var a;return(a=t.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}return $y(e,t)?t.payload:{}}function Ole(e){var t=e.activeTooltipItem,i=e.graphicalItem,a=e.itemData,f=Ile(i,t),y=Cle(i,t),w=a.filter(function(o,L){var $=Ud(y,o),F=i.props[f].filter(function(oe){var te=Ple(i,t);return te(oe,t)}),H=i.props[f].indexOf(F[F.length-1]),Y=L===H;return $&&Y}),O=a.indexOf(w[w.length-1]);return O}var kle=Math.ceil,Dle=Math.max;function Lle(e,t,i,a){for(var f=-1,y=Dle(kle((t-e)/(i||1)),0),w=Array(y);y--;)w[a?y:++f]=e,e+=i;return w}var Rle=Lle,zle=fN,ez=1/0,Ble=17976931348623157e292;function Fle(e){if(!e)return e===0?e:0;if(e=zle(e),e===ez||e===-ez){var t=e<0?-1:1;return t*Ble}return e===e?e:0}var Nle=Fle,jle=Rle,$le=H1,KT=Nle;function Ule(e){return function(t,i,a){return a&&typeof a!="number"&&$le(t,i,a)&&(i=a=void 0),t=KT(t),i===void 0?(i=t,t=0):i=KT(i),a=a===void 0?t<i?1:-1:KT(a),jle(t,i,a,e)}}var Vle=Ule,Gle=Vle,qle=Gle(),Wle=qle;const Xx=Fn(Wle);function Uy(e){"@babel/helpers - typeof";return Uy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uy(e)}function tz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function rz(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?tz(Object(i),!0).forEach(function(a){R5(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function R5(e,t,i){return t=Hle(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Hle(e){var t=Zle(e,"string");return Uy(t)=="symbol"?t:t+""}function Zle(e,t){if(Uy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Uy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Xle=["Webkit","Moz","O","ms"],Yle=function(t,i){var a=t.replace(/(\w)/,function(y){return y.toUpperCase()}),f=Xle.reduce(function(y,w){return rz(rz({},y),{},R5({},w+a,i))},{});return f[t]=i,f};function qd(e){"@babel/helpers - typeof";return qd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qd(e)}function Yx(){return Yx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Yx.apply(this,arguments)}function nz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function JT(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nz(Object(i),!0).forEach(function(a){ia(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Kle(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iz(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,B5(a.key),a)}}function Jle(e,t,i){return t&&iz(e.prototype,t),i&&iz(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qle(e,t,i){return t=Kx(t),ece(e,z5()?Reflect.construct(t,i||[],Kx(e).constructor):t.apply(e,i))}function ece(e,t){if(t&&(qd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tce(e)}function tce(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(z5=function(){return!!e})()}function Kx(e){return Kx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Kx(e)}function rce(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&QA(e,t)}function QA(e,t){return QA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},QA(e,t)}function ia(e,t,i){return t=B5(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function B5(e){var t=nce(e,"string");return qd(t)=="symbol"?t:t+""}function nce(e,t){if(qd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(qd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ice=function(t){var i=t.data,a=t.startIndex,f=t.endIndex,y=t.x,w=t.width,O=t.travellerWidth;if(!i||!i.length)return{};var o=i.length,L=qg().domain(Xx(0,o)).range([y,y+w-O]),$=L.domain().map(function(F){return L(F)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:L(a),endX:L(f),scale:L,scaleValues:$}},oz=function(t){return t.changedTouches&&!!t.changedTouches.length},Wd=function(e){function t(i){var a;return Kle(this,t),a=Qle(this,t,[i]),ia(a,"handleDrag",function(f){a.leaveTimer&&(clearTimeout(a.leaveTimer),a.leaveTimer=null),a.state.isTravellerMoving?a.handleTravellerMove(f):a.state.isSlideMoving&&a.handleSlideDrag(f)}),ia(a,"handleTouchMove",function(f){f.changedTouches!=null&&f.changedTouches.length>0&&a.handleDrag(f.changedTouches[0])}),ia(a,"handleDragEnd",function(){a.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var f=a.props,y=f.endIndex,w=f.onDragEnd,O=f.startIndex;w==null||w({endIndex:y,startIndex:O})}),a.detachDragEndListener()}),ia(a,"handleLeaveWrapper",function(){(a.state.isTravellerMoving||a.state.isSlideMoving)&&(a.leaveTimer=window.setTimeout(a.handleDragEnd,a.props.leaveTimeOut))}),ia(a,"handleEnterSlideOrTraveller",function(){a.setState({isTextActive:!0})}),ia(a,"handleLeaveSlideOrTraveller",function(){a.setState({isTextActive:!1})}),ia(a,"handleSlideDragStart",function(f){var y=oz(f)?f.changedTouches[0]:f;a.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:y.pageX}),a.attachDragEndListener()}),a.travellerDragStartHandlers={startX:a.handleTravellerDragStart.bind(a,"startX"),endX:a.handleTravellerDragStart.bind(a,"endX")},a.state={},a}return rce(t,e),Jle(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(a){var f=a.startX,y=a.endX,w=this.state.scaleValues,O=this.props,o=O.gap,L=O.data,$=L.length-1,F=Math.min(f,y),H=Math.max(f,y),Y=t.getIndexInRange(w,F),oe=t.getIndexInRange(w,H);return{startIndex:Y-Y%o,endIndex:oe===$?$:oe-oe%o}}},{key:"getTextOfTick",value:function(a){var f=this.props,y=f.data,w=f.tickFormatter,O=f.dataKey,o=Mo(y[a],O,a);return on(w)?w(o,a):o}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(a){var f=this.state,y=f.slideMoveStartX,w=f.startX,O=f.endX,o=this.props,L=o.x,$=o.width,F=o.travellerWidth,H=o.startIndex,Y=o.endIndex,oe=o.onChange,te=a.pageX-y;te>0?te=Math.min(te,L+$-F-O,L+$-F-w):te<0&&(te=Math.max(te,L-w,L-O));var ie=this.getIndex({startX:w+te,endX:O+te});(ie.startIndex!==H||ie.endIndex!==Y)&&oe&&oe(ie),this.setState({startX:w+te,endX:O+te,slideMoveStartX:a.pageX})}},{key:"handleTravellerDragStart",value:function(a,f){var y=oz(f)?f.changedTouches[0]:f;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:a,brushMoveStartX:y.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(a){var f=this.state,y=f.brushMoveStartX,w=f.movingTravellerId,O=f.endX,o=f.startX,L=this.state[w],$=this.props,F=$.x,H=$.width,Y=$.travellerWidth,oe=$.onChange,te=$.gap,ie=$.data,ae={startX:this.state.startX,endX:this.state.endX},J=a.pageX-y;J>0?J=Math.min(J,F+H-Y-L):J<0&&(J=Math.max(J,F-L)),ae[w]=L+J;var ue=this.getIndex(ae),le=ue.startIndex,se=ue.endIndex,be=function(){var Ae=ie.length-1;return w==="startX"&&(O>o?le%te===0:se%te===0)||O<o&&se===Ae||w==="endX"&&(O>o?se%te===0:le%te===0)||O>o&&se===Ae};this.setState(ia(ia({},w,L+J),"brushMoveStartX",a.pageX),function(){oe&&be()&&oe(ue)})}},{key:"handleTravellerMoveKeyboard",value:function(a,f){var y=this,w=this.state,O=w.scaleValues,o=w.startX,L=w.endX,$=this.state[f],F=O.indexOf($);if(F!==-1){var H=F+a;if(!(H===-1||H>=O.length)){var Y=O[H];f==="startX"&&Y>=L||f==="endX"&&Y<=o||this.setState(ia({},f,Y),function(){y.props.onChange(y.getIndex({startX:y.state.startX,endX:y.state.endX}))})}}}},{key:"renderBackground",value:function(){var a=this.props,f=a.x,y=a.y,w=a.width,O=a.height,o=a.fill,L=a.stroke;return tt.createElement("rect",{stroke:L,fill:o,x:f,y,width:w,height:O})}},{key:"renderPanorama",value:function(){var a=this.props,f=a.x,y=a.y,w=a.width,O=a.height,o=a.data,L=a.children,$=a.padding,F=Wt.Children.only(L);return F?tt.cloneElement(F,{x:f,y,width:w,height:O,margin:$,compact:!0,data:o}):null}},{key:"renderTravellerLayer",value:function(a,f){var y,w,O=this,o=this.props,L=o.y,$=o.travellerWidth,F=o.height,H=o.traveller,Y=o.ariaLabel,oe=o.data,te=o.startIndex,ie=o.endIndex,ae=Math.max(a,this.props.x),J=JT(JT({},Yr(this.props,!1)),{},{x:ae,y:L,width:$,height:F}),ue=Y||"Min value: ".concat((y=oe[te])===null||y===void 0?void 0:y.name,", Max value: ").concat((w=oe[ie])===null||w===void 0?void 0:w.name);return tt.createElement(Vn,{tabIndex:0,role:"slider","aria-label":ue,"aria-valuenow":a,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[f],onTouchStart:this.travellerDragStartHandlers[f],onKeyDown:function(se){["ArrowLeft","ArrowRight"].includes(se.key)&&(se.preventDefault(),se.stopPropagation(),O.handleTravellerMoveKeyboard(se.key==="ArrowRight"?1:-1,f))},onFocus:function(){O.setState({isTravellerFocused:!0})},onBlur:function(){O.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(H,J))}},{key:"renderSlide",value:function(a,f){var y=this.props,w=y.y,O=y.height,o=y.stroke,L=y.travellerWidth,$=Math.min(a,f)+L,F=Math.max(Math.abs(f-a)-L,0);return tt.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:o,fillOpacity:.2,x:$,y:w,width:F,height:O})}},{key:"renderText",value:function(){var a=this.props,f=a.startIndex,y=a.endIndex,w=a.y,O=a.height,o=a.travellerWidth,L=a.stroke,$=this.state,F=$.startX,H=$.endX,Y=5,oe={pointerEvents:"none",fill:L};return tt.createElement(Vn,{className:"recharts-brush-texts"},tt.createElement(Ax,Yx({textAnchor:"end",verticalAnchor:"middle",x:Math.min(F,H)-Y,y:w+O/2},oe),this.getTextOfTick(f)),tt.createElement(Ax,Yx({textAnchor:"start",verticalAnchor:"middle",x:Math.max(F,H)+o+Y,y:w+O/2},oe),this.getTextOfTick(y)))}},{key:"render",value:function(){var a=this.props,f=a.data,y=a.className,w=a.children,O=a.x,o=a.y,L=a.width,$=a.height,F=a.alwaysShowText,H=this.state,Y=H.startX,oe=H.endX,te=H.isTextActive,ie=H.isSlideMoving,ae=H.isTravellerMoving,J=H.isTravellerFocused;if(!f||!f.length||!tr(O)||!tr(o)||!tr(L)||!tr($)||L<=0||$<=0)return null;var ue=pn("recharts-brush",y),le=tt.Children.count(w)===1,se=Yle("userSelect","none");return tt.createElement(Vn,{className:ue,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:se},this.renderBackground(),le&&this.renderPanorama(),this.renderSlide(Y,oe),this.renderTravellerLayer(Y,"startX"),this.renderTravellerLayer(oe,"endX"),(te||ie||ae||J||F)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(a){var f=a.x,y=a.y,w=a.width,O=a.height,o=a.stroke,L=Math.floor(y+O/2)-1;return tt.createElement(tt.Fragment,null,tt.createElement("rect",{x:f,y,width:w,height:O,fill:o,stroke:"none"}),tt.createElement("line",{x1:f+1,y1:L,x2:f+w-1,y2:L,fill:"none",stroke:"#fff"}),tt.createElement("line",{x1:f+1,y1:L+2,x2:f+w-1,y2:L+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(a,f){var y;return tt.isValidElement(a)?y=tt.cloneElement(a,f):on(a)?y=a(f):y=t.renderDefaultTraveller(f),y}},{key:"getDerivedStateFromProps",value:function(a,f){var y=a.data,w=a.width,O=a.x,o=a.travellerWidth,L=a.updateId,$=a.startIndex,F=a.endIndex;if(y!==f.prevData||L!==f.prevUpdateId)return JT({prevData:y,prevTravellerWidth:o,prevUpdateId:L,prevX:O,prevWidth:w},y&&y.length?ice({data:y,width:w,x:O,travellerWidth:o,startIndex:$,endIndex:F}):{scale:null,scaleValues:null});if(f.scale&&(w!==f.prevWidth||O!==f.prevX||o!==f.prevTravellerWidth)){f.scale.range([O,O+w-o]);var H=f.scale.domain().map(function(Y){return f.scale(Y)});return{prevData:y,prevTravellerWidth:o,prevUpdateId:L,prevX:O,prevWidth:w,startX:f.scale(a.startIndex),endX:f.scale(a.endIndex),scaleValues:H}}return null}},{key:"getIndexInRange",value:function(a,f){for(var y=a.length,w=0,O=y-1;O-w>1;){var o=Math.floor((w+O)/2);a[o]>f?O=o:w=o}return f>=a[O]?O:w}}])}(Wt.PureComponent);ia(Wd,"displayName","Brush");ia(Wd,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var oce=FM;function ace(e,t){var i;return oce(e,function(a,f,y){return i=t(a,f,y),!i}),!!i}var sce=ace,lce=jF,cce=yp,uce=sce,hce=Vo,fce=H1;function dce(e,t,i){var a=hce(e)?lce:uce;return i&&fce(e,t,i)&&(t=void 0),a(e,cce(t))}var pce=dce;const mce=Fn(pce);var Gs=function(t,i){var a=t.alwaysShow,f=t.ifOverflow;return a&&(f="extendDomain"),f===i},az=sN;function gce(e,t,i){t=="__proto__"&&az?az(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var yce=gce,_ce=yce,vce=oN,xce=yp;function bce(e,t){var i={};return t=xce(t),vce(e,function(a,f,y){_ce(i,f,t(a,f,y))}),i}var wce=bce;const Tce=Fn(wce);function Sce(e,t){for(var i=-1,a=e==null?0:e.length;++i<a;)if(!t(e[i],i,e))return!1;return!0}var Ace=Sce,Ece=FM;function Mce(e,t){var i=!0;return Ece(e,function(a,f,y){return i=!!t(a,f,y),i}),i}var Pce=Mce,Ice=Ace,Cce=Pce,Oce=yp,kce=Vo,Dce=H1;function Lce(e,t,i){var a=kce(e)?Ice:Cce;return i&&Dce(e,t,i)&&(t=void 0),a(e,Oce(t))}var Rce=Lce;const zce=Fn(Rce);var Bce=["x","y"];function Vy(e){"@babel/helpers - typeof";return Vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vy(e)}function eE(){return eE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},eE.apply(this,arguments)}function sz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function Pg(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?sz(Object(i),!0).forEach(function(a){Fce(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Fce(e,t,i){return t=Nce(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Nce(e){var t=jce(e,"string");return Vy(t)=="symbol"?t:t+""}function jce(e,t){if(Vy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Vy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $ce(e,t){if(e==null)return{};var i=Uce(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Uce(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function Vce(e,t){var i=e.x,a=e.y,f=$ce(e,Bce),y="".concat(i),w=parseInt(y,10),O="".concat(a),o=parseInt(O,10),L="".concat(t.height||f.height),$=parseInt(L,10),F="".concat(t.width||f.width),H=parseInt(F,10);return Pg(Pg(Pg(Pg(Pg({},t),f),w?{x:w}:{}),o?{y:o}:{}),{},{height:$,width:H,name:t.name,radius:t.radius})}function lz(e){return tt.createElement(Sle,eE({shapeType:"rectangle",propTransformer:Vce,activeClassName:"recharts-active-bar"},e))}var Gce=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(a,f){if(typeof t=="number")return t;var y=typeof a=="number";return y?t(a,f):(y||Ih(),i)}},qce=["value","background"],F5;function Hd(e){"@babel/helpers - typeof";return Hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hd(e)}function Wce(e,t){if(e==null)return{};var i=Hce(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Hce(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function Jx(){return Jx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Jx.apply(this,arguments)}function cz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function vi(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cz(Object(i),!0).forEach(function(a){qc(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Zce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uz(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,j5(a.key),a)}}function Xce(e,t,i){return t&&uz(e.prototype,t),i&&uz(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yce(e,t,i){return t=Qx(t),Kce(e,N5()?Reflect.construct(t,i||[],Qx(e).constructor):t.apply(e,i))}function Kce(e,t){if(t&&(Hd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jce(e)}function Jce(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N5(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(N5=function(){return!!e})()}function Qx(e){return Qx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Qx(e)}function Qce(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tE(e,t)}function tE(e,t){return tE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},tE(e,t)}function qc(e,t,i){return t=j5(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function j5(e){var t=eue(e,"string");return Hd(t)=="symbol"?t:t+""}function eue(e,t){if(Hd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Hd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var a_=function(e){function t(){var i;Zce(this,t);for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];return i=Yce(this,t,[].concat(f)),qc(i,"state",{isAnimationFinished:!1}),qc(i,"id",dp("recharts-bar-")),qc(i,"handleAnimationEnd",function(){var w=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),w&&w()}),qc(i,"handleAnimationStart",function(){var w=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),w&&w()}),i}return Qce(t,e),Xce(t,[{key:"renderRectanglesStatically",value:function(a){var f=this,y=this.props,w=y.shape,O=y.dataKey,o=y.activeIndex,L=y.activeBar,$=Yr(this.props,!1);return a&&a.map(function(F,H){var Y=H===o,oe=Y?L:w,te=vi(vi(vi({},$),F),{},{isActive:Y,option:oe,index:H,dataKey:O,onAnimationStart:f.handleAnimationStart,onAnimationEnd:f.handleAnimationEnd});return tt.createElement(Vn,Jx({className:"recharts-bar-rectangle"},hx(f.props,F,H),{key:"rectangle-".concat(F==null?void 0:F.x,"-").concat(F==null?void 0:F.y,"-").concat(F==null?void 0:F.value)}),tt.createElement(lz,te))})}},{key:"renderRectanglesWithAnimation",value:function(){var a=this,f=this.props,y=f.data,w=f.layout,O=f.isAnimationActive,o=f.animationBegin,L=f.animationDuration,$=f.animationEasing,F=f.animationId,H=this.state.prevData;return tt.createElement(Hs,{begin:o,duration:L,isActive:O,easing:$,from:{t:0},to:{t:1},key:"bar-".concat(F),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(Y){var oe=Y.t,te=y.map(function(ie,ae){var J=H&&H[ae];if(J){var ue=Xi(J.x,ie.x),le=Xi(J.y,ie.y),se=Xi(J.width,ie.width),be=Xi(J.height,ie.height);return vi(vi({},ie),{},{x:ue(oe),y:le(oe),width:se(oe),height:be(oe)})}if(w==="horizontal"){var Ie=Xi(0,ie.height),Ae=Ie(oe);return vi(vi({},ie),{},{y:ie.y+ie.height-Ae,height:Ae})}var ht=Xi(0,ie.width),st=ht(oe);return vi(vi({},ie),{},{width:st})});return tt.createElement(Vn,null,a.renderRectanglesStatically(te))})}},{key:"renderRectangles",value:function(){var a=this.props,f=a.data,y=a.isAnimationActive,w=this.state.prevData;return y&&f&&f.length&&(!w||!Ud(w,f))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(f)}},{key:"renderBackground",value:function(){var a=this,f=this.props,y=f.data,w=f.dataKey,O=f.activeIndex,o=Yr(this.props.background,!1);return y.map(function(L,$){L.value;var F=L.background,H=Wce(L,qce);if(!F)return null;var Y=vi(vi(vi(vi(vi({},H),{},{fill:"#eee"},F),o),hx(a.props,L,$)),{},{onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd,dataKey:w,index:$,className:"recharts-bar-background-rectangle"});return tt.createElement(lz,Jx({key:"background-bar-".concat($),option:a.props.background,isActive:$===O},Y))})}},{key:"renderErrorBar",value:function(a,f){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var y=this.props,w=y.data,O=y.xAxis,o=y.yAxis,L=y.layout,$=y.children,F=Ra($,o_);if(!F)return null;var H=L==="vertical"?w[0].height/2:w[0].width/2,Y=function(ie,ae){var J=Array.isArray(ie.value)?ie.value[1]:ie.value;return{x:ie.x,y:ie.y,value:J,errorVal:Mo(ie,ae)}},oe={clipPath:a?"url(#clipPath-".concat(f,")"):null};return tt.createElement(Vn,oe,F.map(function(te){return tt.cloneElement(te,{key:"error-bar-".concat(f,"-").concat(te.props.dataKey),data:w,xAxis:O,yAxis:o,layout:L,offset:H,dataPointFormatter:Y})}))}},{key:"render",value:function(){var a=this.props,f=a.hide,y=a.data,w=a.className,O=a.xAxis,o=a.yAxis,L=a.left,$=a.top,F=a.width,H=a.height,Y=a.isAnimationActive,oe=a.background,te=a.id;if(f||!y||!y.length)return null;var ie=this.state.isAnimationFinished,ae=pn("recharts-bar",w),J=O&&O.allowDataOverflow,ue=o&&o.allowDataOverflow,le=J||ue,se=en(te)?this.id:te;return tt.createElement(Vn,{className:ae},J||ue?tt.createElement("defs",null,tt.createElement("clipPath",{id:"clipPath-".concat(se)},tt.createElement("rect",{x:J?L:L-F/2,y:ue?$:$-H/2,width:J?F:F*2,height:ue?H:H*2}))):null,tt.createElement(Vn,{className:"recharts-bar-rectangles",clipPath:le?"url(#clipPath-".concat(se,")"):null},oe?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(le,se),(!Y||ie)&&Al.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(a,f){return a.animationId!==f.prevAnimationId?{prevAnimationId:a.animationId,curData:a.data,prevData:f.curData}:a.data!==f.curData?{curData:a.data}:null}}])}(Wt.PureComponent);F5=a_;qc(a_,"displayName","Bar");qc(a_,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Us.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});qc(a_,"getComposedData",function(e){var t=e.props,i=e.item,a=e.barPosition,f=e.bandSize,y=e.xAxis,w=e.yAxis,O=e.xAxisTicks,o=e.yAxisTicks,L=e.stackedData,$=e.dataStartIndex,F=e.displayedData,H=e.offset,Y=Fie(a,i);if(!Y)return null;var oe=t.layout,te=i.type.defaultProps,ie=te!==void 0?vi(vi({},te),i.props):i.props,ae=ie.dataKey,J=ie.children,ue=ie.minPointSize,le=oe==="horizontal"?w:y,se=L?le.scale.domain():null,be=Wie({numericAxis:le}),Ie=Ra(J,pN),Ae=F.map(function(ht,st){var We,He,At,Tt,kt,ct;L?We=Nie(L[$+st],se):(We=Mo(ht,ae),Array.isArray(We)||(We=[be,We]));var Ot=Gce(ue,F5.defaultProps.minPointSize)(We[1],st);if(oe==="horizontal"){var mt,Lt=[w.scale(We[0]),w.scale(We[1])],yt=Lt[0],Zt=Lt[1];He=cR({axis:y,ticks:O,bandSize:f,offset:Y.offset,entry:ht,index:st}),At=(mt=Zt??yt)!==null&&mt!==void 0?mt:void 0,Tt=Y.size;var Yt=yt-Zt;if(kt=Number.isNaN(Yt)?0:Yt,ct={x:He,y:w.y,width:Tt,height:w.height},Math.abs(Ot)>0&&Math.abs(kt)<Math.abs(Ot)){var xr=ps(kt||Ot)*(Math.abs(Ot)-Math.abs(kt));At-=xr,kt+=xr}}else{var Vt=[y.scale(We[0]),y.scale(We[1])],Sn=Vt[0],vn=Vt[1];if(He=Sn,At=cR({axis:w,ticks:o,bandSize:f,offset:Y.offset,entry:ht,index:st}),Tt=vn-Sn,kt=Y.size,ct={x:y.x,y:At,width:y.width,height:kt},Math.abs(Ot)>0&&Math.abs(Tt)<Math.abs(Ot)){var sn=ps(Tt||Ot)*(Math.abs(Ot)-Math.abs(Tt));Tt+=sn}}return vi(vi(vi({},ht),{},{x:He,y:At,width:Tt,height:kt,value:L?We:We[1],payload:ht,background:ct},Ie&&Ie[st]&&Ie[st].props),{},{tooltipPayload:[v5(i,ht)],tooltipPosition:{x:He+Tt/2,y:At+kt/2}})});return vi({data:Ae,layout:oe},H)});function Gy(e){"@babel/helpers - typeof";return Gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gy(e)}function tue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hz(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,$5(a.key),a)}}function rue(e,t,i){return t&&hz(e.prototype,t),i&&hz(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function fz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function us(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?fz(Object(i),!0).forEach(function(a){ab(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function ab(e,t,i){return t=$5(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function $5(e){var t=nue(e,"string");return Gy(t)=="symbol"?t:t+""}function nue(e,t){if(Gy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Gy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U5=function(t,i,a,f,y){var w=t.width,O=t.height,o=t.layout,L=t.children,$=Object.keys(i),F={left:a.left,leftMirror:a.left,right:w-a.right,rightMirror:w-a.right,top:a.top,topMirror:a.top,bottom:O-a.bottom,bottomMirror:O-a.bottom},H=!!aa(L,a_);return $.reduce(function(Y,oe){var te=i[oe],ie=te.orientation,ae=te.domain,J=te.padding,ue=J===void 0?{}:J,le=te.mirror,se=te.reversed,be="".concat(ie).concat(le?"Mirror":""),Ie,Ae,ht,st,We;if(te.type==="number"&&(te.padding==="gap"||te.padding==="no-gap")){var He=ae[1]-ae[0],At=1/0,Tt=te.categoricalDomain.sort();if(Tt.forEach(function(Vt,Sn){Sn>0&&(At=Math.min((Vt||0)-(Tt[Sn-1]||0),At))}),Number.isFinite(At)){var kt=At/He,ct=te.layout==="vertical"?a.height:a.width;if(te.padding==="gap"&&(Ie=kt*ct/2),te.padding==="no-gap"){var Ot=Mh(t.barCategoryGap,kt*ct),mt=kt*ct/2;Ie=mt-Ot-(mt-Ot)/ct*Ot}}}f==="xAxis"?Ae=[a.left+(ue.left||0)+(Ie||0),a.left+a.width-(ue.right||0)-(Ie||0)]:f==="yAxis"?Ae=o==="horizontal"?[a.top+a.height-(ue.bottom||0),a.top+(ue.top||0)]:[a.top+(ue.top||0)+(Ie||0),a.top+a.height-(ue.bottom||0)-(Ie||0)]:Ae=te.range,se&&(Ae=[Ae[1],Ae[0]]);var Lt=zie(te,y,H),yt=Lt.scale,Zt=Lt.realScaleType;yt.domain(ae).range(Ae),Bie(yt);var Yt=qie(yt,us(us({},te),{},{realScaleType:Zt}));f==="xAxis"?(We=ie==="top"&&!le||ie==="bottom"&&le,ht=a.left,st=F[be]-We*te.height):f==="yAxis"&&(We=ie==="left"&&!le||ie==="right"&&le,ht=F[be]-We*te.width,st=a.top);var xr=us(us(us({},te),Yt),{},{realScaleType:Zt,x:ht,y:st,scale:yt,width:f==="xAxis"?a.width:te.width,height:f==="yAxis"?a.height:te.height});return xr.bandSize=jx(xr,Yt),!te.hide&&f==="xAxis"?F[be]+=(We?-1:1)*xr.height:te.hide||(F[be]+=(We?-1:1)*xr.width),us(us({},Y),{},ab({},oe,xr))},{})},V5=function(t,i){var a=t.x,f=t.y,y=i.x,w=i.y;return{x:Math.min(a,y),y:Math.min(f,w),width:Math.abs(y-a),height:Math.abs(w-f)}},iue=function(t){var i=t.x1,a=t.y1,f=t.x2,y=t.y2;return V5({x:i,y:a},{x:f,y})},G5=function(){function e(t){tue(this,e),this.scale=t}return rue(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=a.bandAware,y=a.position;if(i!==void 0){if(y)switch(y){case"start":return this.scale(i);case"middle":{var w=this.bandwidth?this.bandwidth()/2:0;return this.scale(i)+w}case"end":{var O=this.bandwidth?this.bandwidth():0;return this.scale(i)+O}default:return this.scale(i)}if(f){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(i)+o}return this.scale(i)}}},{key:"isInRange",value:function(i){var a=this.range(),f=a[0],y=a[a.length-1];return f<=y?i>=f&&i<=y:i>=y&&i<=f}}],[{key:"create",value:function(i){return new e(i)}}])}();ab(G5,"EPS",1e-4);var pP=function(t){var i=Object.keys(t).reduce(function(a,f){return us(us({},a),{},ab({},f,G5.create(t[f])))},{});return us(us({},i),{},{apply:function(f){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=y.bandAware,O=y.position;return Tce(f,function(o,L){return i[L].apply(o,{bandAware:w,position:O})})},isInRange:function(f){return zce(f,function(y,w){return i[w].isInRange(y)})}})};function oue(e){return(e%180+180)%180}var aue=function(t){var i=t.width,a=t.height,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,y=oue(f),w=y*Math.PI/180,O=Math.atan(a/i),o=w>O&&w<Math.PI-O?a/Math.sin(w):i/Math.cos(w);return Math.abs(o)},sue=wG(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),q5=Wt.createContext(void 0),W5=Wt.createContext(void 0),H5=Wt.createContext(void 0),lue=Wt.createContext({}),Z5=Wt.createContext(void 0),X5=Wt.createContext(0),Y5=Wt.createContext(0),dz=function(t){var i=t.state,a=i.xAxisMap,f=i.yAxisMap,y=i.offset,w=t.clipPathId,O=t.children,o=t.width,L=t.height,$=sue(y);return tt.createElement(q5.Provider,{value:a},tt.createElement(W5.Provider,{value:f},tt.createElement(lue.Provider,{value:y},tt.createElement(H5.Provider,{value:$},tt.createElement(Z5.Provider,{value:w},tt.createElement(X5.Provider,{value:L},tt.createElement(Y5.Provider,{value:o},O)))))))},cue=function(){return Wt.useContext(Z5)},K5=function(t){var i=Wt.useContext(q5);i==null&&Ih();var a=i[t];return a==null&&Ih(),a},J5=function(t){var i=Wt.useContext(W5);i==null&&Ih();var a=i[t];return a==null&&Ih(),a},uue=function(){var t=Wt.useContext(H5);return t},Q5=function(){return Wt.useContext(Y5)},ej=function(){return Wt.useContext(X5)};function Zd(e){"@babel/helpers - typeof";return Zd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zd(e)}function hue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fue(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,rj(a.key),a)}}function due(e,t,i){return t&&fue(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function pue(e,t,i){return t=e1(t),mue(e,tj()?Reflect.construct(t,i||[],e1(e).constructor):t.apply(e,i))}function mue(e,t){if(t&&(Zd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gue(e)}function gue(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tj=function(){return!!e})()}function e1(e){return e1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},e1(e)}function yue(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rE(e,t)}function rE(e,t){return rE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},rE(e,t)}function pz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function mz(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?pz(Object(i),!0).forEach(function(a){mP(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function mP(e,t,i){return t=rj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function rj(e){var t=_ue(e,"string");return Zd(t)=="symbol"?t:t+""}function _ue(e,t){if(Zd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Zd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vue(e,t){return Tue(e)||wue(e,t)||bue(e,t)||xue()}function xue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bue(e,t){if(e){if(typeof e=="string")return gz(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return gz(e,t)}}function gz(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function wue(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function Tue(e){if(Array.isArray(e))return e}function nE(){return nE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},nE.apply(this,arguments)}var Sue=function(t,i){var a;return tt.isValidElement(t)?a=tt.cloneElement(t,i):on(t)?a=t(i):a=tt.createElement("line",nE({},i,{className:"recharts-reference-line-line"})),a},Aue=function(t,i,a,f,y,w,O,o,L){var $=y.x,F=y.y,H=y.width,Y=y.height;if(a){var oe=L.y,te=t.y.apply(oe,{position:w});if(Gs(L,"discard")&&!t.y.isInRange(te))return null;var ie=[{x:$+H,y:te},{x:$,y:te}];return o==="left"?ie.reverse():ie}if(i){var ae=L.x,J=t.x.apply(ae,{position:w});if(Gs(L,"discard")&&!t.x.isInRange(J))return null;var ue=[{x:J,y:F+Y},{x:J,y:F}];return O==="top"?ue.reverse():ue}if(f){var le=L.segment,se=le.map(function(be){return t.apply(be,{position:w})});return Gs(L,"discard")&&mce(se,function(be){return!t.isInRange(be)})?null:se}return null};function Eue(e){var t=e.x,i=e.y,a=e.segment,f=e.xAxisId,y=e.yAxisId,w=e.shape,O=e.className,o=e.alwaysShow,L=cue(),$=K5(f),F=J5(y),H=uue();if(!L||!H)return null;vh(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var Y=pP({x:$.scale,y:F.scale}),oe=Pi(t),te=Pi(i),ie=a&&a.length===2,ae=Aue(Y,oe,te,ie,H,e.position,$.orientation,F.orientation,e);if(!ae)return null;var J=vue(ae,2),ue=J[0],le=ue.x,se=ue.y,be=J[1],Ie=be.x,Ae=be.y,ht=Gs(e,"hidden")?"url(#".concat(L,")"):void 0,st=mz(mz({clipPath:ht},Yr(e,!0)),{},{x1:le,y1:se,x2:Ie,y2:Ae});return tt.createElement(Vn,{className:pn("recharts-reference-line",O)},Sue(w,st),uo.renderCallByParent(e,iue({x1:le,y1:se,x2:Ie,y2:Ae})))}var gP=function(e){function t(){return hue(this,t),pue(this,t,arguments)}return yue(t,e),due(t,[{key:"render",value:function(){return tt.createElement(Eue,this.props)}}])}(tt.Component);mP(gP,"displayName","ReferenceLine");mP(gP,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function iE(){return iE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},iE.apply(this,arguments)}function Xd(e){"@babel/helpers - typeof";return Xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xd(e)}function yz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function _z(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(i),!0).forEach(function(a){sb(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Mue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pue(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,ij(a.key),a)}}function Iue(e,t,i){return t&&Pue(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cue(e,t,i){return t=t1(t),Oue(e,nj()?Reflect.construct(t,i||[],t1(e).constructor):t.apply(e,i))}function Oue(e,t){if(t&&(Xd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kue(e)}function kue(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nj=function(){return!!e})()}function t1(e){return t1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},t1(e)}function Due(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oE(e,t)}function oE(e,t){return oE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},oE(e,t)}function sb(e,t,i){return t=ij(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ij(e){var t=Lue(e,"string");return Xd(t)=="symbol"?t:t+""}function Lue(e,t){if(Xd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Xd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Rue=function(t){var i=t.x,a=t.y,f=t.xAxis,y=t.yAxis,w=pP({x:f.scale,y:y.scale}),O=w.apply({x:i,y:a},{bandAware:!0});return Gs(t,"discard")&&!w.isInRange(O)?null:O},lb=function(e){function t(){return Mue(this,t),Cue(this,t,arguments)}return Due(t,e),Iue(t,[{key:"render",value:function(){var a=this.props,f=a.x,y=a.y,w=a.r,O=a.alwaysShow,o=a.clipPathId,L=Pi(f),$=Pi(y);if(vh(O===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!L||!$)return null;var F=Rue(this.props);if(!F)return null;var H=F.x,Y=F.y,oe=this.props,te=oe.shape,ie=oe.className,ae=Gs(this.props,"hidden")?"url(#".concat(o,")"):void 0,J=_z(_z({clipPath:ae},Yr(this.props,!0)),{},{cx:H,cy:Y});return tt.createElement(Vn,{className:pn("recharts-reference-dot",ie)},t.renderDot(te,J),uo.renderCallByParent(this.props,{x:H-w,y:Y-w,width:2*w,height:2*w}))}}])}(tt.Component);sb(lb,"displayName","ReferenceDot");sb(lb,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});sb(lb,"renderDot",function(e,t){var i;return tt.isValidElement(e)?i=tt.cloneElement(e,t):on(e)?i=e(t):i=tt.createElement(nb,iE({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),i});function aE(){return aE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},aE.apply(this,arguments)}function Yd(e){"@babel/helpers - typeof";return Yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yd(e)}function vz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function xz(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vz(Object(i),!0).forEach(function(a){cb(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function zue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bue(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,aj(a.key),a)}}function Fue(e,t,i){return t&&Bue(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Nue(e,t,i){return t=r1(t),jue(e,oj()?Reflect.construct(t,i||[],r1(e).constructor):t.apply(e,i))}function jue(e,t){if(t&&(Yd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $ue(e)}function $ue(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oj=function(){return!!e})()}function r1(e){return r1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},r1(e)}function Uue(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sE(e,t)}function sE(e,t){return sE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},sE(e,t)}function cb(e,t,i){return t=aj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function aj(e){var t=Vue(e,"string");return Yd(t)=="symbol"?t:t+""}function Vue(e,t){if(Yd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Yd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Gue=function(t,i,a,f,y){var w=y.x1,O=y.x2,o=y.y1,L=y.y2,$=y.xAxis,F=y.yAxis;if(!$||!F)return null;var H=pP({x:$.scale,y:F.scale}),Y={x:t?H.x.apply(w,{position:"start"}):H.x.rangeMin,y:a?H.y.apply(o,{position:"start"}):H.y.rangeMin},oe={x:i?H.x.apply(O,{position:"end"}):H.x.rangeMax,y:f?H.y.apply(L,{position:"end"}):H.y.rangeMax};return Gs(y,"discard")&&(!H.isInRange(Y)||!H.isInRange(oe))?null:V5(Y,oe)},ub=function(e){function t(){return zue(this,t),Nue(this,t,arguments)}return Uue(t,e),Fue(t,[{key:"render",value:function(){var a=this.props,f=a.x1,y=a.x2,w=a.y1,O=a.y2,o=a.className,L=a.alwaysShow,$=a.clipPathId;vh(L===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var F=Pi(f),H=Pi(y),Y=Pi(w),oe=Pi(O),te=this.props.shape;if(!F&&!H&&!Y&&!oe&&!te)return null;var ie=Gue(F,H,Y,oe,this.props);if(!ie&&!te)return null;var ae=Gs(this.props,"hidden")?"url(#".concat($,")"):void 0;return tt.createElement(Vn,{className:pn("recharts-reference-area",o)},t.renderRect(te,xz(xz({clipPath:ae},Yr(this.props,!0)),ie)),uo.renderCallByParent(this.props,ie))}}])}(tt.Component);cb(ub,"displayName","ReferenceArea");cb(ub,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});cb(ub,"renderRect",function(e,t){var i;return tt.isValidElement(e)?i=tt.cloneElement(e,t):on(e)?i=e(t):i=tt.createElement(dP,aE({},t,{className:"recharts-reference-area-rect"})),i});function sj(e,t,i){if(t<1)return[];if(t===1&&i===void 0)return e;for(var a=[],f=0;f<e.length;f+=t)a.push(e[f]);return a}function que(e,t,i){var a={width:e.width+t.width,height:e.height+t.height};return aue(a,i)}function Wue(e,t,i){var a=i==="width",f=e.x,y=e.y,w=e.width,O=e.height;return t===1?{start:a?f:y,end:a?f+w:y+O}:{start:a?f+w:y+O,end:a?f:y}}function n1(e,t,i,a,f){if(e*t<e*a||e*t>e*f)return!1;var y=i();return e*(t-e*y/2-a)>=0&&e*(t+e*y/2-f)<=0}function Hue(e,t){return sj(e,t+1)}function Zue(e,t,i,a,f){for(var y=(a||[]).slice(),w=t.start,O=t.end,o=0,L=1,$=w,F=function(){var oe=a==null?void 0:a[o];if(oe===void 0)return{v:sj(a,L)};var te=o,ie,ae=function(){return ie===void 0&&(ie=i(oe,te)),ie},J=oe.coordinate,ue=o===0||n1(e,J,ae,$,O);ue||(o=0,$=w,L+=1),ue&&($=J+e*(ae()/2+f),o+=L)},H;L<=y.length;)if(H=F(),H)return H.v;return[]}function qy(e){"@babel/helpers - typeof";return qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qy(e)}function bz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function lo(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?bz(Object(i),!0).forEach(function(a){Xue(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Xue(e,t,i){return t=Yue(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Yue(e){var t=Kue(e,"string");return qy(t)=="symbol"?t:t+""}function Kue(e,t){if(qy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(qy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jue(e,t,i,a,f){for(var y=(a||[]).slice(),w=y.length,O=t.start,o=t.end,L=function(H){var Y=y[H],oe,te=function(){return oe===void 0&&(oe=i(Y,H)),oe};if(H===w-1){var ie=e*(Y.coordinate+e*te()/2-o);y[H]=Y=lo(lo({},Y),{},{tickCoord:ie>0?Y.coordinate-ie*e:Y.coordinate})}else y[H]=Y=lo(lo({},Y),{},{tickCoord:Y.coordinate});var ae=n1(e,Y.tickCoord,te,O,o);ae&&(o=Y.tickCoord-e*(te()/2+f),y[H]=lo(lo({},Y),{},{isShow:!0}))},$=w-1;$>=0;$--)L($);return y}function Que(e,t,i,a,f,y){var w=(a||[]).slice(),O=w.length,o=t.start,L=t.end;if(y){var $=a[O-1],F=i($,O-1),H=e*($.coordinate+e*F/2-L);w[O-1]=$=lo(lo({},$),{},{tickCoord:H>0?$.coordinate-H*e:$.coordinate});var Y=n1(e,$.tickCoord,function(){return F},o,L);Y&&(L=$.tickCoord-e*(F/2+f),w[O-1]=lo(lo({},$),{},{isShow:!0}))}for(var oe=y?O-1:O,te=function(J){var ue=w[J],le,se=function(){return le===void 0&&(le=i(ue,J)),le};if(J===0){var be=e*(ue.coordinate-e*se()/2-o);w[J]=ue=lo(lo({},ue),{},{tickCoord:be<0?ue.coordinate-be*e:ue.coordinate})}else w[J]=ue=lo(lo({},ue),{},{tickCoord:ue.coordinate});var Ie=n1(e,ue.tickCoord,se,o,L);Ie&&(o=ue.tickCoord+e*(se()/2+f),w[J]=lo(lo({},ue),{},{isShow:!0}))},ie=0;ie<oe;ie++)te(ie);return w}function ehe(e,t,i){var a=e.tick,f=e.ticks,y=e.viewBox,w=e.minTickGap,O=e.orientation,o=e.interval,L=e.tickFormatter,$=e.unit,F=e.angle;if(!f||!f.length||!a)return[];if(tr(o)||Us.isSsr)return Hue(f,typeof o=="number"&&tr(o)?o:0);var H=[],Y=O==="top"||O==="bottom"?"width":"height",oe=$&&Y==="width"?Gg($,{fontSize:t,letterSpacing:i}):{width:0,height:0},te=function(ue,le){var se=on(L)?L(ue.value,le):ue.value;return Y==="width"?que(Gg(se,{fontSize:t,letterSpacing:i}),oe,F):Gg(se,{fontSize:t,letterSpacing:i})[Y]},ie=f.length>=2?ps(f[1].coordinate-f[0].coordinate):1,ae=Wue(y,ie,Y);return o==="equidistantPreserveStart"?Zue(ie,ae,te,f,w):(o==="preserveStart"||o==="preserveStartEnd"?H=Que(ie,ae,te,f,w,o==="preserveStartEnd"):H=Jue(ie,ae,te,f,w),H.filter(function(J){return J.isShow}))}var the=["viewBox"],rhe=["viewBox"],nhe=["ticks"];function Kd(e){"@babel/helpers - typeof";return Kd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kd(e)}function md(){return md=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},md.apply(this,arguments)}function wz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function To(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?wz(Object(i),!0).forEach(function(a){yP(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function QT(e,t){if(e==null)return{};var i=ihe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function ihe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function ohe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tz(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,cj(a.key),a)}}function ahe(e,t,i){return t&&Tz(e.prototype,t),i&&Tz(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function she(e,t,i){return t=i1(t),lhe(e,lj()?Reflect.construct(t,i||[],i1(e).constructor):t.apply(e,i))}function lhe(e,t){if(t&&(Kd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return che(e)}function che(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lj=function(){return!!e})()}function i1(e){return i1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},i1(e)}function uhe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lE(e,t)}function lE(e,t){return lE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},lE(e,t)}function yP(e,t,i){return t=cj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function cj(e){var t=hhe(e,"string");return Kd(t)=="symbol"?t:t+""}function hhe(e,t){if(Kd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Kd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hb=function(e){function t(i){var a;return ohe(this,t),a=she(this,t,[i]),a.state={fontSize:"",letterSpacing:""},a}return uhe(t,e),ahe(t,[{key:"shouldComponentUpdate",value:function(a,f){var y=a.viewBox,w=QT(a,the),O=this.props,o=O.viewBox,L=QT(O,rhe);return!wd(y,o)||!wd(w,L)||!wd(f,this.state)}},{key:"componentDidMount",value:function(){var a=this.layerReference;if(a){var f=a.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];f&&this.setState({fontSize:window.getComputedStyle(f).fontSize,letterSpacing:window.getComputedStyle(f).letterSpacing})}}},{key:"getTickLineCoord",value:function(a){var f=this.props,y=f.x,w=f.y,O=f.width,o=f.height,L=f.orientation,$=f.tickSize,F=f.mirror,H=f.tickMargin,Y,oe,te,ie,ae,J,ue=F?-1:1,le=a.tickSize||$,se=tr(a.tickCoord)?a.tickCoord:a.coordinate;switch(L){case"top":Y=oe=a.coordinate,ie=w+ +!F*o,te=ie-ue*le,J=te-ue*H,ae=se;break;case"left":te=ie=a.coordinate,oe=y+ +!F*O,Y=oe-ue*le,ae=Y-ue*H,J=se;break;case"right":te=ie=a.coordinate,oe=y+ +F*O,Y=oe+ue*le,ae=Y+ue*H,J=se;break;default:Y=oe=a.coordinate,ie=w+ +F*o,te=ie+ue*le,J=te+ue*H,ae=se;break}return{line:{x1:Y,y1:te,x2:oe,y2:ie},tick:{x:ae,y:J}}}},{key:"getTickTextAnchor",value:function(){var a=this.props,f=a.orientation,y=a.mirror,w;switch(f){case"left":w=y?"start":"end";break;case"right":w=y?"end":"start";break;default:w="middle";break}return w}},{key:"getTickVerticalAnchor",value:function(){var a=this.props,f=a.orientation,y=a.mirror,w="end";switch(f){case"left":case"right":w="middle";break;case"top":w=y?"start":"end";break;default:w=y?"end":"start";break}return w}},{key:"renderAxisLine",value:function(){var a=this.props,f=a.x,y=a.y,w=a.width,O=a.height,o=a.orientation,L=a.mirror,$=a.axisLine,F=To(To(To({},Yr(this.props,!1)),Yr($,!1)),{},{fill:"none"});if(o==="top"||o==="bottom"){var H=+(o==="top"&&!L||o==="bottom"&&L);F=To(To({},F),{},{x1:f,y1:y+H*O,x2:f+w,y2:y+H*O})}else{var Y=+(o==="left"&&!L||o==="right"&&L);F=To(To({},F),{},{x1:f+Y*w,y1:y,x2:f+Y*w,y2:y+O})}return tt.createElement("line",md({},F,{className:pn("recharts-cartesian-axis-line",La($,"className"))}))}},{key:"renderTicks",value:function(a,f,y){var w=this,O=this.props,o=O.tickLine,L=O.stroke,$=O.tick,F=O.tickFormatter,H=O.unit,Y=ehe(To(To({},this.props),{},{ticks:a}),f,y),oe=this.getTickTextAnchor(),te=this.getTickVerticalAnchor(),ie=Yr(this.props,!1),ae=Yr($,!1),J=To(To({},ie),{},{fill:"none"},Yr(o,!1)),ue=Y.map(function(le,se){var be=w.getTickLineCoord(le),Ie=be.line,Ae=be.tick,ht=To(To(To(To({textAnchor:oe,verticalAnchor:te},ie),{},{stroke:"none",fill:L},ae),Ae),{},{index:se,payload:le,visibleTicksCount:Y.length,tickFormatter:F});return tt.createElement(Vn,md({className:"recharts-cartesian-axis-tick",key:"tick-".concat(le.value,"-").concat(le.coordinate,"-").concat(le.tickCoord)},hx(w.props,le,se)),o&&tt.createElement("line",md({},J,Ie,{className:pn("recharts-cartesian-axis-tick-line",La(o,"className"))})),$&&t.renderTickItem($,ht,"".concat(on(F)?F(le.value,se):le.value).concat(H||"")))});return tt.createElement("g",{className:"recharts-cartesian-axis-ticks"},ue)}},{key:"render",value:function(){var a=this,f=this.props,y=f.axisLine,w=f.width,O=f.height,o=f.ticksGenerator,L=f.className,$=f.hide;if($)return null;var F=this.props,H=F.ticks,Y=QT(F,nhe),oe=H;return on(o)&&(oe=H&&H.length>0?o(this.props):o(Y)),w<=0||O<=0||!oe||!oe.length?null:tt.createElement(Vn,{className:pn("recharts-cartesian-axis",L),ref:function(ie){a.layerReference=ie}},y&&this.renderAxisLine(),this.renderTicks(oe,this.state.fontSize,this.state.letterSpacing),uo.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(a,f,y){var w;return tt.isValidElement(a)?w=tt.cloneElement(a,f):on(a)?w=a(f):w=tt.createElement(Ax,md({},f,{className:"recharts-cartesian-axis-tick-value"}),y),w}}])}(Wt.Component);yP(hb,"displayName","CartesianAxis");yP(hb,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var fhe=["type","layout","connectNulls","ref"],dhe=["key"];function Jd(e){"@babel/helpers - typeof";return Jd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jd(e)}function Sz(e,t){if(e==null)return{};var i=phe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function phe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function Zg(){return Zg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Zg.apply(this,arguments)}function Az(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function na(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Az(Object(i),!0).forEach(function(a){hs(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Az(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function ed(e){return _he(e)||yhe(e)||ghe(e)||mhe()}function mhe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ghe(e,t){if(e){if(typeof e=="string")return cE(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return cE(e,t)}}function yhe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _he(e){if(Array.isArray(e))return cE(e)}function cE(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function vhe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ez(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,hj(a.key),a)}}function xhe(e,t,i){return t&&Ez(e.prototype,t),i&&Ez(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function bhe(e,t,i){return t=o1(t),whe(e,uj()?Reflect.construct(t,i||[],o1(e).constructor):t.apply(e,i))}function whe(e,t){if(t&&(Jd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return The(e)}function The(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uj=function(){return!!e})()}function o1(e){return o1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},o1(e)}function She(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uE(e,t)}function uE(e,t){return uE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},uE(e,t)}function hs(e,t,i){return t=hj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function hj(e){var t=Ahe(e,"string");return Jd(t)=="symbol"?t:t+""}function Ahe(e,t){if(Jd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Jd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wp=function(e){function t(){var i;vhe(this,t);for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];return i=bhe(this,t,[].concat(f)),hs(i,"state",{isAnimationFinished:!0,totalLength:0}),hs(i,"generateSimpleStrokeDasharray",function(w,O){return"".concat(O,"px ").concat(w-O,"px")}),hs(i,"getStrokeDasharray",function(w,O,o){var L=o.reduce(function(ae,J){return ae+J});if(!L)return i.generateSimpleStrokeDasharray(O,w);for(var $=Math.floor(w/L),F=w%L,H=O-w,Y=[],oe=0,te=0;oe<o.length;te+=o[oe],++oe)if(te+o[oe]>F){Y=[].concat(ed(o.slice(0,oe)),[F-te]);break}var ie=Y.length%2===0?[0,H]:[H];return[].concat(ed(t.repeat(o,$)),ed(Y),ie).map(function(ae){return"".concat(ae,"px")}).join(", ")}),hs(i,"id",dp("recharts-line-")),hs(i,"pathRef",function(w){i.mainCurve=w}),hs(i,"handleAnimationEnd",function(){i.setState({isAnimationFinished:!0}),i.props.onAnimationEnd&&i.props.onAnimationEnd()}),hs(i,"handleAnimationStart",function(){i.setState({isAnimationFinished:!1}),i.props.onAnimationStart&&i.props.onAnimationStart()}),i}return She(t,e),xhe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();this.setState({totalLength:a})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var a=this.getTotalLength();a!==this.state.totalLength&&this.setState({totalLength:a})}}},{key:"getTotalLength",value:function(){var a=this.mainCurve;try{return a&&a.getTotalLength&&a.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(a,f){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var y=this.props,w=y.points,O=y.xAxis,o=y.yAxis,L=y.layout,$=y.children,F=Ra($,o_);if(!F)return null;var H=function(te,ie){return{x:te.x,y:te.y,value:te.value,errorVal:Mo(te.payload,ie)}},Y={clipPath:a?"url(#clipPath-".concat(f,")"):null};return tt.createElement(Vn,Y,F.map(function(oe){return tt.cloneElement(oe,{key:"bar-".concat(oe.props.dataKey),data:w,xAxis:O,yAxis:o,layout:L,dataPointFormatter:H})}))}},{key:"renderDots",value:function(a,f,y){var w=this.props.isAnimationActive;if(w&&!this.state.isAnimationFinished)return null;var O=this.props,o=O.dot,L=O.points,$=O.dataKey,F=Yr(this.props,!1),H=Yr(o,!0),Y=L.map(function(te,ie){var ae=na(na(na({key:"dot-".concat(ie),r:3},F),H),{},{value:te.value,dataKey:$,cx:te.x,cy:te.y,index:ie,payload:te.payload});return t.renderDotItem(o,ae)}),oe={clipPath:a?"url(#clipPath-".concat(f?"":"dots-").concat(y,")"):null};return tt.createElement(Vn,Zg({className:"recharts-line-dots",key:"dots"},oe),Y)}},{key:"renderCurveStatically",value:function(a,f,y,w){var O=this.props,o=O.type,L=O.layout,$=O.connectNulls;O.ref;var F=Sz(O,fhe),H=na(na(na({},Yr(F,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:f?"url(#clipPath-".concat(y,")"):null,points:a},w),{},{type:o,layout:L,connectNulls:$});return tt.createElement(Ed,Zg({},H,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(a,f){var y=this,w=this.props,O=w.points,o=w.strokeDasharray,L=w.isAnimationActive,$=w.animationBegin,F=w.animationDuration,H=w.animationEasing,Y=w.animationId,oe=w.animateNewValues,te=w.width,ie=w.height,ae=this.state,J=ae.prevPoints,ue=ae.totalLength;return tt.createElement(Hs,{begin:$,duration:F,isActive:L,easing:H,from:{t:0},to:{t:1},key:"line-".concat(Y),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(le){var se=le.t;if(J){var be=J.length/O.length,Ie=O.map(function(He,At){var Tt=Math.floor(At*be);if(J[Tt]){var kt=J[Tt],ct=Xi(kt.x,He.x),Ot=Xi(kt.y,He.y);return na(na({},He),{},{x:ct(se),y:Ot(se)})}if(oe){var mt=Xi(te*2,He.x),Lt=Xi(ie/2,He.y);return na(na({},He),{},{x:mt(se),y:Lt(se)})}return na(na({},He),{},{x:He.x,y:He.y})});return y.renderCurveStatically(Ie,a,f)}var Ae=Xi(0,ue),ht=Ae(se),st;if(o){var We="".concat(o).split(/[,\s]+/gim).map(function(He){return parseFloat(He)});st=y.getStrokeDasharray(ht,ue,We)}else st=y.generateSimpleStrokeDasharray(ue,ht);return y.renderCurveStatically(O,a,f,{strokeDasharray:st})})}},{key:"renderCurve",value:function(a,f){var y=this.props,w=y.points,O=y.isAnimationActive,o=this.state,L=o.prevPoints,$=o.totalLength;return O&&w&&w.length&&(!L&&$>0||!Ud(L,w))?this.renderCurveWithAnimation(a,f):this.renderCurveStatically(w,a,f)}},{key:"render",value:function(){var a,f=this.props,y=f.hide,w=f.dot,O=f.points,o=f.className,L=f.xAxis,$=f.yAxis,F=f.top,H=f.left,Y=f.width,oe=f.height,te=f.isAnimationActive,ie=f.id;if(y||!O||!O.length)return null;var ae=this.state.isAnimationFinished,J=O.length===1,ue=pn("recharts-line",o),le=L&&L.allowDataOverflow,se=$&&$.allowDataOverflow,be=le||se,Ie=en(ie)?this.id:ie,Ae=(a=Yr(w,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},ht=Ae.r,st=ht===void 0?3:ht,We=Ae.strokeWidth,He=We===void 0?2:We,At=hF(w)?w:{},Tt=At.clipDot,kt=Tt===void 0?!0:Tt,ct=st*2+He;return tt.createElement(Vn,{className:ue},le||se?tt.createElement("defs",null,tt.createElement("clipPath",{id:"clipPath-".concat(Ie)},tt.createElement("rect",{x:le?H:H-Y/2,y:se?F:F-oe/2,width:le?Y:Y*2,height:se?oe:oe*2})),!kt&&tt.createElement("clipPath",{id:"clipPath-dots-".concat(Ie)},tt.createElement("rect",{x:H-ct/2,y:F-ct/2,width:Y+ct,height:oe+ct}))):null,!J&&this.renderCurve(be,Ie),this.renderErrorBar(be,Ie),(J||w)&&this.renderDots(be,kt,Ie),(!te||ae)&&Al.renderCallByParent(this.props,O))}}],[{key:"getDerivedStateFromProps",value:function(a,f){return a.animationId!==f.prevAnimationId?{prevAnimationId:a.animationId,curPoints:a.points,prevPoints:f.curPoints}:a.points!==f.curPoints?{curPoints:a.points}:null}},{key:"repeat",value:function(a,f){for(var y=a.length%2!==0?[].concat(ed(a),[0]):a,w=[],O=0;O<f;++O)w=[].concat(ed(w),ed(y));return w}},{key:"renderDotItem",value:function(a,f){var y;if(tt.isValidElement(a))y=tt.cloneElement(a,f);else if(on(a))y=a(f);else{var w=f.key,O=Sz(f,dhe),o=pn("recharts-line-dot",typeof a!="boolean"?a.className:"");y=tt.createElement(nb,Zg({key:w},O,{className:o}))}return y}}])}(Wt.PureComponent);hs(wp,"displayName","Line");hs(wp,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Us.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});hs(wp,"getComposedData",function(e){var t=e.props,i=e.xAxis,a=e.yAxis,f=e.xAxisTicks,y=e.yAxisTicks,w=e.dataKey,O=e.bandSize,o=e.displayedData,L=e.offset,$=t.layout,F=o.map(function(H,Y){var oe=Mo(H,w);return $==="horizontal"?{x:Nx({axis:i,ticks:f,bandSize:O,entry:H,index:Y}),y:en(oe)?null:a.scale(oe),value:oe,payload:H}:{x:en(oe)?null:i.scale(oe),y:Nx({axis:a,ticks:y,bandSize:O,entry:H,index:Y}),value:oe,payload:H}});return na({points:F,layout:$},L)});var Ehe=["layout","type","stroke","connectNulls","isRange","ref"],Mhe=["key"],fj;function Qd(e){"@babel/helpers - typeof";return Qd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qd(e)}function dj(e,t){if(e==null)return{};var i=Phe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Phe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function gh(){return gh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},gh.apply(this,arguments)}function Mz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function zc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Mz(Object(i),!0).forEach(function(a){Ns(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Mz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Ihe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pz(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,mj(a.key),a)}}function Che(e,t,i){return t&&Pz(e.prototype,t),i&&Pz(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ohe(e,t,i){return t=a1(t),khe(e,pj()?Reflect.construct(t,i||[],a1(e).constructor):t.apply(e,i))}function khe(e,t){if(t&&(Qd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dhe(e)}function Dhe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pj=function(){return!!e})()}function a1(e){return a1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},a1(e)}function Lhe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hE(e,t)}function hE(e,t){return hE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},hE(e,t)}function Ns(e,t,i){return t=mj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function mj(e){var t=Rhe(e,"string");return Qd(t)=="symbol"?t:t+""}function Rhe(e,t){if(Qd(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Qd(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qs=function(e){function t(){var i;Ihe(this,t);for(var a=arguments.length,f=new Array(a),y=0;y<a;y++)f[y]=arguments[y];return i=Ohe(this,t,[].concat(f)),Ns(i,"state",{isAnimationFinished:!0}),Ns(i,"id",dp("recharts-area-")),Ns(i,"handleAnimationEnd",function(){var w=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),on(w)&&w()}),Ns(i,"handleAnimationStart",function(){var w=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),on(w)&&w()}),i}return Lhe(t,e),Che(t,[{key:"renderDots",value:function(a,f,y){var w=this.props.isAnimationActive,O=this.state.isAnimationFinished;if(w&&!O)return null;var o=this.props,L=o.dot,$=o.points,F=o.dataKey,H=Yr(this.props,!1),Y=Yr(L,!0),oe=$.map(function(ie,ae){var J=zc(zc(zc({key:"dot-".concat(ae),r:3},H),Y),{},{index:ae,cx:ie.x,cy:ie.y,dataKey:F,value:ie.value,payload:ie.payload,points:$});return t.renderDotItem(L,J)}),te={clipPath:a?"url(#clipPath-".concat(f?"":"dots-").concat(y,")"):null};return tt.createElement(Vn,gh({className:"recharts-area-dots"},te),oe)}},{key:"renderHorizontalRect",value:function(a){var f=this.props,y=f.baseLine,w=f.points,O=f.strokeWidth,o=w[0].x,L=w[w.length-1].x,$=a*Math.abs(o-L),F=Gc(w.map(function(H){return H.y||0}));return tr(y)&&typeof y=="number"?F=Math.max(y,F):y&&Array.isArray(y)&&y.length&&(F=Math.max(Gc(y.map(function(H){return H.y||0})),F)),tr(F)?tt.createElement("rect",{x:o<L?o:o-$,y:0,width:$,height:Math.floor(F+(O?parseInt("".concat(O),10):1))}):null}},{key:"renderVerticalRect",value:function(a){var f=this.props,y=f.baseLine,w=f.points,O=f.strokeWidth,o=w[0].y,L=w[w.length-1].y,$=a*Math.abs(o-L),F=Gc(w.map(function(H){return H.x||0}));return tr(y)&&typeof y=="number"?F=Math.max(y,F):y&&Array.isArray(y)&&y.length&&(F=Math.max(Gc(y.map(function(H){return H.x||0})),F)),tr(F)?tt.createElement("rect",{x:0,y:o<L?o:o-$,width:F+(O?parseInt("".concat(O),10):1),height:Math.floor($)}):null}},{key:"renderClipRect",value:function(a){var f=this.props.layout;return f==="vertical"?this.renderVerticalRect(a):this.renderHorizontalRect(a)}},{key:"renderAreaStatically",value:function(a,f,y,w){var O=this.props,o=O.layout,L=O.type,$=O.stroke,F=O.connectNulls,H=O.isRange;O.ref;var Y=dj(O,Ehe);return tt.createElement(Vn,{clipPath:y?"url(#clipPath-".concat(w,")"):null},tt.createElement(Ed,gh({},Yr(Y,!0),{points:a,connectNulls:F,type:L,baseLine:f,layout:o,stroke:"none",className:"recharts-area-area"})),$!=="none"&&tt.createElement(Ed,gh({},Yr(this.props,!1),{className:"recharts-area-curve",layout:o,type:L,connectNulls:F,fill:"none",points:a})),$!=="none"&&H&&tt.createElement(Ed,gh({},Yr(this.props,!1),{className:"recharts-area-curve",layout:o,type:L,connectNulls:F,fill:"none",points:f})))}},{key:"renderAreaWithAnimation",value:function(a,f){var y=this,w=this.props,O=w.points,o=w.baseLine,L=w.isAnimationActive,$=w.animationBegin,F=w.animationDuration,H=w.animationEasing,Y=w.animationId,oe=this.state,te=oe.prevPoints,ie=oe.prevBaseLine;return tt.createElement(Hs,{begin:$,duration:F,isActive:L,easing:H,from:{t:0},to:{t:1},key:"area-".concat(Y),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(ae){var J=ae.t;if(te){var ue=te.length/O.length,le=O.map(function(Ae,ht){var st=Math.floor(ht*ue);if(te[st]){var We=te[st],He=Xi(We.x,Ae.x),At=Xi(We.y,Ae.y);return zc(zc({},Ae),{},{x:He(J),y:At(J)})}return Ae}),se;if(tr(o)&&typeof o=="number"){var be=Xi(ie,o);se=be(J)}else if(en(o)||fp(o)){var Ie=Xi(ie,0);se=Ie(J)}else se=o.map(function(Ae,ht){var st=Math.floor(ht*ue);if(ie[st]){var We=ie[st],He=Xi(We.x,Ae.x),At=Xi(We.y,Ae.y);return zc(zc({},Ae),{},{x:He(J),y:At(J)})}return Ae});return y.renderAreaStatically(le,se,a,f)}return tt.createElement(Vn,null,tt.createElement("defs",null,tt.createElement("clipPath",{id:"animationClipPath-".concat(f)},y.renderClipRect(J))),tt.createElement(Vn,{clipPath:"url(#animationClipPath-".concat(f,")")},y.renderAreaStatically(O,o,a,f)))})}},{key:"renderArea",value:function(a,f){var y=this.props,w=y.points,O=y.baseLine,o=y.isAnimationActive,L=this.state,$=L.prevPoints,F=L.prevBaseLine,H=L.totalLength;return o&&w&&w.length&&(!$&&H>0||!Ud($,w)||!Ud(F,O))?this.renderAreaWithAnimation(a,f):this.renderAreaStatically(w,O,a,f)}},{key:"render",value:function(){var a,f=this.props,y=f.hide,w=f.dot,O=f.points,o=f.className,L=f.top,$=f.left,F=f.xAxis,H=f.yAxis,Y=f.width,oe=f.height,te=f.isAnimationActive,ie=f.id;if(y||!O||!O.length)return null;var ae=this.state.isAnimationFinished,J=O.length===1,ue=pn("recharts-area",o),le=F&&F.allowDataOverflow,se=H&&H.allowDataOverflow,be=le||se,Ie=en(ie)?this.id:ie,Ae=(a=Yr(w,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},ht=Ae.r,st=ht===void 0?3:ht,We=Ae.strokeWidth,He=We===void 0?2:We,At=hF(w)?w:{},Tt=At.clipDot,kt=Tt===void 0?!0:Tt,ct=st*2+He;return tt.createElement(Vn,{className:ue},le||se?tt.createElement("defs",null,tt.createElement("clipPath",{id:"clipPath-".concat(Ie)},tt.createElement("rect",{x:le?$:$-Y/2,y:se?L:L-oe/2,width:le?Y:Y*2,height:se?oe:oe*2})),!kt&&tt.createElement("clipPath",{id:"clipPath-dots-".concat(Ie)},tt.createElement("rect",{x:$-ct/2,y:L-ct/2,width:Y+ct,height:oe+ct}))):null,J?null:this.renderArea(be,Ie),(w||J)&&this.renderDots(be,kt,Ie),(!te||ae)&&Al.renderCallByParent(this.props,O))}}],[{key:"getDerivedStateFromProps",value:function(a,f){return a.animationId!==f.prevAnimationId?{prevAnimationId:a.animationId,curPoints:a.points,curBaseLine:a.baseLine,prevPoints:f.curPoints,prevBaseLine:f.curBaseLine}:a.points!==f.curPoints||a.baseLine!==f.curBaseLine?{curPoints:a.points,curBaseLine:a.baseLine}:null}}])}(Wt.PureComponent);fj=qs;Ns(qs,"displayName","Area");Ns(qs,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Us.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Ns(qs,"getBaseValue",function(e,t,i,a){var f=e.layout,y=e.baseValue,w=t.props.baseValue,O=w??y;if(tr(O)&&typeof O=="number")return O;var o=f==="horizontal"?a:i,L=o.scale.domain();if(o.type==="number"){var $=Math.max(L[0],L[1]),F=Math.min(L[0],L[1]);return O==="dataMin"?F:O==="dataMax"||$<0?$:Math.max(Math.min(L[0],L[1]),0)}return O==="dataMin"?L[0]:O==="dataMax"?L[1]:L[0]});Ns(qs,"getComposedData",function(e){var t=e.props,i=e.item,a=e.xAxis,f=e.yAxis,y=e.xAxisTicks,w=e.yAxisTicks,O=e.bandSize,o=e.dataKey,L=e.stackedData,$=e.dataStartIndex,F=e.displayedData,H=e.offset,Y=t.layout,oe=L&&L.length,te=fj.getBaseValue(t,i,a,f),ie=Y==="horizontal",ae=!1,J=F.map(function(le,se){var be;oe?be=L[$+se]:(be=Mo(le,o),Array.isArray(be)?ae=!0:be=[te,be]);var Ie=be[1]==null||oe&&Mo(le,o)==null;return ie?{x:Nx({axis:a,ticks:y,bandSize:O,entry:le,index:se}),y:Ie?null:f.scale(be[1]),value:be,payload:le}:{x:Ie?null:a.scale(be[1]),y:Nx({axis:f,ticks:w,bandSize:O,entry:le,index:se}),value:be,payload:le}}),ue;return oe||ae?ue=J.map(function(le){var se=Array.isArray(le.value)?le.value[0]:null;return ie?{x:le.x,y:se!=null&&le.y!=null?f.scale(se):null}:{x:se!=null?a.scale(se):null,y:le.y}}):ue=ie?f.scale(te):a.scale(te),zc({points:J,baseLine:ue,layout:Y,isRange:ae},H)});Ns(qs,"renderDotItem",function(e,t){var i;if(tt.isValidElement(e))i=tt.cloneElement(e,t);else if(on(e))i=e(t);else{var a=pn("recharts-area-dot",typeof e!="boolean"?e.className:""),f=t.key,y=dj(t,Mhe);i=tt.createElement(nb,gh({},y,{key:f,className:a}))}return i});function ep(e){"@babel/helpers - typeof";return ep=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ep(e)}function zhe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bhe(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_j(a.key),a)}}function Fhe(e,t,i){return t&&Bhe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Nhe(e,t,i){return t=s1(t),jhe(e,gj()?Reflect.construct(t,i||[],s1(e).constructor):t.apply(e,i))}function jhe(e,t){if(t&&(ep(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $he(e)}function $he(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gj=function(){return!!e})()}function s1(e){return s1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},s1(e)}function Uhe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fE(e,t)}function fE(e,t){return fE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},fE(e,t)}function yj(e,t,i){return t=_j(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _j(e){var t=Vhe(e,"string");return ep(t)=="symbol"?t:t+""}function Vhe(e,t){if(ep(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(ep(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dE(){return dE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},dE.apply(this,arguments)}function Ghe(e){var t=e.xAxisId,i=Q5(),a=ej(),f=K5(t);return f==null?null:tt.createElement(hb,dE({},f,{className:pn("recharts-".concat(f.axisType," ").concat(f.axisType),f.className),viewBox:{x:0,y:0,width:i,height:a},ticksGenerator:function(w){return mh(w,!0)}}))}var Tp=function(e){function t(){return zhe(this,t),Nhe(this,t,arguments)}return Uhe(t,e),Fhe(t,[{key:"render",value:function(){return tt.createElement(Ghe,this.props)}}])}(tt.Component);yj(Tp,"displayName","XAxis");yj(Tp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function tp(e){"@babel/helpers - typeof";return tp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tp(e)}function qhe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Whe(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,bj(a.key),a)}}function Hhe(e,t,i){return t&&Whe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zhe(e,t,i){return t=l1(t),Xhe(e,vj()?Reflect.construct(t,i||[],l1(e).constructor):t.apply(e,i))}function Xhe(e,t){if(t&&(tp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yhe(e)}function Yhe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vj=function(){return!!e})()}function l1(e){return l1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},l1(e)}function Khe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pE(e,t)}function pE(e,t){return pE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},pE(e,t)}function xj(e,t,i){return t=bj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function bj(e){var t=Jhe(e,"string");return tp(t)=="symbol"?t:t+""}function Jhe(e,t){if(tp(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(tp(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mE(){return mE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},mE.apply(this,arguments)}var Qhe=function(t){var i=t.yAxisId,a=Q5(),f=ej(),y=J5(i);return y==null?null:tt.createElement(hb,mE({},y,{className:pn("recharts-".concat(y.axisType," ").concat(y.axisType),y.className),viewBox:{x:0,y:0,width:a,height:f},ticksGenerator:function(O){return mh(O,!0)}}))},Sp=function(e){function t(){return qhe(this,t),Zhe(this,t,arguments)}return Khe(t,e),Hhe(t,[{key:"render",value:function(){return tt.createElement(Qhe,this.props)}}])}(tt.Component);xj(Sp,"displayName","YAxis");xj(Sp,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function Iz(e){return nfe(e)||rfe(e)||tfe(e)||efe()}function efe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tfe(e,t){if(e){if(typeof e=="string")return gE(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return gE(e,t)}}function rfe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nfe(e){if(Array.isArray(e))return gE(e)}function gE(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var yE=function(t,i,a,f,y){var w=Ra(t,gP),O=Ra(t,lb),o=[].concat(Iz(w),Iz(O)),L=Ra(t,ub),$="".concat(f,"Id"),F=f[0],H=i;if(o.length&&(H=o.reduce(function(te,ie){if(ie.props[$]===a&&Gs(ie.props,"extendDomain")&&tr(ie.props[F])){var ae=ie.props[F];return[Math.min(te[0],ae),Math.max(te[1],ae)]}return te},H)),L.length){var Y="".concat(F,"1"),oe="".concat(F,"2");H=L.reduce(function(te,ie){if(ie.props[$]===a&&Gs(ie.props,"extendDomain")&&tr(ie.props[Y])&&tr(ie.props[oe])){var ae=ie.props[Y],J=ie.props[oe];return[Math.min(te[0],ae,J),Math.max(te[1],ae,J)]}return te},H)}return y&&y.length&&(H=y.reduce(function(te,ie){return tr(ie)?[Math.min(te[0],ie),Math.max(te[1],ie)]:te},H)),H},wj={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(i=!1));function f(o,L,$){this.fn=o,this.context=L,this.once=$||!1}function y(o,L,$,F,H){if(typeof $!="function")throw new TypeError("The listener must be a function");var Y=new f($,F||o,H),oe=i?i+L:L;return o._events[oe]?o._events[oe].fn?o._events[oe]=[o._events[oe],Y]:o._events[oe].push(Y):(o._events[oe]=Y,o._eventsCount++),o}function w(o,L){--o._eventsCount===0?o._events=new a:delete o._events[L]}function O(){this._events=new a,this._eventsCount=0}O.prototype.eventNames=function(){var L=[],$,F;if(this._eventsCount===0)return L;for(F in $=this._events)t.call($,F)&&L.push(i?F.slice(1):F);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols($)):L},O.prototype.listeners=function(L){var $=i?i+L:L,F=this._events[$];if(!F)return[];if(F.fn)return[F.fn];for(var H=0,Y=F.length,oe=new Array(Y);H<Y;H++)oe[H]=F[H].fn;return oe},O.prototype.listenerCount=function(L){var $=i?i+L:L,F=this._events[$];return F?F.fn?1:F.length:0},O.prototype.emit=function(L,$,F,H,Y,oe){var te=i?i+L:L;if(!this._events[te])return!1;var ie=this._events[te],ae=arguments.length,J,ue;if(ie.fn){switch(ie.once&&this.removeListener(L,ie.fn,void 0,!0),ae){case 1:return ie.fn.call(ie.context),!0;case 2:return ie.fn.call(ie.context,$),!0;case 3:return ie.fn.call(ie.context,$,F),!0;case 4:return ie.fn.call(ie.context,$,F,H),!0;case 5:return ie.fn.call(ie.context,$,F,H,Y),!0;case 6:return ie.fn.call(ie.context,$,F,H,Y,oe),!0}for(ue=1,J=new Array(ae-1);ue<ae;ue++)J[ue-1]=arguments[ue];ie.fn.apply(ie.context,J)}else{var le=ie.length,se;for(ue=0;ue<le;ue++)switch(ie[ue].once&&this.removeListener(L,ie[ue].fn,void 0,!0),ae){case 1:ie[ue].fn.call(ie[ue].context);break;case 2:ie[ue].fn.call(ie[ue].context,$);break;case 3:ie[ue].fn.call(ie[ue].context,$,F);break;case 4:ie[ue].fn.call(ie[ue].context,$,F,H);break;default:if(!J)for(se=1,J=new Array(ae-1);se<ae;se++)J[se-1]=arguments[se];ie[ue].fn.apply(ie[ue].context,J)}}return!0},O.prototype.on=function(L,$,F){return y(this,L,$,F,!1)},O.prototype.once=function(L,$,F){return y(this,L,$,F,!0)},O.prototype.removeListener=function(L,$,F,H){var Y=i?i+L:L;if(!this._events[Y])return this;if(!$)return w(this,Y),this;var oe=this._events[Y];if(oe.fn)oe.fn===$&&(!H||oe.once)&&(!F||oe.context===F)&&w(this,Y);else{for(var te=0,ie=[],ae=oe.length;te<ae;te++)(oe[te].fn!==$||H&&!oe[te].once||F&&oe[te].context!==F)&&ie.push(oe[te]);ie.length?this._events[Y]=ie.length===1?ie[0]:ie:w(this,Y)}return this},O.prototype.removeAllListeners=function(L){var $;return L?($=i?i+L:L,this._events[$]&&w(this,$)):(this._events=new a,this._eventsCount=0),this},O.prototype.off=O.prototype.removeListener,O.prototype.addListener=O.prototype.on,O.prefixed=i,O.EventEmitter=O,e.exports=O})(wj);var ife=wj.exports;const ofe=Fn(ife);var eS=new ofe,tS="recharts.syncMouseEvents";function Wy(e){"@babel/helpers - typeof";return Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wy(e)}function afe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sfe(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Tj(a.key),a)}}function lfe(e,t,i){return t&&sfe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rS(e,t,i){return t=Tj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Tj(e){var t=cfe(e,"string");return Wy(t)=="symbol"?t:t+""}function cfe(e,t){if(Wy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t);if(Wy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ufe=function(){function e(){afe(this,e),rS(this,"activeIndex",0),rS(this,"coordinateList",[]),rS(this,"layout","horizontal")}return lfe(e,[{key:"setDetails",value:function(i){var a,f=i.coordinateList,y=f===void 0?null:f,w=i.container,O=w===void 0?null:w,o=i.layout,L=o===void 0?null:o,$=i.offset,F=$===void 0?null:$,H=i.mouseHandlerCallback,Y=H===void 0?null:H;this.coordinateList=(a=y??this.coordinateList)!==null&&a!==void 0?a:[],this.container=O??this.container,this.layout=L??this.layout,this.offset=F??this.offset,this.mouseHandlerCallback=Y??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(i){if(this.coordinateList.length!==0)switch(i.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(i){this.activeIndex=i}},{key:"spoofMouse",value:function(){var i,a;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var f=this.container.getBoundingClientRect(),y=f.x,w=f.y,O=f.height,o=this.coordinateList[this.activeIndex].coordinate,L=((i=window)===null||i===void 0?void 0:i.scrollX)||0,$=((a=window)===null||a===void 0?void 0:a.scrollY)||0,F=y+o+L,H=w+this.offset.top+O/2+$;this.mouseHandlerCallback({pageX:F,pageY:H})}}}])}();function hfe(e,t,i){if(i==="number"&&t===!0&&Array.isArray(e)){var a=e==null?void 0:e[0],f=e==null?void 0:e[1];if(a&&f&&tr(a)&&tr(f))return!0}return!1}function ffe(e,t,i,a){var f=a/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-f:i.left+.5,y:e==="horizontal"?i.top+.5:t.y-f,width:e==="horizontal"?a:i.width-1,height:e==="horizontal"?i.height-1:a}}function Sj(e){var t=e.cx,i=e.cy,a=e.radius,f=e.startAngle,y=e.endAngle,w=Yi(t,i,a,f),O=Yi(t,i,a,y);return{points:[w,O],cx:t,cy:i,radius:a,startAngle:f,endAngle:y}}function dfe(e,t,i){var a,f,y,w;if(e==="horizontal")a=t.x,y=a,f=i.top,w=i.top+i.height;else if(e==="vertical")f=t.y,w=f,a=i.left,y=i.left+i.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var O=t.cx,o=t.cy,L=t.innerRadius,$=t.outerRadius,F=t.angle,H=Yi(O,o,L,F),Y=Yi(O,o,$,F);a=H.x,f=H.y,y=Y.x,w=Y.y}else return Sj(t);return[{x:a,y:f},{x:y,y:w}]}function Hy(e){"@babel/helpers - typeof";return Hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hy(e)}function Cz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function A0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Cz(Object(i),!0).forEach(function(a){pfe(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Cz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function pfe(e,t,i){return t=mfe(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function mfe(e){var t=gfe(e,"string");return Hy(t)=="symbol"?t:t+""}function gfe(e,t){if(Hy(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(Hy(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yfe(e){var t,i,a=e.element,f=e.tooltipEventType,y=e.isActive,w=e.activeCoordinate,O=e.activePayload,o=e.offset,L=e.activeTooltipIndex,$=e.tooltipAxisBandSize,F=e.layout,H=e.chartName,Y=(t=a.props.cursor)!==null&&t!==void 0?t:(i=a.type.defaultProps)===null||i===void 0?void 0:i.cursor;if(!a||!Y||!y||!w||H!=="ScatterChart"&&f!=="axis")return null;var oe,te=Ed;if(H==="ScatterChart")oe=w,te=Fse;else if(H==="BarChart")oe=ffe(F,w,o,$),te=dP;else if(F==="radial"){var ie=Sj(w),ae=ie.cx,J=ie.cy,ue=ie.radius,le=ie.startAngle,se=ie.endAngle;oe={cx:ae,cy:J,startAngle:le,endAngle:se,innerRadius:ue,outerRadius:ue},te=w5}else oe={points:dfe(F,w,o)},te=Ed;var be=A0(A0(A0(A0({stroke:"#ccc",pointerEvents:"none"},o),oe),Yr(Y,!1)),{},{payload:O,payloadIndex:L,className:pn("recharts-tooltip-cursor",Y.className)});return Wt.isValidElement(Y)?Wt.cloneElement(Y,be):Wt.createElement(te,be)}var _fe=["item"],vfe=["children","className","width","height","style","compact","title","desc"];function rp(e){"@babel/helpers - typeof";return rp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rp(e)}function Xg(){return Xg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Xg.apply(this,arguments)}function Oz(e,t){return wfe(e)||bfe(e,t)||Ej(e,t)||xfe()}function xfe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bfe(e,t){var i=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i!=null){var a,f,y,w,O=[],o=!0,L=!1;try{if(y=(i=i.call(e)).next,t!==0)for(;!(o=(a=y.call(i)).done)&&(O.push(a.value),O.length!==t);o=!0);}catch($){L=!0,f=$}finally{try{if(!o&&i.return!=null&&(w=i.return(),Object(w)!==w))return}finally{if(L)throw f}}return O}}function wfe(e){if(Array.isArray(e))return e}function kz(e,t){if(e==null)return{};var i=Tfe(e,t),a,f;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(f=0;f<y.length;f++)a=y[f],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function Tfe(e,t){if(e==null)return{};var i={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;i[a]=e[a]}return i}function Sfe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Afe(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Mj(a.key),a)}}function Efe(e,t,i){return t&&Afe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mfe(e,t,i){return t=c1(t),Pfe(e,Aj()?Reflect.construct(t,i||[],c1(e).constructor):t.apply(e,i))}function Pfe(e,t){if(t&&(rp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ife(e)}function Ife(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Aj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Aj=function(){return!!e})()}function c1(e){return c1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},c1(e)}function Cfe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_E(e,t)}function _E(e,t){return _E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,f){return a.__proto__=f,a},_E(e,t)}function np(e){return Dfe(e)||kfe(e)||Ej(e)||Ofe()}function Ofe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ej(e,t){if(e){if(typeof e=="string")return vE(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return vE(e,t)}}function kfe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Dfe(e){if(Array.isArray(e))return vE(e)}function vE(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Dz(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),i.push.apply(i,a)}return i}function It(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Dz(Object(i),!0).forEach(function(a){Lr(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dz(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Lr(e,t,i){return t=Mj(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Mj(e){var t=Lfe(e,"string");return rp(t)=="symbol"?t:t+""}function Lfe(e,t){if(rp(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t||"default");if(rp(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Rfe={xAxis:["bottom","top"],yAxis:["left","right"]},zfe={width:"100%",height:"100%"},Pj={x:0,y:0};function E0(e){return e}var Bfe=function(t,i){return i==="horizontal"?t.x:i==="vertical"?t.y:i==="centric"?t.angle:t.radius},Ffe=function(t,i,a,f){var y=i.find(function($){return $&&$.index===a});if(y){if(t==="horizontal")return{x:y.coordinate,y:f.y};if(t==="vertical")return{x:f.x,y:y.coordinate};if(t==="centric"){var w=y.coordinate,O=f.radius;return It(It(It({},f),Yi(f.cx,f.cy,O,w)),{},{angle:w,radius:O})}var o=y.coordinate,L=f.angle;return It(It(It({},f),Yi(f.cx,f.cy,o,L)),{},{angle:L,radius:o})}return Pj},fb=function(t,i){var a=i.graphicalItems,f=i.dataStartIndex,y=i.dataEndIndex,w=(a??[]).reduce(function(O,o){var L=o.props.data;return L&&L.length?[].concat(np(O),np(L)):O},[]);return w.length>0?w:t&&t.length&&tr(f)&&tr(y)?t.slice(f,y+1):[]};function Ij(e){return e==="number"?[0,"auto"]:void 0}var xE=function(t,i,a,f){var y=t.graphicalItems,w=t.tooltipAxis,O=fb(i,t);return a<0||!y||!y.length||a>=O.length?null:y.reduce(function(o,L){var $,F=($=L.props.data)!==null&&$!==void 0?$:i;F&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=a&&(F=F.slice(t.dataStartIndex,t.dataEndIndex+1));var H;if(w.dataKey&&!w.allowDuplicatedCategory){var Y=F===void 0?O:F;H=cx(Y,w.dataKey,f)}else H=F&&F[a]||O[a];return H?[].concat(np(o),[v5(L,H)]):o},[])},Lz=function(t,i,a,f){var y=f||{x:t.chartX,y:t.chartY},w=Bfe(y,a),O=t.orderedTooltipTicks,o=t.tooltipAxis,L=t.tooltipTicks,$=Cie(w,O,L,o);if($>=0&&L){var F=L[$]&&L[$].value,H=xE(t,i,$,F),Y=Ffe(a,O,$,y);return{activeTooltipIndex:$,activeLabel:F,activePayload:H,activeCoordinate:Y}}return null},Nfe=function(t,i){var a=i.axes,f=i.graphicalItems,y=i.axisType,w=i.axisIdKey,O=i.stackGroups,o=i.dataStartIndex,L=i.dataEndIndex,$=t.layout,F=t.children,H=t.stackOffset,Y=y5($,y);return a.reduce(function(oe,te){var ie,ae=te.type.defaultProps!==void 0?It(It({},te.type.defaultProps),te.props):te.props,J=ae.type,ue=ae.dataKey,le=ae.allowDataOverflow,se=ae.allowDuplicatedCategory,be=ae.scale,Ie=ae.ticks,Ae=ae.includeHidden,ht=ae[w];if(oe[ht])return oe;var st=fb(t.data,{graphicalItems:f.filter(function(Yt){var xr,Vt=w in Yt.props?Yt.props[w]:(xr=Yt.type.defaultProps)===null||xr===void 0?void 0:xr[w];return Vt===ht}),dataStartIndex:o,dataEndIndex:L}),We=st.length,He,At,Tt;hfe(ae.domain,le,J)&&(He=BA(ae.domain,null,le),Y&&(J==="number"||be!=="auto")&&(Tt=Wg(st,ue,"category")));var kt=Ij(J);if(!He||He.length===0){var ct,Ot=(ct=ae.domain)!==null&&ct!==void 0?ct:kt;if(ue){if(He=Wg(st,ue,J),J==="category"&&Y){var mt=_q(He);se&&mt?(At=He,He=Xx(0,We)):se||(He=fR(Ot,He,te).reduce(function(Yt,xr){return Yt.indexOf(xr)>=0?Yt:[].concat(np(Yt),[xr])},[]))}else if(J==="category")se?He=He.filter(function(Yt){return Yt!==""&&!en(Yt)}):He=fR(Ot,He,te).reduce(function(Yt,xr){return Yt.indexOf(xr)>=0||xr===""||en(xr)?Yt:[].concat(np(Yt),[xr])},[]);else if(J==="number"){var Lt=Rie(st,f.filter(function(Yt){var xr,Vt,Sn=w in Yt.props?Yt.props[w]:(xr=Yt.type.defaultProps)===null||xr===void 0?void 0:xr[w],vn="hide"in Yt.props?Yt.props.hide:(Vt=Yt.type.defaultProps)===null||Vt===void 0?void 0:Vt.hide;return Sn===ht&&(Ae||!vn)}),ue,y,$);Lt&&(He=Lt)}Y&&(J==="number"||be!=="auto")&&(Tt=Wg(st,ue,"category"))}else Y?He=Xx(0,We):O&&O[ht]&&O[ht].hasStack&&J==="number"?He=H==="expand"?[0,1]:_5(O[ht].stackGroups,o,L):He=g5(st,f.filter(function(Yt){var xr=w in Yt.props?Yt.props[w]:Yt.type.defaultProps[w],Vt="hide"in Yt.props?Yt.props.hide:Yt.type.defaultProps.hide;return xr===ht&&(Ae||!Vt)}),J,$,!0);if(J==="number")He=yE(F,He,ht,y,Ie),Ot&&(He=BA(Ot,He,le));else if(J==="category"&&Ot){var yt=Ot,Zt=He.every(function(Yt){return yt.indexOf(Yt)>=0});Zt&&(He=yt)}}return It(It({},oe),{},Lr({},ht,It(It({},ae),{},{axisType:y,domain:He,categoricalDomain:Tt,duplicateDomain:At,originalDomain:(ie=ae.domain)!==null&&ie!==void 0?ie:kt,isCategorical:Y,layout:$})))},{})},jfe=function(t,i){var a=i.graphicalItems,f=i.Axis,y=i.axisType,w=i.axisIdKey,O=i.stackGroups,o=i.dataStartIndex,L=i.dataEndIndex,$=t.layout,F=t.children,H=fb(t.data,{graphicalItems:a,dataStartIndex:o,dataEndIndex:L}),Y=H.length,oe=y5($,y),te=-1;return a.reduce(function(ie,ae){var J=ae.type.defaultProps!==void 0?It(It({},ae.type.defaultProps),ae.props):ae.props,ue=J[w],le=Ij("number");if(!ie[ue]){te++;var se;return oe?se=Xx(0,Y):O&&O[ue]&&O[ue].hasStack?(se=_5(O[ue].stackGroups,o,L),se=yE(F,se,ue,y)):(se=BA(le,g5(H,a.filter(function(be){var Ie,Ae,ht=w in be.props?be.props[w]:(Ie=be.type.defaultProps)===null||Ie===void 0?void 0:Ie[w],st="hide"in be.props?be.props.hide:(Ae=be.type.defaultProps)===null||Ae===void 0?void 0:Ae.hide;return ht===ue&&!st}),"number",$),f.defaultProps.allowDataOverflow),se=yE(F,se,ue,y)),It(It({},ie),{},Lr({},ue,It(It({axisType:y},f.defaultProps),{},{hide:!0,orientation:La(Rfe,"".concat(y,".").concat(te%2),null),domain:se,originalDomain:le,isCategorical:oe,layout:$})))}return ie},{})},$fe=function(t,i){var a=i.axisType,f=a===void 0?"xAxis":a,y=i.AxisComp,w=i.graphicalItems,O=i.stackGroups,o=i.dataStartIndex,L=i.dataEndIndex,$=t.children,F="".concat(f,"Id"),H=Ra($,y),Y={};return H&&H.length?Y=Nfe(t,{axes:H,graphicalItems:w,axisType:f,axisIdKey:F,stackGroups:O,dataStartIndex:o,dataEndIndex:L}):w&&w.length&&(Y=jfe(t,{Axis:y,graphicalItems:w,axisType:f,axisIdKey:F,stackGroups:O,dataStartIndex:o,dataEndIndex:L})),Y},Ufe=function(t){var i=td(t),a=mh(i,!1,!0);return{tooltipTicks:a,orderedTooltipTicks:NM(a,function(f){return f.coordinate}),tooltipAxis:i,tooltipAxisBandSize:jx(i,a)}},Rz=function(t){var i=t.children,a=t.defaultShowTooltip,f=aa(i,Wd),y=0,w=0;return t.data&&t.data.length!==0&&(w=t.data.length-1),f&&f.props&&(f.props.startIndex>=0&&(y=f.props.startIndex),f.props.endIndex>=0&&(w=f.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:y,dataEndIndex:w,activeTooltipIndex:-1,isTooltipActive:!!a}},Vfe=function(t){return!t||!t.length?!1:t.some(function(i){var a=Tl(i&&i.type);return a&&a.indexOf("Bar")>=0})},zz=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Gfe=function(t,i){var a=t.props,f=t.graphicalItems,y=t.xAxisMap,w=y===void 0?{}:y,O=t.yAxisMap,o=O===void 0?{}:O,L=a.width,$=a.height,F=a.children,H=a.margin||{},Y=aa(F,Wd),oe=aa(F,Td),te=Object.keys(o).reduce(function(se,be){var Ie=o[be],Ae=Ie.orientation;return!Ie.mirror&&!Ie.hide?It(It({},se),{},Lr({},Ae,se[Ae]+Ie.width)):se},{left:H.left||0,right:H.right||0}),ie=Object.keys(w).reduce(function(se,be){var Ie=w[be],Ae=Ie.orientation;return!Ie.mirror&&!Ie.hide?It(It({},se),{},Lr({},Ae,La(se,"".concat(Ae))+Ie.height)):se},{top:H.top||0,bottom:H.bottom||0}),ae=It(It({},ie),te),J=ae.bottom;Y&&(ae.bottom+=Y.props.height||Wd.defaultProps.height),oe&&i&&(ae=Die(ae,f,a,i));var ue=L-ae.left-ae.right,le=$-ae.top-ae.bottom;return It(It({brushBottom:J},ae),{},{width:Math.max(ue,0),height:Math.max(le,0)})},qfe=function(t,i){if(i==="xAxis")return t[i].width;if(i==="yAxis")return t[i].height},Cj=function(t){var i=t.chartName,a=t.GraphicalChild,f=t.defaultTooltipEventType,y=f===void 0?"axis":f,w=t.validateTooltipEventTypes,O=w===void 0?["axis"]:w,o=t.axisComponents,L=t.legendContent,$=t.formatAxisMap,F=t.defaultProps,H=function(ie,ae){var J=ae.graphicalItems,ue=ae.stackGroups,le=ae.offset,se=ae.updateId,be=ae.dataStartIndex,Ie=ae.dataEndIndex,Ae=ie.barSize,ht=ie.layout,st=ie.barGap,We=ie.barCategoryGap,He=ie.maxBarSize,At=zz(ht),Tt=At.numericAxisName,kt=At.cateAxisName,ct=Vfe(J),Ot=[];return J.forEach(function(mt,Lt){var yt=fb(ie.data,{graphicalItems:[mt],dataStartIndex:be,dataEndIndex:Ie}),Zt=mt.type.defaultProps!==void 0?It(It({},mt.type.defaultProps),mt.props):mt.props,Yt=Zt.dataKey,xr=Zt.maxBarSize,Vt=Zt["".concat(Tt,"Id")],Sn=Zt["".concat(kt,"Id")],vn={},sn=o.reduce(function(An,di){var Go=ae["".concat(di.axisType,"Map")],qo=Zt["".concat(di.axisType,"Id")];Go&&Go[qo]||di.axisType==="zAxis"||Ih();var $a=Go[qo];return It(It({},An),{},Lr(Lr({},di.axisType,$a),"".concat(di.axisType,"Ticks"),mh($a)))},vn),Ci=sn[kt],rr=sn["".concat(kt,"Ticks")],Pr=ue&&ue[Vt]&&ue[Vt].hasStack&&Hie(mt,ue[Vt].stackGroups),Me=Tl(mt.type).indexOf("Bar")>=0,Bt=jx(Ci,rr),yn=[],Hr=ct&&Oie({barSize:Ae,stackGroups:ue,totalSize:qfe(sn,kt)});if(Me){var _t,wn,hn=en(xr)?He:xr,fi=(_t=(wn=jx(Ci,rr,!0))!==null&&wn!==void 0?wn:hn)!==null&&_t!==void 0?_t:0;yn=kie({barGap:st,barCategoryGap:We,bandSize:fi!==Bt?fi:Bt,sizeList:Hr[Sn],maxBarSize:hn}),fi!==Bt&&(yn=yn.map(function(An){return It(It({},An),{},{position:It(It({},An.position),{},{offset:An.position.offset-fi/2})})}))}var Sr=mt&&mt.type&&mt.type.getComposedData;Sr&&Ot.push({props:It(It({},Sr(It(It({},sn),{},{displayedData:yt,props:ie,dataKey:Yt,item:mt,bandSize:Bt,barPosition:yn,offset:le,stackedData:Pr,layout:ht,dataStartIndex:be,dataEndIndex:Ie}))),{},Lr(Lr(Lr({key:mt.key||"item-".concat(Lt)},Tt,sn[Tt]),kt,sn[kt]),"animationId",se)),childIndex:Iq(mt,ie.children),item:mt})}),Ot},Y=function(ie,ae){var J=ie.props,ue=ie.dataStartIndex,le=ie.dataEndIndex,se=ie.updateId;if(!aD({props:J}))return null;var be=J.children,Ie=J.layout,Ae=J.stackOffset,ht=J.data,st=J.reverseStackOrder,We=zz(Ie),He=We.numericAxisName,At=We.cateAxisName,Tt=Ra(be,a),kt=Gie(ht,Tt,"".concat(He,"Id"),"".concat(At,"Id"),Ae,st),ct=o.reduce(function(Zt,Yt){var xr="".concat(Yt.axisType,"Map");return It(It({},Zt),{},Lr({},xr,$fe(J,It(It({},Yt),{},{graphicalItems:Tt,stackGroups:Yt.axisType===He&&kt,dataStartIndex:ue,dataEndIndex:le}))))},{}),Ot=Gfe(It(It({},ct),{},{props:J,graphicalItems:Tt}),ae==null?void 0:ae.legendBBox);Object.keys(ct).forEach(function(Zt){ct[Zt]=$(J,ct[Zt],Ot,Zt.replace("Map",""),i)});var mt=ct["".concat(At,"Map")],Lt=Ufe(mt),yt=H(J,It(It({},ct),{},{dataStartIndex:ue,dataEndIndex:le,updateId:se,graphicalItems:Tt,stackGroups:kt,offset:Ot}));return It(It({formattedGraphicalItems:yt,graphicalItems:Tt,offset:Ot,stackGroups:kt},Lt),ct)},oe=function(te){function ie(ae){var J,ue,le;return Sfe(this,ie),le=Mfe(this,ie,[ae]),Lr(le,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Lr(le,"accessibilityManager",new ufe),Lr(le,"handleLegendBBoxUpdate",function(se){if(se){var be=le.state,Ie=be.dataStartIndex,Ae=be.dataEndIndex,ht=be.updateId;le.setState(It({legendBBox:se},Y({props:le.props,dataStartIndex:Ie,dataEndIndex:Ae,updateId:ht},It(It({},le.state),{},{legendBBox:se}))))}}),Lr(le,"handleReceiveSyncEvent",function(se,be,Ie){if(le.props.syncId===se){if(Ie===le.eventEmitterSymbol&&typeof le.props.syncMethod!="function")return;le.applySyncEvent(be)}}),Lr(le,"handleBrushChange",function(se){var be=se.startIndex,Ie=se.endIndex;if(be!==le.state.dataStartIndex||Ie!==le.state.dataEndIndex){var Ae=le.state.updateId;le.setState(function(){return It({dataStartIndex:be,dataEndIndex:Ie},Y({props:le.props,dataStartIndex:be,dataEndIndex:Ie,updateId:Ae},le.state))}),le.triggerSyncEvent({dataStartIndex:be,dataEndIndex:Ie})}}),Lr(le,"handleMouseEnter",function(se){var be=le.getMouseInfo(se);if(be){var Ie=It(It({},be),{},{isTooltipActive:!0});le.setState(Ie),le.triggerSyncEvent(Ie);var Ae=le.props.onMouseEnter;on(Ae)&&Ae(Ie,se)}}),Lr(le,"triggeredAfterMouseMove",function(se){var be=le.getMouseInfo(se),Ie=be?It(It({},be),{},{isTooltipActive:!0}):{isTooltipActive:!1};le.setState(Ie),le.triggerSyncEvent(Ie);var Ae=le.props.onMouseMove;on(Ae)&&Ae(Ie,se)}),Lr(le,"handleItemMouseEnter",function(se){le.setState(function(){return{isTooltipActive:!0,activeItem:se,activePayload:se.tooltipPayload,activeCoordinate:se.tooltipPosition||{x:se.cx,y:se.cy}}})}),Lr(le,"handleItemMouseLeave",function(){le.setState(function(){return{isTooltipActive:!1}})}),Lr(le,"handleMouseMove",function(se){se.persist(),le.throttleTriggeredAfterMouseMove(se)}),Lr(le,"handleMouseLeave",function(se){le.throttleTriggeredAfterMouseMove.cancel();var be={isTooltipActive:!1};le.setState(be),le.triggerSyncEvent(be);var Ie=le.props.onMouseLeave;on(Ie)&&Ie(be,se)}),Lr(le,"handleOuterEvent",function(se){var be=Pq(se),Ie=La(le.props,"".concat(be));if(be&&on(Ie)){var Ae,ht;/.*touch.*/i.test(be)?ht=le.getMouseInfo(se.changedTouches[0]):ht=le.getMouseInfo(se),Ie((Ae=ht)!==null&&Ae!==void 0?Ae:{},se)}}),Lr(le,"handleClick",function(se){var be=le.getMouseInfo(se);if(be){var Ie=It(It({},be),{},{isTooltipActive:!0});le.setState(Ie),le.triggerSyncEvent(Ie);var Ae=le.props.onClick;on(Ae)&&Ae(Ie,se)}}),Lr(le,"handleMouseDown",function(se){var be=le.props.onMouseDown;if(on(be)){var Ie=le.getMouseInfo(se);be(Ie,se)}}),Lr(le,"handleMouseUp",function(se){var be=le.props.onMouseUp;if(on(be)){var Ie=le.getMouseInfo(se);be(Ie,se)}}),Lr(le,"handleTouchMove",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&le.throttleTriggeredAfterMouseMove(se.changedTouches[0])}),Lr(le,"handleTouchStart",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&le.handleMouseDown(se.changedTouches[0])}),Lr(le,"handleTouchEnd",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&le.handleMouseUp(se.changedTouches[0])}),Lr(le,"triggerSyncEvent",function(se){le.props.syncId!==void 0&&eS.emit(tS,le.props.syncId,se,le.eventEmitterSymbol)}),Lr(le,"applySyncEvent",function(se){var be=le.props,Ie=be.layout,Ae=be.syncMethod,ht=le.state.updateId,st=se.dataStartIndex,We=se.dataEndIndex;if(se.dataStartIndex!==void 0||se.dataEndIndex!==void 0)le.setState(It({dataStartIndex:st,dataEndIndex:We},Y({props:le.props,dataStartIndex:st,dataEndIndex:We,updateId:ht},le.state)));else if(se.activeTooltipIndex!==void 0){var He=se.chartX,At=se.chartY,Tt=se.activeTooltipIndex,kt=le.state,ct=kt.offset,Ot=kt.tooltipTicks;if(!ct)return;if(typeof Ae=="function")Tt=Ae(Ot,se);else if(Ae==="value"){Tt=-1;for(var mt=0;mt<Ot.length;mt++)if(Ot[mt].value===se.activeLabel){Tt=mt;break}}var Lt=It(It({},ct),{},{x:ct.left,y:ct.top}),yt=Math.min(He,Lt.x+Lt.width),Zt=Math.min(At,Lt.y+Lt.height),Yt=Ot[Tt]&&Ot[Tt].value,xr=xE(le.state,le.props.data,Tt),Vt=Ot[Tt]?{x:Ie==="horizontal"?Ot[Tt].coordinate:yt,y:Ie==="horizontal"?Zt:Ot[Tt].coordinate}:Pj;le.setState(It(It({},se),{},{activeLabel:Yt,activeCoordinate:Vt,activePayload:xr,activeTooltipIndex:Tt}))}else le.setState(se)}),Lr(le,"renderCursor",function(se){var be,Ie=le.state,Ae=Ie.isTooltipActive,ht=Ie.activeCoordinate,st=Ie.activePayload,We=Ie.offset,He=Ie.activeTooltipIndex,At=Ie.tooltipAxisBandSize,Tt=le.getTooltipEventType(),kt=(be=se.props.active)!==null&&be!==void 0?be:Ae,ct=le.props.layout,Ot=se.key||"_recharts-cursor";return tt.createElement(yfe,{key:Ot,activeCoordinate:ht,activePayload:st,activeTooltipIndex:He,chartName:i,element:se,isActive:kt,layout:ct,offset:We,tooltipAxisBandSize:At,tooltipEventType:Tt})}),Lr(le,"renderPolarAxis",function(se,be,Ie){var Ae=La(se,"type.axisType"),ht=La(le.state,"".concat(Ae,"Map")),st=se.type.defaultProps,We=st!==void 0?It(It({},st),se.props):se.props,He=ht&&ht[We["".concat(Ae,"Id")]];return Wt.cloneElement(se,It(It({},He),{},{className:pn(Ae,He.className),key:se.key||"".concat(be,"-").concat(Ie),ticks:mh(He,!0)}))}),Lr(le,"renderPolarGrid",function(se){var be=se.props,Ie=be.radialLines,Ae=be.polarAngles,ht=be.polarRadius,st=le.state,We=st.radiusAxisMap,He=st.angleAxisMap,At=td(We),Tt=td(He),kt=Tt.cx,ct=Tt.cy,Ot=Tt.innerRadius,mt=Tt.outerRadius;return Wt.cloneElement(se,{polarAngles:Array.isArray(Ae)?Ae:mh(Tt,!0).map(function(Lt){return Lt.coordinate}),polarRadius:Array.isArray(ht)?ht:mh(At,!0).map(function(Lt){return Lt.coordinate}),cx:kt,cy:ct,innerRadius:Ot,outerRadius:mt,key:se.key||"polar-grid",radialLines:Ie})}),Lr(le,"renderLegend",function(){var se=le.state.formattedGraphicalItems,be=le.props,Ie=be.children,Ae=be.width,ht=be.height,st=le.props.margin||{},We=Ae-(st.left||0)-(st.right||0),He=p5({children:Ie,formattedGraphicalItems:se,legendWidth:We,legendContent:L});if(!He)return null;var At=He.item,Tt=kz(He,_fe);return Wt.cloneElement(At,It(It({},Tt),{},{chartWidth:Ae,chartHeight:ht,margin:st,onBBoxUpdate:le.handleLegendBBoxUpdate}))}),Lr(le,"renderTooltip",function(){var se,be=le.props,Ie=be.children,Ae=be.accessibilityLayer,ht=aa(Ie,cs);if(!ht)return null;var st=le.state,We=st.isTooltipActive,He=st.activeCoordinate,At=st.activePayload,Tt=st.activeLabel,kt=st.offset,ct=(se=ht.props.active)!==null&&se!==void 0?se:We;return Wt.cloneElement(ht,{viewBox:It(It({},kt),{},{x:kt.left,y:kt.top}),active:ct,label:Tt,payload:ct?At:[],coordinate:He,accessibilityLayer:Ae})}),Lr(le,"renderBrush",function(se){var be=le.props,Ie=be.margin,Ae=be.data,ht=le.state,st=ht.offset,We=ht.dataStartIndex,He=ht.dataEndIndex,At=ht.updateId;return Wt.cloneElement(se,{key:se.key||"_recharts-brush",onChange:b0(le.handleBrushChange,se.props.onChange),data:Ae,x:tr(se.props.x)?se.props.x:st.left,y:tr(se.props.y)?se.props.y:st.top+st.height+st.brushBottom-(Ie.bottom||0),width:tr(se.props.width)?se.props.width:st.width,startIndex:We,endIndex:He,updateId:"brush-".concat(At)})}),Lr(le,"renderReferenceElement",function(se,be,Ie){if(!se)return null;var Ae=le,ht=Ae.clipPathId,st=le.state,We=st.xAxisMap,He=st.yAxisMap,At=st.offset,Tt=se.type.defaultProps||{},kt=se.props,ct=kt.xAxisId,Ot=ct===void 0?Tt.xAxisId:ct,mt=kt.yAxisId,Lt=mt===void 0?Tt.yAxisId:mt;return Wt.cloneElement(se,{key:se.key||"".concat(be,"-").concat(Ie),xAxis:We[Ot],yAxis:He[Lt],viewBox:{x:At.left,y:At.top,width:At.width,height:At.height},clipPathId:ht})}),Lr(le,"renderActivePoints",function(se){var be=se.item,Ie=se.activePoint,Ae=se.basePoint,ht=se.childIndex,st=se.isRange,We=[],He=be.props.key,At=be.item.type.defaultProps!==void 0?It(It({},be.item.type.defaultProps),be.item.props):be.item.props,Tt=At.activeDot,kt=At.dataKey,ct=It(It({index:ht,dataKey:kt,cx:Ie.x,cy:Ie.y,r:4,fill:fP(be.item),strokeWidth:2,stroke:"#fff",payload:Ie.payload,value:Ie.value},Yr(Tt,!1)),ux(Tt));return We.push(ie.renderActiveDot(Tt,ct,"".concat(He,"-activePoint-").concat(ht))),Ae?We.push(ie.renderActiveDot(Tt,It(It({},ct),{},{cx:Ae.x,cy:Ae.y}),"".concat(He,"-basePoint-").concat(ht))):st&&We.push(null),We}),Lr(le,"renderGraphicChild",function(se,be,Ie){var Ae=le.filterFormatItem(se,be,Ie);if(!Ae)return null;var ht=le.getTooltipEventType(),st=le.state,We=st.isTooltipActive,He=st.tooltipAxis,At=st.activeTooltipIndex,Tt=st.activeLabel,kt=le.props.children,ct=aa(kt,cs),Ot=Ae.props,mt=Ot.points,Lt=Ot.isRange,yt=Ot.baseLine,Zt=Ae.item.type.defaultProps!==void 0?It(It({},Ae.item.type.defaultProps),Ae.item.props):Ae.item.props,Yt=Zt.activeDot,xr=Zt.hide,Vt=Zt.activeBar,Sn=Zt.activeShape,vn=!!(!xr&&We&&ct&&(Yt||Vt||Sn)),sn={};ht!=="axis"&&ct&&ct.props.trigger==="click"?sn={onClick:b0(le.handleItemMouseEnter,se.props.onClick)}:ht!=="axis"&&(sn={onMouseLeave:b0(le.handleItemMouseLeave,se.props.onMouseLeave),onMouseEnter:b0(le.handleItemMouseEnter,se.props.onMouseEnter)});var Ci=Wt.cloneElement(se,It(It({},Ae.props),sn));function rr(di){return typeof He.dataKey=="function"?He.dataKey(di.payload):null}if(vn)if(At>=0){var Pr,Me;if(He.dataKey&&!He.allowDuplicatedCategory){var Bt=typeof He.dataKey=="function"?rr:"payload.".concat(He.dataKey.toString());Pr=cx(mt,Bt,Tt),Me=Lt&&yt&&cx(yt,Bt,Tt)}else Pr=mt==null?void 0:mt[At],Me=Lt&&yt&&yt[At];if(Sn||Vt){var yn=se.props.activeIndex!==void 0?se.props.activeIndex:At;return[Wt.cloneElement(se,It(It(It({},Ae.props),sn),{},{activeIndex:yn})),null,null]}if(!en(Pr))return[Ci].concat(np(le.renderActivePoints({item:Ae,activePoint:Pr,basePoint:Me,childIndex:At,isRange:Lt})))}else{var Hr,_t=(Hr=le.getItemByXY(le.state.activeCoordinate))!==null&&Hr!==void 0?Hr:{graphicalItem:Ci},wn=_t.graphicalItem,hn=wn.item,fi=hn===void 0?se:hn,Sr=wn.childIndex,An=It(It(It({},Ae.props),sn),{},{activeIndex:Sr});return[Wt.cloneElement(fi,An),null,null]}return Lt?[Ci,null,null]:[Ci,null]}),Lr(le,"renderCustomized",function(se,be,Ie){return Wt.cloneElement(se,It(It({key:"recharts-customized-".concat(Ie)},le.props),le.state))}),Lr(le,"renderMap",{CartesianGrid:{handler:E0,once:!0},ReferenceArea:{handler:le.renderReferenceElement},ReferenceLine:{handler:E0},ReferenceDot:{handler:le.renderReferenceElement},XAxis:{handler:E0},YAxis:{handler:E0},Brush:{handler:le.renderBrush,once:!0},Bar:{handler:le.renderGraphicChild},Line:{handler:le.renderGraphicChild},Area:{handler:le.renderGraphicChild},Radar:{handler:le.renderGraphicChild},RadialBar:{handler:le.renderGraphicChild},Scatter:{handler:le.renderGraphicChild},Pie:{handler:le.renderGraphicChild},Funnel:{handler:le.renderGraphicChild},Tooltip:{handler:le.renderCursor,once:!0},PolarGrid:{handler:le.renderPolarGrid,once:!0},PolarAngleAxis:{handler:le.renderPolarAxis},PolarRadiusAxis:{handler:le.renderPolarAxis},Customized:{handler:le.renderCustomized}}),le.clipPathId="".concat((J=ae.id)!==null&&J!==void 0?J:dp("recharts"),"-clip"),le.throttleTriggeredAfterMouseMove=dN(le.triggeredAfterMouseMove,(ue=ae.throttleDelay)!==null&&ue!==void 0?ue:1e3/60),le.state={},le}return Cfe(ie,te),Efe(ie,[{key:"componentDidMount",value:function(){var J,ue;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(J=this.props.margin.left)!==null&&J!==void 0?J:0,top:(ue=this.props.margin.top)!==null&&ue!==void 0?ue:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var J=this.props,ue=J.children,le=J.data,se=J.height,be=J.layout,Ie=aa(ue,cs);if(Ie){var Ae=Ie.props.defaultIndex;if(!(typeof Ae!="number"||Ae<0||Ae>this.state.tooltipTicks.length-1)){var ht=this.state.tooltipTicks[Ae]&&this.state.tooltipTicks[Ae].value,st=xE(this.state,le,Ae,ht),We=this.state.tooltipTicks[Ae].coordinate,He=(this.state.offset.top+se)/2,At=be==="horizontal",Tt=At?{x:We,y:He}:{y:We,x:He},kt=this.state.formattedGraphicalItems.find(function(Ot){var mt=Ot.item;return mt.type.name==="Scatter"});kt&&(Tt=It(It({},Tt),kt.props.points[Ae].tooltipPosition),st=kt.props.points[Ae].tooltipPayload);var ct={activeTooltipIndex:Ae,isTooltipActive:!0,activeLabel:ht,activePayload:st,activeCoordinate:Tt};this.setState(ct),this.renderCursor(Ie),this.accessibilityManager.setIndex(Ae)}}}},{key:"getSnapshotBeforeUpdate",value:function(J,ue){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ue.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==J.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==J.margin){var le,se;this.accessibilityManager.setDetails({offset:{left:(le=this.props.margin.left)!==null&&le!==void 0?le:0,top:(se=this.props.margin.top)!==null&&se!==void 0?se:0}})}return null}},{key:"componentDidUpdate",value:function(J){JS([aa(J.children,cs)],[aa(this.props.children,cs)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var J=aa(this.props.children,cs);if(J&&typeof J.props.shared=="boolean"){var ue=J.props.shared?"axis":"item";return O.indexOf(ue)>=0?ue:y}return y}},{key:"getMouseInfo",value:function(J){if(!this.container)return null;var ue=this.container,le=ue.getBoundingClientRect(),se=ree(le),be={chartX:Math.round(J.pageX-se.left),chartY:Math.round(J.pageY-se.top)},Ie=le.width/ue.offsetWidth||1,Ae=this.inRange(be.chartX,be.chartY,Ie);if(!Ae)return null;var ht=this.state,st=ht.xAxisMap,We=ht.yAxisMap,He=this.getTooltipEventType();if(He!=="axis"&&st&&We){var At=td(st).scale,Tt=td(We).scale,kt=At&&At.invert?At.invert(be.chartX):null,ct=Tt&&Tt.invert?Tt.invert(be.chartY):null;return It(It({},be),{},{xValue:kt,yValue:ct})}var Ot=Lz(this.state,this.props.data,this.props.layout,Ae);return Ot?It(It({},be),Ot):null}},{key:"inRange",value:function(J,ue){var le=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,se=this.props.layout,be=J/le,Ie=ue/le;if(se==="horizontal"||se==="vertical"){var Ae=this.state.offset,ht=be>=Ae.left&&be<=Ae.left+Ae.width&&Ie>=Ae.top&&Ie<=Ae.top+Ae.height;return ht?{x:be,y:Ie}:null}var st=this.state,We=st.angleAxisMap,He=st.radiusAxisMap;if(We&&He){var At=td(We);return mR({x:be,y:Ie},At)}return null}},{key:"parseEventsOfWrapper",value:function(){var J=this.props.children,ue=this.getTooltipEventType(),le=aa(J,cs),se={};le&&ue==="axis"&&(le.props.trigger==="click"?se={onClick:this.handleClick}:se={onMouseEnter:this.handleMouseEnter,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd});var be=ux(this.props,this.handleOuterEvent);return It(It({},be),se)}},{key:"addListener",value:function(){eS.on(tS,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){eS.removeListener(tS,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(J,ue,le){for(var se=this.state.formattedGraphicalItems,be=0,Ie=se.length;be<Ie;be++){var Ae=se[be];if(Ae.item===J||Ae.props.key===J.key||ue===Tl(Ae.item.type)&&le===Ae.childIndex)return Ae}return null}},{key:"renderClipPath",value:function(){var J=this.clipPathId,ue=this.state.offset,le=ue.left,se=ue.top,be=ue.height,Ie=ue.width;return tt.createElement("defs",null,tt.createElement("clipPath",{id:J},tt.createElement("rect",{x:le,y:se,height:be,width:Ie})))}},{key:"getXScales",value:function(){var J=this.state.xAxisMap;return J?Object.entries(J).reduce(function(ue,le){var se=Oz(le,2),be=se[0],Ie=se[1];return It(It({},ue),{},Lr({},be,Ie.scale))},{}):null}},{key:"getYScales",value:function(){var J=this.state.yAxisMap;return J?Object.entries(J).reduce(function(ue,le){var se=Oz(le,2),be=se[0],Ie=se[1];return It(It({},ue),{},Lr({},be,Ie.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(J){var ue;return(ue=this.state.xAxisMap)===null||ue===void 0||(ue=ue[J])===null||ue===void 0?void 0:ue.scale}},{key:"getYScaleByAxisId",value:function(J){var ue;return(ue=this.state.yAxisMap)===null||ue===void 0||(ue=ue[J])===null||ue===void 0?void 0:ue.scale}},{key:"getItemByXY",value:function(J){var ue=this.state,le=ue.formattedGraphicalItems,se=ue.activeItem;if(le&&le.length)for(var be=0,Ie=le.length;be<Ie;be++){var Ae=le[be],ht=Ae.props,st=Ae.item,We=st.type.defaultProps!==void 0?It(It({},st.type.defaultProps),st.props):st.props,He=Tl(st.type);if(He==="Bar"){var At=(ht.data||[]).find(function(Ot){return Pse(J,Ot)});if(At)return{graphicalItem:Ae,payload:At}}else if(He==="RadialBar"){var Tt=(ht.data||[]).find(function(Ot){return mR(J,Ot)});if(Tt)return{graphicalItem:Ae,payload:Tt}}else if(ib(Ae,se)||ob(Ae,se)||$y(Ae,se)){var kt=Ole({graphicalItem:Ae,activeTooltipItem:se,itemData:We.data}),ct=We.activeIndex===void 0?kt:We.activeIndex;return{graphicalItem:It(It({},Ae),{},{childIndex:ct}),payload:$y(Ae,se)?We.data[kt]:Ae.props.data[kt]}}}return null}},{key:"render",value:function(){var J=this;if(!aD(this))return null;var ue=this.props,le=ue.children,se=ue.className,be=ue.width,Ie=ue.height,Ae=ue.style,ht=ue.compact,st=ue.title,We=ue.desc,He=kz(ue,vfe),At=Yr(He,!1);if(ht)return tt.createElement(dz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},tt.createElement(eA,Xg({},At,{width:be,height:Ie,title:st,desc:We}),this.renderClipPath(),lD(le,this.renderMap)));if(this.props.accessibilityLayer){var Tt,kt;At.tabIndex=(Tt=this.props.tabIndex)!==null&&Tt!==void 0?Tt:0,At.role=(kt=this.props.role)!==null&&kt!==void 0?kt:"application",At.onKeyDown=function(Ot){J.accessibilityManager.keyboardEvent(Ot)},At.onFocus=function(){J.accessibilityManager.focus()}}var ct=this.parseEventsOfWrapper();return tt.createElement(dz,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},tt.createElement("div",Xg({className:pn("recharts-wrapper",se),style:It({position:"relative",cursor:"default",width:be,height:Ie},Ae)},ct,{ref:function(mt){J.container=mt}}),tt.createElement(eA,Xg({},At,{width:be,height:Ie,title:st,desc:We,style:zfe}),this.renderClipPath(),lD(le,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Wt.Component);return Lr(oe,"displayName",i),Lr(oe,"defaultProps",It({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},F)),Lr(oe,"getDerivedStateFromProps",function(te,ie){var ae=te.dataKey,J=te.data,ue=te.children,le=te.width,se=te.height,be=te.layout,Ie=te.stackOffset,Ae=te.margin,ht=ie.dataStartIndex,st=ie.dataEndIndex;if(ie.updateId===void 0){var We=Rz(te);return It(It(It({},We),{},{updateId:0},Y(It(It({props:te},We),{},{updateId:0}),ie)),{},{prevDataKey:ae,prevData:J,prevWidth:le,prevHeight:se,prevLayout:be,prevStackOffset:Ie,prevMargin:Ae,prevChildren:ue})}if(ae!==ie.prevDataKey||J!==ie.prevData||le!==ie.prevWidth||se!==ie.prevHeight||be!==ie.prevLayout||Ie!==ie.prevStackOffset||!wd(Ae,ie.prevMargin)){var He=Rz(te),At={chartX:ie.chartX,chartY:ie.chartY,isTooltipActive:ie.isTooltipActive},Tt=It(It({},Lz(ie,J,be)),{},{updateId:ie.updateId+1}),kt=It(It(It({},He),At),Tt);return It(It(It({},kt),Y(It({props:te},kt),ie)),{},{prevDataKey:ae,prevData:J,prevWidth:le,prevHeight:se,prevLayout:be,prevStackOffset:Ie,prevMargin:Ae,prevChildren:ue})}if(!JS(ue,ie.prevChildren)){var ct,Ot,mt,Lt,yt=aa(ue,Wd),Zt=yt&&(ct=(Ot=yt.props)===null||Ot===void 0?void 0:Ot.startIndex)!==null&&ct!==void 0?ct:ht,Yt=yt&&(mt=(Lt=yt.props)===null||Lt===void 0?void 0:Lt.endIndex)!==null&&mt!==void 0?mt:st,xr=Zt!==ht||Yt!==st,Vt=!en(J),Sn=Vt&&!xr?ie.updateId:ie.updateId+1;return It(It({updateId:Sn},Y(It(It({props:te},ie),{},{updateId:Sn,dataStartIndex:Zt,dataEndIndex:Yt}),ie)),{},{prevChildren:ue,dataStartIndex:Zt,dataEndIndex:Yt})}return null}),Lr(oe,"renderActiveDot",function(te,ie,ae){var J;return Wt.isValidElement(te)?J=Wt.cloneElement(te,ie):on(te)?J=te(ie):J=tt.createElement(nb,ie),tt.createElement(Vn,{className:"recharts-active-dot",key:ae},J)}),function(ie){return tt.createElement(oe,ie)}},Oj=Cj({chartName:"LineChart",GraphicalChild:wp,axisComponents:[{axisType:"xAxis",AxisComp:Tp},{axisType:"yAxis",AxisComp:Sp}],formatAxisMap:U5}),Wfe=Cj({chartName:"AreaChart",GraphicalChild:qs,axisComponents:[{axisType:"xAxis",AxisComp:Tp},{axisType:"yAxis",AxisComp:Sp}],formatAxisMap:U5}),kj={exports:{}};(function(e,t){var i={};(function(a,f){e.exports=f()})(Ig,function(){var a,f,y;function w(o,L){if(!a)a=L;else if(!f)f=L;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",F={};a(F),y=L(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}w(["exports"],function(o){function L(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var $,F={},H={};function Y(){if($)return H;$=1,Object.defineProperty(H,"__esModule",{value:!0}),H.setMatrixArrayType=function(m){H.ARRAY_TYPE=r=m},H.toRadian=function(m){return m*u},H.equals=function(m,h){return Math.abs(m-h)<=c*Math.max(1,Math.abs(m),Math.abs(h))},H.RANDOM=H.ARRAY_TYPE=H.EPSILON=void 0;var c=1e-6;H.EPSILON=c;var r=typeof Float32Array<"u"?Float32Array:Array;H.ARRAY_TYPE=r;var s=Math.random;H.RANDOM=s;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),H}var oe,te={};function ie(){if(oe)return te;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}oe=1,Object.defineProperty(te,"__esModule",{value:!0}),te.create=function(){var h=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},te.clone=function(h){var g=new r.ARRAY_TYPE(4);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g},te.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h},te.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},te.fromValues=function(h,g,b,E){var I=new r.ARRAY_TYPE(4);return I[0]=h,I[1]=g,I[2]=b,I[3]=E,I},te.set=function(h,g,b,E,I){return h[0]=g,h[1]=b,h[2]=E,h[3]=I,h},te.transpose=function(h,g){if(h===g){var b=g[1];h[1]=g[2],h[2]=b}else h[0]=g[0],h[1]=g[2],h[2]=g[1],h[3]=g[3];return h},te.invert=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=b*v-I*E;return S?(h[0]=v*(S=1/S),h[1]=-E*S,h[2]=-I*S,h[3]=b*S,h):null},te.adjoint=function(h,g){var b=g[0];return h[0]=g[3],h[1]=-g[1],h[2]=-g[2],h[3]=b,h},te.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},te.multiply=u,te.rotate=function(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=Math.sin(b),A=Math.cos(b);return h[0]=E*A+v*P,h[1]=I*A+S*P,h[2]=E*-P+v*A,h[3]=I*-P+S*A,h},te.scale=function(h,g,b){var E=g[1],I=g[2],v=g[3],S=b[0],P=b[1];return h[0]=g[0]*S,h[1]=E*S,h[2]=I*P,h[3]=v*P,h},te.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=-b,h[3]=E,h},te.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h},te.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},te.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},te.LDU=function(h,g,b,E){return h[2]=E[2]/E[0],b[0]=E[0],b[1]=E[1],b[3]=E[3]-h[2]*b[1],[h,g,b]},te.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h},te.subtract=m,te.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]},te.equals=function(h,g){var b=h[0],E=h[1],I=h[2],v=h[3],S=g[0],P=g[1],A=g[2],M=g[3];return Math.abs(b-S)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(S))&&Math.abs(E-P)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(I-A)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(A))&&Math.abs(v-M)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(M))},te.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h},te.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h},te.sub=te.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=s(void 0);if(b&&b.has(h))return b.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=I?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(Y());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(s=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=b[0],A=b[1],M=b[2],k=b[3];return h[0]=E*P+v*A,h[1]=I*P+S*A,h[2]=E*M+v*k,h[3]=I*M+S*k,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h}return te.mul=u,te.sub=m,te}var ae,J={};function ue(){if(ae)return J;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}ae=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var h=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},J.clone=function(h){var g=new r.ARRAY_TYPE(6);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g},J.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h},J.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},J.fromValues=function(h,g,b,E,I,v){var S=new r.ARRAY_TYPE(6);return S[0]=h,S[1]=g,S[2]=b,S[3]=E,S[4]=I,S[5]=v,S},J.set=function(h,g,b,E,I,v,S){return h[0]=g,h[1]=b,h[2]=E,h[3]=I,h[4]=v,h[5]=S,h},J.invert=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=g[4],P=g[5],A=b*v-E*I;return A?(h[0]=v*(A=1/A),h[1]=-E*A,h[2]=-I*A,h[3]=b*A,h[4]=(I*P-v*S)*A,h[5]=(E*S-b*P)*A,h):null},J.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},J.multiply=u,J.rotate=function(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=Math.sin(b),k=Math.cos(b);return h[0]=E*k+v*M,h[1]=I*k+S*M,h[2]=E*-M+v*k,h[3]=I*-M+S*k,h[4]=P,h[5]=A,h},J.scale=function(h,g,b){var E=g[1],I=g[2],v=g[3],S=g[4],P=g[5],A=b[0],M=b[1];return h[0]=g[0]*A,h[1]=E*A,h[2]=I*M,h[3]=v*M,h[4]=S,h[5]=P,h},J.translate=function(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=b[0],k=b[1];return h[0]=E,h[1]=I,h[2]=v,h[3]=S,h[4]=E*M+v*k+P,h[5]=I*M+S*k+A,h},J.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=-b,h[3]=E,h[4]=0,h[5]=0,h},J.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h[4]=0,h[5]=0,h},J.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=g[0],h[5]=g[1],h},J.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},J.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},J.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h},J.subtract=m,J.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h},J.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h[4]=g[4]+b[4]*E,h[5]=g[5]+b[5]*E,h},J.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]},J.equals=function(h,g){var b=h[0],E=h[1],I=h[2],v=h[3],S=h[4],P=h[5],A=g[0],M=g[1],k=g[2],R=g[3],N=g[4],G=g[5];return Math.abs(b-A)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(A))&&Math.abs(E-M)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(I-k)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(k))&&Math.abs(v-R)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(S-N)<=r.EPSILON*Math.max(1,Math.abs(S),Math.abs(N))&&Math.abs(P-G)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(G))},J.sub=J.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=s(void 0);if(b&&b.has(h))return b.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=I?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(Y());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(s=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=b[0],k=b[1],R=b[2],N=b[3],G=b[4],W=b[5];return h[0]=E*M+v*k,h[1]=I*M+S*k,h[2]=E*R+v*N,h[3]=I*R+S*N,h[4]=E*G+v*W+P,h[5]=I*G+S*W+A,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h}return J.mul=u,J.sub=m,J}var le,se={};function be(){if(le)return se;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(h)}le=1,Object.defineProperty(se,"__esModule",{value:!0}),se.create=function(){var h=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},se.fromMat4=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[4],h[4]=g[5],h[5]=g[6],h[6]=g[8],h[7]=g[9],h[8]=g[10],h},se.clone=function(h){var g=new r.ARRAY_TYPE(9);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=h[7],g[8]=h[8],g},se.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},se.fromValues=function(h,g,b,E,I,v,S,P,A){var M=new r.ARRAY_TYPE(9);return M[0]=h,M[1]=g,M[2]=b,M[3]=E,M[4]=I,M[5]=v,M[6]=S,M[7]=P,M[8]=A,M},se.set=function(h,g,b,E,I,v,S,P,A,M){return h[0]=g,h[1]=b,h[2]=E,h[3]=I,h[4]=v,h[5]=S,h[6]=P,h[7]=A,h[8]=M,h},se.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},se.transpose=function(h,g){if(h===g){var b=g[1],E=g[2],I=g[5];h[1]=g[3],h[2]=g[6],h[3]=b,h[5]=g[7],h[6]=E,h[7]=I}else h[0]=g[0],h[1]=g[3],h[2]=g[6],h[3]=g[1],h[4]=g[4],h[5]=g[7],h[6]=g[2],h[7]=g[5],h[8]=g[8];return h},se.invert=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=g[4],P=g[5],A=g[6],M=g[7],k=g[8],R=k*S-P*M,N=-k*v+P*A,G=M*v-S*A,W=b*R+E*N+I*G;return W?(h[0]=R*(W=1/W),h[1]=(-k*E+I*M)*W,h[2]=(P*E-I*S)*W,h[3]=N*W,h[4]=(k*b-I*A)*W,h[5]=(-P*b+I*v)*W,h[6]=G*W,h[7]=(-M*b+E*A)*W,h[8]=(S*b-E*v)*W,h):null},se.adjoint=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=g[4],P=g[5],A=g[6],M=g[7],k=g[8];return h[0]=S*k-P*M,h[1]=I*M-E*k,h[2]=E*P-I*S,h[3]=P*A-v*k,h[4]=b*k-I*A,h[5]=I*v-b*P,h[6]=v*M-S*A,h[7]=E*A-b*M,h[8]=b*S-E*v,h},se.determinant=function(h){var g=h[3],b=h[4],E=h[5],I=h[6],v=h[7],S=h[8];return h[0]*(S*b-E*v)+h[1]*(-S*g+E*I)+h[2]*(v*g-b*I)},se.multiply=u,se.translate=function(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=g[6],k=g[7],R=g[8],N=b[0],G=b[1];return h[0]=E,h[1]=I,h[2]=v,h[3]=S,h[4]=P,h[5]=A,h[6]=N*E+G*S+M,h[7]=N*I+G*P+k,h[8]=N*v+G*A+R,h},se.rotate=function(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=g[6],k=g[7],R=g[8],N=Math.sin(b),G=Math.cos(b);return h[0]=G*E+N*S,h[1]=G*I+N*P,h[2]=G*v+N*A,h[3]=G*S-N*E,h[4]=G*P-N*I,h[5]=G*A-N*v,h[6]=M,h[7]=k,h[8]=R,h},se.scale=function(h,g,b){var E=b[0],I=b[1];return h[0]=E*g[0],h[1]=E*g[1],h[2]=E*g[2],h[3]=I*g[3],h[4]=I*g[4],h[5]=I*g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},se.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=g[0],h[7]=g[1],h[8]=1,h},se.fromRotation=function(h,g){var b=Math.sin(g),E=Math.cos(g);return h[0]=E,h[1]=b,h[2]=0,h[3]=-b,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},se.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=0,h[4]=g[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},se.fromMat2d=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=0,h[3]=g[2],h[4]=g[3],h[5]=0,h[6]=g[4],h[7]=g[5],h[8]=1,h},se.fromQuat=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=b+b,P=E+E,A=I+I,M=b*S,k=E*S,R=E*P,N=I*S,G=I*P,W=I*A,j=v*S,Z=v*P,X=v*A;return h[0]=1-R-W,h[3]=k-X,h[6]=N+Z,h[1]=k+X,h[4]=1-M-W,h[7]=G-j,h[2]=N-Z,h[5]=G+j,h[8]=1-M-R,h},se.normalFromMat4=function(h,g){var b=g[0],E=g[1],I=g[2],v=g[3],S=g[4],P=g[5],A=g[6],M=g[7],k=g[8],R=g[9],N=g[10],G=g[11],W=g[12],j=g[13],Z=g[14],X=g[15],ce=b*P-E*S,pe=b*A-I*S,ge=b*M-v*S,fe=E*A-I*P,Te=E*M-v*P,_e=I*M-v*A,Ee=k*j-R*W,Re=k*Z-N*W,Fe=k*X-G*W,Ne=R*Z-N*j,je=R*X-G*j,Xe=N*X-G*Z,Ue=ce*Xe-pe*je+ge*Ne+fe*Fe-Te*Re+_e*Ee;return Ue?(h[0]=(P*Xe-A*je+M*Ne)*(Ue=1/Ue),h[1]=(A*Fe-S*Xe-M*Re)*Ue,h[2]=(S*je-P*Fe+M*Ee)*Ue,h[3]=(I*je-E*Xe-v*Ne)*Ue,h[4]=(b*Xe-I*Fe+v*Re)*Ue,h[5]=(E*Fe-b*je-v*Ee)*Ue,h[6]=(j*_e-Z*Te+X*fe)*Ue,h[7]=(Z*ge-W*_e-X*pe)*Ue,h[8]=(W*Te-j*ge+X*ce)*Ue,h):null},se.projection=function(h,g,b){return h[0]=2/g,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/b,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},se.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},se.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},se.add=function(h,g,b){return h[0]=g[0]+b[0],h[1]=g[1]+b[1],h[2]=g[2]+b[2],h[3]=g[3]+b[3],h[4]=g[4]+b[4],h[5]=g[5]+b[5],h[6]=g[6]+b[6],h[7]=g[7]+b[7],h[8]=g[8]+b[8],h},se.subtract=m,se.multiplyScalar=function(h,g,b){return h[0]=g[0]*b,h[1]=g[1]*b,h[2]=g[2]*b,h[3]=g[3]*b,h[4]=g[4]*b,h[5]=g[5]*b,h[6]=g[6]*b,h[7]=g[7]*b,h[8]=g[8]*b,h},se.multiplyScalarAndAdd=function(h,g,b,E){return h[0]=g[0]+b[0]*E,h[1]=g[1]+b[1]*E,h[2]=g[2]+b[2]*E,h[3]=g[3]+b[3]*E,h[4]=g[4]+b[4]*E,h[5]=g[5]+b[5]*E,h[6]=g[6]+b[6]*E,h[7]=g[7]+b[7]*E,h[8]=g[8]+b[8]*E,h},se.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]&&h[6]===g[6]&&h[7]===g[7]&&h[8]===g[8]},se.equals=function(h,g){var b=h[0],E=h[1],I=h[2],v=h[3],S=h[4],P=h[5],A=h[6],M=h[7],k=h[8],R=g[0],N=g[1],G=g[2],W=g[3],j=g[4],Z=g[5],X=g[6],ce=g[7],pe=g[8];return Math.abs(b-R)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(R))&&Math.abs(E-N)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(I-G)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(G))&&Math.abs(v-W)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(S-j)<=r.EPSILON*Math.max(1,Math.abs(S),Math.abs(j))&&Math.abs(P-Z)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(Z))&&Math.abs(A-X)<=r.EPSILON*Math.max(1,Math.abs(A),Math.abs(X))&&Math.abs(M-ce)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(ce))&&Math.abs(k-pe)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(pe))},se.sub=se.mul=void 0;var r=function(h,g){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var b=s(void 0);if(b&&b.has(h))return b.get(h);var E={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var S=I?Object.getOwnPropertyDescriptor(h,v):null;S&&(S.get||S.set)?Object.defineProperty(E,v,S):E[v]=h[v]}return E.default=h,b&&b.set(h,E),E}(Y());function s(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,b=new WeakMap;return(s=function(E){return E?b:g})(h)}function u(h,g,b){var E=g[0],I=g[1],v=g[2],S=g[3],P=g[4],A=g[5],M=g[6],k=g[7],R=g[8],N=b[0],G=b[1],W=b[2],j=b[3],Z=b[4],X=b[5],ce=b[6],pe=b[7],ge=b[8];return h[0]=N*E+G*S+W*M,h[1]=N*I+G*P+W*k,h[2]=N*v+G*A+W*R,h[3]=j*E+Z*S+X*M,h[4]=j*I+Z*P+X*k,h[5]=j*v+Z*A+X*R,h[6]=ce*E+pe*S+ge*M,h[7]=ce*I+pe*P+ge*k,h[8]=ce*v+pe*A+ge*R,h}function m(h,g,b){return h[0]=g[0]-b[0],h[1]=g[1]-b[1],h[2]=g[2]-b[2],h[3]=g[3]-b[3],h[4]=g[4]-b[4],h[5]=g[5]-b[5],h[6]=g[6]-b[6],h[7]=g[7]-b[7],h[8]=g[8]-b[8],h}return se.mul=u,se.sub=m,se}var Ie,Ae={};function ht(){if(Ie)return Ae;function c(v){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},c(v)}Ie=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=function(){var v=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},Ae.clone=function(v){var S=new r.ARRAY_TYPE(16);return S[0]=v[0],S[1]=v[1],S[2]=v[2],S[3]=v[3],S[4]=v[4],S[5]=v[5],S[6]=v[6],S[7]=v[7],S[8]=v[8],S[9]=v[9],S[10]=v[10],S[11]=v[11],S[12]=v[12],S[13]=v[13],S[14]=v[14],S[15]=v[15],S},Ae.copy=function(v,S){return v[0]=S[0],v[1]=S[1],v[2]=S[2],v[3]=S[3],v[4]=S[4],v[5]=S[5],v[6]=S[6],v[7]=S[7],v[8]=S[8],v[9]=S[9],v[10]=S[10],v[11]=S[11],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15],v},Ae.fromValues=function(v,S,P,A,M,k,R,N,G,W,j,Z,X,ce,pe,ge){var fe=new r.ARRAY_TYPE(16);return fe[0]=v,fe[1]=S,fe[2]=P,fe[3]=A,fe[4]=M,fe[5]=k,fe[6]=R,fe[7]=N,fe[8]=G,fe[9]=W,fe[10]=j,fe[11]=Z,fe[12]=X,fe[13]=ce,fe[14]=pe,fe[15]=ge,fe},Ae.set=function(v,S,P,A,M,k,R,N,G,W,j,Z,X,ce,pe,ge,fe){return v[0]=S,v[1]=P,v[2]=A,v[3]=M,v[4]=k,v[5]=R,v[6]=N,v[7]=G,v[8]=W,v[9]=j,v[10]=Z,v[11]=X,v[12]=ce,v[13]=pe,v[14]=ge,v[15]=fe,v},Ae.identity=u,Ae.transpose=function(v,S){if(v===S){var P=S[1],A=S[2],M=S[3],k=S[6],R=S[7],N=S[11];v[1]=S[4],v[2]=S[8],v[3]=S[12],v[4]=P,v[6]=S[9],v[7]=S[13],v[8]=A,v[9]=k,v[11]=S[14],v[12]=M,v[13]=R,v[14]=N}else v[0]=S[0],v[1]=S[4],v[2]=S[8],v[3]=S[12],v[4]=S[1],v[5]=S[5],v[6]=S[9],v[7]=S[13],v[8]=S[2],v[9]=S[6],v[10]=S[10],v[11]=S[14],v[12]=S[3],v[13]=S[7],v[14]=S[11],v[15]=S[15];return v},Ae.invert=function(v,S){var P=S[0],A=S[1],M=S[2],k=S[3],R=S[4],N=S[5],G=S[6],W=S[7],j=S[8],Z=S[9],X=S[10],ce=S[11],pe=S[12],ge=S[13],fe=S[14],Te=S[15],_e=P*N-A*R,Ee=P*G-M*R,Re=P*W-k*R,Fe=A*G-M*N,Ne=A*W-k*N,je=M*W-k*G,Xe=j*ge-Z*pe,Ue=j*fe-X*pe,it=j*Te-ce*pe,dt=Z*fe-X*ge,Qe=Z*Te-ce*ge,Rt=X*Te-ce*fe,Pt=_e*Rt-Ee*Qe+Re*dt+Fe*it-Ne*Ue+je*Xe;return Pt?(v[0]=(N*Rt-G*Qe+W*dt)*(Pt=1/Pt),v[1]=(M*Qe-A*Rt-k*dt)*Pt,v[2]=(ge*je-fe*Ne+Te*Fe)*Pt,v[3]=(X*Ne-Z*je-ce*Fe)*Pt,v[4]=(G*it-R*Rt-W*Ue)*Pt,v[5]=(P*Rt-M*it+k*Ue)*Pt,v[6]=(fe*Re-pe*je-Te*Ee)*Pt,v[7]=(j*je-X*Re+ce*Ee)*Pt,v[8]=(R*Qe-N*it+W*Xe)*Pt,v[9]=(A*it-P*Qe-k*Xe)*Pt,v[10]=(pe*Ne-ge*Re+Te*_e)*Pt,v[11]=(Z*Re-j*Ne-ce*_e)*Pt,v[12]=(N*Ue-R*dt-G*Xe)*Pt,v[13]=(P*dt-A*Ue+M*Xe)*Pt,v[14]=(ge*Ee-pe*Fe-fe*_e)*Pt,v[15]=(j*Fe-Z*Ee+X*_e)*Pt,v):null},Ae.adjoint=function(v,S){var P=S[0],A=S[1],M=S[2],k=S[3],R=S[4],N=S[5],G=S[6],W=S[7],j=S[8],Z=S[9],X=S[10],ce=S[11],pe=S[12],ge=S[13],fe=S[14],Te=S[15];return v[0]=N*(X*Te-ce*fe)-Z*(G*Te-W*fe)+ge*(G*ce-W*X),v[1]=-(A*(X*Te-ce*fe)-Z*(M*Te-k*fe)+ge*(M*ce-k*X)),v[2]=A*(G*Te-W*fe)-N*(M*Te-k*fe)+ge*(M*W-k*G),v[3]=-(A*(G*ce-W*X)-N*(M*ce-k*X)+Z*(M*W-k*G)),v[4]=-(R*(X*Te-ce*fe)-j*(G*Te-W*fe)+pe*(G*ce-W*X)),v[5]=P*(X*Te-ce*fe)-j*(M*Te-k*fe)+pe*(M*ce-k*X),v[6]=-(P*(G*Te-W*fe)-R*(M*Te-k*fe)+pe*(M*W-k*G)),v[7]=P*(G*ce-W*X)-R*(M*ce-k*X)+j*(M*W-k*G),v[8]=R*(Z*Te-ce*ge)-j*(N*Te-W*ge)+pe*(N*ce-W*Z),v[9]=-(P*(Z*Te-ce*ge)-j*(A*Te-k*ge)+pe*(A*ce-k*Z)),v[10]=P*(N*Te-W*ge)-R*(A*Te-k*ge)+pe*(A*W-k*N),v[11]=-(P*(N*ce-W*Z)-R*(A*ce-k*Z)+j*(A*W-k*N)),v[12]=-(R*(Z*fe-X*ge)-j*(N*fe-G*ge)+pe*(N*X-G*Z)),v[13]=P*(Z*fe-X*ge)-j*(A*fe-M*ge)+pe*(A*X-M*Z),v[14]=-(P*(N*fe-G*ge)-R*(A*fe-M*ge)+pe*(A*G-M*N)),v[15]=P*(N*X-G*Z)-R*(A*X-M*Z)+j*(A*G-M*N),v},Ae.determinant=function(v){var S=v[0],P=v[1],A=v[2],M=v[3],k=v[4],R=v[5],N=v[6],G=v[7],W=v[8],j=v[9],Z=v[10],X=v[11],ce=v[12],pe=v[13],ge=v[14],fe=v[15];return(S*R-P*k)*(Z*fe-X*ge)-(S*N-A*k)*(j*fe-X*pe)+(S*G-M*k)*(j*ge-Z*pe)+(P*N-A*R)*(W*fe-X*ce)-(P*G-M*R)*(W*ge-Z*ce)+(A*G-M*N)*(W*pe-j*ce)},Ae.multiply=m,Ae.translate=function(v,S,P){var A,M,k,R,N,G,W,j,Z,X,ce,pe,ge=P[0],fe=P[1],Te=P[2];return S===v?(v[12]=S[0]*ge+S[4]*fe+S[8]*Te+S[12],v[13]=S[1]*ge+S[5]*fe+S[9]*Te+S[13],v[14]=S[2]*ge+S[6]*fe+S[10]*Te+S[14],v[15]=S[3]*ge+S[7]*fe+S[11]*Te+S[15]):(M=S[1],k=S[2],R=S[3],N=S[4],G=S[5],W=S[6],j=S[7],Z=S[8],X=S[9],ce=S[10],pe=S[11],v[0]=A=S[0],v[1]=M,v[2]=k,v[3]=R,v[4]=N,v[5]=G,v[6]=W,v[7]=j,v[8]=Z,v[9]=X,v[10]=ce,v[11]=pe,v[12]=A*ge+N*fe+Z*Te+S[12],v[13]=M*ge+G*fe+X*Te+S[13],v[14]=k*ge+W*fe+ce*Te+S[14],v[15]=R*ge+j*fe+pe*Te+S[15]),v},Ae.scale=function(v,S,P){var A=P[0],M=P[1],k=P[2];return v[0]=S[0]*A,v[1]=S[1]*A,v[2]=S[2]*A,v[3]=S[3]*A,v[4]=S[4]*M,v[5]=S[5]*M,v[6]=S[6]*M,v[7]=S[7]*M,v[8]=S[8]*k,v[9]=S[9]*k,v[10]=S[10]*k,v[11]=S[11]*k,v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15],v},Ae.rotate=function(v,S,P,A){var M,k,R,N,G,W,j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re,Fe,Ne,je,Xe,Ue,it,dt,Qe=A[0],Rt=A[1],Pt=A[2],wt=Math.hypot(Qe,Rt,Pt);return wt<r.EPSILON?null:(Qe*=wt=1/wt,Rt*=wt,Pt*=wt,M=Math.sin(P),k=Math.cos(P),G=S[1],W=S[2],j=S[3],X=S[5],ce=S[6],pe=S[7],fe=S[9],Te=S[10],_e=S[11],Ee=Qe*Qe*(R=1-k)+k,Ne=Qe*Rt*R-Pt*M,je=Rt*Rt*R+k,Xe=Pt*Rt*R+Qe*M,Ue=Qe*Pt*R+Rt*M,it=Rt*Pt*R-Qe*M,dt=Pt*Pt*R+k,v[0]=(N=S[0])*Ee+(Z=S[4])*(Re=Rt*Qe*R+Pt*M)+(ge=S[8])*(Fe=Pt*Qe*R-Rt*M),v[1]=G*Ee+X*Re+fe*Fe,v[2]=W*Ee+ce*Re+Te*Fe,v[3]=j*Ee+pe*Re+_e*Fe,v[4]=N*Ne+Z*je+ge*Xe,v[5]=G*Ne+X*je+fe*Xe,v[6]=W*Ne+ce*je+Te*Xe,v[7]=j*Ne+pe*je+_e*Xe,v[8]=N*Ue+Z*it+ge*dt,v[9]=G*Ue+X*it+fe*dt,v[10]=W*Ue+ce*it+Te*dt,v[11]=j*Ue+pe*it+_e*dt,S!==v&&(v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v)},Ae.rotateX=function(v,S,P){var A=Math.sin(P),M=Math.cos(P),k=S[4],R=S[5],N=S[6],G=S[7],W=S[8],j=S[9],Z=S[10],X=S[11];return S!==v&&(v[0]=S[0],v[1]=S[1],v[2]=S[2],v[3]=S[3],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[4]=k*M+W*A,v[5]=R*M+j*A,v[6]=N*M+Z*A,v[7]=G*M+X*A,v[8]=W*M-k*A,v[9]=j*M-R*A,v[10]=Z*M-N*A,v[11]=X*M-G*A,v},Ae.rotateY=function(v,S,P){var A=Math.sin(P),M=Math.cos(P),k=S[0],R=S[1],N=S[2],G=S[3],W=S[8],j=S[9],Z=S[10],X=S[11];return S!==v&&(v[4]=S[4],v[5]=S[5],v[6]=S[6],v[7]=S[7],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[0]=k*M-W*A,v[1]=R*M-j*A,v[2]=N*M-Z*A,v[3]=G*M-X*A,v[8]=k*A+W*M,v[9]=R*A+j*M,v[10]=N*A+Z*M,v[11]=G*A+X*M,v},Ae.rotateZ=function(v,S,P){var A=Math.sin(P),M=Math.cos(P),k=S[0],R=S[1],N=S[2],G=S[3],W=S[4],j=S[5],Z=S[6],X=S[7];return S!==v&&(v[8]=S[8],v[9]=S[9],v[10]=S[10],v[11]=S[11],v[12]=S[12],v[13]=S[13],v[14]=S[14],v[15]=S[15]),v[0]=k*M+W*A,v[1]=R*M+j*A,v[2]=N*M+Z*A,v[3]=G*M+X*A,v[4]=W*M-k*A,v[5]=j*M-R*A,v[6]=Z*M-N*A,v[7]=X*M-G*A,v},Ae.fromTranslation=function(v,S){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=S[0],v[13]=S[1],v[14]=S[2],v[15]=1,v},Ae.fromScaling=function(v,S){return v[0]=S[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=S[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=S[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ae.fromRotation=function(v,S,P){var A,M,k,R=P[0],N=P[1],G=P[2],W=Math.hypot(R,N,G);return W<r.EPSILON?null:(R*=W=1/W,N*=W,G*=W,A=Math.sin(S),M=Math.cos(S),v[0]=R*R*(k=1-M)+M,v[1]=N*R*k+G*A,v[2]=G*R*k-N*A,v[3]=0,v[4]=R*N*k-G*A,v[5]=N*N*k+M,v[6]=G*N*k+R*A,v[7]=0,v[8]=R*G*k+N*A,v[9]=N*G*k-R*A,v[10]=G*G*k+M,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},Ae.fromXRotation=function(v,S){var P=Math.sin(S),A=Math.cos(S);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=A,v[6]=P,v[7]=0,v[8]=0,v[9]=-P,v[10]=A,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ae.fromYRotation=function(v,S){var P=Math.sin(S),A=Math.cos(S);return v[0]=A,v[1]=0,v[2]=-P,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=P,v[9]=0,v[10]=A,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ae.fromZRotation=function(v,S){var P=Math.sin(S),A=Math.cos(S);return v[0]=A,v[1]=P,v[2]=0,v[3]=0,v[4]=-P,v[5]=A,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ae.fromRotationTranslation=h,Ae.fromQuat2=function(v,S){var P=new r.ARRAY_TYPE(3),A=-S[0],M=-S[1],k=-S[2],R=S[3],N=S[4],G=S[5],W=S[6],j=S[7],Z=A*A+M*M+k*k+R*R;return Z>0?(P[0]=2*(N*R+j*A+G*k-W*M)/Z,P[1]=2*(G*R+j*M+W*A-N*k)/Z,P[2]=2*(W*R+j*k+N*M-G*A)/Z):(P[0]=2*(N*R+j*A+G*k-W*M),P[1]=2*(G*R+j*M+W*A-N*k),P[2]=2*(W*R+j*k+N*M-G*A)),h(v,S,P),v},Ae.getTranslation=function(v,S){return v[0]=S[12],v[1]=S[13],v[2]=S[14],v},Ae.getScaling=g,Ae.getRotation=function(v,S){var P=new r.ARRAY_TYPE(3);g(P,S);var A=1/P[0],M=1/P[1],k=1/P[2],R=S[0]*A,N=S[1]*M,G=S[2]*k,W=S[4]*A,j=S[5]*M,Z=S[6]*k,X=S[8]*A,ce=S[9]*M,pe=S[10]*k,ge=R+j+pe,fe=0;return ge>0?(fe=2*Math.sqrt(ge+1),v[3]=.25*fe,v[0]=(Z-ce)/fe,v[1]=(X-G)/fe,v[2]=(N-W)/fe):R>j&&R>pe?(fe=2*Math.sqrt(1+R-j-pe),v[3]=(Z-ce)/fe,v[0]=.25*fe,v[1]=(N+W)/fe,v[2]=(X+G)/fe):j>pe?(fe=2*Math.sqrt(1+j-R-pe),v[3]=(X-G)/fe,v[0]=(N+W)/fe,v[1]=.25*fe,v[2]=(Z+ce)/fe):(fe=2*Math.sqrt(1+pe-R-j),v[3]=(N-W)/fe,v[0]=(X+G)/fe,v[1]=(Z+ce)/fe,v[2]=.25*fe),v},Ae.fromRotationTranslationScale=function(v,S,P,A){var M=S[0],k=S[1],R=S[2],N=S[3],G=M+M,W=k+k,j=R+R,Z=M*G,X=M*W,ce=M*j,pe=k*W,ge=k*j,fe=R*j,Te=N*G,_e=N*W,Ee=N*j,Re=A[0],Fe=A[1],Ne=A[2];return v[0]=(1-(pe+fe))*Re,v[1]=(X+Ee)*Re,v[2]=(ce-_e)*Re,v[3]=0,v[4]=(X-Ee)*Fe,v[5]=(1-(Z+fe))*Fe,v[6]=(ge+Te)*Fe,v[7]=0,v[8]=(ce+_e)*Ne,v[9]=(ge-Te)*Ne,v[10]=(1-(Z+pe))*Ne,v[11]=0,v[12]=P[0],v[13]=P[1],v[14]=P[2],v[15]=1,v},Ae.fromRotationTranslationScaleOrigin=function(v,S,P,A,M){var k=S[0],R=S[1],N=S[2],G=S[3],W=k+k,j=R+R,Z=N+N,X=k*W,ce=k*j,pe=k*Z,ge=R*j,fe=R*Z,Te=N*Z,_e=G*W,Ee=G*j,Re=G*Z,Fe=A[0],Ne=A[1],je=A[2],Xe=M[0],Ue=M[1],it=M[2],dt=(1-(ge+Te))*Fe,Qe=(ce+Re)*Fe,Rt=(pe-Ee)*Fe,Pt=(ce-Re)*Ne,wt=(1-(X+Te))*Ne,gt=(fe+_e)*Ne,Jt=(pe+Ee)*je,Dt=(fe-_e)*je,jt=(1-(X+ge))*je;return v[0]=dt,v[1]=Qe,v[2]=Rt,v[3]=0,v[4]=Pt,v[5]=wt,v[6]=gt,v[7]=0,v[8]=Jt,v[9]=Dt,v[10]=jt,v[11]=0,v[12]=P[0]+Xe-(dt*Xe+Pt*Ue+Jt*it),v[13]=P[1]+Ue-(Qe*Xe+wt*Ue+Dt*it),v[14]=P[2]+it-(Rt*Xe+gt*Ue+jt*it),v[15]=1,v},Ae.fromQuat=function(v,S){var P=S[0],A=S[1],M=S[2],k=S[3],R=P+P,N=A+A,G=M+M,W=P*R,j=A*R,Z=A*N,X=M*R,ce=M*N,pe=M*G,ge=k*R,fe=k*N,Te=k*G;return v[0]=1-Z-pe,v[1]=j+Te,v[2]=X-fe,v[3]=0,v[4]=j-Te,v[5]=1-W-pe,v[6]=ce+ge,v[7]=0,v[8]=X+fe,v[9]=ce-ge,v[10]=1-W-Z,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ae.frustum=function(v,S,P,A,M,k,R){var N=1/(P-S),G=1/(M-A),W=1/(k-R);return v[0]=2*k*N,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*k*G,v[6]=0,v[7]=0,v[8]=(P+S)*N,v[9]=(M+A)*G,v[10]=(R+k)*W,v[11]=-1,v[12]=0,v[13]=0,v[14]=R*k*2*W,v[15]=0,v},Ae.perspectiveNO=b,Ae.perspectiveZO=function(v,S,P,A,M){var k,R=1/Math.tan(S/2);return v[0]=R/P,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=R,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,M!=null&&M!==1/0?(v[10]=M*(k=1/(A-M)),v[14]=M*A*k):(v[10]=-1,v[14]=-A),v},Ae.perspectiveFromFieldOfView=function(v,S,P,A){var M=Math.tan(S.upDegrees*Math.PI/180),k=Math.tan(S.downDegrees*Math.PI/180),R=Math.tan(S.leftDegrees*Math.PI/180),N=Math.tan(S.rightDegrees*Math.PI/180),G=2/(R+N),W=2/(M+k);return v[0]=G,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=W,v[6]=0,v[7]=0,v[8]=-(R-N)*G*.5,v[9]=(M-k)*W*.5,v[10]=A/(P-A),v[11]=-1,v[12]=0,v[13]=0,v[14]=A*P/(P-A),v[15]=0,v},Ae.orthoNO=E,Ae.orthoZO=function(v,S,P,A,M,k,R){var N=1/(S-P),G=1/(A-M),W=1/(k-R);return v[0]=-2*N,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*G,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=W,v[11]=0,v[12]=(S+P)*N,v[13]=(M+A)*G,v[14]=k*W,v[15]=1,v},Ae.lookAt=function(v,S,P,A){var M,k,R,N,G,W,j,Z,X,ce,pe=S[0],ge=S[1],fe=S[2],Te=A[0],_e=A[1],Ee=A[2],Re=P[0],Fe=P[1],Ne=P[2];return Math.abs(pe-Re)<r.EPSILON&&Math.abs(ge-Fe)<r.EPSILON&&Math.abs(fe-Ne)<r.EPSILON?u(v):(j=pe-Re,Z=ge-Fe,X=fe-Ne,M=_e*(X*=ce=1/Math.hypot(j,Z,X))-Ee*(Z*=ce),k=Ee*(j*=ce)-Te*X,R=Te*Z-_e*j,(ce=Math.hypot(M,k,R))?(M*=ce=1/ce,k*=ce,R*=ce):(M=0,k=0,R=0),N=Z*R-X*k,G=X*M-j*R,W=j*k-Z*M,(ce=Math.hypot(N,G,W))?(N*=ce=1/ce,G*=ce,W*=ce):(N=0,G=0,W=0),v[0]=M,v[1]=N,v[2]=j,v[3]=0,v[4]=k,v[5]=G,v[6]=Z,v[7]=0,v[8]=R,v[9]=W,v[10]=X,v[11]=0,v[12]=-(M*pe+k*ge+R*fe),v[13]=-(N*pe+G*ge+W*fe),v[14]=-(j*pe+Z*ge+X*fe),v[15]=1,v)},Ae.targetTo=function(v,S,P,A){var M=S[0],k=S[1],R=S[2],N=A[0],G=A[1],W=A[2],j=M-P[0],Z=k-P[1],X=R-P[2],ce=j*j+Z*Z+X*X;ce>0&&(j*=ce=1/Math.sqrt(ce),Z*=ce,X*=ce);var pe=G*X-W*Z,ge=W*j-N*X,fe=N*Z-G*j;return(ce=pe*pe+ge*ge+fe*fe)>0&&(pe*=ce=1/Math.sqrt(ce),ge*=ce,fe*=ce),v[0]=pe,v[1]=ge,v[2]=fe,v[3]=0,v[4]=Z*fe-X*ge,v[5]=X*pe-j*fe,v[6]=j*ge-Z*pe,v[7]=0,v[8]=j,v[9]=Z,v[10]=X,v[11]=0,v[12]=M,v[13]=k,v[14]=R,v[15]=1,v},Ae.str=function(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},Ae.frob=function(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},Ae.add=function(v,S,P){return v[0]=S[0]+P[0],v[1]=S[1]+P[1],v[2]=S[2]+P[2],v[3]=S[3]+P[3],v[4]=S[4]+P[4],v[5]=S[5]+P[5],v[6]=S[6]+P[6],v[7]=S[7]+P[7],v[8]=S[8]+P[8],v[9]=S[9]+P[9],v[10]=S[10]+P[10],v[11]=S[11]+P[11],v[12]=S[12]+P[12],v[13]=S[13]+P[13],v[14]=S[14]+P[14],v[15]=S[15]+P[15],v},Ae.subtract=I,Ae.multiplyScalar=function(v,S,P){return v[0]=S[0]*P,v[1]=S[1]*P,v[2]=S[2]*P,v[3]=S[3]*P,v[4]=S[4]*P,v[5]=S[5]*P,v[6]=S[6]*P,v[7]=S[7]*P,v[8]=S[8]*P,v[9]=S[9]*P,v[10]=S[10]*P,v[11]=S[11]*P,v[12]=S[12]*P,v[13]=S[13]*P,v[14]=S[14]*P,v[15]=S[15]*P,v},Ae.multiplyScalarAndAdd=function(v,S,P,A){return v[0]=S[0]+P[0]*A,v[1]=S[1]+P[1]*A,v[2]=S[2]+P[2]*A,v[3]=S[3]+P[3]*A,v[4]=S[4]+P[4]*A,v[5]=S[5]+P[5]*A,v[6]=S[6]+P[6]*A,v[7]=S[7]+P[7]*A,v[8]=S[8]+P[8]*A,v[9]=S[9]+P[9]*A,v[10]=S[10]+P[10]*A,v[11]=S[11]+P[11]*A,v[12]=S[12]+P[12]*A,v[13]=S[13]+P[13]*A,v[14]=S[14]+P[14]*A,v[15]=S[15]+P[15]*A,v},Ae.exactEquals=function(v,S){return v[0]===S[0]&&v[1]===S[1]&&v[2]===S[2]&&v[3]===S[3]&&v[4]===S[4]&&v[5]===S[5]&&v[6]===S[6]&&v[7]===S[7]&&v[8]===S[8]&&v[9]===S[9]&&v[10]===S[10]&&v[11]===S[11]&&v[12]===S[12]&&v[13]===S[13]&&v[14]===S[14]&&v[15]===S[15]},Ae.equals=function(v,S){var P=v[0],A=v[1],M=v[2],k=v[3],R=v[4],N=v[5],G=v[6],W=v[7],j=v[8],Z=v[9],X=v[10],ce=v[11],pe=v[12],ge=v[13],fe=v[14],Te=v[15],_e=S[0],Ee=S[1],Re=S[2],Fe=S[3],Ne=S[4],je=S[5],Xe=S[6],Ue=S[7],it=S[8],dt=S[9],Qe=S[10],Rt=S[11],Pt=S[12],wt=S[13],gt=S[14],Jt=S[15];return Math.abs(P-_e)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(_e))&&Math.abs(A-Ee)<=r.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ee))&&Math.abs(M-Re)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(Re))&&Math.abs(k-Fe)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(Fe))&&Math.abs(R-Ne)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ne))&&Math.abs(N-je)<=r.EPSILON*Math.max(1,Math.abs(N),Math.abs(je))&&Math.abs(G-Xe)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(Xe))&&Math.abs(W-Ue)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ue))&&Math.abs(j-it)<=r.EPSILON*Math.max(1,Math.abs(j),Math.abs(it))&&Math.abs(Z-dt)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(dt))&&Math.abs(X-Qe)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(Qe))&&Math.abs(ce-Rt)<=r.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Rt))&&Math.abs(pe-Pt)<=r.EPSILON*Math.max(1,Math.abs(pe),Math.abs(Pt))&&Math.abs(ge-wt)<=r.EPSILON*Math.max(1,Math.abs(ge),Math.abs(wt))&&Math.abs(fe-gt)<=r.EPSILON*Math.max(1,Math.abs(fe),Math.abs(gt))&&Math.abs(Te-Jt)<=r.EPSILON*Math.max(1,Math.abs(Te),Math.abs(Jt))},Ae.sub=Ae.mul=Ae.ortho=Ae.perspective=void 0;var r=function(v,S){if(v&&v.__esModule)return v;if(v===null||c(v)!=="object"&&typeof v!="function")return{default:v};var P=s(void 0);if(P&&P.has(v))return P.get(v);var A={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in v)if(k!=="default"&&Object.prototype.hasOwnProperty.call(v,k)){var R=M?Object.getOwnPropertyDescriptor(v,k):null;R&&(R.get||R.set)?Object.defineProperty(A,k,R):A[k]=v[k]}return A.default=v,P&&P.set(v,A),A}(Y());function s(v){if(typeof WeakMap!="function")return null;var S=new WeakMap,P=new WeakMap;return(s=function(A){return A?P:S})(v)}function u(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function m(v,S,P){var A=S[0],M=S[1],k=S[2],R=S[3],N=S[4],G=S[5],W=S[6],j=S[7],Z=S[8],X=S[9],ce=S[10],pe=S[11],ge=S[12],fe=S[13],Te=S[14],_e=S[15],Ee=P[0],Re=P[1],Fe=P[2],Ne=P[3];return v[0]=Ee*A+Re*N+Fe*Z+Ne*ge,v[1]=Ee*M+Re*G+Fe*X+Ne*fe,v[2]=Ee*k+Re*W+Fe*ce+Ne*Te,v[3]=Ee*R+Re*j+Fe*pe+Ne*_e,v[4]=(Ee=P[4])*A+(Re=P[5])*N+(Fe=P[6])*Z+(Ne=P[7])*ge,v[5]=Ee*M+Re*G+Fe*X+Ne*fe,v[6]=Ee*k+Re*W+Fe*ce+Ne*Te,v[7]=Ee*R+Re*j+Fe*pe+Ne*_e,v[8]=(Ee=P[8])*A+(Re=P[9])*N+(Fe=P[10])*Z+(Ne=P[11])*ge,v[9]=Ee*M+Re*G+Fe*X+Ne*fe,v[10]=Ee*k+Re*W+Fe*ce+Ne*Te,v[11]=Ee*R+Re*j+Fe*pe+Ne*_e,v[12]=(Ee=P[12])*A+(Re=P[13])*N+(Fe=P[14])*Z+(Ne=P[15])*ge,v[13]=Ee*M+Re*G+Fe*X+Ne*fe,v[14]=Ee*k+Re*W+Fe*ce+Ne*Te,v[15]=Ee*R+Re*j+Fe*pe+Ne*_e,v}function h(v,S,P){var A=S[0],M=S[1],k=S[2],R=S[3],N=A+A,G=M+M,W=k+k,j=A*N,Z=A*G,X=A*W,ce=M*G,pe=M*W,ge=k*W,fe=R*N,Te=R*G,_e=R*W;return v[0]=1-(ce+ge),v[1]=Z+_e,v[2]=X-Te,v[3]=0,v[4]=Z-_e,v[5]=1-(j+ge),v[6]=pe+fe,v[7]=0,v[8]=X+Te,v[9]=pe-fe,v[10]=1-(j+ce),v[11]=0,v[12]=P[0],v[13]=P[1],v[14]=P[2],v[15]=1,v}function g(v,S){var P=S[4],A=S[5],M=S[6],k=S[8],R=S[9],N=S[10];return v[0]=Math.hypot(S[0],S[1],S[2]),v[1]=Math.hypot(P,A,M),v[2]=Math.hypot(k,R,N),v}function b(v,S,P,A,M){var k,R=1/Math.tan(S/2);return v[0]=R/P,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=R,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,M!=null&&M!==1/0?(v[10]=(M+A)*(k=1/(A-M)),v[14]=2*M*A*k):(v[10]=-1,v[14]=-2*A),v}function E(v,S,P,A,M,k,R){var N=1/(S-P),G=1/(A-M),W=1/(k-R);return v[0]=-2*N,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*G,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*W,v[11]=0,v[12]=(S+P)*N,v[13]=(M+A)*G,v[14]=(R+k)*W,v[15]=1,v}function I(v,S,P){return v[0]=S[0]-P[0],v[1]=S[1]-P[1],v[2]=S[2]-P[2],v[3]=S[3]-P[3],v[4]=S[4]-P[4],v[5]=S[5]-P[5],v[6]=S[6]-P[6],v[7]=S[7]-P[7],v[8]=S[8]-P[8],v[9]=S[9]-P[9],v[10]=S[10]-P[10],v[11]=S[11]-P[11],v[12]=S[12]-P[12],v[13]=S[13]-P[13],v[14]=S[14]-P[14],v[15]=S[15]-P[15],v}return Ae.perspective=b,Ae.ortho=E,Ae.mul=m,Ae.sub=I,Ae}var st,We={},He={};function At(){if(st)return He;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},c(M)}st=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=u,He.clone=function(M){var k=new r.ARRAY_TYPE(3);return k[0]=M[0],k[1]=M[1],k[2]=M[2],k},He.length=m,He.fromValues=function(M,k,R){var N=new r.ARRAY_TYPE(3);return N[0]=M,N[1]=k,N[2]=R,N},He.copy=function(M,k){return M[0]=k[0],M[1]=k[1],M[2]=k[2],M},He.set=function(M,k,R,N){return M[0]=k,M[1]=R,M[2]=N,M},He.add=function(M,k,R){return M[0]=k[0]+R[0],M[1]=k[1]+R[1],M[2]=k[2]+R[2],M},He.subtract=h,He.multiply=g,He.divide=b,He.ceil=function(M,k){return M[0]=Math.ceil(k[0]),M[1]=Math.ceil(k[1]),M[2]=Math.ceil(k[2]),M},He.floor=function(M,k){return M[0]=Math.floor(k[0]),M[1]=Math.floor(k[1]),M[2]=Math.floor(k[2]),M},He.min=function(M,k,R){return M[0]=Math.min(k[0],R[0]),M[1]=Math.min(k[1],R[1]),M[2]=Math.min(k[2],R[2]),M},He.max=function(M,k,R){return M[0]=Math.max(k[0],R[0]),M[1]=Math.max(k[1],R[1]),M[2]=Math.max(k[2],R[2]),M},He.round=function(M,k){return M[0]=Math.round(k[0]),M[1]=Math.round(k[1]),M[2]=Math.round(k[2]),M},He.scale=function(M,k,R){return M[0]=k[0]*R,M[1]=k[1]*R,M[2]=k[2]*R,M},He.scaleAndAdd=function(M,k,R,N){return M[0]=k[0]+R[0]*N,M[1]=k[1]+R[1]*N,M[2]=k[2]+R[2]*N,M},He.distance=E,He.squaredDistance=I,He.squaredLength=v,He.negate=function(M,k){return M[0]=-k[0],M[1]=-k[1],M[2]=-k[2],M},He.inverse=function(M,k){return M[0]=1/k[0],M[1]=1/k[1],M[2]=1/k[2],M},He.normalize=function(M,k){var R=k[0],N=k[1],G=k[2],W=R*R+N*N+G*G;return W>0&&(W=1/Math.sqrt(W)),M[0]=k[0]*W,M[1]=k[1]*W,M[2]=k[2]*W,M},He.dot=S,He.cross=function(M,k,R){var N=k[0],G=k[1],W=k[2],j=R[0],Z=R[1],X=R[2];return M[0]=G*X-W*Z,M[1]=W*j-N*X,M[2]=N*Z-G*j,M},He.lerp=function(M,k,R,N){var G=k[0],W=k[1],j=k[2];return M[0]=G+N*(R[0]-G),M[1]=W+N*(R[1]-W),M[2]=j+N*(R[2]-j),M},He.hermite=function(M,k,R,N,G,W){var j=W*W,Z=j*(2*W-3)+1,X=j*(W-2)+W,ce=j*(W-1),pe=j*(3-2*W);return M[0]=k[0]*Z+R[0]*X+N[0]*ce+G[0]*pe,M[1]=k[1]*Z+R[1]*X+N[1]*ce+G[1]*pe,M[2]=k[2]*Z+R[2]*X+N[2]*ce+G[2]*pe,M},He.bezier=function(M,k,R,N,G,W){var j=1-W,Z=j*j,X=W*W,ce=Z*j,pe=3*W*Z,ge=3*X*j,fe=X*W;return M[0]=k[0]*ce+R[0]*pe+N[0]*ge+G[0]*fe,M[1]=k[1]*ce+R[1]*pe+N[1]*ge+G[1]*fe,M[2]=k[2]*ce+R[2]*pe+N[2]*ge+G[2]*fe,M},He.random=function(M,k){k=k||1;var R=2*r.RANDOM()*Math.PI,N=2*r.RANDOM()-1,G=Math.sqrt(1-N*N)*k;return M[0]=Math.cos(R)*G,M[1]=Math.sin(R)*G,M[2]=N*k,M},He.transformMat4=function(M,k,R){var N=k[0],G=k[1],W=k[2],j=R[3]*N+R[7]*G+R[11]*W+R[15];return M[0]=(R[0]*N+R[4]*G+R[8]*W+R[12])/(j=j||1),M[1]=(R[1]*N+R[5]*G+R[9]*W+R[13])/j,M[2]=(R[2]*N+R[6]*G+R[10]*W+R[14])/j,M},He.transformMat3=function(M,k,R){var N=k[0],G=k[1],W=k[2];return M[0]=N*R[0]+G*R[3]+W*R[6],M[1]=N*R[1]+G*R[4]+W*R[7],M[2]=N*R[2]+G*R[5]+W*R[8],M},He.transformQuat=function(M,k,R){var N=R[0],G=R[1],W=R[2],j=k[0],Z=k[1],X=k[2],ce=G*X-W*Z,pe=W*j-N*X,ge=N*Z-G*j,fe=G*ge-W*pe,Te=W*ce-N*ge,_e=N*pe-G*ce,Ee=2*R[3];return pe*=Ee,ge*=Ee,Te*=2,_e*=2,M[0]=j+(ce*=Ee)+(fe*=2),M[1]=Z+pe+Te,M[2]=X+ge+_e,M},He.rotateX=function(M,k,R,N){var G=[],W=[];return G[0]=k[0]-R[0],G[1]=k[1]-R[1],G[2]=k[2]-R[2],W[0]=G[0],W[1]=G[1]*Math.cos(N)-G[2]*Math.sin(N),W[2]=G[1]*Math.sin(N)+G[2]*Math.cos(N),M[0]=W[0]+R[0],M[1]=W[1]+R[1],M[2]=W[2]+R[2],M},He.rotateY=function(M,k,R,N){var G=[],W=[];return G[0]=k[0]-R[0],G[1]=k[1]-R[1],G[2]=k[2]-R[2],W[0]=G[2]*Math.sin(N)+G[0]*Math.cos(N),W[1]=G[1],W[2]=G[2]*Math.cos(N)-G[0]*Math.sin(N),M[0]=W[0]+R[0],M[1]=W[1]+R[1],M[2]=W[2]+R[2],M},He.rotateZ=function(M,k,R,N){var G=[],W=[];return G[0]=k[0]-R[0],G[1]=k[1]-R[1],G[2]=k[2]-R[2],W[0]=G[0]*Math.cos(N)-G[1]*Math.sin(N),W[1]=G[0]*Math.sin(N)+G[1]*Math.cos(N),W[2]=G[2],M[0]=W[0]+R[0],M[1]=W[1]+R[1],M[2]=W[2]+R[2],M},He.angle=function(M,k){var R=M[0],N=M[1],G=M[2],W=k[0],j=k[1],Z=k[2],X=Math.sqrt(R*R+N*N+G*G)*Math.sqrt(W*W+j*j+Z*Z),ce=X&&S(M,k)/X;return Math.acos(Math.min(Math.max(ce,-1),1))},He.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},He.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},He.exactEquals=function(M,k){return M[0]===k[0]&&M[1]===k[1]&&M[2]===k[2]},He.equals=function(M,k){var R=M[0],N=M[1],G=M[2],W=k[0],j=k[1],Z=k[2];return Math.abs(R-W)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(W))&&Math.abs(N-j)<=r.EPSILON*Math.max(1,Math.abs(N),Math.abs(j))&&Math.abs(G-Z)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(Z))},He.forEach=He.sqrLen=He.len=He.sqrDist=He.dist=He.div=He.mul=He.sub=void 0;var r=function(M,k){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=s(void 0);if(R&&R.has(M))return R.get(M);var N={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in M)if(W!=="default"&&Object.prototype.hasOwnProperty.call(M,W)){var j=G?Object.getOwnPropertyDescriptor(M,W):null;j&&(j.get||j.set)?Object.defineProperty(N,W,j):N[W]=M[W]}return N.default=M,R&&R.set(M,N),N}(Y());function s(M){if(typeof WeakMap!="function")return null;var k=new WeakMap,R=new WeakMap;return(s=function(N){return N?R:k})(M)}function u(){var M=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function m(M){return Math.hypot(M[0],M[1],M[2])}function h(M,k,R){return M[0]=k[0]-R[0],M[1]=k[1]-R[1],M[2]=k[2]-R[2],M}function g(M,k,R){return M[0]=k[0]*R[0],M[1]=k[1]*R[1],M[2]=k[2]*R[2],M}function b(M,k,R){return M[0]=k[0]/R[0],M[1]=k[1]/R[1],M[2]=k[2]/R[2],M}function E(M,k){return Math.hypot(k[0]-M[0],k[1]-M[1],k[2]-M[2])}function I(M,k){var R=k[0]-M[0],N=k[1]-M[1],G=k[2]-M[2];return R*R+N*N+G*G}function v(M){var k=M[0],R=M[1],N=M[2];return k*k+R*R+N*N}function S(M,k){return M[0]*k[0]+M[1]*k[1]+M[2]*k[2]}He.sub=h,He.mul=g,He.div=b,He.dist=E,He.sqrDist=I,He.len=m,He.sqrLen=v;var P,A=(P=u(),function(M,k,R,N,G,W){var j,Z;for(k||(k=3),R||(R=0),Z=N?Math.min(N*k+R,M.length):M.length,j=R;j<Z;j+=k)P[0]=M[j],P[1]=M[j+1],P[2]=M[j+2],G(P,P,W),M[j]=P[0],M[j+1]=P[1],M[j+2]=P[2];return M});return He.forEach=A,He}var Tt,kt,ct={};function Ot(){if(Tt)return ct;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(A)}Tt=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=u,ct.clone=function(A){var M=new r.ARRAY_TYPE(4);return M[0]=A[0],M[1]=A[1],M[2]=A[2],M[3]=A[3],M},ct.fromValues=function(A,M,k,R){var N=new r.ARRAY_TYPE(4);return N[0]=A,N[1]=M,N[2]=k,N[3]=R,N},ct.copy=function(A,M){return A[0]=M[0],A[1]=M[1],A[2]=M[2],A[3]=M[3],A},ct.set=function(A,M,k,R,N){return A[0]=M,A[1]=k,A[2]=R,A[3]=N,A},ct.add=function(A,M,k){return A[0]=M[0]+k[0],A[1]=M[1]+k[1],A[2]=M[2]+k[2],A[3]=M[3]+k[3],A},ct.subtract=m,ct.multiply=h,ct.divide=g,ct.ceil=function(A,M){return A[0]=Math.ceil(M[0]),A[1]=Math.ceil(M[1]),A[2]=Math.ceil(M[2]),A[3]=Math.ceil(M[3]),A},ct.floor=function(A,M){return A[0]=Math.floor(M[0]),A[1]=Math.floor(M[1]),A[2]=Math.floor(M[2]),A[3]=Math.floor(M[3]),A},ct.min=function(A,M,k){return A[0]=Math.min(M[0],k[0]),A[1]=Math.min(M[1],k[1]),A[2]=Math.min(M[2],k[2]),A[3]=Math.min(M[3],k[3]),A},ct.max=function(A,M,k){return A[0]=Math.max(M[0],k[0]),A[1]=Math.max(M[1],k[1]),A[2]=Math.max(M[2],k[2]),A[3]=Math.max(M[3],k[3]),A},ct.round=function(A,M){return A[0]=Math.round(M[0]),A[1]=Math.round(M[1]),A[2]=Math.round(M[2]),A[3]=Math.round(M[3]),A},ct.scale=function(A,M,k){return A[0]=M[0]*k,A[1]=M[1]*k,A[2]=M[2]*k,A[3]=M[3]*k,A},ct.scaleAndAdd=function(A,M,k,R){return A[0]=M[0]+k[0]*R,A[1]=M[1]+k[1]*R,A[2]=M[2]+k[2]*R,A[3]=M[3]+k[3]*R,A},ct.distance=b,ct.squaredDistance=E,ct.length=I,ct.squaredLength=v,ct.negate=function(A,M){return A[0]=-M[0],A[1]=-M[1],A[2]=-M[2],A[3]=-M[3],A},ct.inverse=function(A,M){return A[0]=1/M[0],A[1]=1/M[1],A[2]=1/M[2],A[3]=1/M[3],A},ct.normalize=function(A,M){var k=M[0],R=M[1],N=M[2],G=M[3],W=k*k+R*R+N*N+G*G;return W>0&&(W=1/Math.sqrt(W)),A[0]=k*W,A[1]=R*W,A[2]=N*W,A[3]=G*W,A},ct.dot=function(A,M){return A[0]*M[0]+A[1]*M[1]+A[2]*M[2]+A[3]*M[3]},ct.cross=function(A,M,k,R){var N=k[0]*R[1]-k[1]*R[0],G=k[0]*R[2]-k[2]*R[0],W=k[0]*R[3]-k[3]*R[0],j=k[1]*R[2]-k[2]*R[1],Z=k[1]*R[3]-k[3]*R[1],X=k[2]*R[3]-k[3]*R[2],ce=M[0],pe=M[1],ge=M[2],fe=M[3];return A[0]=pe*X-ge*Z+fe*j,A[1]=-ce*X+ge*W-fe*G,A[2]=ce*Z-pe*W+fe*N,A[3]=-ce*j+pe*G-ge*N,A},ct.lerp=function(A,M,k,R){var N=M[0],G=M[1],W=M[2],j=M[3];return A[0]=N+R*(k[0]-N),A[1]=G+R*(k[1]-G),A[2]=W+R*(k[2]-W),A[3]=j+R*(k[3]-j),A},ct.random=function(A,M){var k,R,N,G,W,j;M=M||1;do W=(k=2*r.RANDOM()-1)*k+(R=2*r.RANDOM()-1)*R;while(W>=1);do j=(N=2*r.RANDOM()-1)*N+(G=2*r.RANDOM()-1)*G;while(j>=1);var Z=Math.sqrt((1-W)/j);return A[0]=M*k,A[1]=M*R,A[2]=M*N*Z,A[3]=M*G*Z,A},ct.transformMat4=function(A,M,k){var R=M[0],N=M[1],G=M[2],W=M[3];return A[0]=k[0]*R+k[4]*N+k[8]*G+k[12]*W,A[1]=k[1]*R+k[5]*N+k[9]*G+k[13]*W,A[2]=k[2]*R+k[6]*N+k[10]*G+k[14]*W,A[3]=k[3]*R+k[7]*N+k[11]*G+k[15]*W,A},ct.transformQuat=function(A,M,k){var R=M[0],N=M[1],G=M[2],W=k[0],j=k[1],Z=k[2],X=k[3],ce=X*R+j*G-Z*N,pe=X*N+Z*R-W*G,ge=X*G+W*N-j*R,fe=-W*R-j*N-Z*G;return A[0]=ce*X+fe*-W+pe*-Z-ge*-j,A[1]=pe*X+fe*-j+ge*-W-ce*-Z,A[2]=ge*X+fe*-Z+ce*-j-pe*-W,A[3]=M[3],A},ct.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},ct.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},ct.exactEquals=function(A,M){return A[0]===M[0]&&A[1]===M[1]&&A[2]===M[2]&&A[3]===M[3]},ct.equals=function(A,M){var k=A[0],R=A[1],N=A[2],G=A[3],W=M[0],j=M[1],Z=M[2],X=M[3];return Math.abs(k-W)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(W))&&Math.abs(R-j)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(j))&&Math.abs(N-Z)<=r.EPSILON*Math.max(1,Math.abs(N),Math.abs(Z))&&Math.abs(G-X)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(X))},ct.forEach=ct.sqrLen=ct.len=ct.sqrDist=ct.dist=ct.div=ct.mul=ct.sub=void 0;var r=function(A,M){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var k=s(void 0);if(k&&k.has(A))return k.get(A);var R={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var W=N?Object.getOwnPropertyDescriptor(A,G):null;W&&(W.get||W.set)?Object.defineProperty(R,G,W):R[G]=A[G]}return R.default=A,k&&k.set(A,R),R}(Y());function s(A){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(s=function(R){return R?k:M})(A)}function u(){var A=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function m(A,M,k){return A[0]=M[0]-k[0],A[1]=M[1]-k[1],A[2]=M[2]-k[2],A[3]=M[3]-k[3],A}function h(A,M,k){return A[0]=M[0]*k[0],A[1]=M[1]*k[1],A[2]=M[2]*k[2],A[3]=M[3]*k[3],A}function g(A,M,k){return A[0]=M[0]/k[0],A[1]=M[1]/k[1],A[2]=M[2]/k[2],A[3]=M[3]/k[3],A}function b(A,M){return Math.hypot(M[0]-A[0],M[1]-A[1],M[2]-A[2],M[3]-A[3])}function E(A,M){var k=M[0]-A[0],R=M[1]-A[1],N=M[2]-A[2],G=M[3]-A[3];return k*k+R*R+N*N+G*G}function I(A){return Math.hypot(A[0],A[1],A[2],A[3])}function v(A){var M=A[0],k=A[1],R=A[2],N=A[3];return M*M+k*k+R*R+N*N}ct.sub=m,ct.mul=h,ct.div=g,ct.dist=b,ct.sqrDist=E,ct.len=I,ct.sqrLen=v;var S,P=(S=u(),function(A,M,k,R,N,G){var W,j;for(M||(M=4),k||(k=0),j=R?Math.min(R*M+k,A.length):A.length,W=k;W<j;W+=M)S[0]=A[W],S[1]=A[W+1],S[2]=A[W+2],S[3]=A[W+3],N(S,S,G),A[W]=S[0],A[W+1]=S[1],A[W+2]=S[2],A[W+3]=S[3];return A});return ct.forEach=P,ct}function mt(){if(kt)return We;function c(_e){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ee){return typeof Ee}:function(Ee){return Ee&&typeof Symbol=="function"&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee},c(_e)}kt=1,Object.defineProperty(We,"__esModule",{value:!0}),We.create=b,We.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},We.setAxisAngle=E,We.getAxisAngle=function(_e,Ee){var Re=2*Math.acos(Ee[3]),Fe=Math.sin(Re/2);return Fe>r.EPSILON?(_e[0]=Ee[0]/Fe,_e[1]=Ee[1]/Fe,_e[2]=Ee[2]/Fe):(_e[0]=1,_e[1]=0,_e[2]=0),Re},We.getAngle=function(_e,Ee){var Re=k(_e,Ee);return Math.acos(2*Re*Re-1)},We.multiply=I,We.rotateX=function(_e,Ee,Re){Re*=.5;var Fe=Ee[0],Ne=Ee[1],je=Ee[2],Xe=Ee[3],Ue=Math.sin(Re),it=Math.cos(Re);return _e[0]=Fe*it+Xe*Ue,_e[1]=Ne*it+je*Ue,_e[2]=je*it-Ne*Ue,_e[3]=Xe*it-Fe*Ue,_e},We.rotateY=function(_e,Ee,Re){Re*=.5;var Fe=Ee[0],Ne=Ee[1],je=Ee[2],Xe=Ee[3],Ue=Math.sin(Re),it=Math.cos(Re);return _e[0]=Fe*it-je*Ue,_e[1]=Ne*it+Xe*Ue,_e[2]=je*it+Fe*Ue,_e[3]=Xe*it-Ne*Ue,_e},We.rotateZ=function(_e,Ee,Re){Re*=.5;var Fe=Ee[0],Ne=Ee[1],je=Ee[2],Xe=Ee[3],Ue=Math.sin(Re),it=Math.cos(Re);return _e[0]=Fe*it+Ne*Ue,_e[1]=Ne*it-Fe*Ue,_e[2]=je*it+Xe*Ue,_e[3]=Xe*it-je*Ue,_e},We.calculateW=function(_e,Ee){var Re=Ee[0],Fe=Ee[1],Ne=Ee[2];return _e[0]=Re,_e[1]=Fe,_e[2]=Ne,_e[3]=Math.sqrt(Math.abs(1-Re*Re-Fe*Fe-Ne*Ne)),_e},We.exp=v,We.ln=S,We.pow=function(_e,Ee,Re){return S(_e,Ee),M(_e,_e,Re),v(_e,_e),_e},We.slerp=P,We.random=function(_e){var Ee=r.RANDOM(),Re=r.RANDOM(),Fe=r.RANDOM(),Ne=Math.sqrt(1-Ee),je=Math.sqrt(Ee);return _e[0]=Ne*Math.sin(2*Math.PI*Re),_e[1]=Ne*Math.cos(2*Math.PI*Re),_e[2]=je*Math.sin(2*Math.PI*Fe),_e[3]=je*Math.cos(2*Math.PI*Fe),_e},We.invert=function(_e,Ee){var Re=Ee[0],Fe=Ee[1],Ne=Ee[2],je=Ee[3],Xe=Re*Re+Fe*Fe+Ne*Ne+je*je,Ue=Xe?1/Xe:0;return _e[0]=-Re*Ue,_e[1]=-Fe*Ue,_e[2]=-Ne*Ue,_e[3]=je*Ue,_e},We.conjugate=function(_e,Ee){return _e[0]=-Ee[0],_e[1]=-Ee[1],_e[2]=-Ee[2],_e[3]=Ee[3],_e},We.fromMat3=A,We.fromEuler=function(_e,Ee,Re,Fe){var Ne=.5*Math.PI/180;Ee*=Ne,Re*=Ne,Fe*=Ne;var je=Math.sin(Ee),Xe=Math.cos(Ee),Ue=Math.sin(Re),it=Math.cos(Re),dt=Math.sin(Fe),Qe=Math.cos(Fe);return _e[0]=je*it*Qe-Xe*Ue*dt,_e[1]=Xe*Ue*Qe+je*it*dt,_e[2]=Xe*it*dt-je*Ue*Qe,_e[3]=Xe*it*Qe+je*Ue*dt,_e},We.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},We.setAxes=We.sqlerp=We.rotationTo=We.equals=We.exactEquals=We.normalize=We.sqrLen=We.squaredLength=We.len=We.length=We.lerp=We.dot=We.scale=We.mul=We.add=We.set=We.copy=We.fromValues=We.clone=void 0;var r=g(Y()),s=g(be()),u=g(At()),m=g(Ot());function h(_e){if(typeof WeakMap!="function")return null;var Ee=new WeakMap,Re=new WeakMap;return(h=function(Fe){return Fe?Re:Ee})(_e)}function g(_e,Ee){if(_e&&_e.__esModule)return _e;if(_e===null||c(_e)!=="object"&&typeof _e!="function")return{default:_e};var Re=h(Ee);if(Re&&Re.has(_e))return Re.get(_e);var Fe={},Ne=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var je in _e)if(je!=="default"&&Object.prototype.hasOwnProperty.call(_e,je)){var Xe=Ne?Object.getOwnPropertyDescriptor(_e,je):null;Xe&&(Xe.get||Xe.set)?Object.defineProperty(Fe,je,Xe):Fe[je]=_e[je]}return Fe.default=_e,Re&&Re.set(_e,Fe),Fe}function b(){var _e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function E(_e,Ee,Re){Re*=.5;var Fe=Math.sin(Re);return _e[0]=Fe*Ee[0],_e[1]=Fe*Ee[1],_e[2]=Fe*Ee[2],_e[3]=Math.cos(Re),_e}function I(_e,Ee,Re){var Fe=Ee[0],Ne=Ee[1],je=Ee[2],Xe=Ee[3],Ue=Re[0],it=Re[1],dt=Re[2],Qe=Re[3];return _e[0]=Fe*Qe+Xe*Ue+Ne*dt-je*it,_e[1]=Ne*Qe+Xe*it+je*Ue-Fe*dt,_e[2]=je*Qe+Xe*dt+Fe*it-Ne*Ue,_e[3]=Xe*Qe-Fe*Ue-Ne*it-je*dt,_e}function v(_e,Ee){var Re=Ee[0],Fe=Ee[1],Ne=Ee[2],je=Ee[3],Xe=Math.sqrt(Re*Re+Fe*Fe+Ne*Ne),Ue=Math.exp(je),it=Xe>0?Ue*Math.sin(Xe)/Xe:0;return _e[0]=Re*it,_e[1]=Fe*it,_e[2]=Ne*it,_e[3]=Ue*Math.cos(Xe),_e}function S(_e,Ee){var Re=Ee[0],Fe=Ee[1],Ne=Ee[2],je=Ee[3],Xe=Math.sqrt(Re*Re+Fe*Fe+Ne*Ne),Ue=Xe>0?Math.atan2(Xe,je)/Xe:0;return _e[0]=Re*Ue,_e[1]=Fe*Ue,_e[2]=Ne*Ue,_e[3]=.5*Math.log(Re*Re+Fe*Fe+Ne*Ne+je*je),_e}function P(_e,Ee,Re,Fe){var Ne,je,Xe,Ue,it,dt=Ee[0],Qe=Ee[1],Rt=Ee[2],Pt=Ee[3],wt=Re[0],gt=Re[1],Jt=Re[2],Dt=Re[3];return(je=dt*wt+Qe*gt+Rt*Jt+Pt*Dt)<0&&(je=-je,wt=-wt,gt=-gt,Jt=-Jt,Dt=-Dt),1-je>r.EPSILON?(Ne=Math.acos(je),Xe=Math.sin(Ne),Ue=Math.sin((1-Fe)*Ne)/Xe,it=Math.sin(Fe*Ne)/Xe):(Ue=1-Fe,it=Fe),_e[0]=Ue*dt+it*wt,_e[1]=Ue*Qe+it*gt,_e[2]=Ue*Rt+it*Jt,_e[3]=Ue*Pt+it*Dt,_e}function A(_e,Ee){var Re,Fe=Ee[0]+Ee[4]+Ee[8];if(Fe>0)Re=Math.sqrt(Fe+1),_e[3]=.5*Re,_e[0]=(Ee[5]-Ee[7])*(Re=.5/Re),_e[1]=(Ee[6]-Ee[2])*Re,_e[2]=(Ee[1]-Ee[3])*Re;else{var Ne=0;Ee[4]>Ee[0]&&(Ne=1),Ee[8]>Ee[3*Ne+Ne]&&(Ne=2);var je=(Ne+1)%3,Xe=(Ne+2)%3;Re=Math.sqrt(Ee[3*Ne+Ne]-Ee[3*je+je]-Ee[3*Xe+Xe]+1),_e[Ne]=.5*Re,_e[3]=(Ee[3*je+Xe]-Ee[3*Xe+je])*(Re=.5/Re),_e[je]=(Ee[3*je+Ne]+Ee[3*Ne+je])*Re,_e[Xe]=(Ee[3*Xe+Ne]+Ee[3*Ne+Xe])*Re}return _e}We.clone=m.clone,We.fromValues=m.fromValues,We.copy=m.copy,We.set=m.set,We.add=m.add,We.mul=I;var M=m.scale;We.scale=M;var k=m.dot;We.dot=k,We.lerp=m.lerp;var R=m.length;We.length=R,We.len=R;var N=m.squaredLength;We.squaredLength=N,We.sqrLen=N;var G=m.normalize;We.normalize=G,We.exactEquals=m.exactEquals,We.equals=m.equals;var W,j,Z,X=(W=u.create(),j=u.fromValues(1,0,0),Z=u.fromValues(0,1,0),function(_e,Ee,Re){var Fe=u.dot(Ee,Re);return Fe<-.999999?(u.cross(W,j,Ee),u.len(W)<1e-6&&u.cross(W,Z,Ee),u.normalize(W,W),E(_e,W,Math.PI),_e):Fe>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(u.cross(W,Ee,Re),_e[0]=W[0],_e[1]=W[1],_e[2]=W[2],_e[3]=1+Fe,G(_e,_e))});We.rotationTo=X;var ce,pe,ge=(ce=b(),pe=b(),function(_e,Ee,Re,Fe,Ne,je){return P(ce,Ee,Ne,je),P(pe,Re,Fe,je),P(_e,ce,pe,2*je*(1-je)),_e});We.sqlerp=ge;var fe,Te=(fe=s.create(),function(_e,Ee,Re,Fe){return fe[0]=Re[0],fe[3]=Re[1],fe[6]=Re[2],fe[1]=Fe[0],fe[4]=Fe[1],fe[7]=Fe[2],fe[2]=-Ee[0],fe[5]=-Ee[1],fe[8]=-Ee[2],G(_e,A(_e,fe))});return We.setAxes=Te,We}var Lt,yt={};function Zt(){if(Lt)return yt;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(P)}Lt=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.create=function(){var P=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},yt.clone=function(P){var A=new r.ARRAY_TYPE(8);return A[0]=P[0],A[1]=P[1],A[2]=P[2],A[3]=P[3],A[4]=P[4],A[5]=P[5],A[6]=P[6],A[7]=P[7],A},yt.fromValues=function(P,A,M,k,R,N,G,W){var j=new r.ARRAY_TYPE(8);return j[0]=P,j[1]=A,j[2]=M,j[3]=k,j[4]=R,j[5]=N,j[6]=G,j[7]=W,j},yt.fromRotationTranslationValues=function(P,A,M,k,R,N,G){var W=new r.ARRAY_TYPE(8);W[0]=P,W[1]=A,W[2]=M,W[3]=k;var j=.5*R,Z=.5*N,X=.5*G;return W[4]=j*k+Z*M-X*A,W[5]=Z*k+X*P-j*M,W[6]=X*k+j*A-Z*P,W[7]=-j*P-Z*A-X*M,W},yt.fromRotationTranslation=g,yt.fromTranslation=function(P,A){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*A[0],P[5]=.5*A[1],P[6]=.5*A[2],P[7]=0,P},yt.fromRotation=function(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},yt.fromMat4=function(P,A){var M=s.create();u.getRotation(M,A);var k=new r.ARRAY_TYPE(3);return u.getTranslation(k,A),g(P,M,k),P},yt.copy=b,yt.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},yt.set=function(P,A,M,k,R,N,G,W,j){return P[0]=A,P[1]=M,P[2]=k,P[3]=R,P[4]=N,P[5]=G,P[6]=W,P[7]=j,P},yt.getDual=function(P,A){return P[0]=A[4],P[1]=A[5],P[2]=A[6],P[3]=A[7],P},yt.setDual=function(P,A){return P[4]=A[0],P[5]=A[1],P[6]=A[2],P[7]=A[3],P},yt.getTranslation=function(P,A){var M=A[4],k=A[5],R=A[6],N=A[7],G=-A[0],W=-A[1],j=-A[2],Z=A[3];return P[0]=2*(M*Z+N*G+k*j-R*W),P[1]=2*(k*Z+N*W+R*G-M*j),P[2]=2*(R*Z+N*j+M*W-k*G),P},yt.translate=function(P,A,M){var k=A[0],R=A[1],N=A[2],G=A[3],W=.5*M[0],j=.5*M[1],Z=.5*M[2],X=A[4],ce=A[5],pe=A[6],ge=A[7];return P[0]=k,P[1]=R,P[2]=N,P[3]=G,P[4]=G*W+R*Z-N*j+X,P[5]=G*j+N*W-k*Z+ce,P[6]=G*Z+k*j-R*W+pe,P[7]=-k*W-R*j-N*Z+ge,P},yt.rotateX=function(P,A,M){var k=-A[0],R=-A[1],N=-A[2],G=A[3],W=A[4],j=A[5],Z=A[6],X=A[7],ce=W*G+X*k+j*N-Z*R,pe=j*G+X*R+Z*k-W*N,ge=Z*G+X*N+W*R-j*k,fe=X*G-W*k-j*R-Z*N;return s.rotateX(P,A,M),P[4]=ce*(G=P[3])+fe*(k=P[0])+pe*(N=P[2])-ge*(R=P[1]),P[5]=pe*G+fe*R+ge*k-ce*N,P[6]=ge*G+fe*N+ce*R-pe*k,P[7]=fe*G-ce*k-pe*R-ge*N,P},yt.rotateY=function(P,A,M){var k=-A[0],R=-A[1],N=-A[2],G=A[3],W=A[4],j=A[5],Z=A[6],X=A[7],ce=W*G+X*k+j*N-Z*R,pe=j*G+X*R+Z*k-W*N,ge=Z*G+X*N+W*R-j*k,fe=X*G-W*k-j*R-Z*N;return s.rotateY(P,A,M),P[4]=ce*(G=P[3])+fe*(k=P[0])+pe*(N=P[2])-ge*(R=P[1]),P[5]=pe*G+fe*R+ge*k-ce*N,P[6]=ge*G+fe*N+ce*R-pe*k,P[7]=fe*G-ce*k-pe*R-ge*N,P},yt.rotateZ=function(P,A,M){var k=-A[0],R=-A[1],N=-A[2],G=A[3],W=A[4],j=A[5],Z=A[6],X=A[7],ce=W*G+X*k+j*N-Z*R,pe=j*G+X*R+Z*k-W*N,ge=Z*G+X*N+W*R-j*k,fe=X*G-W*k-j*R-Z*N;return s.rotateZ(P,A,M),P[4]=ce*(G=P[3])+fe*(k=P[0])+pe*(N=P[2])-ge*(R=P[1]),P[5]=pe*G+fe*R+ge*k-ce*N,P[6]=ge*G+fe*N+ce*R-pe*k,P[7]=fe*G-ce*k-pe*R-ge*N,P},yt.rotateByQuatAppend=function(P,A,M){var k=M[0],R=M[1],N=M[2],G=M[3],W=A[0],j=A[1],Z=A[2],X=A[3];return P[0]=W*G+X*k+j*N-Z*R,P[1]=j*G+X*R+Z*k-W*N,P[2]=Z*G+X*N+W*R-j*k,P[3]=X*G-W*k-j*R-Z*N,P[4]=(W=A[4])*G+(X=A[7])*k+(j=A[5])*N-(Z=A[6])*R,P[5]=j*G+X*R+Z*k-W*N,P[6]=Z*G+X*N+W*R-j*k,P[7]=X*G-W*k-j*R-Z*N,P},yt.rotateByQuatPrepend=function(P,A,M){var k=A[0],R=A[1],N=A[2],G=A[3],W=M[0],j=M[1],Z=M[2],X=M[3];return P[0]=k*X+G*W+R*Z-N*j,P[1]=R*X+G*j+N*W-k*Z,P[2]=N*X+G*Z+k*j-R*W,P[3]=G*X-k*W-R*j-N*Z,P[4]=k*(X=M[7])+G*(W=M[4])+R*(Z=M[6])-N*(j=M[5]),P[5]=R*X+G*j+N*W-k*Z,P[6]=N*X+G*Z+k*j-R*W,P[7]=G*X-k*W-R*j-N*Z,P},yt.rotateAroundAxis=function(P,A,M,k){if(Math.abs(k)<r.EPSILON)return b(P,A);var R=Math.hypot(M[0],M[1],M[2]);k*=.5;var N=Math.sin(k),G=N*M[0]/R,W=N*M[1]/R,j=N*M[2]/R,Z=Math.cos(k),X=A[0],ce=A[1],pe=A[2],ge=A[3];P[0]=X*Z+ge*G+ce*j-pe*W,P[1]=ce*Z+ge*W+pe*G-X*j,P[2]=pe*Z+ge*j+X*W-ce*G,P[3]=ge*Z-X*G-ce*W-pe*j;var fe=A[4],Te=A[5],_e=A[6],Ee=A[7];return P[4]=fe*Z+Ee*G+Te*j-_e*W,P[5]=Te*Z+Ee*W+_e*G-fe*j,P[6]=_e*Z+Ee*j+fe*W-Te*G,P[7]=Ee*Z-fe*G-Te*W-_e*j,P},yt.add=function(P,A,M){return P[0]=A[0]+M[0],P[1]=A[1]+M[1],P[2]=A[2]+M[2],P[3]=A[3]+M[3],P[4]=A[4]+M[4],P[5]=A[5]+M[5],P[6]=A[6]+M[6],P[7]=A[7]+M[7],P},yt.multiply=E,yt.scale=function(P,A,M){return P[0]=A[0]*M,P[1]=A[1]*M,P[2]=A[2]*M,P[3]=A[3]*M,P[4]=A[4]*M,P[5]=A[5]*M,P[6]=A[6]*M,P[7]=A[7]*M,P},yt.lerp=function(P,A,M,k){var R=1-k;return I(A,M)<0&&(k=-k),P[0]=A[0]*R+M[0]*k,P[1]=A[1]*R+M[1]*k,P[2]=A[2]*R+M[2]*k,P[3]=A[3]*R+M[3]*k,P[4]=A[4]*R+M[4]*k,P[5]=A[5]*R+M[5]*k,P[6]=A[6]*R+M[6]*k,P[7]=A[7]*R+M[7]*k,P},yt.invert=function(P,A){var M=S(A);return P[0]=-A[0]/M,P[1]=-A[1]/M,P[2]=-A[2]/M,P[3]=A[3]/M,P[4]=-A[4]/M,P[5]=-A[5]/M,P[6]=-A[6]/M,P[7]=A[7]/M,P},yt.conjugate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P[2]=-A[2],P[3]=A[3],P[4]=-A[4],P[5]=-A[5],P[6]=-A[6],P[7]=A[7],P},yt.normalize=function(P,A){var M=S(A);if(M>0){M=Math.sqrt(M);var k=A[0]/M,R=A[1]/M,N=A[2]/M,G=A[3]/M,W=A[4],j=A[5],Z=A[6],X=A[7],ce=k*W+R*j+N*Z+G*X;P[0]=k,P[1]=R,P[2]=N,P[3]=G,P[4]=(W-k*ce)/M,P[5]=(j-R*ce)/M,P[6]=(Z-N*ce)/M,P[7]=(X-G*ce)/M}return P},yt.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},yt.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]&&P[4]===A[4]&&P[5]===A[5]&&P[6]===A[6]&&P[7]===A[7]},yt.equals=function(P,A){var M=P[0],k=P[1],R=P[2],N=P[3],G=P[4],W=P[5],j=P[6],Z=P[7],X=A[0],ce=A[1],pe=A[2],ge=A[3],fe=A[4],Te=A[5],_e=A[6],Ee=A[7];return Math.abs(M-X)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(X))&&Math.abs(k-ce)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(ce))&&Math.abs(R-pe)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(pe))&&Math.abs(N-ge)<=r.EPSILON*Math.max(1,Math.abs(N),Math.abs(ge))&&Math.abs(G-fe)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(fe))&&Math.abs(W-Te)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Te))&&Math.abs(j-_e)<=r.EPSILON*Math.max(1,Math.abs(j),Math.abs(_e))&&Math.abs(Z-Ee)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ee))},yt.sqrLen=yt.squaredLength=yt.len=yt.length=yt.dot=yt.mul=yt.setReal=yt.getReal=void 0;var r=h(Y()),s=h(mt()),u=h(ht());function m(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,M=new WeakMap;return(m=function(k){return k?M:A})(P)}function h(P,A){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var M=m(A);if(M&&M.has(P))return M.get(P);var k={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var N in P)if(N!=="default"&&Object.prototype.hasOwnProperty.call(P,N)){var G=R?Object.getOwnPropertyDescriptor(P,N):null;G&&(G.get||G.set)?Object.defineProperty(k,N,G):k[N]=P[N]}return k.default=P,M&&M.set(P,k),k}function g(P,A,M){var k=.5*M[0],R=.5*M[1],N=.5*M[2],G=A[0],W=A[1],j=A[2],Z=A[3];return P[0]=G,P[1]=W,P[2]=j,P[3]=Z,P[4]=k*Z+R*j-N*W,P[5]=R*Z+N*G-k*j,P[6]=N*Z+k*W-R*G,P[7]=-k*G-R*W-N*j,P}function b(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=A[4],P[5]=A[5],P[6]=A[6],P[7]=A[7],P}function E(P,A,M){var k=A[0],R=A[1],N=A[2],G=A[3],W=M[4],j=M[5],Z=M[6],X=M[7],ce=A[4],pe=A[5],ge=A[6],fe=A[7],Te=M[0],_e=M[1],Ee=M[2],Re=M[3];return P[0]=k*Re+G*Te+R*Ee-N*_e,P[1]=R*Re+G*_e+N*Te-k*Ee,P[2]=N*Re+G*Ee+k*_e-R*Te,P[3]=G*Re-k*Te-R*_e-N*Ee,P[4]=k*X+G*W+R*Z-N*j+ce*Re+fe*Te+pe*Ee-ge*_e,P[5]=R*X+G*j+N*W-k*Z+pe*Re+fe*_e+ge*Te-ce*Ee,P[6]=N*X+G*Z+k*j-R*W+ge*Re+fe*Ee+ce*_e-pe*Te,P[7]=G*X-k*W-R*j-N*Z+fe*Re-ce*Te-pe*_e-ge*Ee,P}yt.getReal=s.copy,yt.setReal=s.copy,yt.mul=E;var I=s.dot;yt.dot=I;var v=s.length;yt.length=v,yt.len=v;var S=s.squaredLength;return yt.squaredLength=S,yt.sqrLen=S,yt}var Yt,xr,Vt={};function Sn(){if(Yt)return Vt;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(A)}Yt=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=u,Vt.clone=function(A){var M=new r.ARRAY_TYPE(2);return M[0]=A[0],M[1]=A[1],M},Vt.fromValues=function(A,M){var k=new r.ARRAY_TYPE(2);return k[0]=A,k[1]=M,k},Vt.copy=function(A,M){return A[0]=M[0],A[1]=M[1],A},Vt.set=function(A,M,k){return A[0]=M,A[1]=k,A},Vt.add=function(A,M,k){return A[0]=M[0]+k[0],A[1]=M[1]+k[1],A},Vt.subtract=m,Vt.multiply=h,Vt.divide=g,Vt.ceil=function(A,M){return A[0]=Math.ceil(M[0]),A[1]=Math.ceil(M[1]),A},Vt.floor=function(A,M){return A[0]=Math.floor(M[0]),A[1]=Math.floor(M[1]),A},Vt.min=function(A,M,k){return A[0]=Math.min(M[0],k[0]),A[1]=Math.min(M[1],k[1]),A},Vt.max=function(A,M,k){return A[0]=Math.max(M[0],k[0]),A[1]=Math.max(M[1],k[1]),A},Vt.round=function(A,M){return A[0]=Math.round(M[0]),A[1]=Math.round(M[1]),A},Vt.scale=function(A,M,k){return A[0]=M[0]*k,A[1]=M[1]*k,A},Vt.scaleAndAdd=function(A,M,k,R){return A[0]=M[0]+k[0]*R,A[1]=M[1]+k[1]*R,A},Vt.distance=b,Vt.squaredDistance=E,Vt.length=I,Vt.squaredLength=v,Vt.negate=function(A,M){return A[0]=-M[0],A[1]=-M[1],A},Vt.inverse=function(A,M){return A[0]=1/M[0],A[1]=1/M[1],A},Vt.normalize=function(A,M){var k=M[0],R=M[1],N=k*k+R*R;return N>0&&(N=1/Math.sqrt(N)),A[0]=M[0]*N,A[1]=M[1]*N,A},Vt.dot=function(A,M){return A[0]*M[0]+A[1]*M[1]},Vt.cross=function(A,M,k){var R=M[0]*k[1]-M[1]*k[0];return A[0]=A[1]=0,A[2]=R,A},Vt.lerp=function(A,M,k,R){var N=M[0],G=M[1];return A[0]=N+R*(k[0]-N),A[1]=G+R*(k[1]-G),A},Vt.random=function(A,M){M=M||1;var k=2*r.RANDOM()*Math.PI;return A[0]=Math.cos(k)*M,A[1]=Math.sin(k)*M,A},Vt.transformMat2=function(A,M,k){var R=M[0],N=M[1];return A[0]=k[0]*R+k[2]*N,A[1]=k[1]*R+k[3]*N,A},Vt.transformMat2d=function(A,M,k){var R=M[0],N=M[1];return A[0]=k[0]*R+k[2]*N+k[4],A[1]=k[1]*R+k[3]*N+k[5],A},Vt.transformMat3=function(A,M,k){var R=M[0],N=M[1];return A[0]=k[0]*R+k[3]*N+k[6],A[1]=k[1]*R+k[4]*N+k[7],A},Vt.transformMat4=function(A,M,k){var R=M[0],N=M[1];return A[0]=k[0]*R+k[4]*N+k[12],A[1]=k[1]*R+k[5]*N+k[13],A},Vt.rotate=function(A,M,k,R){var N=M[0]-k[0],G=M[1]-k[1],W=Math.sin(R),j=Math.cos(R);return A[0]=N*j-G*W+k[0],A[1]=N*W+G*j+k[1],A},Vt.angle=function(A,M){var k=A[0],R=A[1],N=M[0],G=M[1],W=Math.sqrt(k*k+R*R)*Math.sqrt(N*N+G*G);return Math.acos(Math.min(Math.max(W&&(k*N+R*G)/W,-1),1))},Vt.zero=function(A){return A[0]=0,A[1]=0,A},Vt.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},Vt.exactEquals=function(A,M){return A[0]===M[0]&&A[1]===M[1]},Vt.equals=function(A,M){var k=A[0],R=A[1],N=M[0],G=M[1];return Math.abs(k-N)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(R-G)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(G))},Vt.forEach=Vt.sqrLen=Vt.sqrDist=Vt.dist=Vt.div=Vt.mul=Vt.sub=Vt.len=void 0;var r=function(A,M){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var k=s(void 0);if(k&&k.has(A))return k.get(A);var R={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var W=N?Object.getOwnPropertyDescriptor(A,G):null;W&&(W.get||W.set)?Object.defineProperty(R,G,W):R[G]=A[G]}return R.default=A,k&&k.set(A,R),R}(Y());function s(A){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(s=function(R){return R?k:M})(A)}function u(){var A=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function m(A,M,k){return A[0]=M[0]-k[0],A[1]=M[1]-k[1],A}function h(A,M,k){return A[0]=M[0]*k[0],A[1]=M[1]*k[1],A}function g(A,M,k){return A[0]=M[0]/k[0],A[1]=M[1]/k[1],A}function b(A,M){return Math.hypot(M[0]-A[0],M[1]-A[1])}function E(A,M){var k=M[0]-A[0],R=M[1]-A[1];return k*k+R*R}function I(A){return Math.hypot(A[0],A[1])}function v(A){var M=A[0],k=A[1];return M*M+k*k}Vt.len=I,Vt.sub=m,Vt.mul=h,Vt.div=g,Vt.dist=b,Vt.sqrDist=E,Vt.sqrLen=v;var S,P=(S=u(),function(A,M,k,R,N,G){var W,j;for(M||(M=2),k||(k=0),j=R?Math.min(R*M+k,A.length):A.length,W=k;W<j;W+=M)S[0]=A[W],S[1]=A[W+1],N(S,S,G),A[W]=S[0],A[W+1]=S[1];return A});return Vt.forEach=P,Vt}function vn(){if(xr)return F;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(A)}xr=1,Object.defineProperty(F,"__esModule",{value:!0}),F.vec4=F.vec3=F.vec2=F.quat2=F.quat=F.mat4=F.mat3=F.mat2d=F.mat2=F.glMatrix=void 0;var r=P(Y());F.glMatrix=r;var s=P(ie());F.mat2=s;var u=P(ue());F.mat2d=u;var m=P(be());F.mat3=m;var h=P(ht());F.mat4=h;var g=P(mt());F.quat=g;var b=P(Zt());F.quat2=b;var E=P(Sn());F.vec2=E;var I=P(At());F.vec3=I;var v=P(Ot());function S(A){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(S=function(R){return R?k:M})(A)}function P(A,M){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var k=S(M);if(k&&k.has(A))return k.get(A);var R={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in A)if(G!=="default"&&Object.prototype.hasOwnProperty.call(A,G)){var W=N?Object.getOwnPropertyDescriptor(A,G):null;W&&(W.get||W.set)?Object.defineProperty(R,G,W):R[G]=A[G]}return R.default=A,k&&k.set(A,R),R}return F.vec4=v,F}var sn,Ci,rr,Pr,Me=vn(),Bt=function(){if(Ci)return sn;function c(r,s,u,m){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=u,this.p2y=m}return Ci=1,sn=c,c.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,m=0;m<8;m++){var h=this.sampleCurveX(u)-r;if(Math.abs(h)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=h/g}var b=0,E=1;for(u=r,m=0;m<20&&(h=this.sampleCurveX(u),!(Math.abs(h-r)<s));m++)r>h?b=u:E=u,u=.5*(E-b)+b;return u},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},sn}(),yn=L(Bt);function Hr(){if(Pr)return rr;function c(r,s){this.x=r,this.y=s}return Pr=1,rr=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,s){return this.clone()._rotateAround(r,s)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var s=r.x-this.x,u=r.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,s){return Math.atan2(this.x*s-this.y*r,this.x*r+this.y*s)},_matMult:function(r){var s=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=s,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var s=Math.cos(r),u=Math.sin(r),m=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=m,this},_rotateAround:function(r,s){var u=Math.cos(r),m=Math.sin(r),h=s.y+m*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-m*(this.y-s.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(r){return r instanceof c?r:Array.isArray(r)?new c(r[0],r[1]):r},rr}var _t=L(Hr());function wn(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(!wn(c[s],r[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const s in c)if(!wn(c[s],r[s]))return!1;return!0}return c===r}const hn=Math.PI/180,fi=180/Math.PI;function Sr(c){return c*hn}function An(c){return c*fi}const di=[[0,0],[1,0],[1,1],[0,1]];function Go(c){if(c<=0)return 0;if(c>=1)return 1;const r=c*c,s=r*c;return 4*(c<.5?s:3*(c-r)+s-.75)}function qo(c,r,s,u){const m=new yn(c,r,s,u);return function(h){return m.solve(h)}}const $a=qo(.25,.1,.25,1);function yr(c,r,s){return Math.min(s,Math.max(r,c))}function Bl(c,r,s){return(s=yr((s-c)/(r-c),0,1))*s*(3-2*s)}function Ua(c,r,s){const u=s-r,m=((c-r)%u+u)%u+r;return m===r?s:m}function Xs(c,r,s){if(!c.length)return s(null,[]);let u=c.length;const m=new Array(c.length);let h=null;c.forEach((g,b)=>{r(g,(E,I)=>{E&&(h=E),m[b]=I,--u==0&&s(h,m)})})}function Oi(c,...r){for(const s of r)for(const u in s)c[u]=s[u];return c}let fo=1;function uu(){return fo++}function hu(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Fl(c,r){c.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function Va(c,r){return c.indexOf(r,c.length-r.length)!==-1}function Ys(c,r,s){const u={};for(const m in c)u[m]=r.call(this,c[m],m,c);return u}function Nl(c,r,s){const u={};for(const m in c)r.call(this,c[m],m,c)&&(u[m]=c[m]);return u}function Co(c){return Array.isArray(c)?c.map(Co):typeof c=="object"&&c?Ys(c,Co):c}const fu={};function zr(c){fu[c]||(typeof console<"u"&&console.warn(c),fu[c]=!0)}function da(c,r,s){return(s.y-c.y)*(r.x-c.x)>(r.y-c.y)*(s.x-c.x)}function Rh(c){let r=0;for(let s,u,m=0,h=c.length,g=h-1;m<h;g=m++)s=c[m],u=c[g],r+=(u.x-s.x)*(s.y+u.y);return r}function po([c,r,s]){const u=Sr(r+90),m=Sr(s);return{x:c*Math.cos(u)*Math.sin(m),y:c*Math.sin(u)*Math.sin(m),z:c*Math.cos(m),azimuthal:r,polar:s}}function Ks(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function du(c){const r={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,m,h)=>{const g=m||h;return r[u]=!g||g.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let jl,pu=null;function Js(c,r){return[c[4*r],c[4*r+1],c[4*r+2],c[4*r+3]]}function Je(c,r,s,u){for(;r<s;){const m=r+s>>1;c[m]<u?r=m+1:s=m}return r}function ne(c,r,s,u){for(;r<s;){const m=r+s>>1;c[m]<=u?r=m+1:s=m}return r}function he(c){return c>0?1/(1.001-c):1+c}function we(c){return c>0?1-1/(1.001-c):-c}const De={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(jl==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{jl=i.API_URL_REGEX!=null?new RegExp(i.API_URL_REGEX):c}catch{jl=c}}return jl},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!De.API_URL)return null;try{const c=new URL(De.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Oe(c){return De.API_URL_REGEX.test(c)}function $e(c){return De.API_SPRITE_REGEX.test(c)}let Ye,qe,Ke,at,nt,xt;function zt(){return Ye==null&&(Ye=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ye}const Ft={now:()=>at!==void 0?at:performance.now(),setNow(c){at=c},restoreNow(){at=void 0},frame(c){const r=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(c,r=0){const{width:s,height:u}=c;nt||(nt=document.createElement("canvas"));const m=nt.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(s>nt.width||u>nt.height)&&(nt.width=s,nt.height=u),m.clearRect(-r,-r,s+2*r,u+2*r),m.drawImage(c,0,0,s,u),m.getImageData(-r,-r,s+2*r,u+2*r)},resolveURL:c=>(qe||(qe=document.createElement("a")),qe.href=c,qe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ke==null&&(Ke=window.matchMedia("(prefers-reduced-motion: reduce)")),Ke.matches)},hasCanvasFingerprintNoise(){if(xt!==void 0)return xt;if(!zt())return xt=!1,!1;const c=new OffscreenCanvas(85,1),r=c.getContext("2d",{willReadFrequently:!0});let s=0;for(let m=0;m<c.width;++m)r.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,r.fillRect(m,0,1,1);const u=r.getImageData(0,0,c.width,c.height);s=0;for(let m=0;m<u.data.length;++m)if(m%4!=3&&s++!==u.data[m])return xt=!0,!0;return xt=!1,!1}};function sr(c,r){const s=c.indexOf("?");if(s<0)return`${c}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(c.slice(s));for(const m in r)u.set(m,r[m]);return`${c.slice(0,s)}?${u.toString()}`}function cr(c,r={persistentParams:[]}){const s=c.indexOf("?");if(s<0)return c;const u=new URLSearchParams,m=new URLSearchParams(c.slice(s));for(const g of r.persistentParams){const b=m.get(g);b&&u.set(g,b)}const h=u.toString();return`${c.slice(0,s)}${h.length>0?`?${h}`:""}`}const hr="mapbox-tiles";let ur=500,Ur=50;const Kr=["language","worldview","jobid"];let _r,Zr;function Tn(){try{return caches}catch{}}function Kn(){const c=Tn();c&&_r==null&&(_r=c.open(hr))}let ti=1/0;const yi={supported:!1,testSupport:function(c){!zh&&Ga&&(mu?Bh(c):Wo=c)}};let Wo,Ga,zh=!1,mu=!1;const $l=typeof self<"u"?self:{};function Bh(c){const r=c.createTexture();c.bindTexture(c.TEXTURE_2D,r);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Ga),c.isContextLost())return;yi.supported=!0}catch{}c.deleteTexture(r),zh=!0}$l.document&&(Ga=$l.document.createElement("img"),Ga.onload=function(){Wo&&Bh(Wo),Wo=null,mu=!0},Ga.onerror=function(){zh=!0,Wo=null},Ga.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ul={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ul);class Ap extends Error{constructor(r,s,u){s===401&&Oe(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ep=Ks()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,gu=function(c,r){if(!(/^file:/.test(s=c.url)||/^file:/.test(Ep())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,m){const h=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Ep(),referrerPolicy:u.referrerPolicy,signal:h.signal});let b=!1,E=!1;const I=(v=g.url).indexOf("sku=")>0&&Oe(v);var v;u.type==="json"&&g.headers.set("Accept","application/json");const S=(A,M,k)=>{if(E)return;if(A&&A.message!=="SecurityError"&&zr(A.toString()),M&&k)return P(M);const R=Date.now();fetch(g).then(N=>{if(N.ok){const G=I?N.clone():null;return P(N,G,R)}return m(new Ap(N.statusText,N.status,u.url))}).catch(N=>{N.name!=="AbortError"&&m(new Error(`${N.message} ${u.url}`))})},P=(A,M,k)=>{(u.type==="arrayBuffer"?A.arrayBuffer():u.type==="json"?A.json():A.text()).then(R=>{E||(M&&k&&function(N,G,W){if(Kn(),_r==null)return;const j=du(G.headers.get("Cache-Control")||"");if(j["no-store"])return;const Z={status:G.status,statusText:G.statusText,headers:new Headers};G.headers.forEach((pe,ge)=>Z.headers.set(ge,pe)),j["max-age"]&&Z.headers.set("Expires",new Date(W+1e3*j["max-age"]).toUTCString());const X=Z.headers.get("Expires");if(!X||new Date(X).getTime()-W<42e4)return;let ce=cr(N.url,{persistentParams:Kr});if(G.status===206){const pe=N.headers.get("Range");if(!pe)return;Z.status=200,ce=sr(ce,{range:pe})}(function(pe,ge){if(Zr===void 0)try{new Response(new ReadableStream),Zr=!0}catch{Zr=!1}Zr?ge(pe.body):pe.blob().then(ge)})(G,pe=>{const ge=new Response((fe=G.status)!==200&&fe!==404&&[101,103,204,205,304].includes(fe)?null:pe,Z);var fe;Kn(),_r!=null&&_r.then(Te=>Te.put(ce,ge)).catch(Te=>zr(Te.message))})}(g,M,k),b=!0,m(null,R,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(R=>{E||m(new Error(R.message))})};return I?function(A,M){if(Kn(),_r==null)return M(null);_r.then(k=>{let R=cr(A.url,{persistentParams:Kr});const N=A.headers.get("Range");N&&(R=sr(R,{range:N})),k.match(R).then(G=>{const W=function(j){if(!j)return!1;const Z=new Date(j.headers.get("Expires")||0),X=du(j.headers.get("Cache-Control")||"");return Z>Date.now()&&!X["no-cache"]}(G);k.delete(R),W&&k.put(R,G.clone()),M(null,G,W)}).catch(M)}).catch(M)}(g,S):S(null,null),{cancel:()=>{E=!0,b||h.abort()}}}(c,r);if(Ks()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,r,void 0,!0)}var s;return function(u,m){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const g in u.headers)h.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{m(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(u.type==="json")try{g=JSON.parse(h.response)}catch(b){return m(b)}m(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else m(new Ap(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,r)},Vl=function(c,r){return gu(Oi(c,{type:"arrayBuffer"}),r)};function Oo(c){const r=document.createElement("a");return r.href=c,r.protocol===location.protocol&&r.host===location.host}const Ho="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Zo,Qi;Zo=[],Qi=0;const pa=function(c,r){if(yi.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Qi>=De.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Zo.push(h),h}Qi++;let s=!1;const u=()=>{if(!s)for(s=!0,Qi--;Zo.length&&Qi<De.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Zo.shift(),{requestParameters:g,callback:b,cancelled:E}=h;E||(h.cancel=pa(g,b).cancel)}},m=Vl(c,(h,g,b,E)=>{u(),h?r(h):g&&(self.createImageBitmap?function(I,v){const S=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(S).then(P=>{v(null,P)}).catch(P=>{v(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(I,v)=>r(I,v,b,E)):function(I,v){const S=new Image;S.onload=()=>{v(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=Ho})},S.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(I)],{type:"image/png"});S.src=I.byteLength?URL.createObjectURL(P):Ho}(g,(I,v)=>r(I,v,b,E)))});return{cancel:()=>{m.cancel(),u()}}};var yu,Mp,Pp,ma={exports:{}},Fh={exports:{}},s_={exports:{}},pb=function(){if(Pp)return ma.exports;Pp=1;var c=(yu||(yu=1,Fh.exports=function(s,u){var m,h,g,b,E,I,v,S;for(h=s.length-(m=3&s.length),g=u,E=3432918353,I=461845907,S=0;S<h;)v=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24,++S,g=27492+(65535&(b=5*(65535&(g=(g^=v=(65535&(v=(v=(65535&v)*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*I+(((v>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(v=0,m){case 3:v^=(255&s.charCodeAt(S+2))<<16;case 2:v^=(255&s.charCodeAt(S+1))<<8;case 1:g^=v=(65535&(v=(v=(65535&(v^=255&s.charCodeAt(S)))*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*I+(((v>>>16)*I&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Fh.exports),r=(Mp||(Mp=1,s_.exports=function(s,u){for(var m,h=s.length,g=u^h,b=0;h>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(m>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),h-=4,++b;switch(h){case 3:g^=(255&s.charCodeAt(b+2))<<16;case 2:g^=(255&s.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),s_.exports);return ma.exports=c,ma.exports.murmur3=c,ma.exports.murmur2=r,ma.exports}(),eo=L(pb);class vs{constructor(r,...s){Oi(this,s[0]||{}),this.type=r}}class _u extends vs{constructor(r,s={}){super("error",Oi({error:r},s))}}function Gl(c,r,s){s[c]&&s[c].indexOf(r)!==-1||(s[c]=s[c]||[],s[c].push(r))}function Ip(c,r,s){if(s&&s[c]){const u=s[c].indexOf(r);u!==-1&&s[c].splice(u,1)}}class ql{on(r,s){return this._listeners=this._listeners||{},Gl(r,s,this._listeners),this}off(r,s){return Ip(r,s,this._listeners),Ip(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Gl(r,s,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,s){const u=typeof r=="string"?new vs(r,s):r,m=u.type;if(this.listens(m)){u.target=this;const h=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const E of h)E.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const E of g)Ip(m,E,this._oneTimeListeners),E.call(this,u);const b=this._eventedParent;b&&(Oi(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof _u&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var Cp,Br={},Op=function(){if(Cp)return Br;Cp=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(h){return(h=Math.round(h))<0?0:h>255?255:h}function s(h){return r(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(g=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:g>1?1:g;var g}function m(h,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?h+(g-h)*b*6:2*b<1?g:3*b<2?h+(g-h)*(2/3-b)*6:h}try{Br.parseCSSColor=function(h){var g,b=h.replace(/ /g,"").toLowerCase();if(b in c)return c[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=b.indexOf("("),I=b.indexOf(")");if(E!==-1&&I+1===b.length){var v=b.substr(0,E),S=b.substr(E+1,I-(E+1)).split(","),P=1;switch(v){case"rgba":if(S.length!==4)return null;P=u(S.pop());case"rgb":return S.length!==3?null:[s(S[0]),s(S[1]),s(S[2]),P];case"hsla":if(S.length!==4)return null;P=u(S.pop());case"hsl":if(S.length!==3)return null;var A=(parseFloat(S[0])%360+360)%360/360,M=u(S[1]),k=u(S[2]),R=k<=.5?k*(M+1):k+M-k*M,N=2*k-R;return[r(255*m(N,R,A+1/3)),r(255*m(N,R,A)),r(255*m(N,R,A-1/3)),P];default:return null}}return null}}catch{}return Br}();class Vr{constructor(r,s,u,m=1){this.r=r,this.g=s,this.b=u,this.a=m}static parse(r){if(!r)return;if(r instanceof Vr)return r;if(typeof r!="string")return;const s=Op.parseCSSColor(r);return s?new Vr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[r,s,u,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(u)},${m})`}toRenderColor(r){const{r:s,g:u,b:m,a:h}=this;return new mb(r,s,u,m,h)}}class mb{constructor(r,s,u,m,h){if(r){const g=r.image.height,b=g*g;s=h===0?0:s/h*(g-1),u=h===0?0:u/h*(g-1),m=h===0?0:m/h*(g-1);const E=Math.floor(s),I=Math.floor(u),v=Math.floor(m),S=Math.ceil(s),P=Math.ceil(u),A=Math.ceil(m),M=s-E,k=u-I,R=m-v,N=r.image.data,G=4*(E+I*b+v*g),W=4*(E+I*b+A*g),j=4*(E+P*b+v*g),Z=4*(E+P*b+A*g),X=4*(S+I*b+v*g),ce=4*(S+I*b+A*g),pe=4*(S+P*b+v*g),ge=4*(S+P*b+A*g);if(G<0||ge>=N.length)throw new Error("out of range");this.r=nr(nr(nr(N[G],N[W],R),nr(N[j],N[Z],R),k),nr(nr(N[X],N[ce],R),nr(N[pe],N[ge],R),k),M)/255*h,this.g=nr(nr(nr(N[G+1],N[W+1],R),nr(N[j+1],N[Z+1],R),k),nr(nr(N[X+1],N[ce+1],R),nr(N[pe+1],N[ge+1],R),k),M)/255*h,this.b=nr(nr(nr(N[G+2],N[W+2],R),nr(N[j+2],N[Z+2],R),k),nr(nr(N[X+2],N[ce+2],R),nr(N[pe+2],N[ge+2],R),k),M)/255*h,this.a=h}else this.r=s,this.g=u,this.b=m,this.a=h}toArray(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[255*r/m,255*s/m,255*u/m,m]}toArray01(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[r/m,s/m,u/m,m]}toArray01Scaled(r){const{r:s,g:u,b:m,a:h}=this;return h===0?[0,0,0]:[s/h*r,u/h*r,m/h*r]}toArray01PremultipliedAlpha(){const{r,g:s,b:u,a:m}=this;return[r,s,u,m]}toArray01Linear(){const{r,g:s,b:u,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(r/m,2.2),Math.pow(s/m,2.2),Math.pow(u/m,2.2),m]}}function nr(c,r,s){return c*(1-s)+r*s}function vu(c,r,s){return c.map((u,m)=>nr(u,r[m],s))}Vr.black=new Vr(0,0,0,1),Vr.white=new Vr(1,1,1,1),Vr.transparent=new Vr(0,0,0,0),Vr.red=new Vr(1,0,0,1),Vr.blue=new Vr(0,0,1,1);var Qs=Object.freeze({__proto__:null,array:vu,color:function(c,r,s){return new Vr(nr(c.r,r.r,s),nr(c.g,r.g,s),nr(c.b,r.b,s),nr(c.a,r.a,s))},number:nr});function Wl(c,...r){for(const s of r)for(const u in s)c[u]=s[u];return c}class ga extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class Nh{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[u,m]of s)this.bindings[u]=m}concat(r){return new Nh(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Xo={kind:"null"},Ut={kind:"number"},Cr={kind:"string"},Or={kind:"boolean"},to={kind:"color"},ki={kind:"object"},Rr={kind:"value"},jh={kind:"collator"},Hl={kind:"formatted"},Zl={kind:"resolvedImage"};function ji(c,r){return{kind:"array",itemType:c,N:r}}function Ln(c){if(c.kind==="array"){const r=Ln(c.itemType);return typeof c.N=="number"?`array<${r}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${r}>`}return c.kind}const l_=[Xo,Ut,Cr,Or,to,Hl,ki,ji(Rr),Zl];function Xl(c,r){if(r.kind==="error")return null;if(c.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Xl(c.itemType,r.itemType))&&(typeof c.N!="number"||c.N===r.N))return null}else{if(c.kind===r.kind)return null;if(c.kind==="value"){for(const s of l_)if(!Xl(s,r))return null}}return`Expected ${Ln(c)} but found ${Ln(r)} instead.`}function Yl(c,r){return r.some(s=>s.kind===c.kind)}function ya(c,r){return r.some(s=>s==="null"?c===null:s==="array"?Array.isArray(c):s==="object"?c&&!Array.isArray(c)&&typeof c=="object":s===typeof c)}class $h{constructor(r,s,u){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mo{constructor(r,s,u,m,h){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=u,this.fontStack=m,this.textColor=h}}class Di{constructor(r){this.sections=r}static fromString(r){return new Di([new mo(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.namePrimary.length!==0)}static factory(r){return r instanceof Di?r:Di.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.namePrimary]);continue}r.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),r.push(u)}return r}}class $i{constructor(r){this.namePrimary=r.namePrimary,r.nameSecondary&&(this.nameSecondary=r.nameSecondary),this.available=r.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(r,s){return r?new $i({namePrimary:r,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function c_(c,r,s,u){return typeof c=="number"&&c>=0&&c<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,r,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,r,s,u]:[c,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xs(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Vr||c instanceof $h||c instanceof Di||c instanceof $i)return!0;if(Array.isArray(c)){for(const r of c)if(!xs(r))return!1;return!0}if(typeof c=="object"){for(const r in c)if(!xs(c[r]))return!1;return!0}return!1}function Gn(c){if(c===null)return Xo;if(typeof c=="string")return Cr;if(typeof c=="boolean")return Or;if(typeof c=="number")return Ut;if(c instanceof Vr)return to;if(c instanceof $h)return jh;if(c instanceof Di)return Hl;if(c instanceof $i)return Zl;if(Array.isArray(c)){const r=c.length;let s;for(const u of c){const m=Gn(u);if(s){if(s===m)continue;s=Rr;break}s=m}return ji(s||Rr,r)}return ki}function Ui(c){const r=typeof c;return c===null?"":r==="string"||r==="number"||r==="boolean"?String(c):c instanceof Vr||c instanceof Di||c instanceof $i?c.toString():JSON.stringify(c)}class Yo{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!xs(r[1]))return s.error("invalid value");const u=r[1];let m=Gn(u);const h=s.expectedType;return m.kind!=="array"||m.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(m=h),new Yo(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Di?this.value.serialize():this.value}}class li{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const kp={string:Cr,number:Ut,boolean:Or,object:ki};class Ko{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let u,m=1;const h=r[0];if(h==="array"){let b,E;if(r.length>2){const I=r[1];if(typeof I!="string"||!(I in kp)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=kp[I],m++}else b=Rr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],m++}u=ji(b,E)}else u=kp[h];const g=[];for(;m<r.length;m++){const b=s.parse(r[m],m,Rr);if(!b)return null;g.push(b)}return new Ko(u,g)}evaluate(r){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(r);if(!Xl(this.type,Gn(u)))return u;if(s===this.args.length-1)throw new li(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ln(Gn(u))} but was expected to be of type ${Ln(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(u=>u.serialize()))}}class Kl{constructor(r){this.type=Hl,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const m=[];let h=!1;for(let g=1;g<=r.length-1;++g){const b=r[g];if(h&&typeof b=="object"&&!Array.isArray(b)){h=!1;let E=null;if(b["font-scale"]&&(E=s.parseObjectValue(b["font-scale"],g,"font-scale",Ut),!E))return null;let I=null;if(b["text-font"]&&(I=s.parseObjectValue(b["text-font"],g,"text-font",ji(Cr)),!I))return null;let v=null;if(b["text-color"]&&(v=s.parseObjectValue(b["text-color"],g,"text-color",to),!v))return null;const S=m[m.length-1];S.scale=E,S.font=I,S.textColor=v}else{const E=s.parse(r[g],g,Rr);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,m.push({content:E,scale:null,font:null,textColor:null})}}return new Kl(m)}evaluate(r){return new Di(this.sections.map(s=>{const u=s.content.evaluate(r);return Gn(u)===Zl?new mo("",u,null,null,null):new mo(Ui(u),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),r.push(u)}return r}}class el{constructor(r,s){this.type=Zl,this.inputPrimary=r,this.inputSecondary=s}static parse(r,s){if(r.length<2)return s.error("Expected two or more arguments.");const u=s.parse(r[1],1,Cr);if(!u)return s.error("No image name provided.");if(r.length===2)return new el(u);const m=s.parse(r[2],1,Cr);return m?new el(u,m):s.error("Secondary image variant is not a string.")}evaluate(r){const s=$i.fromString(this.inputPrimary.evaluate(r),this.inputSecondary?this.inputSecondary.evaluate(r):void 0);return s&&r.availableImages&&(s.available=r.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&r.availableImages&&(s.available=r.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(r){r(this.inputPrimary),this.inputSecondary&&r(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function tl(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const Uh={"to-boolean":Or,"to-color":to,"to-number":Ut,"to-string":Cr};class qa{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[0],m=[];let h=Xo;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const g=r[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);h=ji(s.expectedType.itemType,g)}else{if(!(g>0&&xs(r[1][0])))return null;h=ji(Gn(r[1][0]),g)}for(let b=0;b<g;b++){const E=r[1][b];let I;if(tl(E)==="array")I=s.parse(E,void 0,h.itemType);else{const v=tl(E);if(v!==h.itemType.kind)return s.error(`Expected ${h.itemType.kind} but found ${v}.`);I=s.registry.literal.parse(["literal",E===void 0?null:E],s)}if(!I)return null;m.push(I)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return s.error("Expected one argument.");h=Uh[u];for(let g=1;g<r.length;g++){const b=s.parse(r[g],g,Rr);if(!b)return null;m.push(b)}}return new qa(h,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let s,u;for(const m of this.args){if(s=m.evaluate(r),u=null,s instanceof Vr)return s;if(typeof s=="string"){const h=r.parseColor(s);if(h)return h}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:c_(s[0],s[1],s[2],s[3]),!u))return new Vr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new li(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(r),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new li(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Di.fromString(Ui(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?$i.fromString(Ui(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(s=>s.evaluate(r)):Ui(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Kl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new el(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const gb=["Unknown","Point","LineString","Polygon"];class u_{constructor(r,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-r[0])+this.featureDistanceData.bearing[1]*(m*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=Vr.parse(r)),s}getConfig(r){return this.options?this.options.get(r):null}}class ro{constructor(r,s,u,m,h){this.name=r,this.type=s,this._evaluate=u,this.args=m,this._overloadIndex=h}evaluate(r){if(!this._evaluate){const s=ro.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const u=r[0],m=ro.definitions[u];if(!m)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,b=[];let E=null,I=-1;for(const[v,S]of g){if(Array.isArray(v)&&v.length!==r.length-1)continue;b.push(v),I++,E=new w_(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const P=[];let A=!1;for(let M=1;M<r.length;M++){const k=r[M],R=Array.isArray(v)?v[M-1]:v.type,N=E.parse(k,1+P.length,R);if(!N){A=!0;break}P.push(N)}if(!A)if(Array.isArray(v)&&v.length!==P.length)E.error(`Expected ${v.length} arguments, but found ${P.length} instead.`);else{for(let M=0;M<P.length;M++){const k=Array.isArray(v)?v[M]:v.type,R=P[M];E.concat(M+1).checkSubtype(k,R.type)}if(E.errors.length===0)return new ro(u,h,S,P,I)}}if(b.length===1)s.errors.push(...E.errors);else{const v=(b.length?b:g.map(([P])=>P)).map(yb).join(" | "),S=[];for(let P=1;P<r.length;P++){const A=s.parse(r[P],1+S.length);if(!A)return null;S.push(Ln(A.type))}s.error(`Expected arguments of type ${v}, but found (${S.join(", ")}) instead.`)}return null}static register(r,s){ro.definitions=s;for(const u in s)r[u]=ro}}function yb(c){return Array.isArray(c)?`(${c.map(Ln).join(", ")})`:`(${Ln(c.type)}...)`}class Vh{constructor(r,s,u){this.type=jh,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const m=u["case-sensitive"]===void 0?s.parse(!1,1,Or):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Or);if(!m)return null;const h=u["diacritic-sensitive"]===void 0?s.parse(!1,1,Or):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Or);if(!h)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",Cr),!g)?null:new Vh(m,h,g)}evaluate(r){return new $h(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function h_(c,r,s=0,u=c.length-1,m=Ql){for(;u>s;){if(u-s>600){const E=u-s+1,I=r-s+1,v=Math.log(E),S=.5*Math.exp(2*v/3),P=.5*Math.sqrt(v*S*(E-S)/E)*(I-E/2<0?-1:1);h_(c,r,Math.max(s,Math.floor(r-I*S/E+P)),Math.min(u,Math.floor(r+(E-I)*S/E+P)),m)}const h=c[r];let g=s,b=u;for(Jl(c,s,r),m(c[u],h)>0&&Jl(c,s,u);g<b;){for(Jl(c,g,b),g++,b--;m(c[g],h)<0;)g++;for(;m(c[b],h)>0;)b--}m(c[s],h)===0?Jl(c,s,b):(b++,Jl(c,b,u)),b<=r&&(s=b+1),r<=b&&(u=b-1)}}function Jl(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}function Ql(c,r){return c<r?-1:c>r?1:0}function _b(c){let r=0;for(let s,u,m=0,h=c.length,g=h-1;m<h;g=m++)s=c[m],u=c[g],r+=(u.x-s.x)*(s.y+u.y);return r}function xu(c,r){c[0]=Math.min(c[0],r[0]),c[1]=Math.min(c[1],r[1]),c[2]=Math.max(c[2],r[0]),c[3]=Math.max(c[3],r[1])}function rl(c,r){return!(c[0]<=r[0]||c[2]>=r[2]||c[1]<=r[1]||c[3]>=r[3])}function vb(c,r,s){const u=c[0]-r[0],m=c[1]-r[1],h=c[0]-s[0],g=c[1]-s[1];return u*g-h*m==0&&u*h<=0&&m*g<=0}function ec(c,r,s=!1){let u=!1;for(let b=0,E=r.length;b<E;b++){const I=r[b];for(let v=0,S=I.length,P=S-1;v<S;P=v++){const A=I[P],M=I[v];if(vb(c,A,M))return s;(h=A)[1]>(m=c)[1]!=(g=M)[1]>m[1]&&m[0]<(g[0]-h[0])*(m[1]-h[1])/(g[1]-h[1])+h[0]&&(u=!u)}}var m,h,g;return u}function f_(c,r,s,u){const m=u[0]-s[0],h=u[1]-s[1],g=(c[0]-s[0])*h-m*(c[1]-s[1]),b=(r[0]-s[0])*h-m*(r[1]-s[1]);return g>0&&b<0||g<0&&b>0}function Gh(c,r,s,u){return(m=[u[0]-s[0],u[1]-s[1]])[0]*(h=[r[0]-c[0],r[1]-c[1]])[1]-m[1]*h[0]!=0&&!(!f_(c,r,s,u)||!f_(s,u,c,r));var m,h}const go=8192;function Mr(c,r){const s=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(s*m*go),Math.round(u*m*go)]}function Qt(c,r){for(let s=0;s<r.length;s++)if(ec(c,r[s]))return!0;return!1}function Dp(c,r,s){for(const u of s)for(let m=0,h=u.length,g=h-1;m<h;g=m++)if(Gh(c,r,u[g],u[m]))return!0;return!1}function pr(c,r){for(let s=0;s<c.length;++s)if(!ec(c[s],r))return!1;for(let s=0;s<c.length-1;++s)if(Dp(c[s],c[s+1],r))return!1;return!0}function Lp(c,r){for(let s=0;s<r.length;s++)if(pr(c,r[s]))return!0;return!1}function bu(c,r,s){const u=[];for(let m=0;m<c.length;m++){const h=[];for(let g=0;g<c[m].length;g++){const b=Mr(c[m][g],s);xu(r,b),h.push(b)}u.push(h)}return u}function or(c,r,s){const u=[];for(let m=0;m<c.length;m++){const h=bu(c[m],r,s);u.push(h)}return u}function Rp(c,r,s,u){if(c[0]<s[0]||c[0]>s[2]){const m=.5*u;let h=c[0]-s[0]>m?-u:s[0]-c[0]>m?u:0;h===0&&(h=c[0]-s[2]>m?-u:s[2]-c[0]>m?u:0),c[0]+=h}xu(r,c)}function qh(c,r,s,u){const m=Math.pow(2,u.z)*go,h=[u.x*go,u.y*go],g=[];if(!c)return g;for(const b of c)for(const E of b){const I=[E.x+h[0],E.y+h[1]];Rp(I,r,s,m),g.push(I)}return g}function zp(c,r,s,u){const m=Math.pow(2,u.z)*go,h=[u.x*go,u.y*go],g=[];if(!c)return g;for(const E of c){const I=[];for(const v of E){const S=[v.x+h[0],v.y+h[1]];xu(r,S),I.push(S)}g.push(I)}if(r[2]-r[0]<=m/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of g)for(const I of E)Rp(I,r,s,m)}var b;return g}class bs{constructor(r,s){this.type=Or,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(xs(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let m=0;m<u.features.length;++m){const h=u.features[m].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new bs(u,u.features[m].geometry)}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new bs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new bs(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=bu(u.coordinates,h,g),E=qh(s.geometry(),m,h,g);if(!rl(m,h))return!1;for(const I of E)if(!ec(I,b))return!1}if(u.type==="MultiPolygon"){const b=or(u.coordinates,h,g),E=qh(s.geometry(),m,h,g);if(!rl(m,h))return!1;for(const I of E)if(!Qt(I,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,u){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=bu(u.coordinates,h,g),E=zp(s.geometry(),m,h,g);if(!rl(m,h))return!1;for(const I of E)if(!pr(I,b))return!1}if(u.type==="MultiPolygon"){const b=or(u.coordinates,h,g),E=zp(s.geometry(),m,h,g);if(!rl(m,h))return!1;for(const I of E)if(!Lp(I,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const nl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},wi=1/298.257223563,Wh=wi*(2-wi),tc=Math.PI/180;class rc{static fromTile(r,s,u){const m=Math.PI*(1-2*(r+.5)/Math.pow(2,s)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/tc;return new rc(h,u)}static get units(){return nl}constructor(r,s){if(r===void 0)throw new Error("No latitude given.");if(s&&!nl[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(nl).join(", ")}`);const u=6378.137*tc*(s?nl[s]:1),m=Math.cos(r*tc),h=1/(1-Wh*(1-m*m)),g=Math.sqrt(h);this.kx=u*g*m,this.ky=u*g*h*(1-Wh)}distance(r,s){const u=En(r[0]-s[0])*this.kx,m=(r[1]-s[1])*this.ky;return Math.sqrt(u*u+m*m)}bearing(r,s){const u=En(s[0]-r[0])*this.kx;return Math.atan2(u,(s[1]-r[1])*this.ky)/tc}destination(r,s,u){const m=u*tc;return this.offset(r,Math.sin(m)*s,Math.cos(m)*s)}offset(r,s,u){return[r[0]+s/this.kx,r[1]+u/this.ky]}lineDistance(r){let s=0;for(let u=0;u<r.length-1;u++)s+=this.distance(r[u],r[u+1]);return s}area(r){let s=0;for(let u=0;u<r.length;u++){const m=r[u];for(let h=0,g=m.length,b=g-1;h<g;b=h++)s+=En(m[h][0]-m[b][0])*(m[h][1]+m[b][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(r,s){let u=0;if(s<=0)return r[0];for(let m=0;m<r.length-1;m++){const h=r[m],g=r[m+1],b=this.distance(h,g);if(u+=b,u>s)return Wa(h,g,(s-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,s,u){let[m,h]=s,g=En(u[0]-m)*this.kx,b=(u[1]-h)*this.ky;if(g!==0||b!==0){const E=(En(r[0]-m)*this.kx*g+(r[1]-h)*this.ky*b)/(g*g+b*b);E>1?(m=u[0],h=u[1]):E>0&&(m+=g/this.kx*E,h+=b/this.ky*E)}return g=En(r[0]-m)*this.kx,b=(r[1]-h)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(r,s){let u=1/0,m=r[0][0],h=r[0][1],g=0,b=0;for(let E=0;E<r.length-1;E++){let I=r[E][0],v=r[E][1],S=En(r[E+1][0]-I)*this.kx,P=(r[E+1][1]-v)*this.ky,A=0;S===0&&P===0||(A=(En(s[0]-I)*this.kx*S+(s[1]-v)*this.ky*P)/(S*S+P*P),A>1?(I=r[E+1][0],v=r[E+1][1]):A>0&&(I+=S/this.kx*A,v+=P/this.ky*A)),S=En(s[0]-I)*this.kx,P=(s[1]-v)*this.ky;const M=S*S+P*P;M<u&&(u=M,m=I,h=v,g=E,b=A)}return{point:[m,h],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(r,s,u){let m=this.pointOnLine(u,r),h=this.pointOnLine(u,s);if(m.index>h.index||m.index===h.index&&m.t>h.t){const I=m;m=h,h=I}const g=[m.point],b=m.index+1,E=h.index;!Hh(u[b],g[0])&&b<=E&&g.push(u[b]);for(let I=b+1;I<=E;I++)g.push(u[I]);return Hh(u[E],h.point)||g.push(h.point),g}lineSliceAlong(r,s,u){let m=0;const h=[];for(let g=0;g<u.length-1;g++){const b=u[g],E=u[g+1],I=this.distance(b,E);if(m+=I,m>r&&h.length===0&&h.push(Wa(b,E,(r-(m-I))/I)),m>=s)return h.push(Wa(b,E,(s-(m-I))/I)),h;m>r&&h.push(E)}return h}bufferPoint(r,s){const u=s/this.ky,m=s/this.kx;return[r[0]-m,r[1]-u,r[0]+m,r[1]+u]}bufferBBox(r,s){const u=s/this.ky,m=s/this.kx;return[r[0]-m,r[1]-u,r[2]+m,r[3]+u]}insideBBox(r,s){return En(r[0]-s[0])>=0&&En(r[0]-s[2])<=0&&r[1]>=s[1]&&r[1]<=s[3]}}function Hh(c,r){return c[0]===r[0]&&c[1]===r[1]}function Wa(c,r,s){const u=En(r[0]-c[0]);return[c[0]+u*s,c[1]+(r[1]-c[1])*s]}function En(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Bp{constructor(r=[],s=(u,m)=>u<m?-1:u>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:u}=this,m=s[r];for(;r>0;){const h=r-1>>1,g=s[h];if(u(m,g)>=0)break;s[r]=g,r=h}s[r]=m}_down(r){const{data:s,compare:u}=this,m=this.length>>1,h=s[r];for(;r<m;){let g=1+(r<<1);const b=g+1;if(b<this.length&&u(s[b],s[g])<0&&(g=b),u(s[g],h)>=0)break;s[r]=s[g],r=g}s[r]=h}}var Ct=8192;function d_(c,r){return r.dist-c.dist}const nc=100,Zh=50;function Xh(c){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==c.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==c[s])return!1;return!0}function Yh(c){return c[1]-c[0]+1}function Ha(c,r){const s=c[1]>=c[0]&&c[1]<r;return s||console.warn("Distance Expression: Index is out of range"),s}function Fp(c,r){if(c[0]>c[1])return[null,null];const s=Yh(c);if(r){if(s===2)return[c,null];const u=Math.floor(s/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(s===1)return[c,null];const u=Math.floor(s/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function yo(c,r){const s=[1/0,1/0,-1/0,-1/0];if(!Ha(r,c.length))return s;for(let u=r[0];u<=r[1];++u)xu(s,c[u]);return s}function Kh(c){const r=[1/0,1/0,-1/0,-1/0];for(let s=0;s<c.length;++s)for(let u=0;u<c[s].length;++u)xu(r,c[s][u]);return r}function ic(c,r,s){if(Xh(c)||Xh(r))return NaN;let u=0,m=0;return c[2]<r[0]&&(u=r[0]-c[2]),c[0]>r[2]&&(u=c[0]-r[2]),c[1]>r[3]&&(m=c[1]-r[3]),c[3]<r[1]&&(m=r[1]-c[3]),s.distance([0,0],[u,m])}function p_(c){return 360*c-180}function m_(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function _o(c,r){const s=Math.pow(2,r.z),u=(c.y/Ct+r.y)/s;return[p_((c.x/Ct+r.x)/s),m_(u)]}function g_(c,r){const s=[];for(let u=0;u<c.length;++u)s.push(_o(c[u],r));return s}function Np(c,r,s){const u=s.pointOnLine(r,c).point;return s.distance(c,u)}function jp(c,r,s,u,m){const h=s.slice(u[0],u[1]+1);let g=1/0;for(let b=r[0];b<=r[1];++b)if((g=Math.min(g,Np(c[b],h,m)))===0)return 0;return g}function Jh(c,r,s,u,m){const h=Math.min(m.pointToSegmentDistance(c,s,u),m.pointToSegmentDistance(r,s,u)),g=Math.min(m.pointToSegmentDistance(s,c,r),m.pointToSegmentDistance(u,c,r));return Math.min(h,g)}function y_(c,r,s,u,m){if(!Ha(r,c.length)||!Ha(u,s.length))return NaN;let h=1/0;for(let g=r[0];g<r[1];++g)for(let b=u[0];b<u[1];++b){if(Gh(c[g],c[g+1],s[b],s[b+1]))return 0;h=Math.min(h,Jh(c[g],c[g+1],s[b],s[b+1],m))}return h}function __(c,r,s,u,m){if(!Ha(r,c.length)||!Ha(u,s.length))return NaN;let h=1/0;for(let g=r[0];g<=r[1];++g)for(let b=u[0];b<=u[1];++b)if((h=Math.min(h,m.distance(c[g],s[b])))===0)return h;return h}function v_(c,r,s){if(ec(c,r,!0))return 0;let u=1/0;for(const m of r){const h=m.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[h-1]&&(u=Math.min(u,s.pointToSegmentDistance(c,m[h-1],m[0])))===0||(u=Math.min(u,Np(c,m,s)))===0)return u}return u}function x_(c,r,s,u){if(!Ha(r,c.length))return NaN;for(let h=r[0];h<=r[1];++h)if(ec(c[h],s,!0))return 0;let m=1/0;for(let h=r[0];h<r[1];++h)for(const g of s)for(let b=0,E=g.length,I=E-1;b<E;I=b++){if(Gh(c[h],c[h+1],g[I],g[b]))return 0;m=Math.min(m,Jh(c[h],c[h+1],g[I],g[b],u))}return m}function $p(c,r){for(const s of c)for(let u=0;u<=s.length-1;++u)if(ec(s[u],r,!0))return!0;return!1}function b_(c,r,s,u=1/0){const m=Kh(c),h=Kh(r);if(u!==1/0&&ic(m,h,s)>=u)return u;if(rl(m,h)){if($p(c,r))return 0}else if($p(r,c))return 0;let g=u;for(const b of c)for(let E=0,I=b.length,v=I-1;E<I;v=E++)for(const S of r)for(let P=0,A=S.length,M=A-1;P<A;M=P++){if(Gh(b[v],b[E],S[M],S[P]))return 0;g=Math.min(g,Jh(b[v],b[E],S[M],S[P],s))}return g}function wu(c,r,s,u,m,h,g){if(h===null||g===null)return;const b=ic(yo(u,h),yo(m,g),s);b<r&&c.push({dist:b,range1:h,range2:g})}function Qh(c,r,s,u,m=1/0){let h=Math.min(u.distance(c[0],s[0][0]),m);if(h===0)return h;const g=new Bp([{dist:0,range1:[0,c.length-1],range2:[0,0]}],d_),b=r?Zh:nc,E=Kh(s);for(;g.length;){const I=g.pop();if(I.dist>=h)continue;const v=I.range1;if(Yh(v)<=b){if(!Ha(v,c.length))return NaN;if(r){const S=x_(c,v,s,u);if((h=Math.min(h,S))===0)return h}else for(let S=v[0];S<=v[1];++S){const P=v_(c[S],s,u);if((h=Math.min(h,P))===0)return h}}else{const S=Fp(v,r);if(S[0]!==null){const P=ic(yo(c,S[0]),E,u);P<h&&g.push({dist:P,range1:S[0],range2:[0,0]})}if(S[1]!==null){const P=ic(yo(c,S[1]),E,u);P<h&&g.push({dist:P,range1:S[1],range2:[0,0]})}}}return h}function Tu(c,r,s,u,m,h=1/0){let g=Math.min(h,m.distance(c[0],s[0]));if(g===0)return g;const b=new Bp([{dist:0,range1:[0,c.length-1],range2:[0,s.length-1]}],d_),E=r?Zh:nc,I=u?Zh:nc;for(;b.length;){const v=b.pop();if(v.dist>=g)continue;const S=v.range1,P=v.range2;if(Yh(S)<=E&&Yh(P)<=I){if(!Ha(S,c.length)||!Ha(P,s.length))return NaN;if(r&&u?g=Math.min(g,y_(c,S,s,P,m)):r||u?r&&!u?g=Math.min(g,jp(s,P,c,S,m)):!r&&u&&(g=Math.min(g,jp(c,S,s,P,m))):g=Math.min(g,__(c,S,s,P,m)),g===0)return g}else{const A=Fp(S,r),M=Fp(P,u);wu(b,g,m,c,s,A[0],M[0]),wu(b,g,m,c,s,A[0],M[1]),wu(b,g,m,c,s,A[1],M[0]),wu(b,g,m,c,s,A[1],M[1])}}return g}function oc(c,r,s,u,m=1/0){let h=m;const g=yo(c,[0,c.length-1]);for(const b of s)if(!(h!==1/0&&ic(g,yo(b,[0,b.length-1]),u)>=h)&&(h=Math.min(h,Tu(c,r,b,!0,u,h)),h===0))return h;return h}function Su(c,r,s,u,m=1/0){let h=m;const g=yo(c,[0,c.length-1]);for(const b of s){if(h!==1/0&&ic(g,Kh(b),u)>=h)continue;const E=Qh(c,r,b,u,h);if(isNaN(E))return E;if((h=Math.min(h,E))===0)return h}return h}function ef(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class ws{constructor(r,s){this.type=Ut,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(xs(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let m=0;m<u.features.length;++m)if(ef(u.features[m].geometry.type))return new ws(u,u.features[m].geometry)}else if(u.type==="Feature"){if(ef(u.geometry.type))return new ws(u,u.geometry)}else if(ef(u.type))return new ws(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const s=r.geometry(),u=r.canonicalID();if(s!=null&&u!=null){if(r.geometryType()==="Point")return function(m,h,g){const b=[];for(const I of m)for(const v of I)b.push(_o(v,h));const E=new rc(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Tu(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?oc(b,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?Su(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null}(s,u,this.geometries);if(r.geometryType()==="LineString")return function(m,h,g){const b=[];for(const I of m){const v=[];for(const S of I)v.push(_o(S,h));b.push(v)}const E=new rc(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return oc(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let I=1/0;for(let v=0;v<g.coordinates.length;v++){const S=oc(g.coordinates[v],!0,b,E,I);if(isNaN(S))return S;if((I=Math.min(I,S))===0)return I}return I}if(g.type==="Polygon"||g.type==="MultiPolygon"){let I=1/0;for(let v=0;v<b.length;v++){const S=Su(b[v],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,I);if(isNaN(S))return S;if((I=Math.min(I,S))===0)return I}return I}return null}(s,u,this.geometries);if(r.geometryType()==="Polygon")return function(m,h,g){const b=[];for(const I of function(v,S){const P=v.length;if(P<=1)return[v];const A=[];let M,k;for(let R=0;R<P;R++){const N=_b(v[R]);N!==0&&(v[R].area=Math.abs(N),k===void 0&&(k=N<0),k===N<0?(M&&A.push(M),M=[v[R]]):M.push(v[R]))}return M&&A.push(M),A}(m)){const v=[];for(let S=0;S<I.length;++S)v.push(g_(I[S],h));b.push(v)}const E=new rc(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Su(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,E);if(g.type==="MultiLineString"){let I=1/0;for(let v=0;v<g.coordinates.length;v++){const S=Su(g.coordinates[v],!0,b,E,I);if(isNaN(S))return S;if((I=Math.min(I,S))===0)return I}return I}return g.type==="Polygon"||g.type==="MultiPolygon"?function(I,v,S){let P=1/0;for(const A of I)for(const M of v){const k=b_(A,M,S,P);if(isNaN(k))return k;if((P=Math.min(P,k))===0)return P}return P}(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ts(c,r){switch(c){case"string":return Ui(r);case"number":return+r;case"boolean":return!!r;case"color":return Vr.parse(r);case"formatted":return Di.fromString(Ui(r));case"resolvedImage":return $i.fromString(Ui(r))}return r}function kr(c,r,s,u){return u!==void 0&&(c=u*Math.round(c/u)),r!==void 0&&c<r&&(c=r),s!==void 0&&c>s&&(c=s),c}class ac{constructor(r,s,u){this.type=r,this.key=s,this.scope=u}static parse(r,s){let u=s.expectedType;if(u==null&&(u=Rr),r.length<2||r.length>3)return s.error("Invalid number of arguments for 'config' expression.");const m=s.parse(r[1],1);if(!(m instanceof Yo))return s.error("Key name of 'config' expression must be a string literal.");if(r.length>=3){const h=s.parse(r[2],2);return h instanceof Yo?new ac(u,Ui(m.value),Ui(h.value)):s.error("Scope of 'config' expression must be a string literal.")}return new ac(u,Ui(m.value))}evaluate(r){const s=[this.key,this.scope,r.scope].filter(Boolean).join(""),u=r.getConfig(s);if(!u)return null;const{type:m,value:h,values:g,minValue:b,maxValue:E,stepValue:I}=u,v=u.default.evaluate(r);let S=v;if(h){const P=r.scope;r.scope=(P||"").split("").slice(1).join(""),S=h.evaluate(r),r.scope=P}return m&&(S=Ts(m,S)),S===void 0||b===void 0&&E===void 0&&I===void 0||(typeof S=="number"?S=kr(S,b,E,I):Array.isArray(S)&&(S=S.map(P=>typeof P=="number"?kr(P,b,E,I):P))),h!==void 0&&S!==void 0&&g&&!g.includes(S)&&(S=v,m&&(S=Ts(m,S))),(m&&m!==this.type||S!==void 0&&Gn(S)!==this.type)&&(S=Ts(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.key),r}}function Au(c){if(c instanceof ro&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof bs||c instanceof ws)return!1;let r=!0;return c.eachChild(s=>{r&&!Au(s)&&(r=!1)}),r}function tf(c){if(c instanceof ro&&c.name==="feature-state")return!1;let r=!0;return c.eachChild(s=>{r&&!tf(s)&&(r=!1)}),r}function rf(c){if(c instanceof ac)return new Set([c.key]);let r=new Set;return c.eachChild(s=>{r=new Set([...r,...rf(s)])}),r}function Eu(c,r){if(c instanceof ro&&r.indexOf(c.name)>=0)return!1;let s=!0;return c.eachChild(u=>{s&&!Eu(u,r)&&(s=!1)}),s}class tn{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=r[1];return s.scope.has(u)?new tn(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Up{constructor(r,s=[],u,m=new Nh,h=[],g,b){this.registry=r,this.path=s,this.key=s.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=m,this.errors=h,this.expectedType=u,this._scope=g,this.options=b}parse(r,s,u,m,h={}){return s||u?this.concat(s,null,u,m)._parse(r,h):this._parse(r,h)}parseObjectValue(r,s,u,m,h,g={}){return this.concat(s,u,m,h)._parse(r,g)}_parse(r,s){function u(m,h,g){return g==="assert"?new Ko(h,[m]):g==="coerce"?new qa(h,[m]):m}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(m){let h=m.parse(r,this);if(!h)return null;if(this.expectedType){const g=this.expectedType,b=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else h=u(h,g,s.typeAnnotation||"coerce");else h=u(h,g,s.typeAnnotation||"assert")}if(!(h instanceof Yo)&&h.type.kind!=="resolvedImage"&&Vp(h)){const g=new u_(this._scope,this.options);try{h=new Yo(h.type,h.evaluate(g))}catch(b){return this.error(b.message),null}}return h}return qa.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,u,m){let h=typeof r=="number"?this.path.concat(r):this.path;h=typeof s=="string"?h.concat(s):h;const g=m?this.scope.concat(m):this.scope;return new Up(this.registry,h,u||null,g,this.errors,this._scope,this.options)}error(r,...s){const u=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new ga(u,r))}checkSubtype(r,s){const u=Xl(r,s);return u&&this.error(u),u}}var w_=Up;function Vp(c){if(c instanceof tn)return Vp(c.boundExpression);if(c instanceof ro&&c.name==="error"||c instanceof Vh||c instanceof bs||c instanceof ws||c instanceof ac)return!1;const r=c instanceof qa||c instanceof Ko;let s=!0;return c.eachChild(u=>{s=r?s&&Vp(u):s&&u instanceof Yo}),!!s&&Au(c)&&Eu(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function nf(c,r){const s=c.length-1;let u,m,h=0,g=s,b=0;for(;h<=g;)if(b=Math.floor((h+g)/2),u=c[b],m=c[b+1],u<=r){if(b===s||r<m)return b;h=b+1}else{if(!(u>r))throw new li("Input is not a number.");g=b-1}return 0}class Mu{constructor(r,s,u){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[m,h]of u)this.labels.push(m),this.outputs.push(h)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(r[1],1,Ut);if(!u)return null;const m=[];let h=null;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);for(let g=1;g<r.length;g+=2){const b=g===1?-1/0:r[g],E=r[g+1],I=g,v=g+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const S=s.parse(E,v,h);if(!S)return null;h=h||S.type,m.push([b,S])}return new Mu(h,u,m)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return u[0].evaluate(r);const h=s.length;return m>=s[h-1]?u[h-1].evaluate(r):u[nf(s,m)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}const T_=.95047,S_=1.08883,A_=4/29,sc=6/29,E_=3*sc*sc,xb=sc*sc*sc,bb=Math.PI/180,wb=180/Math.PI;function Gp(c){return c>xb?Math.pow(c,1/3):c/E_+A_}function qp(c){return c>sc?c*c*c:E_*(c-A_)}function Wp(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Hp(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function M_(c){const r=Hp(c.r),s=Hp(c.g),u=Hp(c.b),m=Gp((.4124564*r+.3575761*s+.1804375*u)/T_),h=Gp((.2126729*r+.7151522*s+.072175*u)/1);return{l:116*h-16,a:500*(m-h),b:200*(h-Gp((.0193339*r+.119192*s+.9503041*u)/S_)),alpha:c.a}}function P_(c){let r=(c.l+16)/116,s=isNaN(c.a)?r:r+c.a/500,u=isNaN(c.b)?r:r-c.b/200;return r=1*qp(r),s=T_*qp(s),u=S_*qp(u),new Vr(Wp(3.2404542*s-1.5371385*r-.4985314*u),Wp(-.969266*s+1.8760108*r+.041556*u),Wp(.0556434*s-.2040259*r+1.0572252*u),c.alpha)}function Tb(c,r,s){const u=r-c;return c+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Pu={forward:M_,reverse:P_,interpolate:function(c,r,s){return{l:nr(c.l,r.l,s),a:nr(c.a,r.a,s),b:nr(c.b,r.b,s),alpha:nr(c.alpha,r.alpha,s)}}},Iu={forward:function(c){const{l:r,a:s,b:u}=M_(c),m=Math.atan2(u,s)*wb;return{h:m<0?m+360:m,c:Math.sqrt(s*s+u*u),l:r,alpha:c.a}},reverse:function(c){const r=c.h*bb,s=c.c;return P_({l:c.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:c.alpha})},interpolate:function(c,r,s){return{h:Tb(c.h,r.h,s),c:nr(c.c,r.c,s),l:nr(c.l,r.l,s),alpha:nr(c.alpha,r.alpha,s)}}};var I_=Object.freeze({__proto__:null,hcl:Iu,lab:Pu});class vo{constructor(r,s,u,m,h){this.type=r,this.operator=s,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[g,b]of h)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(r,s,u,m){let h=0;if(r.name==="exponential")h=Zp(s,r.base,u,m);else if(r.name==="linear")h=Zp(s,1,u,m);else if(r.name==="cubic-bezier"){const g=r.controlPoints;h=new yn(g[0],g[1],g[2],g[3]).solve(Zp(s,1,u,m))}return h}static parse(r,s){let[u,m,h,...g]=r;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const I=m[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:I}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const I=m.slice(1);if(I.length!==4||I.some(v=>typeof v!="number"||v<0||v>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(h=s.parse(h,2,Ut),!h)return null;const b=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=to:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let I=0;I<g.length;I+=2){const v=g[I],S=g[I+1],P=I+3,A=I+4;if(typeof v!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(b.length&&b[b.length-1][0]>=v)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const M=s.parse(S,A,E);if(!M)return null;E=E||M.type,b.push([v,M])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new vo(E,u,m,h,b):s.error(`Type ${Ln(E)} is not interpolatable.`)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return u[0].evaluate(r);const h=s.length;if(m>=s[h-1])return u[h-1].evaluate(r);const g=nf(s,m),b=vo.interpolationFactor(this.interpolation,m,s[g],s[g+1]),E=u[g].evaluate(r),I=u[g+1].evaluate(r);return this.operator==="interpolate"?Qs[this.type.kind.toLowerCase()](E,I,b):this.operator==="interpolate-hcl"?Iu.reverse(Iu.interpolate(Iu.forward(E),Iu.forward(I),b)):Pu.reverse(Pu.interpolate(Pu.forward(E),Pu.forward(I),b))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Zp(c,r,s,u){const m=u-s,h=c-s;return m===0?0:r===1?h/m:(Math.pow(r,h)-1)/(Math.pow(r,m)-1)}class of{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let u=null;const m=s.expectedType;m&&m.kind!=="value"&&(u=m);const h=[];for(const b of r.slice(1)){const E=s.parse(b,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,h.push(E)}const g=m&&h.some(b=>Xl(m,b.type));return new of(g?Rr:u,h)}evaluate(r){let s,u=null,m=0;for(const h of this.args){if(m++,u=h.evaluate(r),u&&u instanceof $i&&!u.available&&(s||(s=u),u=null,m===this.args.length))return s;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class af{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let h=1;h<r.length-1;h+=2){const g=r[h];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",h);const b=s.parse(r[h+1],h+1);if(!b)return null;u.push([g,b])}const m=s.parse(r[r.length-1],r.length-1,s.expectedType,u);return m?new af(u,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,u]of this.bindings)r.push(s,u.serialize());return r.push(this.result.serialize()),r}}class Xp{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Ut),m=s.parse(r[2],2,ji(s.expectedType||Rr));return u&&m?new Xp(m.type.itemType,u,m):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new li(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new li(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new li(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Yp{constructor(r,s){this.type=Or,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Rr),m=s.parse(r[2],2,Rr);return u&&m?Yl(u.type,[Or,Cr,Ut,Xo,Rr])?new Yp(u,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(u.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!ya(s,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(Gn(s))} instead.`);if(!ya(u,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${Ln(Gn(u))} instead.`);return u.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class sf{constructor(r,s,u){this.type=Ut,this.needle=r,this.haystack=s,this.fromIndex=u}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Rr),m=s.parse(r[2],2,Rr);if(!u||!m)return null;if(!Yl(u.type,[Or,Cr,Ut,Xo,Rr]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(u.type)} instead`);if(r.length===4){const h=s.parse(r[3],3,Ut);return h?new sf(u,m,h):null}return new sf(u,m)}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!ya(s,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(Gn(s))} instead.`);if(!ya(u,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${Ln(Gn(u))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return u.indexOf(s,m)}return u.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Kp{constructor(r,s,u,m,h,g){this.inputType=r,this.type=s,this.input=u,this.cases=m,this.outputs=h,this.otherwise=g}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let u,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const h={},g=[];for(let I=2;I<r.length-1;I+=2){let v=r[I];const S=r[I+1];Array.isArray(v)||(v=[v]);const P=s.concat(I);if(v.length===0)return P.error("Expected at least one branch label.");for(const M of v){if(typeof M!="number"&&typeof M!="string")return P.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return P.error("Numeric branch labels must be integer values.");if(u){if(P.checkSubtype(u,Gn(M)))return null}else u=Gn(M);if(h[String(M)]!==void 0)return P.error("Branch labels must be unique.");h[String(M)]=g.length}const A=s.parse(S,I,m);if(!A)return null;m=m||A.type,g.push(A)}const b=s.parse(r[1],1,Rr);if(!b)return null;const E=s.parse(r[r.length-1],r.length-1,m);return E?b.type.kind!=="value"&&s.concat(1).checkSubtype(u,b.type)?null:new Kp(u,m,b,h,g,E):null}evaluate(r){const s=this.input.evaluate(r);return(Gn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],m={};for(const g of s){const b=m[this.cases[g]];b===void 0?(m[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[b][1].push(g)}const h=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of u)r.push(b.length===1?h(b[0]):b.map(h)),r.push(this.outputs[g].serialize());return r.push(this.otherwise.serialize()),r}}class Cu{constructor(r,s,u){this.type=r,this.branches=s,this.otherwise=u}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const m=[];for(let g=1;g<r.length-1;g+=2){const b=s.parse(r[g],g,Or);if(!b)return null;const E=s.parse(r[g+1],g+1,u);if(!E)return null;m.push([b,E]),u=u||E.type}const h=s.parse(r[r.length-1],r.length-1,u);return h?new Cu(u,m,h):null}evaluate(r){for(const[s,u]of this.branches)if(s.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,u]of this.branches)r(s),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class lf{constructor(r,s,u,m){this.type=r,this.input=s,this.beginIndex=u,this.endIndex=m}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Rr),m=s.parse(r[2],2,Ut);if(!u||!m)return null;if(!Yl(u.type,[ji(Rr),Cr,Rr]))return s.error(`Expected first argument to be of type array or string, but found ${Ln(u.type)} instead`);if(r.length===4){const h=s.parse(r[3],3,Ut);return h?new lf(u.type,u,m,h):null}return new lf(u.type,u,m)}evaluate(r){const s=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!ya(s,["string","array"]))throw new li(`Expected first argument to be of type array or string, but found ${Ln(Gn(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return s.slice(u,m)}return s.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jp(c,r){return c==="=="||c==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function C_(c,r,s,u){return u.compare(r,s)===0}function lc(c,r,s){const u=c!=="=="&&c!=="!=";return class Dj{constructor(h,g,b){this.type=Or,this.lhs=h,this.rhs=g,this.collator=b,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");const b=h[0];let E=g.parse(h[1],1,Rr);if(!E)return null;if(!Jp(b,E.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Ln(E.type)}'.`);let I=g.parse(h[2],2,Rr);if(!I)return null;if(!Jp(b,I.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Ln(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return g.error(`Cannot compare types '${Ln(E.type)}' and '${Ln(I.type)}'.`);u&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new Ko(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ko(E.type,[I])));let v=null;if(h.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(v=g.parse(h[3],3,jh),!v)return null}return new Dj(E,I,v)}evaluate(h){const g=this.lhs.evaluate(h),b=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const E=Gn(g),I=Gn(b);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new li(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=Gn(g),I=Gn(b);if(E.kind!=="string"||I.kind!=="string")return r(h,g,b)}return this.collator?s(h,g,b,this.collator.evaluate(h)):r(h,g,b)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(g=>{h.push(g.serialize())}),h}}}const Sb=lc("==",function(c,r,s){return r===s},C_),O_=lc("!=",function(c,r,s){return r!==s},function(c,r,s,u){return!C_(0,r,s,u)}),k_=lc("<",function(c,r,s){return r<s},function(c,r,s,u){return u.compare(r,s)<0}),cc=lc(">",function(c,r,s){return r>s},function(c,r,s,u){return u.compare(r,s)>0}),D_=lc("<=",function(c,r,s){return r<=s},function(c,r,s,u){return u.compare(r,s)<=0}),L_=lc(">=",function(c,r,s){return r>=s},function(c,r,s,u){return u.compare(r,s)>=0});class Qp{constructor(r,s,u,m,h,g){this.type=Cr,this.number=r,this.locale=s,this.currency=u,this.unit=m,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const u=s.parse(r[1],1,Ut);if(!u)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let h=null;if(m.locale&&(h=s.parseObjectValue(m.locale,2,"locale",Cr),!h))return null;let g=null;if(m.currency&&(g=s.parseObjectValue(m.currency,2,"currency",Cr),!g))return null;let b=null;if(m.unit&&(b=s.parseObjectValue(m.unit,2,"unit",Cr),!b))return null;let E=null;if(m["min-fraction-digits"]&&(E=s.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",Ut),!E))return null;let I=null;return m["max-fraction-digits"]&&(I=s.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",Ut),!I)?null:new Qp(u,h,g,b,E,I)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ou{constructor(r){this.type=Ut,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=s.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ln(u.type)} instead.`):new Ou(u):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string"||Array.isArray(s))return s.length;throw new li(`Expected value to be of type string or array, but found ${Ln(Gn(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}function cf(c){return function(){c=1831565813+(c|=0)|0;let r=Math.imul(c^c>>>15,1|c);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const uc={"==":Sb,"!=":O_,">":cc,"<":k_,">=":L_,"<=":D_,array:Ko,at:Xp,boolean:Ko,case:Cu,coalesce:of,collator:Vh,format:Kl,image:el,in:Yp,"index-of":sf,interpolate:vo,"interpolate-hcl":vo,"interpolate-lab":vo,length:Ou,let:af,literal:Yo,match:Kp,number:Ko,"number-format":Qp,object:Ko,slice:lf,step:Mu,string:Ko,"to-boolean":qa,"to-color":qa,"to-number":qa,"to-string":qa,var:tn,within:bs,distance:ws,config:ac};function R_(c,[r,s,u,m]){r=r.evaluate(c),s=s.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=c_(r,s,u,h);if(g)throw new li(g);return new Vr(r/255*h,s/255*h,u/255*h,h)}function em(c,[r,s,u,m]){r=r.evaluate(c),s=s.evaluate(c),u=u.evaluate(c);const h=m?m.evaluate(c):1,g=function(I,v,S,P){return typeof I=="number"&&I>=0&&I<=360?typeof v=="number"&&v>=0&&v<=100&&typeof S=="number"&&S>=0&&S<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[I,v,S,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[I,v,S,P]:[I,v,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[I,v,S,P]:[I,v,S]).join(", ")}]: 'h' must be between 0 and 360.`}(r,s,u,h);if(g)throw new li(g);const b=`hsla(${r}, ${s}%, ${u}%, ${h})`,E=Vr.parse(b);if(!E)throw new li(`Failed to parse HSLA color: ${b}`);return E}function tm(c,r){return c in r}function rm(c,r){const s=r[c];return s===void 0?null:s}function il(c){return{type:c}}function z_(c){return{result:"success",value:c}}function Ss(c){return{result:"error",value:c}}function nm(c,r){return!!c&&!!c.parameters&&c.parameters.indexOf(r)>-1}function uf(c){return c["property-type"]==="data-driven"}function im(c){return nm(c.expression,"measure-light")}function B_(c){return nm(c.expression,"zoom")}function om(c){return!!c.expression&&c.expression.interpolated}function hf(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function F_(c){return c}function N_(c,r){const s=r.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",m=u||!(u||c.property!==void 0),h=c.type||(om(r)?"exponential":"interval");if(s&&((c=Wl({},c)).stops&&(c.stops=c.stops.map(I=>[I[0],Vr.parse(I[1])])),c.default=Vr.parse(c.default?c.default:r.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!I_[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let g,b,E;if(h==="exponential")g=$_;else if(h==="interval")g=j_;else if(h==="categorical"){g=Ab,b=Object.create(null);for(const I of c.stops)b[I[0]]=I[1];E=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=Eb}if(u){const I={},v=[];for(let A=0;A<c.stops.length;A++){const M=c.stops[A],k=M[0].zoom;I[k]===void 0&&(I[k]={zoom:k,type:c.type,property:c.property,default:c.default,stops:[]},v.push(k)),I[k].stops.push([M[0].value,M[1]])}const S=[];for(const A of v)S.push([I[A].zoom,N_(I[A],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:vo.interpolationFactor.bind(void 0,P),zoomStops:S.map(A=>A[0]),evaluate:({zoom:A},M)=>$_({stops:S,base:c.base},r,A).evaluate(A,M)}}if(m){const I=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:vo.interpolationFactor.bind(void 0,I),zoomStops:c.stops.map(v=>v[0]),evaluate:({zoom:v})=>g(c,r,v,b,E)}}return{kind:"source",evaluate(I,v){const S=v&&v.properties?v.properties[c.property]:void 0;return S===void 0?ku(c.default,r.default):g(c,r,S,b,E)}}}function ku(c,r,s){return c!==void 0?c:r!==void 0?r:s!==void 0?s:void 0}function Ab(c,r,s,u,m){return ku(typeof s===m?u[s]:void 0,c.default,r.default)}function j_(c,r,s){if(tl(s)!=="number")return ku(c.default,r.default);const u=c.stops.length;if(u===1||s<=c.stops[0][0])return c.stops[0][1];if(s>=c.stops[u-1][0])return c.stops[u-1][1];const m=nf(c.stops.map(h=>h[0]),s);return c.stops[m][1]}function $_(c,r,s){const u=c.base!==void 0?c.base:1;if(tl(s)!=="number")return ku(c.default,r.default);const m=c.stops.length;if(m===1||s<=c.stops[0][0])return c.stops[0][1];if(s>=c.stops[m-1][0])return c.stops[m-1][1];const h=nf(c.stops.map(v=>v[0]),s),g=function(v,S,P,A){const M=A-P,k=v-P;return M===0?0:S===1?k/M:(Math.pow(S,k)-1)/(Math.pow(S,M)-1)}(s,u,c.stops[h][0],c.stops[h+1][0]),b=c.stops[h][1],E=c.stops[h+1][1];let I=Qs[r.type]||F_;if(c.colorSpace&&c.colorSpace!=="rgb"){const v=I_[c.colorSpace];I=(S,P)=>v.reverse(v.interpolate(v.forward(S),v.forward(P),g))}return typeof b.evaluate=="function"?{evaluate(...v){const S=b.evaluate.apply(void 0,v),P=E.evaluate.apply(void 0,v);if(S!==void 0&&P!==void 0)return I(S,P,g)}}:I(b,E,g)}function Eb(c,r,s){return r.type==="color"?s=Vr.parse(s):r.type==="formatted"?s=Di.fromString(s.toString()):r.type==="resolvedImage"?s=$i.fromString(s.toString()):tl(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0),ku(s,c.default,r.default)}ro.register(uc,{error:[{kind:"error"},[Cr],(c,[r])=>{throw new li(r.evaluate(c))}],typeof:[Cr,[Rr],(c,[r])=>Ln(Gn(r.evaluate(c)))],"to-rgba":[ji(Ut,4),[to],(c,[r])=>r.evaluate(c).toRenderColor(null).toArray()],rgb:[to,[Ut,Ut,Ut],R_],rgba:[to,[Ut,Ut,Ut,Ut],R_],hsl:[to,[Ut,Ut,Ut],em],hsla:[to,[Ut,Ut,Ut,Ut],em],has:{type:Or,overloads:[[[Cr],(c,[r])=>tm(r.evaluate(c),c.properties())],[[Cr,ki],(c,[r,s])=>tm(r.evaluate(c),s.evaluate(c))]]},get:{type:Rr,overloads:[[[Cr],(c,[r])=>rm(r.evaluate(c),c.properties())],[[Cr,ki],(c,[r,s])=>rm(r.evaluate(c),s.evaluate(c))]]},"feature-state":[Rr,[Cr],(c,[r])=>rm(r.evaluate(c),c.featureState||{})],properties:[ki,[],c=>c.properties()],"geometry-type":[Cr,[],c=>c.geometryType()],id:[Rr,[],c=>c.id()],zoom:[Ut,[],c=>c.globals.zoom],pitch:[Ut,[],c=>c.globals.pitch||0],"distance-from-center":[Ut,[],c=>c.distanceFromCenter()],"measure-light":[Ut,[Cr],(c,[r])=>c.measureLight(r.evaluate(c))],"heatmap-density":[Ut,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ut,[],c=>c.globals.lineProgress||0],"raster-value":[Ut,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[Ut,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],c=>c.globals.skyRadialProgress||0],accumulated:[Rr,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ut,il(Ut),(c,r)=>{let s=0;for(const u of r)s+=u.evaluate(c);return s}],"*":[Ut,il(Ut),(c,r)=>{let s=1;for(const u of r)s*=u.evaluate(c);return s}],"-":{type:Ut,overloads:[[[Ut,Ut],(c,[r,s])=>r.evaluate(c)-s.evaluate(c)],[[Ut],(c,[r])=>-r.evaluate(c)]]},"/":[Ut,[Ut,Ut],(c,[r,s])=>r.evaluate(c)/s.evaluate(c)],"%":[Ut,[Ut,Ut],(c,[r,s])=>r.evaluate(c)%s.evaluate(c)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(c,[r,s])=>Math.pow(r.evaluate(c),s.evaluate(c))],sqrt:[Ut,[Ut],(c,[r])=>Math.sqrt(r.evaluate(c))],log10:[Ut,[Ut],(c,[r])=>Math.log(r.evaluate(c))/Math.LN10],ln:[Ut,[Ut],(c,[r])=>Math.log(r.evaluate(c))],log2:[Ut,[Ut],(c,[r])=>Math.log(r.evaluate(c))/Math.LN2],sin:[Ut,[Ut],(c,[r])=>Math.sin(r.evaluate(c))],cos:[Ut,[Ut],(c,[r])=>Math.cos(r.evaluate(c))],tan:[Ut,[Ut],(c,[r])=>Math.tan(r.evaluate(c))],asin:[Ut,[Ut],(c,[r])=>Math.asin(r.evaluate(c))],acos:[Ut,[Ut],(c,[r])=>Math.acos(r.evaluate(c))],atan:[Ut,[Ut],(c,[r])=>Math.atan(r.evaluate(c))],min:[Ut,il(Ut),(c,r)=>Math.min(...r.map(s=>s.evaluate(c)))],max:[Ut,il(Ut),(c,r)=>Math.max(...r.map(s=>s.evaluate(c)))],abs:[Ut,[Ut],(c,[r])=>Math.abs(r.evaluate(c))],round:[Ut,[Ut],(c,[r])=>{const s=r.evaluate(c);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ut,[Ut],(c,[r])=>Math.floor(r.evaluate(c))],ceil:[Ut,[Ut],(c,[r])=>Math.ceil(r.evaluate(c))],"filter-==":[Or,[Cr,Rr],(c,[r,s])=>c.properties()[r.value]===s.value],"filter-id-==":[Or,[Rr],(c,[r])=>c.id()===r.value],"filter-type-==":[Or,[Cr],(c,[r])=>c.geometryType()===r.value],"filter-<":[Or,[Cr,Rr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u<m}],"filter-id-<":[Or,[Rr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s<u}],"filter->":[Or,[Cr,Rr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u>m}],"filter-id->":[Or,[Rr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s>u}],"filter-<=":[Or,[Cr,Rr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[Or,[Rr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s<=u}],"filter->=":[Or,[Cr,Rr],(c,[r,s])=>{const u=c.properties()[r.value],m=s.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[Or,[Rr],(c,[r])=>{const s=c.id(),u=r.value;return typeof s==typeof u&&s>=u}],"filter-has":[Or,[Rr],(c,[r])=>r.value in c.properties()],"filter-has-id":[Or,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Or,[ji(Cr)],(c,[r])=>r.value.indexOf(c.geometryType())>=0],"filter-id-in":[Or,[ji(Rr)],(c,[r])=>r.value.indexOf(c.id())>=0],"filter-in-small":[Or,[Cr,ji(Rr)],(c,[r,s])=>s.value.indexOf(c.properties()[r.value])>=0],"filter-in-large":[Or,[Cr,ji(Rr)],(c,[r,s])=>function(u,m,h,g){for(;h<=g;){const b=h+g>>1;if(m[b]===u)return!0;m[b]>u?g=b-1:h=b+1}return!1}(c.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Or,overloads:[[[Or,Or],(c,[r,s])=>r.evaluate(c)&&s.evaluate(c)],[il(Or),(c,r)=>{for(const s of r)if(!s.evaluate(c))return!1;return!0}]]},any:{type:Or,overloads:[[[Or,Or],(c,[r,s])=>r.evaluate(c)||s.evaluate(c)],[il(Or),(c,r)=>{for(const s of r)if(s.evaluate(c))return!0;return!1}]]},"!":[Or,[Or],(c,[r])=>!r.evaluate(c)],"is-supported-script":[Or,[Cr],(c,[r])=>{const s=c.globals&&c.globals.isSupportedScript;return!s||s(r.evaluate(c))}],upcase:[Cr,[Cr],(c,[r])=>r.evaluate(c).toUpperCase()],downcase:[Cr,[Cr],(c,[r])=>r.evaluate(c).toLowerCase()],concat:[Cr,il(Rr),(c,r)=>r.map(s=>Ui(s.evaluate(c))).join("")],"resolved-locale":[Cr,[jh],(c,[r])=>r.evaluate(c).resolvedLocale()],random:[Ut,[Ut,Ut,Rr],(c,r)=>{const[s,u,m]=r.map(g=>g.evaluate(c));if(s>u||s===u)return s;let h;if(typeof m=="string")h=function(g){let b=0;if(g.length===0)return b;for(let E=0;E<g.length;E++)b=(b<<5)-b+g.charCodeAt(E),b|=0;return b}(m);else{if(typeof m!="number")throw new li(`Invalid seed input: ${m}`);h=m}return s+cf(h)()*(u-s)}]});class ff{constructor(r,s,u,m){this.expression=r,this._warningHistory={},this._evaluator=new u_(u,m),this._defaultValue=s?function(h){return h.type==="color"&&(hf(h.default)||Array.isArray(h.default))?new Vr(0,0,0,0):h.type==="color"?Vr.parse(h.default)||null:h.default===void 0?null:h.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(r,s,u,m,h,g,b,E){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,u,m,h,g,b,E){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new li(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function df(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in uc}function Du(c,r,s,u){const m=new w_(uc,[],r?function(g){const b={color:to,string:Cr,number:Ut,enum:Cr,boolean:Or,formatted:Hl,resolvedImage:Zl};return g.type==="array"?ji(b[g.value]||Rr,g.length):b[g.type]}(r):void 0,void 0,void 0,s,u),h=m.parse(c,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?z_(new ff(h,r,s,u)):Ss(m.errors)}class am{constructor(r,s,u){this.kind=r,this._styleExpression=s,this.isLightConstant=u,this.isStateDependent=r!=="constant"&&!tf(s.expression),this.configDependencies=rf(s.expression)}evaluateWithoutErrorHandling(r,s,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,m,h,g)}evaluate(r,s,u,m,h,g){return this._styleExpression.evaluate(r,s,u,m,h,g)}}class _a{constructor(r,s,u,m,h){this.kind=r,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!tf(s.expression),this.isLightConstant=h,this.configDependencies=rf(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,s,u,m,h,g){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,m,h,g)}evaluate(r,s,u,m,h,g){return this._styleExpression.evaluate(r,s,u,m,h,g)}interpolationFactor(r,s,u){return this.interpolationType?vo.interpolationFactor(this.interpolationType,r,s,u):0}}function U_(c,r,s,u){if((c=Du(c,r,s,u)).result==="error")return c;const m=c.value.expression,h=Au(m);if(!h&&!uf(r))return Ss([new ga("","data expressions not supported")]);const g=Eu(m,["zoom","pitch","distance-from-center"]);if(!g&&!B_(r))return Ss([new ga("","zoom expressions not supported")]);const b=Eu(m,["measure-light"]);if(!b&&!im(r))return Ss([new ga("","measure-light expression not supported")]);const E=r.expression&&r.expression.relaxZoomRestriction,I=mf(m);return I||g||E?I instanceof ga?Ss([I]):I instanceof vo&&!om(r)?Ss([new ga("",'"interpolate" expressions cannot be used with this property')]):z_(I?new _a(h?"camera":"composite",c.value,I.labels,I instanceof vo?I.interpolation:void 0,b):new am(h?"constant":"source",c.value,b)):Ss([new ga("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pf{constructor(r,s){this._parameters=r,this._specification=s,Wl(this,N_(this._parameters,this._specification))}static deserialize(r){return new pf(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function mf(c){let r=null;if(c instanceof af)r=mf(c.result);else if(c instanceof of){for(const s of c.args)if(r=mf(s),r)break}else(c instanceof Mu||c instanceof vo)&&c.input instanceof ro&&c.input.name==="zoom"&&(r=c);return r instanceof ga||c.eachChild(s=>{const u=mf(s);u instanceof ga?r=u:r&&u&&r!==u&&(r=new ga("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var gf,sm,V_=function(){if(sm)return gf;sm=1,gf=r;var c=3;function r(s,u,m){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(m=g[2]);for(var b=0;b<this.d*this.d;b++){var E=g[c+b],I=g[c+b+1];h.push(E===I?null:g.subarray(E,I))}var v=g[c+h.length+1];this.keys=g.subarray(g[c+h.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=u+2*m;for(var S=0;S<this.d*this.d;S++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=m,this.scale=u/s,this.uid=0;var P=m/u*s;this.min=-P,this.max=s+P}return r.prototype.insert=function(s,u,m,h,g){this._forEachCell(u,m,h,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(h),this.bboxes.push(g)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(s,u,m,h,g,b){this.cells[g].push(b)},r.prototype.query=function(s,u,m,h,g){var b=this.min,E=this.max;if(s<=b&&u<=b&&E<=m&&E<=h&&!g)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(s,u,m,h,this._queryCell,I,{},g),I},r.prototype._queryCell=function(s,u,m,h,g,b,E,I){var v=this.cells[g];if(v!==null)for(var S=this.keys,P=this.bboxes,A=0;A<v.length;A++){var M=v[A];if(E[M]===void 0){var k=4*M;(I?I(P[k+0],P[k+1],P[k+2],P[k+3]):s<=P[k+2]&&u<=P[k+3]&&m>=P[k+0]&&h>=P[k+1])?(E[M]=!0,b.push(S[M])):E[M]=!1}}},r.prototype._forEachCell=function(s,u,m,h,g,b,E,I){for(var v=this._convertToCellCoord(s),S=this._convertToCellCoord(u),P=this._convertToCellCoord(m),A=this._convertToCellCoord(h),M=v;M<=P;M++)for(var k=S;k<=A;k++){var R=this.d*k+M;if((!I||I(this._convertFromCellCoord(M),this._convertFromCellCoord(k),this._convertFromCellCoord(M+1),this._convertFromCellCoord(k+1)))&&g.call(this,s,u,m,h,R,b,E,I))return}},r.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},r.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=c+this.cells.length+1+1,m=0,h=0;h<this.cells.length;h++)m+=this.cells[h].length;var g=new Int32Array(u+m+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=u,E=0;E<s.length;E++){var I=s[E];g[c+E]=b,g.set(I,b),b+=I.length}return g[c+s.length]=b,g.set(this.keys,b),g[c+s.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},gf}(),ol=L(V_);const hc={};function $t(c,r,s={}){Object.defineProperty(c,"_classRegistryKey",{value:r,writable:!1}),hc[r]={klass:c,omit:s.omit||[]}}$t(Object,"Object"),ol.serialize=function(c,r){const s=c.toArrayBuffer();return r&&r.add(s),{buffer:s}},ol.deserialize=function(c){return new ol(c.buffer)},Object.defineProperty(ol,"name",{value:"Grid"}),$t(ol,"Grid"),$t(Vr,"Color"),$t(Error,"Error"),$t(Di,"Formatted"),$t(mo,"FormattedSection"),$t(Ap,"AJAXError"),$t($i,"ResolvedImage"),$t(pf,"StylePropertyFunction"),$t(ff,"StyleExpression",{omit:["_evaluator"]}),$t(_a,"ZoomDependentExpression"),$t(am,"ZoomConstantExpression"),$t(ro,"CompoundExpression",{omit:["_evaluate"]});for(const c in uc)hc[uc[c]._classRegistryKey]||$t(uc[c],`Expression${c}`);function lm(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function G_(c){return self.ImageBitmap&&c instanceof ImageBitmap}function no(c,r){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(lm(c)||G_(c))return r&&r.add(c),c;if(ArrayBuffer.isView(c)){const s=c;return r&&r.add(s.buffer),s}if(c instanceof ImageData)return r&&r.add(c.data.buffer),c;if(Array.isArray(c)){const s=[];for(const u of c)s.push(no(u,r));return s}if(c instanceof Map){const s={$name:"Map"};for(const[u,m]of c.entries())s[u]=no(m);return s}if(c instanceof Set){const s={$name:"Set"};let u=0;for(const m of c.values())s[++u]=no(m);return s}if(typeof c=="object"){const s=c.constructor,u=s._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const m=s.serialize?s.serialize(c,r):{};if(!s.serialize){for(const h in c)c.hasOwnProperty(h)&&(hc[u].omit.indexOf(h)>=0||(m[h]=no(c[h],r)));c instanceof Error&&(m.message=c.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(m.$name=u),m}throw new Error("can't serialize object of type "+typeof c)}function al(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||lm(c)||G_(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(al);if(typeof c=="object"){const r=c.$name||"Object";if(r==="Map"){const m=new Map;for(const h of Object.keys(c))h!=="$name"&&m.set(h,al(c[h]));return m}if(r==="Set"){const m=new Set;for(const h of Object.keys(c))h!=="$name"&&m.add(al(c[h]));return m}const{klass:s}=hc[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(c);const u=Object.create(s.prototype);for(const m of Object.keys(c))m!=="$name"&&(u[m]=al(c[m]));return u}throw new Error("can't deserialize object of type "+typeof c)}const Ht={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function yf(c){for(const r of c)if(vf(r.charCodeAt(0)))return!0;return!1}function Mb(c){for(const r of c)if(!_f(r.charCodeAt(0)))return!1;return!0}function _f(c){return!(Ht.Arabic(c)||Ht["Arabic Supplement"](c)||Ht["Arabic Extended-A"](c)||Ht["Arabic Presentation Forms-A"](c)||Ht["Arabic Presentation Forms-B"](c))}function vf(c){return!(c!==746&&c!==747&&(c<4352||!(Ht["Bopomofo Extended"](c)||Ht.Bopomofo(c)||Ht["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ht["CJK Compatibility Ideographs"](c)||Ht["CJK Compatibility"](c)||Ht["CJK Radicals Supplement"](c)||Ht["CJK Strokes"](c)||!(!Ht["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ht["CJK Unified Ideographs Extension A"](c)||Ht["CJK Unified Ideographs"](c)||Ht["Enclosed CJK Letters and Months"](c)||Ht["Hangul Compatibility Jamo"](c)||Ht["Hangul Jamo Extended-A"](c)||Ht["Hangul Jamo Extended-B"](c)||Ht["Hangul Jamo"](c)||Ht["Hangul Syllables"](c)||Ht.Hiragana(c)||Ht["Ideographic Description Characters"](c)||Ht.Kanbun(c)||Ht["Kangxi Radicals"](c)||Ht["Katakana Phonetic Extensions"](c)||Ht.Katakana(c)&&c!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ht["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](c)||Ht["Unified Canadian Aboriginal Syllabics Extended"](c)||Ht["Vertical Forms"](c)||Ht["Yijing Hexagram Symbols"](c)||Ht["Yi Syllables"](c)||Ht["Yi Radicals"](c))))}function Lu(c){return!(vf(c)||function(r){return!!(Ht["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ht["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ht["Letterlike Symbols"](r)||Ht["Number Forms"](r)||Ht["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ht["Control Pictures"](r)&&r!==9251||Ht["Optical Character Recognition"](r)||Ht["Enclosed Alphanumerics"](r)||Ht["Geometric Shapes"](r)||Ht["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ht["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ht["CJK Symbols and Punctuation"](r)||Ht.Katakana(r)||Ht["Private Use Area"](r)||Ht["CJK Compatibility Forms"](r)||Ht["Small Form Variants"](r)||Ht["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(c))}function cm(c){return c>=1424&&c<=2303||Ht["Arabic Presentation Forms-A"](c)||Ht["Arabic Presentation Forms-B"](c)}function Pb(c,r){return!(!r&&cm(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ht.Khmer(c))}function Ib(c){for(const r of c)if(cm(r.charCodeAt(0)))return!0;return!1}const Ru="deferred",zu="loading",xf="loaded";let fc=null,pi="unavailable",As=null;const q_=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(pi="error"),fc&&fc(c)};function um(){hm.fire(new vs("pluginStateChange",{pluginStatus:pi,pluginURL:As}))}const hm=new ql,fm=function(){return pi},dm=function(){if(pi!==Ru||!As)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pi=zu,um(),As&&Vl({url:As},c=>{c?q_(c):(pi=xf,um())})},io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>pi===xf||io.applyArabicShaping!=null,isLoading:()=>pi===zu,setState(c){pi=c.pluginStatus,As=c.pluginURL},isParsed:()=>io.applyArabicShaping!=null&&io.processBidirectionalText!=null&&io.processStyledBidirectionalText!=null,getPluginURL:()=>As};class Cn{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(s,u){for(const m of s)if(!Pb(m.charCodeAt(0),u))return!1;return!0}(r,io.isLoaded())}}class bf{constructor(r,s,u,m){this.property=r,this.value=s,this.expression=function(h,g,b,E){if(hf(h))return new pf(h,g);if(df(h)||Array.isArray(h)&&h.length>0){const I=U_(h,g,b,E);if(I.result==="error")throw new Error(I.value.map(v=>`${v.key}: ${v.message}`).join(", "));return I.value}{let I=h;return typeof h=="string"&&g.type==="color"&&(I=Vr.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(s===void 0?r.specification.default:s,r.specification,u,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,s,u){return this.property.possiblyEvaluate(this,r,s,u)}}class pm{constructor(r,s,u){this.property=r,this.value=new bf(r,void 0,s,u)}transitioned(r,s){return new H_(this.property,this.value,s,Oi({},r.transition,this.transition),r.now)}untransitioned(){return new H_(this.property,this.value,null,{},0)}}class W_{constructor(r,s,u){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(r){return Co(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new pm(this._values[r].property,this._scope,this._options)),this._values[r].value=new bf(this._values[r].property,s===null?void 0:Co(s),this._scope,this._options),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,s){s&&(this._options=s);const u=this._properties.properties;if(r)for(const m in r){const h=r[m];if(Va(m,"-transition")){const g=m.slice(0,-11);u[g]&&this.setTransition(g,h)}else u.hasOwnProperty(m)&&this.setValue(m,h)}}getTransition(r){return Co(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new pm(this._values[r].property)),this._values[r].transition=Co(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u);const m=this.getTransition(s);m!==void 0&&(r[`${s}-transition`]=m)}return r}transitioned(r,s){const u=new Z_(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(r,s._values[m]);return u}untransitioned(){const r=new Z_(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class H_{constructor(r,s,u,m,h){const g=m.delay||0,b=m.duration||0;h=h||0,this.property=r,this.value=s,this.begin=h+g,this.end=this.begin+b,r.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(r,s,u){const m=r.now||0,h=this.value.possiblyEvaluate(r,s,u),g=this.prior;if(g){if(m>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(m<this.begin)return g.possiblyEvaluate(r,s,u);{const b=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(r,s,u),h,Go(b))}}return h}}class Z_{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,u){const m=new pc(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,s,u);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Cb{constructor(r,s,u){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(r){return Co(this._values[r].value)}setValue(r,s){this._values[r]=new bf(this._values[r].property,s===null?void 0:Co(s),this._scope,this._options),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u)}return r}possiblyEvaluate(r,s,u){const m=new pc(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(r,s,u);return m}}class dc{constructor(r,s,u){this.property=r,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,u,m){return this.property.evaluate(this.value,this.parameters,r,s,u,m)}}class pc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Et{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,u){const m=Qs[this.specification.type];return m?m(r,s,u):r}}class Xt{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,u,m){return new dc(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(s,null,{},u,m)}:r.expression,s)}interpolate(r,s,u){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new dc(this,{kind:"constant",value:void 0},r.parameters);const m=Qs[this.specification.type];return m?new dc(this,{kind:"constant",value:m(r.value.value,s.value.value,u)},r.parameters):r}evaluate(r,s,u,m,h,g){return r.kind==="constant"?r.value:r.evaluate(s,u,m,h,g)}}class Jo{constructor(r){this.specification=r}possiblyEvaluate(r,s,u,m){return!!r.expression.evaluate(s,null,{},u,m)}interpolate(){return!1}}class xn{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Cn(0,{});for(const u in r){const m=r[u];m.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new bf(m,void 0),g=this.defaultTransitionablePropertyValues[u]=new pm(m);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(s)}}}$t(Xt,"DataDrivenProperty"),$t(Et,"DataConstantProperty"),$t(Jo,"ColorRampProperty");var Ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Bu(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function wf(c){if(Array.isArray(c))return c.map(wf);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const r={};for(const s in c)r[s]=wf(c[s]);return r}return Bu(c)}function mm(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const r of c.slice(1))if(!mm(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Qo(c,r="",s=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mm(c)||(c=Tf(c));const m=c;let h=!0;try{h=function(S){if(!mc(S))return S;let P=wf(S);return sl(P),P=gm(P),P}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}const g=Ze[`filter_${u}`],b=Du(h,g,r,s);let E=null;if(b.result==="error")throw new Error(b.value.map(S=>`${S.key}: ${S.message}`).join(", "));E=(S,P,A)=>b.value.evaluate(S,P,{},A);let I=null,v=null;if(h!==m){const S=Du(m,g,r,s);if(S.result==="error")throw new Error(S.value.map(P=>`${P.key}: ${P.message}`).join(", "));I=(P,A,M,k,R)=>S.value.evaluate(P,A,{},M,void 0,void 0,k,R),v=!Au(S.value.expression)}return{filter:E,dynamicFilter:I||void 0,needGeometry:X_(h),needFeature:!!v}}function gm(c){if(!Array.isArray(c))return c;const r=function(s){if(Ob.has(s[0])){for(let u=1;u<s.length;u++)if(mc(s[u]))return!0}return s}(c);return r===!0?r:r.map(s=>gm(s))}function sl(c){let r=!1;const s=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)r=r||mc(c[u]),s.push(c[u+1]);s.push(c[c.length-1])}else if(c[0]==="match"){r=r||mc(c[1]);for(let u=2;u<c.length-1;u+=2)s.push(c[u+1]);s.push(c[c.length-1])}else if(c[0]==="step"){r=r||mc(c[1]);for(let u=1;u<c.length-1;u+=2)s.push(c[u+1])}r&&(c.length=0,c.push("any",...s));for(let u=1;u<c.length;u++)sl(c[u])}function mc(c){if(!Array.isArray(c))return!1;if((r=c[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let s=1;s<c.length;s++)if(mc(c[s]))return!0;return!1}const Ob=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kb(c,r){return c<r?-1:c>r?1:0}function X_(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let r=1;r<c.length;r++)if(X_(c[r]))return!0;return!1}function Tf(c){if(!c)return!0;const r=c[0];return c.length<=1?r!=="any":r==="=="?Sf(c[1],c[2],"=="):r==="!="?Nu(Sf(c[1],c[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Sf(c[1],c[2],r):r==="any"?(s=c.slice(1),["any"].concat(s.map(Tf))):r==="all"?["all"].concat(c.slice(1).map(Tf)):r==="none"?["all"].concat(c.slice(1).map(Tf).map(Nu)):r==="in"?Af(c[1],c.slice(2)):r==="!in"?Nu(Af(c[1],c.slice(2))):r==="has"?Fu(c[1]):r!=="!has"||Nu(Fu(c[1]));var s}function Sf(c,r,s){switch(c){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,c,r]}}function Af(c,r){if(r.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",c,["literal",r.sort(kb)]]:["filter-in-small",c,["literal",r]]}}function Fu(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Nu(c){return["!",c]}const gc="";function Y_(c,r){return r?`${c}${gc}${r}`:c}const ea="-transition",Db=new Set(["fill","line","background","hillshade","raster"]);class Li extends ql{constructor(r,s,u,m,h){if(super(),this.id=r.id,this.fqid=Y_(this.id,u),this.type=r.type,this.scope=u,this.lut=m,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),r.slot&&(this.slot=r.slot),s.layout&&(this._unevaluatedLayout=new Cb(s.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint)){this._transitionablePaint=new W_(s.paint,this.scope,h);for(const g in r.paint)this.setPaintProperty(g,r.paint[g]);for(const g in r.layout)this.setLayoutProperty(g,r.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pc(s.paint)}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D()&&Db.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s){if(this.type==="custom"&&r==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(r){return Va(r,ea)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s){const u=this._transitionablePaint,m=u._properties.properties;if(Va(r,ea)){const S=r.slice(0,-11);return m[S]&&u.setTransition(S,s||void 0),!1}if(!m[r])return!1;const h=u._values[r],g=h.value.isDataDriven(),b=h.value;u.setValue(r,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const E=u._values[r].value,I=E.isDataDriven(),v=Va(r,"pattern")||r==="line-dasharray";return I||g||v||this._handleOverridablePaintPropertyUpdate(r,b,E)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,s,u){return null}_handleOverridablePaintPropertyUpdate(r,s,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){return Nl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof dc&&uf(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Qo(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(r){}queryIntersectsFeature(r,s,u,m,h,g,b,E,I){}queryIntersectsMatchingFeature(r,s,u,m){}}const Lb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ju{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.add(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fr(c,r=1){let s=0,u=0;return{members:c.map(m=>{const h=Lb[m.type].BYTES_PER_ELEMENT,g=s=K_(s,Math.max(r,h)),b=m.components||1;return u=Math.max(u,h),s+=h*b,{name:m.name,type:m.type,components:b,offset:g}}),size:K_(s,Math.max(u,r)),alignment:r}}function K_(c,r){return Math.ceil(c/r)*r}class Es extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.int16[m+0]=s,this.int16[m+1]=u,r}}Es.prototype.bytesPerElement=4,$t(Es,"StructArrayLayout2i4");class Ef extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.int16[h+0]=s,this.int16[h+1]=u,this.int16[h+2]=m,r}}Ef.prototype.bytesPerElement=6,$t(Ef,"StructArrayLayout3i6");class Ms extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=m,this.int16[g+3]=h,r}}Ms.prototype.bytesPerElement=8,$t(Ms,"StructArrayLayout4i8");class Mf extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const b=5*r;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=m,this.int16[b+3]=h,this.int16[b+4]=g,r}}Mf.prototype.bytesPerElement=10,$t(Mf,"StructArrayLayout5i10");class ym extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,b)}emplace(r,s,u,m,h,g,b,E){const I=6*r,v=12*r,S=3*r;return this.int16[I+0]=s,this.int16[I+1]=u,this.uint8[v+4]=m,this.uint8[v+5]=h,this.uint8[v+6]=g,this.uint8[v+7]=b,this.float32[S+2]=E,r}}ym.prototype.bytesPerElement=12,$t(ym,"StructArrayLayout2i4ub1f12");class Za extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=m,this.float32[g+3]=h,r}}Za.prototype.bytesPerElement=16,$t(Za,"StructArrayLayout4f16");class Ps extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.float32[h+0]=s,this.float32[h+1]=u,this.float32[h+2]=m,r}}Ps.prototype.bytesPerElement=12,$t(Ps,"StructArrayLayout3f12");class Xa extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const b=6*r,E=3*r;return this.uint16[b+0]=s,this.uint16[b+1]=u,this.uint16[b+2]=m,this.uint16[b+3]=h,this.float32[E+2]=g,r}}Xa.prototype.bytesPerElement=12,$t(Xa,"StructArrayLayout4ui1f12");class ll extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=4*r;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=m,this.uint16[g+3]=h,r}}ll.prototype.bytesPerElement=8,$t(ll,"StructArrayLayout4ui8");class Pf extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,b){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=m,this.int16[E+3]=h,this.int16[E+4]=g,this.int16[E+5]=b,r}}Pf.prototype.bytesPerElement=12,$t(Pf,"StructArrayLayout6i12");class _m extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b,E,I,v,S,P){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,u,m,h,g,b,E,I,v,S,P)}emplace(r,s,u,m,h,g,b,E,I,v,S,P,A){const M=12*r;return this.int16[M+0]=s,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=h,this.uint16[M+4]=g,this.uint16[M+5]=b,this.uint16[M+6]=E,this.uint16[M+7]=I,this.int16[M+8]=v,this.int16[M+9]=S,this.int16[M+10]=P,this.int16[M+11]=A,r}}_m.prototype.bytesPerElement=24,$t(_m,"StructArrayLayout4i4ui4i24");class vm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,b){const E=10*r,I=5*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=m,this.float32[I+2]=h,this.float32[I+3]=g,this.float32[I+4]=b,r}}vm.prototype.bytesPerElement=20,$t(vm,"StructArrayLayout3i3f20");class xm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}xm.prototype.bytesPerElement=4,$t(xm,"StructArrayLayout1ul4");class Is extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.uint16[m+0]=s,this.uint16[m+1]=u,r}}Is.prototype.bytesPerElement=4,$t(Is,"StructArrayLayout2ui4");class yc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b,E,I,v,S,P,A){const M=this.length;return this.resize(M+1),this.emplace(M,r,s,u,m,h,g,b,E,I,v,S,P,A)}emplace(r,s,u,m,h,g,b,E,I,v,S,P,A,M){const k=20*r,R=10*r;return this.int16[k+0]=s,this.int16[k+1]=u,this.int16[k+2]=m,this.int16[k+3]=h,this.int16[k+4]=g,this.float32[R+3]=b,this.float32[R+4]=E,this.float32[R+5]=I,this.float32[R+6]=v,this.int16[k+14]=S,this.uint32[R+8]=P,this.uint16[k+18]=A,this.uint16[k+19]=M,r}}yc.prototype.bytesPerElement=40,$t(yc,"StructArrayLayout5i4f1i1ul2ui40");class cl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,b)}emplace(r,s,u,m,h,g,b,E){const I=8*r;return this.int16[I+0]=s,this.int16[I+1]=u,this.int16[I+2]=m,this.int16[I+4]=h,this.int16[I+5]=g,this.int16[I+6]=b,this.int16[I+7]=E,r}}cl.prototype.bytesPerElement=16,$t(cl,"StructArrayLayout3i2i2i16");class Vi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const b=4*r,E=8*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=m,this.int16[E+6]=h,this.int16[E+7]=g,r}}Vi.prototype.bytesPerElement=16,$t(Vi,"StructArrayLayout2f1f2i16");class _c extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,m,h,g)}emplace(r,s,u,m,h,g,b){const E=20*r,I=5*r;return this.uint8[E+0]=s,this.uint8[E+1]=u,this.float32[I+1]=m,this.float32[I+2]=h,this.float32[I+3]=g,this.float32[I+4]=b,r}}_c.prototype.bytesPerElement=20,$t(_c,"StructArrayLayout2ub4f20");class _i extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u){const m=this.length;return this.resize(m+1),this.emplace(m,r,s,u)}emplace(r,s,u,m){const h=3*r;return this.uint16[h+0]=s,this.uint16[h+1]=u,this.uint16[h+2]=m,r}}_i.prototype.bytesPerElement=6,$t(_i,"StructArrayLayout3ui6");class bm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z){const X=this.length;return this.resize(X+1),this.emplace(X,r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z)}emplace(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z,X){const ce=30*r,pe=15*r,ge=60*r;return this.int16[ce+0]=s,this.int16[ce+1]=u,this.int16[ce+2]=m,this.float32[pe+2]=h,this.float32[pe+3]=g,this.uint16[ce+8]=b,this.uint16[ce+9]=E,this.uint32[pe+5]=I,this.uint32[pe+6]=v,this.uint32[pe+7]=S,this.uint16[ce+16]=P,this.uint16[ce+17]=A,this.uint16[ce+18]=M,this.float32[pe+10]=k,this.float32[pe+11]=R,this.uint8[ge+48]=N,this.uint8[ge+49]=G,this.uint8[ge+50]=W,this.uint32[pe+13]=j,this.int16[ce+28]=Z,this.uint8[ge+58]=X,r}}bm.prototype.bytesPerElement=60,$t(bm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re,Fe,Ne){const je=this.length;return this.resize(je+1),this.emplace(je,r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re,Fe,Ne)}emplace(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N,G,W,j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re,Fe,Ne,je){const Xe=20*r,Ue=40*r,it=80*r;return this.float32[Xe+0]=s,this.float32[Xe+1]=u,this.int16[Ue+4]=m,this.int16[Ue+5]=h,this.int16[Ue+6]=g,this.int16[Ue+7]=b,this.int16[Ue+8]=E,this.int16[Ue+9]=I,this.int16[Ue+10]=v,this.int16[Ue+11]=S,this.int16[Ue+12]=P,this.uint16[Ue+13]=A,this.uint16[Ue+14]=M,this.uint16[Ue+15]=k,this.uint16[Ue+16]=R,this.uint16[Ue+17]=N,this.uint16[Ue+18]=G,this.uint16[Ue+19]=W,this.uint16[Ue+20]=j,this.uint16[Ue+21]=Z,this.uint16[Ue+22]=X,this.uint16[Ue+23]=ce,this.uint16[Ue+24]=pe,this.uint16[Ue+25]=ge,this.uint16[Ue+26]=fe,this.uint16[Ue+27]=Te,this.uint32[Xe+14]=_e,this.float32[Xe+15]=Ee,this.float32[Xe+16]=Re,this.float32[Xe+17]=Fe,this.float32[Xe+18]=Ne,this.uint8[it+76]=je,r}}wm.prototype.bytesPerElement=80,$t(wm,"StructArrayLayout2f9i15ui1ul4f1ub80");class vc extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}vc.prototype.bytesPerElement=4,$t(vc,"StructArrayLayout1f4");class Ya extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,m,h)}emplace(r,s,u,m,h,g){const b=5*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=m,this.float32[b+3]=h,this.float32[b+4]=g,r}}Ya.prototype.bytesPerElement=20,$t(Ya,"StructArrayLayout5f20");class Tm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,b)}emplace(r,s,u,m,h,g,b,E){const I=7*r;return this.float32[I+0]=s,this.float32[I+1]=u,this.float32[I+2]=m,this.float32[I+3]=h,this.float32[I+4]=g,this.float32[I+5]=b,this.float32[I+6]=E,r}}Tm.prototype.bytesPerElement=28,$t(Tm,"StructArrayLayout7f28");class $u extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,m){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u,m)}emplace(r,s,u,m,h){const g=6*r;return this.uint32[3*r+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=m,this.uint16[g+4]=h,r}}$u.prototype.bytesPerElement=12,$t($u,"StructArrayLayout1ul3ui12");class Sm extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}Sm.prototype.bytesPerElement=2,$t(Sm,"StructArrayLayout1ui2");class Uu extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const m=2*r;return this.float32[m+0]=s,this.float32[m+1]=u,r}}Uu.prototype.bytesPerElement=8,$t(Uu,"StructArrayLayout2f8");class Vu extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R){const N=this.length;return this.resize(N+1),this.emplace(N,r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R)}emplace(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N){const G=16*r;return this.float32[G+0]=s,this.float32[G+1]=u,this.float32[G+2]=m,this.float32[G+3]=h,this.float32[G+4]=g,this.float32[G+5]=b,this.float32[G+6]=E,this.float32[G+7]=I,this.float32[G+8]=v,this.float32[G+9]=S,this.float32[G+10]=P,this.float32[G+11]=A,this.float32[G+12]=M,this.float32[G+13]=k,this.float32[G+14]=R,this.float32[G+15]=N,r}}Vu.prototype.bytesPerElement=64,$t(Vu,"StructArrayLayout16f64");class If extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,m,h,g,b){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,u,m,h,g,b)}emplace(r,s,u,m,h,g,b,E){const I=10*r,v=5*r;return this.uint16[I+0]=s,this.uint16[I+1]=u,this.uint16[I+2]=m,this.uint16[I+3]=h,this.float32[v+2]=g,this.float32[v+3]=b,this.float32[v+4]=E,r}}If.prototype.bytesPerElement=20,$t(If,"StructArrayLayout4ui3f20");class Cf extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.int16[1*r+0]=s,r}}Cf.prototype.bytesPerElement=2,$t(Cf,"StructArrayLayout1i2");class Of extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint8[1*r+0]=s,r}}Of.prototype.bytesPerElement=1,$t(Of,"StructArrayLayout1ub1");class J_ extends ju{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}J_.prototype.size=40;class kf extends yc{get(r){return new J_(this,r)}}$t(kf,"CollisionBoxArray");class Gu extends ju{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Gu.prototype.size=60;class Am extends bm{get(r){return new Gu(this,r)}}$t(Am,"PlacedSymbolArray");class Q_ extends ju{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Q_.prototype.size=80;class Em extends wm{get(r){return new Q_(this,r)}}$t(Em,"SymbolInstanceArray");class ev extends vc{getoffsetX(r){return this.float32[1*r+0]}}$t(ev,"GlyphOffsetArray");class Df extends Es{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}$t(Df,"SymbolLineVertexArray");class tv extends ju{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}tv.prototype.size=12;class rv extends $u{get(r){return new tv(this,r)}}$t(rv,"FeatureIndexArray");class nv extends Is{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}$t(nv,"FillExtrusionCentroidArray");class iv extends ju{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}iv.prototype.size=6;class Mm extends Ef{get(r){return new iv(this,r)}}$t(Mm,"FillExtrusionWallArray");const Rb=Fr([{name:"a_pos",components:2,type:"Int16"}],4),zb=Fr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class On{constructor(r=[]){this.segments=r}_prepareSegment(r,s,u,m){let h=this.segments[this.segments.length-1];return r>On.MAX_VERTEX_ARRAY_LENGTH&&zr(`Max vertices per segment is ${On.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!h||h.vertexLength+r>On.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==m)&&(h={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},m!==void 0&&(h.sortKey=m),this.segments.push(h)),h}prepareSegment(r,s,u,m){return this._prepareSegment(r,s.length,u.length,m)}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,u,m){return new On([{vertexOffset:r,primitiveOffset:s,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function ov(c,r){return 256*(c=yr(Math.floor(c),0,255))+yr(Math.floor(r),0,255)}On.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$t(On,"SegmentVector");const Bb=Fr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fb=Fr([{name:"a_dash",components:4,type:"Uint16"}]);class qu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,s,u,m){this.ids.push(av(r)),this.positions.push(s,u,m)}eachPosition(r,s){const u=av(r);let m=0,h=this.ids.length-1;for(;m<h;){const g=m+h>>1;this.ids[g]>=u?h=g:m=g+1}for(;this.ids[m]===u;)s(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(r,s){const u=new Float64Array(r.ids),m=new Uint32Array(r.positions);return xc(u,m,0,u.length-1),s&&(s.add(u.buffer),s.add(m.buffer)),{ids:u,positions:m}}static deserialize(r){const s=new qu;let u;s.ids=r.ids,s.positions=r.positions;for(const m of s.ids)m!==u&&s.uniqueIds.push(m),u=m;return s.indexed=!0,s}}function av(c){const r=+c;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:eo(String(c))}function xc(c,r,s,u){for(;s<u;){const m=c[s+u>>1];let h=s-1,g=u+1;for(;;){do h++;while(c[h]<m);do g--;while(c[g]>m);if(h>=g)break;Lf(c,h,g),Lf(r,3*h,3*g),Lf(r,3*h+1,3*g+1),Lf(r,3*h+2,3*g+2)}g-s<u-g?(xc(c,r,s,g),s=g+1):(xc(c,r,g+1,u),u=g)}}function Lf(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}$t(qu,"FeaturePositionMap");class Ka{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,s),this.initialized=!0),!!this.location}set(r,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ul extends Ka{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Ri extends Ka{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class va extends Ka{constructor(r){super(r),this.current=[0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Pm extends Ka{constructor(r){super(r),this.current=[0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Rf extends Ka{constructor(r){super(r),this.current=[0,0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Im extends Ka{constructor(r){super(r),this.current=Vr.transparent.toRenderColor(null)}set(r,s,u){this.fetchUniformLocation(r,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const sv=new Float32Array(16);class Wu extends Ka{constructor(r){super(r),this.current=sv}set(r,s,u){if(this.fetchUniformLocation(r,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let m=1;m<16;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Nb=new Float32Array(9),jb=new Float32Array(4);class Cm extends Ka{constructor(r){super(r),this.current=jb}set(r,s,u){if(this.fetchUniformLocation(r,s)){for(let m=0;m<4;m++)if(u[m]!==this.current[m]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Om(c){return[ov(255*c.r,255*c.g),ov(255*c.b,255*c.a)]}class Hu{constructor(r,s,u,m){this.value=r,this.uniformNames=s.map(h=>`u_${h}`),this.type=u,this.context=m}setUniform(r,s,u,m,h){const g=m.constantOr(this.value);s.set(r,h,g instanceof Vr?g.toRenderColor(this.context.lut):g)}getBinding(r,s){return this.type==="color"?new Im(r):new Ri(r)}}class bc{constructor(r,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,s,u,m,h){const g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&s.set(r,h,g)}getBinding(r,s){return s==="u_pattern"||s==="u_dash"?new Rf(r):new Ri(r)}}class xa{constructor(r,s,u,m){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,s,u,m,h,g,b){const E=this.paintVertexArray.length,I=this.expression.evaluate(new Cn(0,{brightness:g}),s,{},h,m,b);this.paintVertexArray.resize(r),this._setPaintValue(E,r,I,this.context)}updatePaintArray(r,s,u,m,h,g,b){const E=this.expression.evaluate({zoom:0,brightness:b},u,m,void 0,h);this._setPaintValue(r,s,E,this.context)}_setPaintValue(r,s,u,m){if(this.type==="color"){const h=Om(u.toRenderColor(m.lut));for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=r;h<s;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xo{constructor(r,s,u,m,h,g){this.expression=r,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=m,this.context=h,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,s,u,m,h,g,b){const E=this.expression.evaluate(new Cn(this.context.zoom,{brightness:g}),s,{},h,m,b),I=this.expression.evaluate(new Cn(this.context.zoom+1,{brightness:g}),s,{},h,m,b),v=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(v,r,E,I,this.context)}updatePaintArray(r,s,u,m,h,g,b){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:b},u,m,void 0,h),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b},u,m,void 0,h);this._setPaintValue(r,s,E,I,this.context)}_setPaintValue(r,s,u,m,h){if(this.type==="color"){const g=Om(u.toRenderColor(h.lut)),b=Om(u.toRenderColor(h.lut));for(let E=r;E<s;E++)this.paintVertexArray.emplace(E,g[0],g[1],b[0],b[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s,u,m,h){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=yr(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(r,h,b)}getBinding(r,s){return new Ri(r)}}class ba{constructor(r,s,u,m,h){this.expression=r,this.layerId=h,this.paintVertexAttributes=(u==="array"?Fb:Bb).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new m}populatePaintArray(r,s,u,m){const h=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(h,r,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(r,s,u,m,h,g,b){this._setPaintValues(r,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(r,s,u,m){if(!m||!u)return;const h=m[u];if(!h)return;const{tl:g,br:b,pixelRatio:E}=h;for(let I=r;I<s;I++)this.paintVertexArray.emplace(I,g[0],g[1],b[0],b[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hl{constructor(r,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const m=[];for(const h in r.paint._values){const g=r.paint.get(h);if(!u(h)||!(g instanceof dc&&uf(g.property.specification)))continue;const b=Ub(h,r.type),E=g.value,I=g.property.specification.type,v=!!g.property.useIntegerZoom,S=h==="line-dasharray"||h.endsWith("pattern"),P=h==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||P)if(E.kind==="source"||P||S){const A=d(h,I,"source");this.binders[h]=S?new ba(E,b,I,A,r.id):new xa(E,b,I,A),m.push(`/a_${h}`)}else{const A=d(h,I,"composite");this.binders[h]=new xo(E,b,I,v,s,A),m.push(`/z_${h}`)}else this.binders[h]=S?new bc(E.value,b):new Hu(E.value,b,I,s),m.push(`/u_${h}`)}this.cacheKey=m.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof xa||s instanceof xo?s.maxValue:0}populatePaintArrays(r,s,u,m,h,g,b){for(const E in this.binders){const I=this.binders[E];I.context=this.context,(I instanceof xa||I instanceof xo||I instanceof ba)&&I.populatePaintArray(r,s,u,m,h,g,b)}}setConstantPatternPositions(r){for(const s in this.binders){const u=this.binders[s];u instanceof bc&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,s,u,m,h,g,b,E){let I=!1;const v=Object.keys(r),S=v.length!==0,P=S?v:s.uniqueIds;this.context.lut=h.lut;for(const A in this.binders){const M=this.binders[A];if(M.context=this.context,(M instanceof xa||M instanceof xo||M instanceof ba)&&(M.expression.isStateDependent===!0||M.expression.isLightConstant===!1)){const k=h.paint.get(A);M.expression=k.value;for(const R of P){const N=r[R.toString()];s.eachPosition(R,(G,W,j)=>{const Z=m.feature(G);M.updatePaintArray(W,j,Z,N,g,b,E)})}if(!S)for(const R of u.uniqueIds){const N=r[R.toString()];u.eachPosition(R,(G,W,j)=>{const Z=m.feature(G);M.updatePaintArray(W,j,Z,N,g,b,E)})}I=!0}}return I}defines(){const r=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Hu||u instanceof bc)&&r.push(...u.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof xa||u instanceof xo||u instanceof ba)for(let m=0;m<u.paintVertexAttributes.length;m++)r.push(u.paintVertexAttributes[m].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Hu||u instanceof bc||u instanceof xo)for(const m of u.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const s=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Hu||m instanceof bc||m instanceof xo)for(const h of m.uniformNames)s.push({name:h,property:u,binding:m.getBinding(r,h)})}return s}setUniforms(r,s,u,m,h){for(const{name:g,property:b,binding:E}of u)this.binders[b].setUniform(r,E,h,m.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const s=this.binders[r];(s instanceof xa||s instanceof xo||s instanceof ba)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(r){for(const s in this.binders){const u=this.binders[s];(u instanceof xa||u instanceof xo||u instanceof ba)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof xa||s instanceof xo||s instanceof ba)&&s.destroy()}}}class Cs{constructor(r,s,u=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new hl(m,s,u);this.needsUpload=!1,this._featureMap=new qu,this._featureMapWithoutIds=new qu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,s,u,m,h,g,b,E){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(r,s,m,h,g,b,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,u,m,h,g){for(const b of u)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,s,b,m,h,g||0)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const $b={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ub(c,r){return $b[c]||[c.replace(`${r}-`,"").replace(/-/g,"_")]}const Vb={"line-pattern":{source:Xa,composite:Xa},"fill-pattern":{source:Xa,composite:Xa},"fill-extrusion-pattern":{source:Xa,composite:Xa},"line-dasharray":{source:ll,composite:ll}},lv={color:{source:Uu,composite:Za},number:{source:vc,composite:Uu}};function d(c,r,s){const u=Vb[c];return u&&u[s]||lv[r][s]}$t(Hu,"ConstantBinder"),$t(bc,"PatternConstantBinder"),$t(xa,"SourceExpressionBinder"),$t(ba,"PatternCompositeBinder"),$t(xo,"CompositeExpressionBinder"),$t(hl,"ProgramConfiguration",{omit:["_buffers"]}),$t(Cs,"ProgramConfigurationSet");const n=Ct/Math.PI/2,l=5,p=6,_=16383,x=64,T=[x,32,16],C=-n,D=n;function z(c,r,s,u=n){return s=Sr(s),[c*Math.sin(s)*u,-r*u,c*Math.cos(s)*u]}function B(c,r,s){return z(Math.cos(Sr(c)),Math.sin(Sr(c)),r,s)}const U=63710088e-1,V=2*Math.PI*U;class q{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new q(Ua(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,u=this.lat*s,m=r.lat*s,h=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((r.lng-this.lng)*s);return U*Math.acos(Math.min(h,1))}toBounds(r=0){const s=360*r/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new K({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(r){return B(this.lat,this.lng,n+r*n/U)}static convert(r){if(r instanceof q)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new q(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new q(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class K{constructor(r,s){if(r)if(s)this.setSouthWest(r).setNorthEast(s);else if(r.length===4){const u=r;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=r;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(r){return this._ne=r instanceof q?new q(r.lng,r.lat):q.convert(r),this}setSouthWest(r){return this._sw=r instanceof q?new q(r.lng,r.lat):q.convert(r),this}extend(r){const s=this._sw,u=this._ne;let m,h;if(r instanceof q)m=r,h=r;else{if(!(r instanceof K))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(K.convert(r)):this.extend(q.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(q.convert(r)):this;if(m=r._sw,h=r._ne,!m||!h)return this}return s||u?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new q(m.lng,m.lat),this._ne=new q(h.lng,h.lat)),this}getCenter(){return new q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new q(this.getWest(),this.getNorth())}getSouthEast(){return new q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:u}=q.convert(r);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&m}static convert(r){if(r)return r instanceof K?r:new K(r)}}const Q=0,ee=25.5;function re(c){return V*Math.cos(c*Math.PI/180)}function me(c){return(180+c)/360}function ye(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function de(c,r){return c/re(r)}function xe(c){return 360*c-180}function ve(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Pe(c,r){return c*re(ve(r))}const Se=85.051129;function Ce(c){return Math.cos(Sr(yr(c,-Se,Se)))}function Be(c,r){const s=yr(r,Q,ee),u=Math.pow(2,s);return Ce(c)*V/(512*u)}function Le(c){return 1/Math.cos(c*Math.PI/180)}function ke(c,r=0){const s=Math.exp(Math.PI*(1-(c.y+r/Ct)/(1<<c.z)*2));return 80150034*s/(s*s+1)/Ct/(1<<c.z)}class Ve{constructor(r,s,u=0){this.x=+r,this.y=+s,this.z=+u}static fromLngLat(r,s=0){const u=q.convert(r);return new Ve(me(u.lng),ye(u.lat),de(s,u.lat))}toLngLat(){return new q(xe(this.x),ve(this.y))}toAltitude(){return Pe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/V*Le(ve(this.y))}}function rt(c,r,s,u,m,h,g,b,E){const I=(r+u)/2,v=(s+m)/2,S=new _t(I,v);b(S),function(P,A,M,k,R,N){const G=M-R,W=k-N;return Math.abs((k-A)*G-(M-P)*W)/Math.hypot(G,W)}(S.x,S.y,h.x,h.y,g.x,g.y)>=E?(rt(c,r,s,I,v,h,S,b,E),rt(c,I,v,u,m,S,g,b,E)):c.push(g)}function ft(c,r,s){let u=c[0],m=u.x,h=u.y;r(u);const g=[u];for(let b=1;b<c.length;b++){const E=c[b],{x:I,y:v}=E;r(E),rt(g,m,h,I,v,u,E,r,s),m=I,h=v,u=E}return g}function et(c,r,s,u){if(u(r,s)){const m=r.add(s)._mult(.5);et(c,r,m,u),et(c,m,s,u)}else c.push(s)}function vt(c,r){let s=c[0];const u=[s];for(let m=1;m<c.length;m++){const h=c[m];et(u,s,h,r),s=h}return u}const Ge=Math.pow(2,14)-1,lt=-Ge-1;function ot(c,r){const s=Math.round(c.x*r),u=Math.round(c.y*r);return c.x=yr(s,lt,Ge),c.y=yr(u,lt,Ge),(s<c.x||s>c.x+1||u<c.y||u>c.y+1)&&zr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function bt(c,r,s){const u=c.loadGeometry(),m=c.extent,h=Ct/m;if(r&&s&&s.projection.isReprojectedInTileSpace){const g=1<<r.z,{scale:b,x:E,y:I,projection:v}=s,S=P=>{const A=xe((r.x+P.x/m)/g),M=ve((r.y+P.y/m)/g),k=v.project(A,M);P.x=(k.x*b-E)*m,P.y=(k.y*b-I)*m};for(let P=0;P<u.length;P++)if(c.type!==1)u[P]=ft(u[P],S,1);else{const A=[];for(const M of u[P])M.x<0||M.x>=m||M.y<0||M.y>=m||(S(M),A.push(M));u[P]=A}}for(const g of u)for(const b of g)ot(b,h);return u}function St(c,r){return{type:c.type,id:c.id,properties:c.properties,geometry:r?bt(c):[]}}function ut(c,r,s,u,m){c.emplaceBack(2*r+(u+1)/2,2*s+(m+1)/2)}function pt(c,r,s){c.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Kt{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Es,this.indexArray=new _i,this.segments=new On,this.programConfigurations=new Cs(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(r,s){}populate(r,s,u,m){const h=this.layers[0],g=[];let b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(const{feature:I,id:v,index:S,sourceLayerIndex:P}of r){const A=this.layers[0]._featureFilter.needGeometry,M=St(I,A);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),M,u))continue;const k=b?b.evaluate(M,{},u):void 0,R={id:v,properties:I.properties,type:I.type,sourceLayerIndex:P,index:S,geometry:A?M.geometry:bt(I,u,m),patterns:{},sortKey:k};g.push(R)}b&&g.sort((I,v)=>I.sortKey-v.sortKey);let E=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new Pf,E=m.projection);for(const I of g){const{geometry:v,index:S,sourceLayerIndex:P}=I,A=r[S].feature;this.addFeature(I,v,S,s.availableImages,u,E,s.brightness),s.featureIndex.insert(A,v,S,P,this.index)}}update(r,s,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,s,g?this.stateDependentLayers:this.layers,u,m,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Rb.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,zb.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,s,u,m,h,g,b){for(const E of s)for(const I of E){const v=I.x,S=I.y;if(v<0||v>=Ct||S<0||S>=Ct)continue;if(g){const M=g.projectTilePoint(v,S,h),k=g.upVector(h,v,S),R=this.globeExtVertexArray;pt(R,M,k),pt(R,M,k),pt(R,M,k),pt(R,M,k)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),A=P.vertexLength;ut(this.layoutVertexArray,v,S,-1,-1),ut(this.layoutVertexArray,v,S,1,-1),ut(this.layoutVertexArray,v,S,1,1),ut(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},m,h,b)}}function Mt(c,r){for(let s=0;s<c.length;s++)if(fn(r,c[s]))return!0;for(let s=0;s<r.length;s++)if(fn(c,r[s]))return!0;return!!er(c,r)}function Nt(c,r,s){return!!fn(c,r)||!!vr(r,c,s)}function ir(c,r){if(c.length===1)return rn(r,c[0]);for(let s=0;s<r.length;s++){const u=r[s];for(let m=0;m<u.length;m++)if(fn(c,u[m]))return!0}for(let s=0;s<c.length;s++)if(rn(r,c[s]))return!0;for(let s=0;s<r.length;s++)if(er(c,r[s]))return!0;return!1}function Gt(c,r,s){if(c.length>1){if(er(c,r))return!0;for(let u=0;u<r.length;u++)if(vr(r[u],c,s))return!0}for(let u=0;u<c.length;u++)if(vr(c[u],r,s))return!0;return!1}function er(c,r){if(c.length===0||r.length===0)return!1;for(let s=0;s<c.length-1;s++){const u=c[s],m=c[s+1];for(let h=0;h<r.length-1;h++)if(Tr(u,m,r[h],r[h+1]))return!0}return!1}function Tr(c,r,s,u){return da(c,s,u)!==da(r,s,u)&&da(c,r,s)!==da(c,r,u)}function vr(c,r,s){const u=s*s;if(r.length===1)return c.distSqr(r[0])<u;for(let m=1;m<r.length;m++)if(Xr(c,r[m-1],r[m])<u)return!0;return!1}function Xr(c,r,s){const u=r.distSqr(s);if(u===0)return c.distSqr(r);const m=((c.x-r.x)*(s.x-r.x)+(c.y-r.y)*(s.y-r.y))/u;return c.distSqr(m<0?r:m>1?s:s.sub(r)._mult(m)._add(r))}function rn(c,r){let s,u,m,h=!1;for(let g=0;g<c.length;g++){s=c[g];for(let b=0,E=s.length-1;b<s.length;E=b++)u=s[b],m=s[E],u.y>r.y!=m.y>r.y&&r.x<(m.x-u.x)*(r.y-u.y)/(m.y-u.y)+u.x&&(h=!h)}return h}function fn(c,r){let s=!1;for(let u=0,m=c.length-1;u<c.length;m=u++){const h=c[u],g=c[m];h.y>r.y!=g.y>r.y&&r.x<(g.x-h.x)*(r.y-h.y)/(g.y-h.y)+h.x&&(s=!s)}return s}function ko(c,r,s,u,m){for(const g of c)if(r<=g.x&&s<=g.y&&u>=g.x&&m>=g.y)return!0;const h=[new _t(r,s),new _t(r,m),new _t(u,m),new _t(u,s)];if(c.length>2){for(const g of h)if(fn(c,g))return!0}for(let g=0;g<c.length-1;g++)if(Nn(c[g],c[g+1],h))return!0;return!1}function Nn(c,r,s){const u=s[0],m=s[2];if(c.x<u.x&&r.x<u.x||c.x>m.x&&r.x>m.x||c.y<u.y&&r.y<u.y||c.y>m.y&&r.y>m.y)return!1;const h=da(c,r,s[0]);return h!==da(c,r,s[1])||h!==da(c,r,s[2])||h!==da(c,r,s[3])}function Ir(c,r,s,u,m,h){let g=r.y-c.y,b=c.x-r.x;if(h=h||0){const E=g*g+b*b;if(E===0)return!0;const I=Math.sqrt(E);g/=I,b/=I}return!((s.x-c.x)*g+(s.y-c.y)*b-h<0||(u.x-c.x)*g+(u.y-c.y)*b-h<0||(m.x-c.x)*g+(m.y-c.y)*b-h<0)}function Qr(c,r,s,u,m,h,g){return!(Ir(c,r,u,m,h,g)||Ir(r,s,u,m,h,g)||Ir(s,c,u,m,h,g)||Ir(u,m,c,r,s,g)||Ir(m,h,c,r,s,g)||Ir(h,u,c,r,s,g))}function bn(c,r,s){const u=r.paint.get(c).value;return u.kind==="constant"?u.value:s.programConfigurations.get(r.id).getMaxValue(c)}function Jr(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function br(c,r,s,u,m){if(!r[0]&&!r[1])return c;const h=_t.convert(r)._mult(m);s==="viewport"&&h._rotate(-u);const g=[];for(let b=0;b<c.length;b++)g.push(c[b].sub(h));return g}function Nr(c,r,s,u){const m=_t.convert(c)._mult(u);return r==="viewport"&&m._rotate(-s),m}let Gr,kn;$t(Kt,"CircleBucket",{omit:["layers"]});var jn,Dr={exports:{}},ri=(jn||(jn=1,function(c,r){(function(s){function u(h,g,b){var E=m(256*h,256*(g=Math.pow(2,b)-g-1),b),I=m(256*(h+1),256*(g+1),b);return E[0]+","+E[1]+","+I[0]+","+I[1]}function m(h,g,b){var E=2*Math.PI*6378137/256/Math.pow(2,b);return[h*E-2*Math.PI*6378137/2,g*E-2*Math.PI*6378137/2]}s.getURL=function(h,g,b,E,I,v){return v=v||{},h+"?"+["bbox="+u(b,E,I),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+g].join("&")},s.getTileBBox=u,s.getMercCoords=m,Object.defineProperty(s,"__esModule",{value:!0})})(r)}(0,Dr.exports)),Dr.exports);class ci{constructor(r,s,u){this.z=r,this.x=s,this.y=u,this.key=Gi(0,r,r,s,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s){const u=ri.getTileBBox(this.x,this.y,this.z),m=function(h,g,b){let E,I="";for(let v=h;v>0;v--)E=1<<v-1,I+=(g&E?1:0)+(b&E?2:0);return I}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ni{constructor(r,s){this.wrap=r,this.canonical=s,this.key=Gi(r,s.z,s.z,s.x,s.y)}}class ln{constructor(r,s,u,m,h){this.overscaledZ=r,this.wrap=s,this.canonical=new ci(u,+m,+h),this.key=s===0&&r===u?this.canonical.key:Gi(s,r,u,m,h)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new ln(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ln(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return Gi(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Gi(this.wrap*+s,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new ln(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new ln(s,this.wrap,s,u,m),new ln(s,this.wrap,s,u+1,m),new ln(s,this.wrap,s,u,m+1),new ln(s,this.wrap,s,u+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new ln(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new ln(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ni(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gi(c,r,s,u,m){const h=1<<Math.min(s,22);let g=h*(m%h)+u%h;return c&&s<22&&(g+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-s)))),16*(32*g+s)+(r-s)}const qi=[c=>{let r=c.canonical.x-1,s=c.wrap;return r<0&&(r=(1<<c.canonical.z)-1,s--),new ln(c.overscaledZ,s,c.canonical.z,r,c.canonical.y)},c=>{let r=c.canonical.x+1,s=c.wrap;return r===1<<c.canonical.z&&(r=0,s++),new ln(c.overscaledZ,s,c.canonical.z,r,c.canonical.y)},c=>new ln(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new ln(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];$t(ci,"CanonicalTileID"),$t(ln,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Do=Fr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bo}=Do,oo=Fr([{name:"a_pos_3",components:3,type:"Int16"}]);var Lo=Fr([{name:"a_pos",type:"Int16",components:2}]);class Ja{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const m=Me.vec3.dot(s,this.dir);if(Math.abs(m)<1e-6)return!1;const h=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1]+(r[2]-this.pos[2])*s[2])/m;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(r,s,u){if(Me.vec3.equals(this.pos,r)||s===0)return u[0]=u[1]=u[2]=0,!1;const[m,h,g]=this.dir,b=this.pos[0]-r[0],E=this.pos[1]-r[1],I=this.pos[2]-r[2],v=m*m+h*h+g*g,S=2*(b*m+E*h+I*g),P=S*S-4*v*(b*b+E*E+I*I-s*s);if(P<0){const A=Math.max(-S/2,0),M=b+m*A,k=E+h*A,R=I+g*A,N=Math.hypot(M,k,R);return u[0]=M*s/N,u[1]=k*s/N,u[2]=R*s/N,!1}{const A=(-S-Math.sqrt(P))/(2*v);if(A<0){const M=Math.hypot(b,E,I);return u[0]=b*s/M,u[1]=E*s/M,u[2]=I*s/M,!1}return u[0]=b+m*A,u[1]=E+h*A,u[2]=I+g*A,!0}}}class Os{constructor(r,s,u,m,h){this.TL=r,this.TR=s,this.BR=u,this.BL=m,this.horizon=h}static fromInvProjectionMatrix(r,s,u){const m=[-1,1,1],h=[1,1,1],g=[1,-1,1],b=[-1,-1,1],E=Me.vec3.transformMat4(m,m,r),I=Me.vec3.transformMat4(h,h,r),v=Me.vec3.transformMat4(g,g,r),S=Me.vec3.transformMat4(b,b,r);return new Os(E,I,v,S,s/u)}}function wa(c,r,s){let u=1/0,m=-1/0;const h=[];for(const g of c){Me.vec3.sub(h,g,r);const b=Me.vec3.dot(h,s);u=Math.min(u,b),m=Math.max(m,b)}return[u,m]}function wc(c,r){let s=!0;for(let u=0;u<c.planes.length;u++){const m=c.planes[u];let h=0;for(let g=0;g<r.length;g++)h+=Me.vec3.dot(m,r[g])+m[3]>=0;if(h===0)return 0;h!==r.length&&(s=!1)}return s?2:1}function Tc(c,r){for(const s of c.projections){const u=wa(r,c.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function zf(c,r){let s=0;const u=[0,0,0,0];for(let m=0;m<c.length;m++)u[0]=c[m][0],u[1]=c[m][1],u[2]=c[m][2],u[3]=1,Me.vec4.dot(u,r)>=0&&s++;return s}class Sc{constructor(r,s){this.points=r||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=cn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Me.vec3.sub([],this.points[2],this.points[3]),Me.vec3.sub([],this.points[0],this.points[3]),Me.vec3.sub([],this.points[4],this.points[0]),Me.vec3.sub([],this.points[5],this.points[1]),Me.vec3.sub([],this.points[6],this.points[2]),Me.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const m=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:m,projection:wa(this.points,this.points[0],m)}),this.projections.push({axis:h,projection:wa(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(r,s,u,m){const h=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const v=Me.vec4.transformMat4([],I,r),S=1/v[3]/s*h;return Me.vec4.mul(v,v,[S,S,m?1/v[3]:S,S])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const v=Me.vec3.sub([],g[I[0]],g[I[1]]),S=Me.vec3.sub([],g[I[2]],g[I[1]]),P=Me.vec3.normalize([],Me.vec3.cross([],v,S)),A=-Me.vec3.dot(P,g[I[1]]);return P.concat(A)}),E=[];for(let I=0;I<g.length;I++)E.push([g[I][0],g[I][1],g[I][2]]);return new Sc(E,b)}intersectsPrecise(r,s,u){for(let m=0;m<s.length;m++)if(!zf(r,s[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!zf(r,this.planes[m]))return 0;for(const m of u)for(const h of this.frustumEdges){const g=Me.vec3.cross([],m,h),b=Me.vec3.length(g);if(b===0)continue;Me.vec3.scale(g,g,1/b);const E=wa(this.points,this.points[0],g),I=wa(r,this.points[0],g);if(E[0]>I[1]||I[0]>E[1])return 0}return 1}containsPoint(r){for(const s of this.planes){const u=s[3];if(Me.vec3.dot([s[0],s[1],s[2]],r)+u<0)return!1}return!0}}class cn{static fromPoints(r){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const m of r)Me.vec3.min(s,s,m),Me.vec3.max(u,u,m);return new cn(s,u)}static fromTileIdAndHeight(r,s,u){const m=1<<r.canonical.z,h=r.canonical.x,g=r.canonical.y;return new cn([h/m,g/m,s],[(h+1)/m,(g+1)/m,u])}static applyTransform(r,s){const u=r.getCorners();for(let m=0;m<u.length;++m)Me.vec3.transformMat4(u[m],u[m],s);return cn.fromPoints(u)}static applyTransformFast(r,s){const u=[s[12],s[13],s[14]],m=[...u];for(let h=0;h<3;h++)for(let g=0;g<3;g++){const b=s[4*g+h],E=b*r.min[g],I=b*r.max[g];u[h]+=Math.min(E,I),m[h]+=Math.max(E,I)}return new cn(u,m)}static projectAabbCorners(r,s){const u=r.getCorners();for(let m=0;m<u.length;++m)Me.vec3.transformMat4(u[m],u[m],s);return u}constructor(r,s){this.min=r,this.max=s,this.center=Me.vec3.scale([],Me.vec3.add([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],u=Me.vec3.clone(this.min),m=Me.vec3.clone(this.max);for(let h=0;h<s.length;h++)u[h]=s[h]?this.min[h]:this.center[h],m[h]=s[h]?this.center[h]:this.max[h];return m[2]=this.max[2],new cn(u,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?wc(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?wc(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,s){return s||this.intersects(r)?Tc(r,this.getCorners()):0}intersectsPreciseFlat(r,s){return s||this.intersectsFlat(r)?Tc(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let s=0;s<3;++s)if(this.min[s]>r.max[s]||r.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r.min[s]),this.max[s]=Math.max(this.max[s],r.max[s])}encapsulatePoint(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r[s]),this.max[s]=Math.max(this.max[s],r[s])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}function fl(c){return c*n/U}$t(cn,"Aabb");const Gb=[new cn([C,C,C],[D,D,D]),new cn([C,C,C],[0,0,D]),new cn([0,C,C],[D,0,D]),new cn([C,0,C],[0,D,D]),new cn([0,0,C],[D,D,D])];function cv(c,r,s,u=!0){const m=Me.vec3.scale([],c._camera.position,c.worldSize),h=[r,s,1,1];Me.vec4.transformMat4(h,h,c.pixelMatrixInverse),Me.vec4.scale(h,h,1/h[3]);const g=Me.vec3.sub([],h,m),b=Me.vec3.normalize([],g),E=c.globeMatrix,I=[E[12],E[13],E[14]],v=Me.vec3.sub([],I,m),S=Me.vec3.length(v),P=Me.vec3.normalize([],v),A=c.worldSize/(2*Math.PI),M=Me.vec3.dot(P,b),k=Math.asin(A/S);if(k<Math.acos(M)){if(!u)return null;const Te=[],_e=[];Me.vec3.scale(Te,b,S/M),Me.vec3.normalize(_e,Me.vec3.sub(_e,Te,v)),Me.vec3.normalize(b,Me.vec3.add(b,v,Me.vec3.scale(b,_e,Math.tan(k)*S)))}const R=[];new Ja(m,b).closestPointOnSphere(I,A,R);const N=Me.vec3.normalize([],Js(E,0)),G=Me.vec3.normalize([],Js(E,1)),W=Me.vec3.normalize([],Js(E,2)),j=Me.vec3.dot(N,R),Z=Me.vec3.dot(G,R),X=Me.vec3.dot(W,R),ce=An(Math.asin(-Z/A));let pe=An(Math.atan2(j,X));pe=c.center.lng+function(Te,_e){const Ee=(_e-Te+180)%360-180;return Ee<-180?Ee+360:Ee}(c.center.lng,pe);const ge=me(pe),fe=yr(ye(ce),0,1);return new Ve(ge,fe)}class Rj{constructor(r,s,u){this.a=Me.vec3.sub([],r,u),this.b=Me.vec3.sub([],s,u),this.center=u;const m=Me.vec3.normalize([],this.a),h=Me.vec3.normalize([],this.b);this.angle=Math.acos(Me.vec3.dot(m,h))}}function qb(c,r){if(c.angle===0)return null;let s;return s=c.a[r]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[r]/c.a[r]/Math.sin(c.angle)-1/Math.tan(c.angle)),s<0||s>1?null:function(u,m,h,g){const b=Math.sin(h);return u*(Math.sin((1-g)*h)/b)+m*(Math.sin(g*h)/b)}(c.a[r],c.b[r],c.angle,yr(s,0,1))+c.center[r]}function ks(c){if(c.z<=1)return Gb[c.z+2*c.y+c.x];const r=Wb(uv(c));return cn.fromPoints(r)}function dl(c,r,s){return Me.vec3.scale(c,c,1-s),Me.vec3.scaleAndAdd(c,c,r,s)}function vP(c,r,s){for(const u of c)Me.vec3.transformMat4(u,u,r),Me.vec3.scale(u,u,s)}function xP(c,r,s,u){const m=r/c.worldSize,h=c.globeMatrix;if(s.z<=1){const ge=ks(s).getCorners();return vP(ge,h,m),cn.fromPoints(ge)}const g=uv(s,u),b=Wb(g,n+fl(c._tileCoverLift));vP(b,h,m);const E=Number.MAX_VALUE,I=[-E,-E,-E],v=[E,E,E];if(g.contains(c.center)){for(const Te of b)Me.vec3.min(v,v,Te),Me.vec3.max(I,I,Te);I[2]=0;const ge=c.point,fe=[ge.x*m,ge.y*m,0];return Me.vec3.min(v,v,fe),Me.vec3.max(I,I,fe),new cn(v,I)}if(c._tileCoverLift>0){for(const ge of b)Me.vec3.min(v,v,ge),Me.vec3.max(I,I,ge);return new cn(v,I)}const S=[h[12]*m,h[13]*m,h[14]*m],P=g.getCenter(),A=yr(c.center.lat,-Se,Se),M=yr(P.lat,-Se,Se),k=me(c.center.lng),R=ye(A);let N=k-me(P.lng);const G=R-ye(M);N>.5?N-=1:N<-.5&&(N+=1);let W=0;if(Math.abs(N)>Math.abs(G))W=N>=0?1:3;else{W=G>=0?0:2;const ge=[h[4]*m,h[5]*m,h[6]*m],fe=-Math.sin(Sr(G>=0?g.getSouth():g.getNorth()))*n;Me.vec3.scaleAndAdd(S,S,ge,fe)}const j=b[W],Z=b[(W+1)%4],X=new Rj(j,Z,S),ce=[qb(X,0)||j[0],qb(X,1)||j[1],qb(X,2)||j[2]],pe=Ac(c.zoom);if(pe>0){const ge=function({x:Te,y:_e,z:Ee},Re,Fe,Ne,je){const Xe=1/(1<<Ee);let Ue=Te*Xe,it=Ue+Xe,dt=_e*Xe,Qe=dt+Xe,Rt=0;const Pt=(Ue+it)/2-Ne;return Pt>.5?Rt=-1:Pt<-.5&&(Rt=1),Ue=((Ue+Rt)*Re-(Ne*=Re))*Fe+Ne,it=((it+Rt)*Re-Ne)*Fe+Ne,dt=(dt*Re-(je*=Re))*Fe+je,Qe=(Qe*Re-je)*Fe+je,[[Ue,Qe,0],[it,Qe,0],[it,dt,0],[Ue,dt,0]]}(s,r,c._pixelsPerMercatorPixel,k,R);for(let Te=0;Te<b.length;Te++)dl(b[Te],ge[Te],pe);const fe=Me.vec3.add([],ge[W],ge[(W+1)%4]);Me.vec3.scale(fe,fe,.5),dl(ce,fe,pe)}for(const ge of b)Me.vec3.min(v,v,ge),Me.vec3.max(I,I,ge);return v[2]=Math.min(j[2],Z[2]),Me.vec3.min(v,v,ce),Me.vec3.max(I,I,ce),new cn(v,I)}function uv({x:c,y:r,z:s},u=!1){const m=1/(1<<s),h=new q(xe(c*m),r===(1<<s)-1&&u?-90:ve((r+1)*m)),g=new q(xe((c+1)*m),r===0&&u?90:ve(r*m));return new K(h,g)}function Wb(c,r=n){const s=Sr(c.getNorth()),u=Sr(c.getSouth()),m=Math.cos(s),h=Math.cos(u),g=Math.sin(s),b=Math.sin(u),E=c.getWest(),I=c.getEast();return[z(h,b,E,r),z(h,b,I,r),z(m,g,I,r),z(m,g,E,r)]}function km(c,r,s,u){const m=1<<s.z,h=(c/Ct+s.x)/m;return B(ve((r/Ct+s.y)/m),xe(h),u)}function hv({min:c,max:r}){return _/Math.max(r[0]-c[0],r[1]-c[1],r[2]-c[2])}const bP=new Float64Array(16);function fv(c){const r=hv(c),s=Me.mat4.fromScaling(bP,[r,r,r]);return Me.mat4.translate(s,s,Me.vec3.negate([],c.min))}function Hb(c){const r=Me.mat4.fromTranslation(bP,c.min),s=1/hv(c);return Me.mat4.scale(r,r,[s,s,s])}function Zb(c){const r=Ct/(2*Math.PI);return c/(2*Math.PI)/r}function wP(c,r){return Ct/(512*Math.pow(2,c))*hv(ks(r))}function TP(c,r,s,u,m){const h=Zb(s),g=[c,r,-s/(2*Math.PI)],b=Me.mat4.identity(new Float64Array(16));return Me.mat4.translate(b,b,g),Me.mat4.scale(b,b,[h,h,h]),Me.mat4.rotateX(b,b,Sr(-m)),Me.mat4.rotateY(b,b,Sr(-u)),b}function Ac(c){return Bl(l,p,c)}function SP(c,r){const s=B(r.lat,r.lng),u=function(h){const g=B(h._center.lat,h._center.lng),b=Me.vec3.fromValues(0,1,0);let E=Me.vec3.cross([],b,g);const I=Me.mat4.fromRotation([],-h.angle,g);E=Me.vec3.transformMat4(E,E,I),Me.mat4.fromRotation(I,-h._pitch,E);const v=Me.vec3.normalize([],g);return Me.vec3.scale(v,v,fl(h.cameraToCenterDistance/h.pixelsPerMeter)),Me.vec3.transformMat4(v,v,I),Me.vec3.add([],g,v)}(c),m=Me.vec3.subtract([],u,s);return Me.vec3.angle(m,s)}function Xb(c,r){return SP(c,r)>Math.PI/2*1.01}const AP=Sr(85),zj=Math.cos(AP),Bj=Math.sin(AP),Fj=Me.mat4.create(),EP=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function MP(c,r,s,u,m,h,g,b,E){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(E*=c.pixelToTileUnitsFactor);const I=c.tileID.canonical,v=s.projection.upVectorScale(I,s.center.lat,s.worldSize).metersToTile;for(const S of r)for(const P of S){const A=P.add(b),M=m&&s.elevation?s.elevation.exaggeration()*m.getElevationAt(A.x,A.y,!0):0,k=s.projection.projectTilePoint(A.x,A.y,I);if(M>0){const W=s.projection.upVector(I,A.x,A.y);k.x+=W[0]*v*M,k.y+=W[1]*v*M,k.z+=W[2]*v*M}const R=h?A:Nj(k.x,k.y,k.z,u),N=h?c.tilespaceRays.map(W=>$j(W,M)):c.queryGeometry.screenGeometry,G=Me.vec4.transformMat4([],[k.x,k.y,k.z,1],u);if(!g&&h?E*=G[3]/s.cameraToCenterDistance:g&&!h&&(E*=s.cameraToCenterDistance/G[3]),h){const W=ve((P.y/Ct+I.y)/(1<<I.z));E/=s.projection.pixelsPerMeter(W,1)/de(1,W)}if(Nt(N,R,E))return!0}return!1}function Nj(c,r,s,u){const m=Me.vec4.transformMat4([],[c,r,s,1],u);return new _t(m[0]/m[3],m[1]/m[3])}const PP=Me.vec3.fromValues(0,0,0),jj=Me.vec3.fromValues(0,0,1);function $j(c,r){const s=Me.vec3.create();return PP[2]=r,c.intersectsPlane(PP,jj,s),new _t(s[0],s[1])}class IP extends Kt{}let CP,OP,kP,DP;function LP(c,{width:r,height:s},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*s*u)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*s*u);return c.width=r,c.height=s,c.data=m,c}function RP(c,r,s){const{width:u,height:m}=r;u===c.width&&m===c.height||(Yb(c,r,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,m)},s,null),c.width=u,c.height=m,c.data=r.data)}function Yb(c,r,s,u,m,h,g,b){if(m.width===0||m.height===0)return r;if(m.width>c.width||m.height>c.height||s.x>c.width-m.width||s.y>c.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||u.x>r.width-m.width||u.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,I=r.data,v=h===4&&b;for(let S=0;S<m.height;S++){const P=((s.y+S)*c.width+s.x)*h,A=((u.y+S)*r.width+u.x)*h;if(v)for(let M=0;M<m.width;M++){const k=P+M*h+3,R=A+M*h;I[R+0]=255,I[R+1]=255,I[R+2]=255,I[R+3]=E[k]}else if(g)for(let M=0;M<m.width;M++){const k=P+M*h,R=A+M*h,N=E[k+3],G=new Vr(E[k+0]/255*N,E[k+1]/255*N,E[k+2]/255*N,N).toRenderColor(g).toArray();I[R+0]=G[0],I[R+1]=G[1],I[R+2]=G[2],I[R+3]=G[3]}else for(let M=0;M<m.width*h;M++)I[A+M]=E[P+M]}return r}$t(IP,"HeatmapBucket",{omit:["layers"]});class Ec{constructor(r,s){LP(this,r,1,s)}resize(r){RP(this,new Ec(r),1)}clone(){return new Ec({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,m,h){Yb(r,s,u,m,h,1,null)}}class Wi{constructor(r,s){LP(this,r,4,s)}resize(r){RP(this,new Wi(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Wi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,m,h,g,b){Yb(r,s,u,m,h,4,g,b)}}class zP{constructor(r,s){this.width=r.width,this.height=r.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Dm(c){const r={},s=c.resolution||256,u=c.clips?c.clips.length:1,m=c.image||new Wi({width:s,height:u}),h=(g,b,E)=>{r[c.evaluationKey]=E;const I=c.expression.evaluate(r);I&&(m.data[g+b+0]=Math.floor(255*I.r/I.a),m.data[g+b+1]=Math.floor(255*I.g/I.a),m.data[g+b+2]=Math.floor(255*I.b/I.a),m.data[g+b+3]=Math.floor(255*I.a))};if(c.clips)for(let g=0,b=0;g<u;++g,b+=4*s)for(let E=0,I=0;E<s;E++,I+=4){const v=E/(s-1),{start:S,end:P}=c.clips[g];h(b,I,S*(1-v)+P*v)}else for(let g=0,b=0;g<s;g++,b+=4)h(0,b,g/(s-1));return m}$t(Ec,"AlphaImage"),$t(Wi,"RGBAImage");const Uj=Fr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vj}=Uj;function Lm(c,r,s=2){const u=r&&r.length,m=u?r[0]*s:c.length;let h=BP(c,0,m,s,!0);const g=[];if(!h||h.next===h.prev)return g;let b,E,I;if(u&&(h=function(v,S,P,A){const M=[];for(let k=0,R=S.length;k<R;k++){const N=BP(v,S[k]*A,k<R-1?S[k+1]*A:v.length,A,!1);N===N.next&&(N.steiner=!0),M.push(Kj(N))}M.sort(Zj);for(let k=0;k<M.length;k++)P=Xj(M[k],P);return P}(c,r,h,s)),c.length>80*s){b=1/0,E=1/0;let v=-1/0,S=-1/0;for(let P=s;P<m;P+=s){const A=c[P],M=c[P+1];A<b&&(b=A),M<E&&(E=M),A>v&&(v=A),M>S&&(S=M)}I=Math.max(v-b,S-E),I=I!==0?32767/I:0}return Rm(h,g,s,b,E,I,0),g}function BP(c,r,s,u,m){let h;if(m===function(g,b,E,I){let v=0;for(let S=b,P=E-I;S<E;S+=I)v+=(g[P]-g[S])*(g[S+1]+g[P+1]),P=S;return v}(c,r,s,u)>0)for(let g=r;g<s;g+=u)h=jP(g/u|0,c[g],c[g+1],h);else for(let g=s-u;g>=r;g-=u)h=jP(g/u|0,c[g],c[g+1],h);return h&&dv(h,h.next)&&(Bm(h),h=h.next),h}function Zu(c,r){if(!c)return c;r||(r=c);let s,u=c;do if(s=!1,u.steiner||!dv(u,u.next)&&ii(u.prev,u,u.next)!==0)u=u.next;else{if(Bm(u),u=r=u.prev,u===u.next)break;s=!0}while(s||u!==r);return r}function Rm(c,r,s,u,m,h,g){if(!c)return;!g&&h&&function(E,I,v,S){let P=E;do P.z===0&&(P.z=Kb(P.x,P.y,I,v,S)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==E);P.prevZ.nextZ=null,P.prevZ=null,function(A){let M,k=1;do{let R,N=A;A=null;let G=null;for(M=0;N;){M++;let W=N,j=0;for(let X=0;X<k&&(j++,W=W.nextZ,W);X++);let Z=k;for(;j>0||Z>0&&W;)j!==0&&(Z===0||!W||N.z<=W.z)?(R=N,N=N.nextZ,j--):(R=W,W=W.nextZ,Z--),G?G.nextZ=R:A=R,R.prevZ=G,G=R;N=W}G.nextZ=null,k*=2}while(M>1)}(P)}(c,u,m,h);let b=c;for(;c.prev!==c.next;){const E=c.prev,I=c.next;if(h?qj(c,u,m,h):Gj(c))r.push(E.i,c.i,I.i),Bm(c),c=I.next,b=I.next;else if((c=I)===b){g?g===1?Rm(c=Wj(Zu(c),r),r,s,u,m,h,2):g===2&&Hj(c,r,s,u,m,h):Rm(Zu(c),r,s,u,m,h,1);break}}}function Gj(c){const r=c.prev,s=c,u=c.next;if(ii(r,s,u)>=0)return!1;const m=r.x,h=s.x,g=u.x,b=r.y,E=s.y,I=u.y,v=m<h?m<g?m:g:h<g?h:g,S=b<E?b<I?b:I:E<I?E:I,P=m>h?m>g?m:g:h>g?h:g,A=b>E?b>I?b:I:E>I?E:I;let M=u.next;for(;M!==r;){if(M.x>=v&&M.x<=P&&M.y>=S&&M.y<=A&&Bf(m,b,h,E,g,I,M.x,M.y)&&ii(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function qj(c,r,s,u){const m=c.prev,h=c,g=c.next;if(ii(m,h,g)>=0)return!1;const b=m.x,E=h.x,I=g.x,v=m.y,S=h.y,P=g.y,A=b<E?b<I?b:I:E<I?E:I,M=v<S?v<P?v:P:S<P?S:P,k=b>E?b>I?b:I:E>I?E:I,R=v>S?v>P?v:P:S>P?S:P,N=Kb(A,M,r,s,u),G=Kb(k,R,r,s,u);let W=c.prevZ,j=c.nextZ;for(;W&&W.z>=N&&j&&j.z<=G;){if(W.x>=A&&W.x<=k&&W.y>=M&&W.y<=R&&W!==m&&W!==g&&Bf(b,v,E,S,I,P,W.x,W.y)&&ii(W.prev,W,W.next)>=0||(W=W.prevZ,j.x>=A&&j.x<=k&&j.y>=M&&j.y<=R&&j!==m&&j!==g&&Bf(b,v,E,S,I,P,j.x,j.y)&&ii(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;W&&W.z>=N;){if(W.x>=A&&W.x<=k&&W.y>=M&&W.y<=R&&W!==m&&W!==g&&Bf(b,v,E,S,I,P,W.x,W.y)&&ii(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;j&&j.z<=G;){if(j.x>=A&&j.x<=k&&j.y>=M&&j.y<=R&&j!==m&&j!==g&&Bf(b,v,E,S,I,P,j.x,j.y)&&ii(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function Wj(c,r){let s=c;do{const u=s.prev,m=s.next.next;!dv(u,m)&&FP(u,s,s.next,m)&&zm(u,m)&&zm(m,u)&&(r.push(u.i,s.i,m.i),Bm(s),Bm(s.next),s=c=m),s=s.next}while(s!==c);return Zu(s)}function Hj(c,r,s,u,m,h){let g=c;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&Jj(g,b)){let E=NP(g,b);return g=Zu(g,g.next),E=Zu(E,E.next),Rm(g,r,s,u,m,h,0),void Rm(E,r,s,u,m,h,0)}b=b.next}g=g.next}while(g!==c)}function Zj(c,r){return c.x-r.x}function Xj(c,r){const s=function(m,h){let g=h;const b=m.x,E=m.y;let I,v=-1/0;do{if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const k=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(k<=b&&k>v&&(v=k,I=g.x<g.next.x?g:g.next,k===b))return I}g=g.next}while(g!==h);if(!I)return null;const S=I,P=I.x,A=I.y;let M=1/0;g=I;do{if(b>=g.x&&g.x>=P&&b!==g.x&&Bf(E<A?b:v,E,P,A,E<A?v:b,E,g.x,g.y)){const k=Math.abs(E-g.y)/(b-g.x);zm(g,m)&&(k<M||k===M&&(g.x>I.x||g.x===I.x&&Yj(I,g)))&&(I=g,M=k)}g=g.next}while(g!==S);return I}(c,r);if(!s)return r;const u=NP(s,c);return Zu(u,u.next),Zu(s,s.next)}function Yj(c,r){return ii(c.prev,c,r.prev)<0&&ii(r.next,c,c.next)<0}function Kb(c,r,s,u,m){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-s)*m|0)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Kj(c){let r=c,s=c;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==c);return s}function Bf(c,r,s,u,m,h,g,b){return(m-g)*(r-b)>=(c-g)*(h-b)&&(c-g)*(u-b)>=(s-g)*(r-b)&&(s-g)*(h-b)>=(m-g)*(u-b)}function Jj(c,r){return c.next.i!==r.i&&c.prev.i!==r.i&&!function(s,u){let m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==u.i&&m.next.i!==u.i&&FP(m,m.next,s,u))return!0;m=m.next}while(m!==s);return!1}(c,r)&&(zm(c,r)&&zm(r,c)&&function(s,u){let m=s,h=!1;const g=(s.x+u.x)/2,b=(s.y+u.y)/2;do m.y>b!=m.next.y>b&&m.next.y!==m.y&&g<(m.next.x-m.x)*(b-m.y)/(m.next.y-m.y)+m.x&&(h=!h),m=m.next;while(m!==s);return h}(c,r)&&(ii(c.prev,c,r.prev)||ii(c,r.prev,r))||dv(c,r)&&ii(c.prev,c,c.next)>0&&ii(r.prev,r,r.next)>0)}function ii(c,r,s){return(r.y-c.y)*(s.x-r.x)-(r.x-c.x)*(s.y-r.y)}function dv(c,r){return c.x===r.x&&c.y===r.y}function FP(c,r,s,u){const m=mv(ii(c,r,s)),h=mv(ii(c,r,u)),g=mv(ii(s,u,c)),b=mv(ii(s,u,r));return m!==h&&g!==b||!(m!==0||!pv(c,s,r))||!(h!==0||!pv(c,u,r))||!(g!==0||!pv(s,c,u))||!(b!==0||!pv(s,r,u))}function pv(c,r,s){return r.x<=Math.max(c.x,s.x)&&r.x>=Math.min(c.x,s.x)&&r.y<=Math.max(c.y,s.y)&&r.y>=Math.min(c.y,s.y)}function mv(c){return c>0?1:c<0?-1:0}function zm(c,r){return ii(c.prev,c,c.next)<0?ii(c,r,c.next)>=0&&ii(c,c.prev,r)>=0:ii(c,r,c.prev)<0||ii(c,c.next,r)<0}function NP(c,r){const s=Jb(c.i,c.x,c.y),u=Jb(r.i,r.x,r.y),m=c.next,h=r.prev;return c.next=r,r.prev=c,s.next=m,m.prev=s,u.next=s,s.prev=u,h.next=u,u.prev=h,u}function jP(c,r,s,u){const m=Jb(c,r,s);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function Bm(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Jb(c,r,s){return{i:c,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function gv(c,r){const s=c.length;if(s<=1)return[c];const u=[];let m,h;for(let g=0;g<s;g++){const b=Rh(c[g]);b!==0&&(c[g].area=Math.abs(b),h===void 0&&(h=b<0),h===b<0?(m&&u.push(m),m=[c[g]]):m.push(c[g]))}if(m&&u.push(m),r>1)for(let g=0;g<u.length;g++)u[g].length<=r||(h_(u[g],r,1,u[g].length-1,Qj),u[g]=u[g].slice(0,r));return u}function Qj(c,r){return r.area-c.area}function Qb(c,r,s){const u=s.patternDependencies;let m=!1;for(const h of r){const g=h.paint.get(`${c}-pattern`);g.isConstant()||(m=!0);const b=g.constantOr(null);b&&(m=!0,u[b]=!0)}return m}function ew(c,r,s,u,m){const h=m.patternDependencies;for(const g of r){const b=g.paint.get(`${c}-pattern`).value;if(b.kind!=="constant"){let E=b.evaluate({zoom:u},s,{},m.availableImages);E=E&&E.name?E.name:E,h[E]=!0,s.patterns[g.id]=E}}return s}class tw{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new _i,this.indexArray2=new Is,this.programConfigurations=new Cs(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new On,this.segments2=new On,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection}updateFootprints(r,s){}populate(r,s,u,m){this.hasPattern=Qb("fill",this.layers,s);const h=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:E,index:I,sourceLayerIndex:v}of r){const S=this.layers[0]._featureFilter.needGeometry,P=St(b,S);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),P,u))continue;const A=h?h.evaluate(P,{},u,s.availableImages):void 0,M={id:E,properties:b.properties,type:b.type,sourceLayerIndex:v,index:I,geometry:S?P.geometry:bt(b,u,m),patterns:{},sortKey:A};g.push(M)}h&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:I,sourceLayerIndex:v}=b;if(this.hasPattern){const S=ew("fill",this.layers,b,this.zoom,s);this.patternFeatures.push(S)}else this.addFeature(b,E,I,u,{},s.availableImages,s.brightness);s.featureIndex.insert(r[I].feature,E,I,v,this.index)}}update(r,s,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,s,g?this.stateDependentLayers:this.layers,u,m,h)}addFeatures(r,s,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Vj),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,u,m,h,g=[],b){for(const E of gv(s,500)){let I=0;for(const k of E)I+=k.length;const v=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),S=v.vertexLength,P=[],A=[];for(const k of E){if(k.length===0)continue;k!==E[0]&&A.push(P.length/2);const R=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),N=R.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(N+k.length-1,N),P.push(k[0].x),P.push(k[0].y);for(let G=1;G<k.length;G++)this.layoutVertexArray.emplaceBack(k[G].x,k[G].y),this.indexArray2.emplaceBack(N+G-1,N+G),P.push(k[G].x),P.push(k[G].y);R.vertexLength+=k.length,R.primitiveLength+=k.length}const M=Lm(P,A);for(let k=0;k<M.length;k+=3)this.indexArray.emplaceBack(S+M[k],S+M[k+1],S+M[k+2]);v.vertexLength+=I,v.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,b)}}let $P,UP,VP,GP;$t(tw,"FillBucket",{omit:["layers","patternFeatures"]});class rw{constructor(r,s,u,m){if(this.triangleCount=s.length/3,this.min=new _t(0,0),this.max=new _t(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[h,g]=[r[0].clone(),r[0].clone()];for(let S=1;S<r.length;++S){const P=r[S];h.x=Math.min(h.x,P.x),h.y=Math.min(h.y,P.y),g.x=Math.max(g.x,P.x),g.y=Math.max(g.y,P.y)}if(m){const S=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/m);u=Math.max(u,S)}if(u===0)return;this.min=h,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const E=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/E)),this.cellsY=Math.max(1,Math.ceil(b.y/E)),this.xScale=1/E,this.yScale=1/E;const I=[];for(let S=0;S<this.triangleCount;S++){const P=r[s[3*S+0]].sub(this.min),A=r[s[3*S+1]].sub(this.min),M=r[s[3*S+2]].sub(this.min),k=Ds(Math.floor(Math.min(P.x,A.x,M.x)),this.xScale,this.cellsX),R=Ds(Math.floor(Math.max(P.x,A.x,M.x)),this.xScale,this.cellsX),N=Ds(Math.floor(Math.min(P.y,A.y,M.y)),this.yScale,this.cellsY),G=Ds(Math.floor(Math.max(P.y,A.y,M.y)),this.yScale,this.cellsY),W=new _t(0,0),j=new _t(0,0),Z=new _t(0,0),X=new _t(0,0);for(let ce=N;ce<=G;++ce){W.y=j.y=ce*E,Z.y=X.y=(ce+1)*E;for(let pe=k;pe<=R;++pe)W.x=Z.x=pe*E,j.x=X.x=(pe+1)*E,(Qr(P,A,M,W,j,X)||Qr(P,A,M,W,X,Z))&&I.push({cellIdx:ce*this.cellsX+pe,triIdx:S})}}if(I.length===0)return;I.sort((S,P)=>S.cellIdx-P.cellIdx||S.triIdx-P.triIdx);let v=0;for(;v<I.length;){const S=I[v].cellIdx,P={start:this.payload.length,len:0};for(;v<I.length&&I[v].cellIdx===S;)++P.len,this.payload.push(I[v++].triIdx);this.cells[S]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,s){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Ds(r.x-this.min.x,this.xScale,this.cellsX),m=Ds(r.y-this.min.y,this.yScale,this.cellsY),h=this.cells[m*this.cellsX+u];if(h){this._lazyInitLookup();for(let g=0;g<h.len;g++){const b=this.payload[h.start+g],E=Math.floor(b/8),I=1<<b%8;if(!(this.lookup[E]&I)&&(this.lookup[E]|=I,s.push(b),s.length===this.triangleCount))return}}}query(r,s,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>s.x||r.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const m=Ds(r.x-this.min.x,this.xScale,this.cellsX),h=Ds(s.x-this.min.x,this.xScale,this.cellsX),g=Ds(r.y-this.min.y,this.yScale,this.cellsY),b=Ds(s.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=b;E++)for(let I=m;I<=h;I++){const v=this.cells[E*this.cellsX+I];if(v)for(let S=0;S<v.len;S++){const P=this.payload[v.start+S],A=Math.floor(P/8),M=1<<P%8;if(!(this.lookup[A]&M)&&(this.lookup[A]|=M,u.push(P),u.length===this.triangleCount))return}}}}function Ds(c,r,s){return Math.max(0,Math.min(s-1,Math.floor(c*r)))}$t(rw,"TriangleGridIndex");class qP{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}populate(r,s,u,m){const h=[];for(const{feature:g,id:b,index:E,sourceLayerIndex:I}of r){const v=this.layers[0]._featureFilter.needGeometry,S=St(g,v);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),S,u))continue;const P={id:b,properties:g.properties,type:g.type,sourceLayerIndex:I,index:E,geometry:v?S.geometry:bt(g,u,m),patterns:{}};h.push(P)}for(const g of h){const{geometry:b,index:E,sourceLayerIndex:I}=g;this.addFeature(g,b,E,u,{},s.availableImages,s.brightness),s.featureIndex.insert(r[E].feature,b,E,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,s,u,m,h){}destroy(){}addFeature(r,s,u,m,h,g=[],b){for(const E of gv(s,2)){const I=[],v=[],S=[],P=new _t(1/0,1/0),A=new _t(-1/0,-1/0);for(const R of E)if(R.length!==0){R!==E[0]&&S.push(v.length/2);for(let N=0;N<R.length;N++)v.push(R[N].x),v.push(R[N].y),I.push(R[N]),P.x=Math.min(P.x,R[N].x),P.y=Math.min(P.y,R[N].y),A.x=Math.max(A.x,R[N].x),A.y=Math.max(A.y,R[N].y)}const M=Lm(v,S),k=new rw(I,M,8,256);this.footprints.push({vertices:I,indices:M,grid:k,min:P,max:A})}}}$t(qP,"ClipBucket",{omit:["layers"]});const e2=Fr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),t2=Fr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),r2=Fr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),n2=Fr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),i2=Fr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),o2=Fr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:a2}=e2;var nw,WP,iw,HP,ow,ZP,XP,yv={};function YP(){if(WP)return nw;WP=1;var c=Hr();function r(m,h,g,b,E){this.properties={},this.extent=g,this.type=0,this._pbf=m,this._geometry=-1,this._keys=b,this._values=E,m.readFields(s,this,h)}function s(m,h,g){m==1?h.id=g.readVarint():m==2?function(b,E){for(var I=b.readVarint()+b.pos;b.pos<I;){var v=E._keys[b.readVarint()],S=E._values[b.readVarint()];E.properties[v]=S}}(g,h):m==3?h.type=g.readVarint():m==4&&(h._geometry=g.pos)}function u(m){for(var h,g,b=0,E=0,I=m.length,v=I-1;E<I;v=E++)b+=((g=m[v]).x-(h=m[E]).x)*(h.y+g.y);return b}return nw=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var h,g=m.readVarint()+m.pos,b=1,E=0,I=0,v=0,S=[];m.pos<g;){if(E<=0){var P=m.readVarint();b=7&P,E=P>>3}if(E--,b===1||b===2)I+=m.readSVarint(),v+=m.readSVarint(),b===1&&(h&&S.push(h),h=[]),h.push(new c(I,v));else{if(b!==7)throw new Error("unknown command "+b);h&&h.push(h[0].clone())}}return h&&S.push(h),S},r.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var h=m.readVarint()+m.pos,g=1,b=0,E=0,I=0,v=1/0,S=-1/0,P=1/0,A=-1/0;m.pos<h;){if(b<=0){var M=m.readVarint();g=7&M,b=M>>3}if(b--,g===1||g===2)(E+=m.readSVarint())<v&&(v=E),E>S&&(S=E),(I+=m.readSVarint())<P&&(P=I),I>A&&(A=I);else if(g!==7)throw new Error("unknown command "+g)}return[v,P,S,A]},r.prototype.toGeoJSON=function(m,h,g){var b,E,I=this.extent*Math.pow(2,g),v=this.extent*m,S=this.extent*h,P=this.loadGeometry(),A=r.types[this.type];function M(N){for(var G=0;G<N.length;G++){var W=N[G];N[G]=[360*(W.x+v)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+S)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(b=0;b<P.length;b++)k[b]=P[b][0];M(P=k);break;case 2:for(b=0;b<P.length;b++)M(P[b]);break;case 3:for(P=function(N){var G=N.length;if(G<=1)return[N];for(var W,j,Z=[],X=0;X<G;X++){var ce=u(N[X]);ce!==0&&(j===void 0&&(j=ce<0),j===ce<0?(W&&Z.push(W),W=[N[X]]):W.push(N[X]))}return W&&Z.push(W),Z}(P),b=0;b<P.length;b++)for(E=0;E<P[b].length;E++)M(P[b][E])}P.length===1?P=P[0]:A="Multi"+A;var R={type:"Feature",geometry:{type:A,coordinates:P},properties:this.properties};return"id"in this&&(R.id=this.id),R},nw}function KP(){if(HP)return iw;HP=1;var c=YP();function r(u,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(s,this,m),this.length=this._features.length}function s(u,m,h){u===15?m.version=h.readVarint():u===1?m.name=h.readString():u===5?m.extent=h.readVarint():u===2?m._features.push(h.pos):u===3?m._keys.push(h.readString()):u===4&&m._values.push(function(g){for(var b=null,E=g.readVarint()+g.pos;g.pos<E;){var I=g.readVarint()>>3;b=I===1?g.readString():I===2?g.readFloat():I===3?g.readDouble():I===4?g.readVarint64():I===5?g.readVarint():I===6?g.readSVarint():I===7?g.readBoolean():null}return b}(h))}return iw=r,r.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var m=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,m,this.extent,this._keys,this._values)},iw}function JP(){return XP||(XP=1,yv.VectorTile=function(){if(ZP)return ow;ZP=1;var c=KP();function r(s,u,m){if(s===3){var h=new c(m,m.readVarint()+m.pos);h.length&&(u[h.name]=h)}}return ow=function(s,u){this.layers=s.readFields(r,{},u)},ow}(),yv.VectorTileFeature=YP(),yv.VectorTileLayer=KP()),yv}var Ff=JP();class Xu extends _t{constructor(r,s,u){super(r,s),this.z=u}}class QP extends Xu{constructor(r,s,u,m){super(r,s,u),this.w=m}}function _v(c,r,s,u){const m=[],h=u===0?(g,b,E,I,v,S)=>{g.push(new _t(S,E+(S-b)/(I-b)*(v-E)))}:(g,b,E,I,v,S)=>{g.push(new _t(b+(S-E)/(v-E)*(I-b),S))};for(const g of c){const b=[];for(const E of g){if(E.length<=2)continue;const I=[];for(let P=0;P<E.length-1;P++){const A=E[P].x,M=E[P].y,k=E[P+1].x,R=E[P+1].y,N=u===0?A:M,G=u===0?k:R;N<r?G>r&&h(I,A,M,k,R,r):N>s?G<s&&h(I,A,M,k,R,s):I.push(E[P]),G<r&&N>=r&&h(I,A,M,k,R,r),G>s&&N<=s&&h(I,A,M,k,R,s)}let v=E[E.length-1];const S=u===0?v.x:v.y;S>=r&&S<=s&&I.push(v),I.length&&(v=I[I.length-1],I[0].x===v.x&&I[0].y===v.y||I.push(I[0]),b.push(I))}b.length&&m.push(b)}return m}function eI(c,r,s,u){const m=s==="x"?"y":"x",h=(u-c[s])/(r[s]-c[s]);c[m]=c[m]+(r[m]-c[m])*h,c[s]=u,c.hasOwnProperty("z")&&(c.z=nr(c.z,r.z,h)),c.hasOwnProperty("w")&&(c.w=nr(c.w,r.w,h))}function tI(c,r,s,u){const m=s,h=u;for(const g of["x","y"]){let b=c,E=r;b[g]>=E[g]&&(b=r,E=c),b[g]<m&&E[g]>m&&eI(b,E,g,m),b[g]<h&&E[g]>h&&eI(E,b,g,h)}}const vv=Number.MAX_SAFE_INTEGER;function rI(c,r,s,u){return c.order<r||c.order===vv||!(c.clipMask&s)||function(m,h){return h.length!==0&&h.find(g=>g===m)===void 0}(u,c.clipScope)}function xv(c,r){return c.x-r.x||c.y-r.y}function nI(c,r){return xv(c.min,r.min)===0&&xv(c.max,r.max)===0}function aw(c,r){return!(c.min.x>r.max.x||c.max.x<r.min.x||c.min.y>r.max.y||c.max.y<r.min.y)}function sw(c,r){if(c.length!==r.length)return!1;for(let s=0;s<c.length;s++)if(c[s].sourceId!==r[s].sourceId||!nI(c[s],r[s])||c[s].order!==r[s].order||c[s].clipMask!==r[s].clipMask||!wn(c[s].clipScope,r[s].clipScope))return!1;return!0}function iI(c,r,s){const u=1/Ct,m=1/(1<<s.canonical.z),h=(r.x*u+s.canonical.x)*m+s.wrap,g=(r.y*u+s.canonical.y)*m;return{min:new _t((c.x*u+s.canonical.x)*m+s.wrap,(c.y*u+s.canonical.y)*m),max:new _t(h,g)}}function s2(c,r,s){const u=1<<s.canonical.z,m=((r.x-s.wrap)*u-s.canonical.x)*Ct,h=(r.y*u-s.canonical.y)*Ct;return{min:new _t(((c.x-s.wrap)*u-s.canonical.x)*Ct,(c.y*u-s.canonical.y)*Ct),max:new _t(m,h)}}function oI(c,r,s,u,m,h,g){const b=c.indices,E=c.vertices,I=[];for(let v=u;v<u+m;v+=3){const S=r[s[v+0]+h],P=r[s[v+1]+h],A=r[s[v+2]+h],M=Math.min(S.x,P.x,A.x),k=Math.max(S.x,P.x,A.x),R=Math.min(S.y,P.y,A.y),N=Math.max(S.y,P.y,A.y);I.length=0,c.grid.query(new _t(M,R),new _t(k,N),I);for(let G=0;G<I.length;G++){const W=I[G];if(Qr(E[b[3*W+0]],E[b[3*W+1]],E[b[3*W+2]],S,P,A,g))return!0}}return!1}function aI(c,r,s,u){if(!c||!s)return!1;let m=c.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(s.vertices.length<c.vertices.length)return aI(s,u,c,r);const h=r.canonical,g=u.canonical,b=Math.pow(2,g.z-h.z);m=c.vertices.map(E=>new _t((E.x+h.x*Ct)*b-g.x*Ct,(E.y+h.y*Ct)*b-g.y*Ct))}return oI(s,m,c.indices,0,c.indices.length,0,0)}function sI(c,r,s,u){const m=Math.pow(2,u.z-s.z);return new _t((c+s.x*Ct)*m-u.x*Ct,(r+s.y*Ct)*m-u.y*Ct)}function lI(c,r){const s=[];r.grid.queryPoint(c,s);const u=r.indices,m=r.vertices;for(let h=0;h<s.length;h++){const g=s[h];if(fn([m[u[3*g+0]],m[u[3*g+1]],m[u[3*g+2]]],c))return!0}return!1}const lw=[new _t(0,0),new _t(Ct,0),new _t(Ct,Ct),new _t(0,Ct)];function cI(c,r){const s=[];let u=[];if(!r||c.length<2)return[c];if(c.length===2)return Nn(c[0],c[1],lw)?[c]:[];for(let m=0;m<c.length+2;m++){const h=c[m%c.length],g=c[(m+1)%c.length],b=Nn(m===0?c[c.length-1]:c[(m-1)%c.length],h,lw),E=Nn(h,g,lw),I=b||E;I&&u.push(h),I&&E||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const cw=Ff.VectorTileFeature.types,l2=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],c2=["fill-extrusion-flood-light-ground-radius"],u2=Math.pow(2,13),h2=Math.pow(2,15)-1,uI=new _t(0,1),Mc=2147483648;function Fm(c,r,s,u,m,h,g,b){c.emplaceBack((r<<1)+g,(s<<1)+h,(Math.floor(u*u2)<<1)+m,Math.round(b))}function Nm(c,r,s){c.emplaceBack(r.x*Ct,r.y*Ct,s?1:0)}function bv(c,r,s,u,m,h){c.emplaceBack(r.x,r.y,(s.x<<1)+u,(s.y<<1)+m,h)}function jm(c,r,s){c.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class hI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class fI{constructor(){this.centroidXY=new _t(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _t(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _t(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _t(this.max.x-this.min.x,this.max.y-this.min.y)}}class dI{constructor(){this.acc=new _t(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,s){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=s.x,r.min.y=r.max.y=s.y)}appendEdge(r,s,u){this.accCount++,this.acc._add(s);let m=!!this.borders;s.x<r.min.x?(r.min.x=s.x,m=!0):s.x>r.max.x&&(r.max.x=s.x,m=!0),s.y<r.min.y?(r.min.y=s.y,m=!0):s.y>r.max.y&&(r.max.y=s.y,m=!0),((s.x===0||s.x===Ct)&&s.x===u.x)!=((s.y===0||s.y===Ct)&&s.y===u.y)&&this.processBorderOverlap(s,u),m&&this.checkBorderIntersection(s,u)}checkBorderIntersection(r,s){s.x<0!=r.x<0&&this.addBorderIntersection(0,nr(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>Ct!=r.x>Ct&&this.addBorderIntersection(1,nr(s.y,r.y,(Ct-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,nr(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>Ct!=r.y>Ct&&this.addBorderIntersection(3,nr(s.x,r.x,(Ct-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new _t(0,0):new _t(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0):0}}function pI(c,r){const s=c.add(r)._unit(),u=yr(c.x*s.x+c.y*s.y,-1,1);var m,h,g;return g=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(g)))/4*h2*((m=c).x*(h=r).y-m.y*h.x<0?-1:1)}const f2=[c=>c.x<0,c=>c.x>Ct,c=>c.y<0,c=>c.y>Ct];function d2(c,r,s,u){const m=[4];if(u===0)return m;s._mult(u);const h=c.sub(s),g=r.sub(s),b=[c,r,h,g];for(let E=0;E<4;E++)for(const I of b)if(f2[E](I)){m.push(E);break}return m}class mI{constructor(r){this.vertexArray=new Mf,this.indexArray=new _i,this.programConfigurations=new Cs(r.layers,{zoom:r.zoom,lut:r.lut},s=>c2.includes(s)),this._segments=new On,this.hiddenByLandmarkVertexArray=new Of,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new On}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,s,u,m=!1){const h=r.length;if(h>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const I=r[0],v=r[1];E=pI(I.sub(r[h-1])._perp()._unit(),v.sub(I)._perp()._unit())}for(let I=0;I<h;I++){const v=I===h-1?0:I+1,S=r[I],P=r[v],A=r[v===h-1?0:v+1],M=P.sub(S)._perp()._unit(),k=pI(M,A.sub(P)._perp()._unit()),R=E,N=k;if(uw(S,P,s)||m&&_I(S,s)&&_I(P,s)){E=k;continue}const G=b.vertexLength;bv(this.vertexArray,S,P,1,1,R),bv(this.vertexArray,S,P,1,0,R),bv(this.vertexArray,S,P,0,1,N),bv(this.vertexArray,S,P,0,0,N),b.vertexLength+=4;const W=d2(S,P,M,u);for(const j of W)this._segmentToGroundQuads[g].push({id:G,region:j}),this._segmentToRegionTriCounts[g][j]+=2,b.primitiveLength+=2;E=k}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),s=r.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((m,h)=>m.region-h.region);for(let u=0;u<s;u++){const m=this._segmentToGroundQuads[u],h=r[u],g=this._segmentToRegionTriCounts[u];g.reduce((E,I)=>E+I,0);let b=0;for(let E=0;E<=4;E++){const I=g[E];if(I!==0){let v=this.regionSegments[E];v||(v=this.regionSegments[E]=new On);const S={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+b,vertexLength:h.vertexLength,primitiveLength:I};v.get().push(S)}b+=I}for(let E=0;E<m.length;E++){const I=m[E].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,s,u,m,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,s,u,m,h,g)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,t2.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,s,u,m,h,g){this.hasData()&&this.programConfigurations.updatePaintArrays(r,s,u,m,h,g)}updateHiddenByLandmark(r){if(!this.hasData())return;const s=r.groundVertexCount+r.groundVertexArrayOffset;if(r.groundVertexCount===0)return;const u=r.flags&Mc?1:0;for(let m=r.groundVertexArrayOffset;m<s;++m)this.hiddenByLandmarkVertexArray.emplace(m,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,i2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const s=this.regionSegments[r];s&&s.destroy()}}}}class wv{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new _i,this.footprintVertices=new Es,this.footprintSegments=[],this.layoutVertexArray=new Ms,this.centroidVertexArray=new nv,this.wallVertexArray=new Mm,this.indexArray=new _i,this.programConfigurations=new Cs(r.layers,{zoom:r.zoom,lut:r.lut},s=>l2.includes(s)),this.segments=new On,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new mI(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(r,s){}populate(r,s,u,m){this.features=[],this.hasPattern=Qb("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ke(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:g,index:b,sourceLayerIndex:E}of r){const I=this.layers[0]._featureFilter.needGeometry,v=St(h,I);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),v,u))continue;const S={id:g,sourceLayerIndex:E,index:b,geometry:I?v.geometry:bt(h,u,m),properties:h.properties,type:h.type,patterns:{}},P=this.layoutVertexArray.length,A=cw[S.type]==="Polygon";if(this.hasPattern)this.features.push(ew("fill-extrusion",this.layers,S,this.zoom,s));else if(this.wallMode)for(const M of S.geometry)for(const k of cI(M,A))this.addFeature(S,[k],b,u,{},s.availableImages,m,s.brightness);else this.addFeature(S,S.geometry,b,u,{},s.availableImages,m,s.brightness);s.featureIndex.insert(h,S.geometry,b,E,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,s,u,m,h,g){for(const b of this.features){const E=cw[b.type]==="Polygon",{geometry:I}=b;if(this.wallMode)for(const v of I)for(const S of cI(v,E))this.addFeature(b,[S],b.index,s,u,m,h,g);else this.addFeature(b,I,b.index,s,u,m,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,s,u,m,h){const g=Object.keys(r).length!==0;if(g&&!this.stateDependentLayers.length)return;const b=g?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(r,s,b,u,m,h),this.groundEffect.update(r,s,b,u,m,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,a2),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,n2.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,o2.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,r2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,u,m,h,g,b,E){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,v=[new _t(0,0),new _t(Ct,Ct)],S=b.projection,P=S.name==="globe",A=this.wallMode||cw[r.type]==="Polygon",M=new dI;M.centroidDataIndex=this.centroidData.length;const k=new fI,R=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},m)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},m);let G;if(k.height=N,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pf),this.wallMode){if(P)return void zr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;G=function(fe){const Te=fe[0].x===fe[fe.length-1].x&&fe[0].y===fe[fe.length-1].y;(function(wt){let gt=0;const Jt=wt.length;for(let Dt=0;Dt<Jt;Dt++)gt+=(wt[(Dt+1)%Jt].x-wt[Dt].x)*(wt[(Dt+1)%Jt].y+wt[Dt].y);return gt>=0})(fe)||(fe=fe.reverse());const Ee={geometry:[],joinNormals:[],indices:[]},Re=[],Fe=[],Ne=[];let je=fe.length;if(je<(Te?3:2))return Ee;for(;je>=2&&fe[je-1].equals(fe[je-2]);)je--;let Xe,Ue,it,dt,Qe,Rt=0;for(;Rt<je-1&&fe[Rt].equals(fe[Rt+1]);)Rt++;Te&&(Xe=fe[je-2],Qe=fe[Rt].sub(Xe)._unit()._perp());for(let wt=Rt;wt<je;wt++){if(it=wt===je-1?Te?fe[Rt+1]:void 0:fe[wt+1],it&&fe[wt].equals(it))continue;Qe&&(dt=Qe),Xe&&(Ue=Xe),Xe=fe[wt],Qe=it?it.sub(Xe)._unit()._perp():dt,dt=dt||Qe;let gt=dt.add(Qe);gt.x===0&&gt.y===0||gt._unit();const Jt=gt.x*Qe.x+gt.y*Qe.y,Dt=Jt!==0?1/Jt:1/0,jt=dt.x*Qe.y-dt.y*Qe.x>0;let ar="miter";const wr=2;ar==="miter"&&Dt>wr&&(ar="bevel"),ar==="bevel"&&(Dt>100&&(ar="flipbevel"),Dt<wr&&(ar="miter"));const mr=(gr,Ar,Er,nn)=>{const qr=new _t(gr.x,gr.y),lr=new _t(gr.x,gr.y);qr.x+=Ar.x*nn,qr.y+=Ar.y*nn,lr.x-=Ar.x*Math.max(Er,1),lr.y-=Ar.y*Math.max(Er,1),Ne.push(Ar),Re.push(qr),Fe.push(lr)};if(ar==="miter")gt._mult(Dt),mr(Xe,gt,0,0);else if(ar==="flipbevel")gt=Qe.mult(-1),mr(Xe,gt,0,0),mr(Xe,gt.mult(-1),0,0);else{const gr=-Math.sqrt(Dt*Dt-1),Ar=jt?gr:0,Er=jt?0:gr;Ue&&mr(Xe,dt,Ar,Er),it&&mr(Xe,Qe,Ar,Er)}}Ee.geometry=[...Re,...Fe.reverse(),Re[0]],Ee.joinNormals=[...Ne,...Ne.reverse(),Ne[Ne.length-1]];const Pt=Ee.geometry.length-1;for(let wt=0;wt<Pt/2;wt++)if(wt+1<Pt/2){let gt=wt,Jt=wt+1,Dt=Pt-1-wt,jt=Pt-2-wt;gt=gt===0?Pt-1:gt-1,Jt=Jt===0?Pt-1:Jt-1,Dt=Dt===0?Pt-1:Dt-1,jt=jt===0?Pt-1:jt-1,Ee.indices.push(Dt),Ee.indices.push(Jt),Ee.indices.push(gt),Ee.indices.push(Dt),Ee.indices.push(jt),Ee.indices.push(Jt)}return Ee}(s[0]),s=[G.geometry]}const W=(fe,Te)=>fe<(Te.length-1)/2||fe===Te.length-1,j=this.wallMode?[s]:gv(s,500);for(let fe=j.length-1;fe>=0;fe--){const Te=j[fe];(Te.length===0||(Z=Te[0]).every(_e=>_e.x<=0)||Z.every(_e=>_e.x>=Ct)||Z.every(_e=>_e.y<=0)||Z.every(_e=>_e.y>=Ct))&&j.splice(fe,1)}var Z;let X;if(P)X=wI(j,v,m);else{X=[];for(const fe of j)X.push({polygon:fe,bounds:v})}const ce=A?this.edgeRadius:0,pe=ce>0&&this.zoom<17,ge=(fe,Te)=>{if(fe.length===0)return!1;const _e=fe[fe.length-1];return Te.x===_e.x&&Te.y===_e.y};for(const{polygon:fe,bounds:Te}of X){let _e=0,Ee=0;for(const je of fe)A&&!je[0].equals(je[je.length-1])&&je.push(je[0]),Ee+=A?je.length-1:je.length;const Re=this.segments.prepareSegment((A?5:4)*Ee,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const Fe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ne=new hI;if(Ne.vertexOffset=this.footprintVertices.length,Ne.indexOffset=3*this.footprintIndices.length,Ne.ringIndices=[],A){const je=[],Xe=[];_e=Re.vertexLength;for(let it=0;it<fe.length;it++){const dt=fe[it];dt.length&&it!==0&&Xe.push(je.length/2);const Qe=[];let Rt,Pt;Rt=dt[1].sub(dt[0])._perp()._unit(),Ne.ringIndices.push(dt.length-1);for(let wt=1;wt<dt.length;wt++){const gt=dt[wt],Jt=dt[wt===dt.length-1?1:wt+1],Dt=gt.clone();if(ce){Pt=Jt.sub(gt)._perp()._unit();const jt=Rt.add(Pt)._unit(),ar=ce*Math.min(4,1/(Rt.x*jt.x+Rt.y*jt.y));Dt.x+=ar*jt.x,Dt.y+=ar*jt.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),Rt=Pt}if(!R||ce!==0&&!pe||ge(Qe,Dt)||Qe.push(Dt),Fm(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),this.wallMode){const jt=W(wt,dt);Nm(this.wallVertexArray,G.joinNormals[wt],!jt)}Re.vertexLength++,this.footprintVertices.emplaceBack(gt.x,gt.y),je.push(gt.x,gt.y),P&&jm(this.layoutVertexExtArray,S.projectTilePoint(Dt.x,Dt.y,m),S.upVector(m,Dt.x,Dt.y))}R&&(ce===0||pe)&&(Qe.length!==0&&ge(Qe,Qe[0])&&Qe.pop(),this.groundEffect.addData(Qe,Te,I))}const Ue=this.wallMode?G.indices:Lm(je,Xe);for(let it=0;it<Ue.length;it+=3)this.footprintIndices.emplaceBack(Ne.vertexOffset+Ue[it+0],Ne.vertexOffset+Ue[it+1],Ne.vertexOffset+Ue[it+2]),this.indexArray.emplaceBack(_e+Ue[it],_e+Ue[it+2],_e+Ue[it+1]),Re.primitiveLength++;Ne.indexCount+=Ue.length,Ne.vertexCount+=this.footprintVertices.length-Ne.vertexOffset}for(let je=0;je<fe.length;je++){const Xe=fe[je];M.startRing(k,Xe[0]);let Ue=Xe.length>4&&vI(Xe[Xe.length-2],Xe[0],Xe[1]),it=ce?p2(Xe[Xe.length-2],Xe[0],Xe[1],ce):0;const dt=[];let Qe,Rt,Pt;Rt=Xe[1].sub(Xe[0])._perp()._unit();let wt=!0;for(let gt=1,Jt=0;gt<Xe.length;gt++){let Dt=Xe[gt-1],jt=Xe[gt];const ar=Xe[gt===Xe.length-1?1:gt+1];if(M.appendEdge(k,jt,Dt),uw(jt,Dt,Te)){ce&&(Rt=ar.sub(jt)._perp()._unit(),wt=!wt);continue}const wr=jt.sub(Dt)._perp(),mr=wr.x/(Math.abs(wr.x)+Math.abs(wr.y)),gr=wr.y>0?1:0,Ar=Dt.dist(jt);if(Jt+Ar>32768&&(Jt=0),ce){Pt=ar.sub(jt)._perp()._unit();let lr=yI(Dt,jt,ar,gI(Rt,Pt),ce);isNaN(lr)&&(lr=0);const jr=jt.sub(Dt)._unit();Dt=Dt.add(jr.mult(it))._round(),jt=jt.add(jr.mult(-lr))._round(),it=lr,Rt=Pt,R&&this.zoom>=17&&(ge(dt,Dt)||dt.push(Dt),ge(dt,jt)||dt.push(jt))}const Er=Re.vertexLength,nn=Xe.length>4&&vI(Dt,jt,ar);let qr=xI(Jt,Ue,wt);if(Fm(this.layoutVertexArray,Dt.x,Dt.y,mr,gr,0,0,qr),Fm(this.layoutVertexArray,Dt.x,Dt.y,mr,gr,0,1,qr),this.wallMode){const lr=W(gt-1,Xe),jr=G.joinNormals[gt-1];Nm(this.wallVertexArray,jr,lr),Nm(this.wallVertexArray,jr,lr)}if(Jt+=Ar,qr=xI(Jt,nn,!wt),Ue=nn,Fm(this.layoutVertexArray,jt.x,jt.y,mr,gr,0,0,qr),Fm(this.layoutVertexArray,jt.x,jt.y,mr,gr,0,1,qr),this.wallMode){const lr=W(gt,Xe),jr=G.joinNormals[gt];Nm(this.wallVertexArray,jr,lr),Nm(this.wallVertexArray,jr,lr)}if(Re.vertexLength+=4,this.indexArray.emplaceBack(Er+0,Er+1,Er+2),this.indexArray.emplaceBack(Er+1,Er+3,Er+2),Re.primitiveLength+=2,ce){const lr=_e+(gt===1?Xe.length-2:gt-2),jr=gt===1?_e:lr+1;if(this.indexArray.emplaceBack(Er+1,lr,Er+3),this.indexArray.emplaceBack(lr,jr,Er+3),Re.primitiveLength+=2,Qe===void 0&&(Qe=Er),!uw(ar,Xe[gt],Te)){const $r=gt===Xe.length-1?Qe:Re.vertexLength;this.indexArray.emplaceBack(Er+2,Er+3,$r),this.indexArray.emplaceBack(Er+3,$r+1,$r),this.indexArray.emplaceBack(Er+3,jr,$r+1),Re.primitiveLength+=3}wt=!wt}if(P){const lr=this.layoutVertexExtArray,jr=S.projectTilePoint(Dt.x,Dt.y,m),$r=S.projectTilePoint(jt.x,jt.y,m),dn=S.upVector(m,Dt.x,Dt.y),Rn=S.upVector(m,jt.x,jt.y);jm(lr,jr,dn),jm(lr,jr,dn),jm(lr,$r,Rn),jm(lr,$r,Rn)}}A&&(_e+=Xe.length-1),R&&ce&&this.zoom>=17&&(dt.length!==0&&ge(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Te,I,ce>0))}this.footprintSegments.push(Ne),Fe.triangleCount=this.indexArray.length-Fe.triangleArrayOffset,this.polygonSegments.push(Fe),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=M.borders?uI:this.encodeCentroid(M,k),this.centroidData.push(k),M.borders){this.featuresOnBorder.push(M);const fe=this.featuresOnBorder.length-1;for(let Te=0;Te<M.borders.length;Te++)M.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(fe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,E),this.groundEffect.addPaintPropertiesData(r,u,h,g,m,E),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((s,u)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const E=this.centroidData[b],I=+(E.min.y+E.max.y>Ct),v=2*I+(+(E.min.x+E.max.x>Ct)^I);for(let S=0;S<E.polygonSegLen;S++){const P=E.polygonSegIdx+S;r.push({centroidIdx:b,subtile:v,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const s=new _i;r.sort((b,E)=>b.triangleSegmentIdx===E.triangleSegmentIdx?b.subtile-E.subtile:b.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,m=0,h=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;h++}const g=r.length;for(;m!==r.length;){u=r[m].triangleSegmentIdx;let b=0,E=m,I=m;for(let v=E;v<h&&r[v].subtile===b;v++)I++;for(;E!==h;){const v=r[E];b=v.subtile;const S=this.centroidData[v.centroidIdx].min.clone(),P=this.centroidData[v.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=E;M<I;M++){const k=r[M],R=this.polygonSegments[k.polygonSegmentIdx],N=this.centroidData[k.centroidIdx].min,G=this.centroidData[k.centroidIdx].max,W=this.indexArray.uint16;for(let j=R.triangleArrayOffset;j<R.triangleArrayOffset+R.triangleCount;j++)s.emplaceBack(W[3*j],W[3*j+1],W[3*j+2]);A.primitiveLength+=R.triangleCount,S.x=Math.min(S.x,N.x),S.y=Math.min(S.y,N.y),P.x=Math.max(P.x,G.x),P.y=Math.max(P.y,G.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:S,max:P}),E=I;for(let M=E;M<h&&r[M].subtile===r[E].subtile;M++)I++}m=h;for(let v=m;v<g&&r[v].triangleSegmentIdx===r[m].triangleSegmentIdx;v++)h++}s._trim(),this.indexArray=s}getVisibleSegments(r,s,u){const m=new On;if(this.wallMode){for(const k of this.triangleSubSegments)m.segments.push(k.segment);return m}let h=0,g=0;const b=1<<r.canonical.z;if(s){const k=s.getMinMaxForTile(r);k&&(h=k.min,g=k.max)}g+=this.maxHeight;const E=r.toUnwrapped();let I;const v=[E.canonical.x/b+E.wrap,E.canonical.y/b],S=[(E.canonical.x+1)/b+E.wrap,(E.canonical.y+1)/b],P=(k,R,N)=>[k[0]*(1-N[0])+R[0]*N[0],k[1]*(1-N[1])+R[1]*N[1]],A=[],M=[];for(const k of this.triangleSubSegments){A[0]=k.min.x/Ct,A[1]=k.min.y/Ct,M[0]=k.max.x/Ct,M[1]=k.max.y/Ct;const R=P(v,S,A),N=P(v,S,M);if(new cn([R[0],R[1],h],[N[0],N[1],g]).intersectsPrecise(u)===0){I&&(m.segments.push(I),I=void 0);continue}const G=k.segment;I&&I.vertexOffset!==G.vertexOffset&&(m.segments.push(I),I=void 0),I?(I.vertexLength+=G.vertexLength,I.primitiveLength+=G.primitiveLength):I={vertexOffset:G.vertexOffset,primitiveLength:G.primitiveLength,vertexLength:G.vertexLength,primitiveOffset:G.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&m.segments.push(I),m}encodeCentroid(r,s){const u=r.centroid(),m=s.span(),h=Math.min(7,Math.round(m.x*this.tileToMeter/10)),g=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new _t(yr(u.x,1,Ct-1)<<3|h,yr(u.y,1,Ct-1)<<3|g)}encodeBorderCentroid(r){if(!r.borders)return new _t(0,0);const s=r.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const m=s[0][0]!==u?0:1;return new _t(6|(s[0][0]!==u?0:65528),(s[m][0]+s[m][1])/2<<3|6)}{const m=s[2][0]!==u?2:3;return new _t((s[m][0]+s[m][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(r){const s=this.centroidData[r.centroidDataIndex];s.flags&=Mc,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const s=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,m=r.flags&Mc?uI:r.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==m.y||h!==m.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const m=s.getReplacementRegionsForTile(r.toUnwrapped());if(sw(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const h=[];for(const g of this.activeReplacements){if(g.order<u)continue;const b=Math.pow(2,g.footprintTileId.canonical.z-r.canonical.z);for(const E of this.centroidData)if(!(E.flags&Mc||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let I=0;I<E.footprintSegLen;I++){const v=this.footprintSegments[E.footprintSegIdx+I];if(h.length=0,m2(this.footprintVertices,v.vertexOffset,v.vertexCount,g.footprintTileId.canonical,r.canonical,h),oI(g.footprint,h,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-b)){E.flags|=Mc;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,s,u){let m=!1;for(let h=0;h<u.footprintSegLen;h++){const g=this.footprintSegments[u.footprintSegIdx+h];let b=0;for(const E of g.ringIndices){for(let I=b,v=E+b-1;I<E+b;v=I++){const S=this.footprintVertices.int16[2*(I+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(I+g.vertexOffset)+1],A=this.footprintVertices.int16[2*(v+g.vertexOffset)+1];P>s!=A>s&&r<(this.footprintVertices.int16[2*(v+g.vertexOffset)+0]-S)*(s-P)/(A-P)+S&&(m=!m)}b=E}}return m}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,m=!0;const h=4*(r+Ct)*Ct+(s+Ct);if(this.partLookup.hasOwnProperty(h)){const g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&Mc)}:void 0}for(const g of this.centroidData)r>g.max.x||g.min.x>r||s>g.max.y||g.min.y>s||this.footprintContainsPoint(r,s,g)&&g&&g.height>u&&(u=g.height,this.partLookup[h]=g,m=!!(g.flags&Mc));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:m};this.partLookup[h]=void 0}}function gI(c,r){const s=c.add(r)._unit();return c.x*s.x+c.y*s.y}function p2(c,r,s,u){const m=r.sub(c)._perp()._unit(),h=s.sub(r)._perp()._unit();return yI(c,r,s,gI(m,h),u)}function yI(c,r,s,u,m){const h=Math.sqrt(1-u*u);return Math.min(c.dist(r)/3,r.dist(s)/3,m*h/u)}function uw(c,r,s){return c.x<s[0].x&&r.x<s[0].x||c.x>s[1].x&&r.x>s[1].x||c.y<s[0].y&&r.y<s[0].y||c.y>s[1].y&&r.y>s[1].y}function _I(c,r){return c.x<r[0].x||c.x>r[1].x||c.y<r[0].y||c.y>r[1].y}function vI(c,r,s){if(c.x<0||c.x>=Ct||r.x<0||r.x>=Ct||s.x<0||s.x>=Ct)return!1;const u=s.sub(r),m=u.perp(),h=c.sub(r);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&m.x*h.x+m.y*h.y<0}function xI(c,r,s){const u=r?2|c:-3&c;return s?1|u:-2&u}function bI(){const c=Math.PI/32,r=Math.tan(c),s=U;return s*Math.sqrt(1+2*r*r)-s}function wI(c,r,s){const u=1<<s.z,m=xe(s.x/u),h=xe((s.x+1)/u),g=ve(s.y/u),b=ve((s.y+1)/u);return function(E,I,v,S,P=0,A){const M=[];if(!E.length||!v||!S)return M;const k=(X,ce)=>{for(const pe of X)M.push({polygon:pe,bounds:ce})},R=Math.ceil(Math.log2(v)),N=Math.ceil(Math.log2(S)),G=R-N,W=[];for(let X=0;X<Math.abs(G);X++)W.push(G>0?0:1);for(let X=0;X<Math.min(R,N);X++)W.push(0),W.push(1);let j=E;if(j=_v(j,I[0].y-P,I[1].y+P,1),j=_v(j,I[0].x-P,I[1].x+P,0),!j.length)return M;const Z=[];for(W.length?Z.push({polygons:j,bounds:I,depth:0}):k(j,I);Z.length;){const X=Z.pop(),ce=X.depth,pe=W[ce],ge=X.bounds[0],fe=X.bounds[1],Te=pe===0?ge.x:ge.y,_e=pe===0?fe.x:fe.y,Ee=A?A(pe,Te,_e):.5*(Te+_e),Re=_v(X.polygons,Te-P,Ee+P,pe),Fe=_v(X.polygons,Ee-P,_e+P,pe);if(Re.length){const Ne=[ge,new _t(pe===0?Ee:fe.x,pe===1?Ee:fe.y)];W.length>ce+1?Z.push({polygons:Re,bounds:Ne,depth:ce+1}):k(Re,Ne)}if(Fe.length){const Ne=[new _t(pe===0?Ee:ge.x,pe===1?Ee:ge.y),fe];W.length>ce+1?Z.push({polygons:Fe,bounds:Ne,depth:ce+1}):k(Fe,Ne)}}return M}(c,r,Math.ceil((h-m)/11.25),Math.ceil((g-b)/11.25),1,(E,I,v)=>{if(E===0)return .5*(I+v);{const S=ve((s.y+I/Ct)/u);return(ye(.5*(ve((s.y+v/Ct)/u)+S))*u-s.y)*Ct}})}function m2(c,r,s,u,m,h){const g=Math.pow(2,u.z-m.z);for(let b=0;b<s;b++){let E=c.int16[2*(b+r)+0],I=c.int16[2*(b+r)+1];E=(E+m.x*Ct)*g-u.x*Ct,I=(I+m.y*Ct)*g-u.y*Ct,h.push(new _t(E,I))}}let TI,SI;function $m(c,r){return c.x*r.x+c.y*r.y}function AI(c,r){if(c.length===1){let s=0;const u=r[s++];let m;for(;!m||u.equals(m);)if(m=r[s++],!m)return 1/0;for(;s<r.length;s++){const h=r[s],g=c[0],b=m.sub(u),E=h.sub(u),I=g.sub(u),v=$m(b,b),S=$m(b,E),P=$m(E,E),A=$m(I,b),M=$m(I,E),k=v*P-S*S,R=(P*A-S*M)/k,N=(v*M-S*A)/k,G=u.z*(1-R-N)+m.z*R+h.z*N;if(isFinite(G))return G}return 1/0}{let s=1/0;for(const u of r)s=Math.min(s,u.z);return s}}function EI(c,r,s,u,m,h,g,b){const E=g*m.getElevationAt(c,r,!0,!0),I=h[0]!==0,v=I?h[1]===0?g*(h[0]/7-450):g*function(S,P,A){const M=Math.floor(P[0]/8),k=Math.floor(P[1]/8),R=10*(P[0]-8*M),N=10*(P[1]-8*k),G=S.getElevationAt(M,k,!0,!0),W=S.getMeterToDEM(A),j=Math.floor(.5*(R*W-1)),Z=Math.floor(.5*(N*W-1)),X=S.tileCoordToPixel(M,k),ce=2*j+1,pe=2*Z+1,ge=function(Fe,Ne,je,Xe,Ue){return[Fe.getElevationAtPixel(Ne,je,!0),Fe.getElevationAtPixel(Ne+Ue,je,!0),Fe.getElevationAtPixel(Ne,je+Ue,!0),Fe.getElevationAtPixel(Ne+Xe,je+Ue,!0)]}(S,X.x-j,X.y-Z,ce,pe),fe=Math.abs(ge[0]-ge[1]),Te=Math.abs(ge[2]-ge[3]),_e=Math.abs(ge[0]-ge[2])+Math.abs(ge[1]-ge[3]),Ee=Math.min(.25,.5*W*(fe+Te)/ce),Re=Math.min(.25,.5*W*_e/pe);return G+Math.max(Ee*R,Re*N)}(m,h,b):E;return{base:E+(s===0)?-1:s,top:I?Math.max(v+u,E+s+2):E+u}}$t(wv,"FillExtrusionBucket",{omit:["layers","features"]}),$t(fI,"PartData"),$t(hI,"FootprintSegment"),$t(dI,"BorderCentroidData"),$t(mI,"GroundEffect");const g2=Fr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),y2=Fr([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:_2}=g2,v2=Fr([{name:"a_packed",components:4,type:"Float32"}]),{members:x2}=v2,b2=Fr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:w2}=b2;class MI{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Ec({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const u=this.getKey(r,s);return this.positions[u]}trim(){const r=this.width,s=this.height=hu(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,u){const m=[];let h=r.length%2==1?-r[r.length-1]*u:0,g=r[0]*u,b=!0;m.push({left:h,right:g,isDash:b,zeroLength:r[0]===0});let E=r[0];for(let I=1;I<r.length;I++){b=!b;const v=r[I];h=E*u,E+=v,g=E*u,m.push({left:h,right:g,isDash:b,zeroLength:v===0})}return m}addRoundDash(r,s,u){const m=s/2;for(let h=-u;h<=u;h++){const g=this.width*(this.nextRow+u+h);let b=0,E=r[b];for(let I=0;I<this.width;I++){I/E.right>1&&(E=r[++b]);const v=Math.abs(I-E.left),S=Math.abs(I-E.right),P=Math.min(v,S);let A;const M=h/u*(m+1);if(E.isDash){const k=m-Math.abs(M);A=Math.sqrt(P*P+k*k)}else A=m-Math.sqrt(P*P+M*M);this.image.data[g+I]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(r,s){for(let E=r.length-1;E>=0;--E){const I=r[E],v=r[E+1];I.zeroLength?r.splice(E,1):v&&v.isDash===I.isDash&&(v.left=I.left,r.splice(E,1))}const u=r[0],m=r[r.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const h=this.width*this.nextRow;let g=0,b=r[g];for(let E=0;E<this.width;E++){E/b.right>1&&(b=r[++g]);const I=Math.abs(E-b.left),v=Math.abs(E-b.right),S=Math.min(I,v);this.image.data[h+E]=Math.max(0,Math.min(255,(b.isDash?S:-S)+s+128))}}addDash(r,s){const u=this.getKey(r,s);if(this.positions[u])return this.positions[u];const m=s==="round",h=m?7:0,g=2*h+1;if(this.nextRow+g>this.height)return zr("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let v=0;v<r.length;v++)r[v]<0&&(zr("Negative value is found in line dasharray, replacing values with 0"),r[v]=0),b+=r[v];if(b!==0){const v=this.width/b,S=this.getDashRanges(r,this.width,v);m?this.addRoundDash(S,v,h):this.addRegularDash(S,s==="square"?.5*v:0)}const E=this.nextRow+h;this.nextRow+=g;const I={tl:[E,h],br:[b,0]};return this.positions[u]=I,I}}$t(MI,"LineAtlas");const T2=Ff.VectorTileFeature.types,S2=Math.cos(Math.PI/180*37.5),A2=Math.cos(Math.PI/180*5);class hw{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ym,this.layoutVertexArray2=new Za,this.patternVertexArray=new Ps,this.indexArray=new _i,this.programConfigurations=new Cs(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new On,this.maxLineLength=0,this.zOffsetVertexArray=new vc,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Ct/64}updateFootprints(r,s){}populate(r,s,u,m){this.hasPattern=Qb("line",this.layers,s);const h=this.layers[0].layout.get("line-sort-key"),g=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!g.isConstant()||!!g.constantOr(0);const b=[];for(const{feature:S,id:P,index:A,sourceLayerIndex:M}of r){const k=this.layers[0]._featureFilter.needGeometry,R=St(S,k);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),R,u))continue;const N=h?h.evaluate(R,{},u):void 0,G={id:P,properties:S.properties,type:S.type,sourceLayerIndex:M,index:A,geometry:k?R.geometry:bt(S,u,m),patterns:{},sortKey:N};b.push(G)}h&&b.sort((S,P)=>S.sortKey-P.sortKey);const{lineAtlas:E,featureIndex:I}=s,v=this.addConstantDashes(E);for(const S of b){const{geometry:P,index:A,sourceLayerIndex:M}=S;if(v&&this.addFeatureDashes(S,E),this.hasPattern){const k=ew("line",this.layers,S,this.zoom,s);this.patternFeatures.push(k)}else this.addFeature(S,P,A,u,E.positions,s.availableImages,s.brightness);I.insert(r[A].feature,P,A,M,this.index)}}addConstantDashes(r){let s=!1;for(const u of this.layers){const m=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(m.kind!=="constant"||h.kind!=="constant")s=!0;else{const g=h.value,b=m.value;if(!b)continue;r.addDash(b,g)}}return s}addFeatureDashes(r,s){const u=this.zoom;for(const m of this.layers){const h=m.paint.get("line-dasharray").value,g=m.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let b,E;if(h.kind==="constant"){if(b=h.value,!b)continue}else b=h.evaluate({zoom:u},r);E=g.kind==="constant"?g.value:g.evaluate({zoom:u},r),s.addDash(b,E),r.patterns[m.id]=s.getKey(b,E)}}update(r,s,u,m,h){const g=Object.keys(r).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(r,s,g?this.stateDependentLayers:this.layers,u,m,h)}addFeatures(r,s,u,m,h,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,m,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,x2)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,w2)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,y2.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,_2),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,u,m,h,g,b){const E=this.layers[0].layout,I=E.get("line-join").evaluate(r,{}),v=E.get("line-cap").evaluate(r,{}),S=E.get("line-miter-limit"),P=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const A of s)this.addLine(A,r,m,I,v,S,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,g,m,b)}addLine(r,s,u,m,h,g,b){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const E={zoom:this.zoom,lineProgress:void 0},I=this.layers[0].layout,v=m==="none";if(this.patternJoinNone=this.hasPattern&&v,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<r.length-1;X++)this.totalDistance+=r[X].dist(r[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=T2[s.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let A=0;for(;A<P-1&&r[A].equals(r[A+1]);)A++;if(P<(S?3:2))return;m==="bevel"&&(g=1.05);const M=this.overscaling<=16?15*Ct/(512*this.overscaling):0,k=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let R,N,G,W,j,Z;this.e1=this.e2=-1,S&&(R=r[P-2],j=r[A].sub(R)._unit()._perp());for(let X=A;X<P;X++){if(G=X===P-1?S?r[A+1]:void 0:r[X+1],G&&r[X].equals(G))continue;if(j&&(W=j),R&&(N=R),R=r[X],this.hasZOffset){const Ne=I.get("line-z-offset").value;if(Ne.kind==="constant")Z=Ne.value;else{if(this.lineClips){const je=this.totalDistance/(this.lineClips.end-this.lineClips.start);E.lineProgress=(je*this.lineClips.start+this.distance+(N?N.dist(R):0))/je}else zr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),E.lineProgress=0;Z=Ne.evaluate(E,s)}Z=Z||0}j=G?G.sub(R)._unit()._perp():W,W=W||j;const ce=N&&G;let pe=ce?m:S||v?"butt":h;const ge=W.x*j.x+W.y*j.y;if(v){const Ne=function(je){if(je.patternJoinNone){const Xe=je.segmentPoints.length/2,Ue=je.lineSoFar-je.segmentStart;for(let it=0;it<Xe;++it){const dt=je.segmentPoints[2*it+1],Qe=Math.round(je.segmentPoints[2*it])+.5+.25*dt;je.patternVertexArray.emplaceBack(Qe,Ue,je.segmentStart),je.patternVertexArray.emplaceBack(Qe,Ue,je.segmentStart)}je.segmentPoints.length=0}je.e1=je.e2=-1};if(ce&&ge<A2){this.updateDistance(N,R),this.addCurrentVertex(R,W,1,1,k,Z),Ne(this),this.addCurrentVertex(R,j,-1,-1,k,Z);continue}if(N){if(!G){this.updateDistance(N,R),this.addCurrentVertex(R,W,1,1,k,Z),Ne(this);continue}pe="miter"}}let fe=W.add(j);fe.x===0&&fe.y===0||fe._unit();const Te=fe.x*j.x+fe.y*j.y,_e=Te!==0?1/Te:1/0,Ee=2*Math.sqrt(2-2*Te),Re=Te<S2&&N&&G,Fe=W.x*j.y-W.y*j.x>0;if(Re&&X>A){const Ne=R.dist(N);if(Ne>2*M){const je=R.sub(R.sub(N)._mult(M/Ne)._round());this.updateDistance(N,je),this.addCurrentVertex(je,W,0,0,k,Z),N=je}}if(ce&&pe==="round"&&(_e<b?pe="miter":_e<=2&&(pe="fakeround")),pe==="miter"&&_e>g&&(pe="bevel"),pe==="bevel"&&(_e>2&&(pe="flipbevel"),_e<g&&(pe="miter")),N&&this.updateDistance(N,R),pe==="miter")fe._mult(_e),this.addCurrentVertex(R,fe,0,0,k,Z);else if(pe==="flipbevel"){if(_e>100)fe=j.mult(-1);else{const Ne=_e*W.add(j).mag()/W.sub(j).mag();fe._perp()._mult(Ne*(Fe?-1:1))}this.addCurrentVertex(R,fe,0,0,k,Z),this.addCurrentVertex(R,fe.mult(-1),0,0,k,Z)}else if(pe==="bevel"||pe==="fakeround"){const Ne=-Math.sqrt(_e*_e-1),je=Fe?Ne:0,Xe=Fe?0:Ne;if(N&&this.addCurrentVertex(R,W,je,Xe,k,Z),pe==="fakeround"){const Ue=Math.round(180*Ee/Math.PI/20);for(let it=1;it<Ue;it++){let dt=it/Ue;if(dt!==.5){const Rt=dt-.5;dt+=dt*Rt*(dt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Rt*Rt+(.848013+ge*(.215638*ge-1.06021)))}const Qe=j.sub(W)._mult(dt)._add(W)._unit()._mult(Fe?-1:1);this.addHalfVertex(R,Qe.x,Qe.y,!1,Fe,0,k,Z)}}G&&this.addCurrentVertex(R,j,-je,-Xe,k,Z)}else pe==="butt"?this.addCurrentVertex(R,fe,0,0,k,Z):pe==="square"?(N||this.addCurrentVertex(R,fe,-1,-1,k,Z),this.addCurrentVertex(R,fe,0,0,k,Z),N&&this.addCurrentVertex(R,fe,1,1,k,Z)):pe==="round"&&(N&&(this.addCurrentVertex(R,W,0,0,k,Z),this.addCurrentVertex(R,W,1,1,k,Z,!0)),G&&(this.addCurrentVertex(R,j,-1,-1,k,Z,!0),this.addCurrentVertex(R,j,0,0,k,Z)));if(Re&&X<P-1){const Ne=R.dist(G);if(Ne>2*M){const je=R.add(G.sub(R)._mult(M/Ne)._round());this.updateDistance(R,je),this.addCurrentVertex(je,j,0,0,k,Z),R=je}}}}addVerticesTo(r,s,u,m,h,g,b,E,I,v){const S=(s.w-r.w)/this.tessellationStep|0;if(S>1){this.lineSoFar=r.w;const P=(s.x-r.x)/S,A=(s.y-r.y)/S,M=(s.z-r.z)/S,k=(s.w-r.w)/S;for(let R=1;R<S;++R)r.x+=P,r.y+=A,r.z+=M,this.lineSoFar+=k,this.addHalfVertex(r,u,m,v,!1,b,I,r.z),this.addHalfVertex(r,h,g,v,!0,-E,I,r.z)}this.lineSoFar=s.w,this.addHalfVertex(s,u,m,v,!1,b,I,s.z),this.addHalfVertex(s,h,g,v,!0,-E,I,s.z)}addCurrentVertex(r,s,u,m,h,g,b=!1){const E=s.x+s.y*u,I=s.y-s.x*u,v=s.y*m-s.x,S=-s.y-s.x*m;if(g!=null){const A=Ct+10,M=g,k=new QP(r.x,r.y,M,this.lineSoFar),R=PI(r,-10,A),N=this.lineSoFar;if(this.currentVertex)if(R){const G=this.currentVertexIsOutside,W=this.currentVertex,j=new QP(r.x,r.y,M,this.lineSoFar);tI(W,j,-10,A),PI(j,-10,A)||(G&&(this.e1=this.e2=-1,this.lineSoFar=W.w,this.addHalfVertex(W,E,I,b,!1,u,h,W.z),this.addHalfVertex(W,v,S,b,!0,-m,h,W.z)),this.addVerticesTo(W,j,E,I,v,S,u,m,h,b))}else{const G=this.currentVertex;this.currentVertexIsOutside&&(tI(G,k,-10,A),this.e1=this.e2=-1,this.lineSoFar=G.w,this.addHalfVertex(G,E,I,b,!1,u,h,G.z),this.addHalfVertex(G,v,S,b,!0,-m,h,G.z)),this.addVerticesTo(G,k,E,I,v,S,u,m,h,b)}else R||(this.addHalfVertex(r,E,I,b,!1,u,h,g),this.addHalfVertex(r,v,S,b,!0,-m,h,g));this.currentVertex=k,this.currentVertexIsOutside=R,this.lineSoFar=N}else this.addHalfVertex(r,E,I,b,!1,u,h,g),this.addHalfVertex(r,v,S,b,!0,-m,h,g)}addHalfVertex({x:r,y:s},u,m,h,g,b,E,I){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(h?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),E.primitiveLength++),g?this.e2=v:this.e1=v,I!=null&&this.zOffsetVertexArray.emplaceBack(I)}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}function PI(c,r,s){return c.x<r||c.x>s||c.y<r||c.y>s}let II,CI;function OI(c,r,s){return r*(Ct/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}function kI(c,r){return 1/OI(c,1,r.tileZoom)}function DI(c,r,s,u){return c.translatePosMatrix(u||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}$t(hw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const LI=c=>{const r=[];RI(c)&&r.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const s=c.paint.get("line-trim-offset");s[0]===0&&s[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",m=!!c.paint.get("line-pattern").constantOr(1);return u&&m&&r.push("LINE_JOIN_NONE"),r};function RI(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let fw;const zI=()=>fw||(fw={layout:II||(II=new xn({"line-cap":new Xt(Ze.layout_line["line-cap"]),"line-join":new Xt(Ze.layout_line["line-join"]),"line-miter-limit":new Et(Ze.layout_line["line-miter-limit"]),"line-round-limit":new Et(Ze.layout_line["line-round-limit"]),"line-sort-key":new Xt(Ze.layout_line["line-sort-key"]),"line-z-offset":new Xt(Ze.layout_line["line-z-offset"]),visibility:new Et(Ze.layout_line.visibility)})),paint:CI||(CI=new xn({"line-opacity":new Xt(Ze.paint_line["line-opacity"]),"line-color":new Xt(Ze.paint_line["line-color"]),"line-translate":new Et(Ze.paint_line["line-translate"]),"line-translate-anchor":new Et(Ze.paint_line["line-translate-anchor"]),"line-width":new Xt(Ze.paint_line["line-width"]),"line-gap-width":new Xt(Ze.paint_line["line-gap-width"]),"line-offset":new Xt(Ze.paint_line["line-offset"]),"line-blur":new Xt(Ze.paint_line["line-blur"]),"line-dasharray":new Xt(Ze.paint_line["line-dasharray"]),"line-pattern":new Xt(Ze.paint_line["line-pattern"]),"line-gradient":new Jo(Ze.paint_line["line-gradient"]),"line-trim-offset":new Et(Ze.paint_line["line-trim-offset"]),"line-trim-fade-range":new Et(Ze.paint_line["line-trim-fade-range"]),"line-trim-color":new Et(Ze.paint_line["line-trim-color"]),"line-emissive-strength":new Et(Ze.paint_line["line-emissive-strength"]),"line-border-width":new Xt(Ze.paint_line["line-border-width"]),"line-border-color":new Xt(Ze.paint_line["line-border-color"]),"line-occlusion-opacity":new Et(Ze.paint_line["line-occlusion-opacity"])}))},fw);class E2 extends Xt{possiblyEvaluate(r,s){return s=new Cn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(r,s)}evaluate(r,s,u,m){return s=Oi({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,u,m)}}let Um;function BI(c,r){return r>0?r+2*c:c}const M2=Fr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),P2=Fr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),I2=Fr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const C2=Fr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),O2=Fr([{name:"a_texb",components:2,type:"Uint16"}]),k2=Fr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),D2=Fr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Fr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const FI=Fr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),L2=Fr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fr([{name:"triangle",components:3,type:"Uint16"}]),Fr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Fr([{type:"Float32",name:"offsetX"}]),Fr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ti=24;const Qa=128;function dw(c,r){const{expression:s}=r;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Cn(c+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=s;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let g=h;for(;g<u.length&&u[g]<c+1;)g++;g=Math.min(u.length-1,g);const b=u[h],E=u[g];return s.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:E,minSize:s.evaluate(new Cn(b)),maxSize:s.evaluate(new Cn(E)),interpolationType:m}}}function Tv(c,{uSize:r,uSizeT:s},{lowerSize:u,upperSize:m}){return c.kind==="source"?u/Qa:c.kind==="composite"?nr(u/Qa,m/Qa,s):r}function Nf(c,r){let s=0,u=0;if(c.kind==="constant")u=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:m,minZoom:h,maxZoom:g}=c,b=m?yr(vo.interpolationFactor(m,r,h,g),0,1):0;c.kind==="camera"?u=nr(c.minSize,c.maxSize,b):s=b}return{uSizeT:s,uSize:u}}var R2=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qa,evaluateSizeForFeature:Tv,evaluateSizeForZoom:Nf,getSizeData:dw});function z2(c,r,s){return c.sections.forEach(u=>{u.text=function(m,h,g){const b=h.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?m=m.toLocaleUpperCase():b==="lowercase"&&(m=m.toLocaleLowerCase()),io.applyArabicShaping&&(m=io.applyArabicShaping(m)),m}(u.text,r,s)}),c}const Vm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function B2(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function F2(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var NI,pw,jI,mw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function N2(){return NI||(NI=1,mw.read=function(c,r,s,u,m){var h,g,b=8*m-u-1,E=(1<<b)-1,I=E>>1,v=-7,S=s?m-1:0,P=s?-1:1,A=c[r+S];for(S+=P,h=A&(1<<-v)-1,A>>=-v,v+=b;v>0;h=256*h+c[r+S],S+=P,v-=8);for(g=h&(1<<-v)-1,h>>=-v,v+=u;v>0;g=256*g+c[r+S],S+=P,v-=8);if(h===0)h=1-I;else{if(h===E)return g?NaN:1/0*(A?-1:1);g+=Math.pow(2,u),h-=I}return(A?-1:1)*g*Math.pow(2,h-u)},mw.write=function(c,r,s,u,m,h){var g,b,E,I=8*h-m-1,v=(1<<I)-1,S=v>>1,P=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=u?0:h-1,M=u?1:-1,k=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(b=isNaN(r)?1:0,g=v):(g=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-g))<1&&(g--,E*=2),(r+=g+S>=1?P/E:P*Math.pow(2,1-S))*E>=2&&(g++,E/=2),g+S>=v?(b=0,g=v):g+S>=1?(b=(r*E-1)*Math.pow(2,m),g+=S):(b=r*Math.pow(2,S-1)*Math.pow(2,m),g=0));m>=8;c[s+A]=255&b,A+=M,b/=256,m-=8);for(g=g<<m|b,I+=m;I>0;c[s+A]=255&g,A+=M,g/=256,I-=8);c[s+A-M]|=128*k}),mw}function $I(){if(jI)return pw;jI=1,pw=r;var c=N2();function r(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var s=4294967296,u=1/s,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(j){return j.type===r.Bytes?j.readVarint()+j.pos:j.pos+1}function g(j,Z,X){return X?4294967296*Z+(j>>>0):4294967296*(Z>>>0)+(j>>>0)}function b(j,Z,X){var ce=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));X.realloc(ce);for(var pe=X.pos-1;pe>=j;pe--)X.buf[pe+ce]=X.buf[pe]}function E(j,Z){for(var X=0;X<j.length;X++)Z.writeVarint(j[X])}function I(j,Z){for(var X=0;X<j.length;X++)Z.writeSVarint(j[X])}function v(j,Z){for(var X=0;X<j.length;X++)Z.writeFloat(j[X])}function S(j,Z){for(var X=0;X<j.length;X++)Z.writeDouble(j[X])}function P(j,Z){for(var X=0;X<j.length;X++)Z.writeBoolean(j[X])}function A(j,Z){for(var X=0;X<j.length;X++)Z.writeFixed32(j[X])}function M(j,Z){for(var X=0;X<j.length;X++)Z.writeSFixed32(j[X])}function k(j,Z){for(var X=0;X<j.length;X++)Z.writeFixed64(j[X])}function R(j,Z){for(var X=0;X<j.length;X++)Z.writeSFixed64(j[X])}function N(j,Z){return(j[Z]|j[Z+1]<<8|j[Z+2]<<16)+16777216*j[Z+3]}function G(j,Z,X){j[X]=Z,j[X+1]=Z>>>8,j[X+2]=Z>>>16,j[X+3]=Z>>>24}function W(j,Z){return(j[Z]|j[Z+1]<<8|j[Z+2]<<16)+(j[Z+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(j,Z,X){for(X=X||this.length;this.pos<X;){var ce=this.readVarint(),pe=ce>>3,ge=this.pos;this.type=7&ce,j(pe,Z,this),this.pos===ge&&this.skip(ce)}return Z},readMessage:function(j,Z){return this.readFields(j,Z,this.readVarint()+this.pos)},readFixed32:function(){var j=N(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=W(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=N(this.buf,this.pos)+N(this.buf,this.pos+4)*s;return this.pos+=8,j},readSFixed64:function(){var j=N(this.buf,this.pos)+W(this.buf,this.pos+4)*s;return this.pos+=8,j},readFloat:function(){var j=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var Z,X,ce=this.buf;return Z=127&(X=ce[this.pos++]),X<128?Z:(Z|=(127&(X=ce[this.pos++]))<<7,X<128?Z:(Z|=(127&(X=ce[this.pos++]))<<14,X<128?Z:(Z|=(127&(X=ce[this.pos++]))<<21,X<128?Z:function(pe,ge,fe){var Te,_e,Ee=fe.buf;if(Te=(112&(_e=Ee[fe.pos++]))>>4,_e<128||(Te|=(127&(_e=Ee[fe.pos++]))<<3,_e<128)||(Te|=(127&(_e=Ee[fe.pos++]))<<10,_e<128)||(Te|=(127&(_e=Ee[fe.pos++]))<<17,_e<128)||(Te|=(127&(_e=Ee[fe.pos++]))<<24,_e<128)||(Te|=(1&(_e=Ee[fe.pos++]))<<31,_e<128))return g(pe,Te,ge);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(X=ce[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,Z=this.pos;return this.pos=j,j-Z>=12&&m?function(X,ce,pe){return m.decode(X.subarray(ce,pe))}(this.buf,Z,j):function(X,ce,pe){for(var ge="",fe=ce;fe<pe;){var Te,_e,Ee,Re=X[fe],Fe=null,Ne=Re>239?4:Re>223?3:Re>191?2:1;if(fe+Ne>pe)break;Ne===1?Re<128&&(Fe=Re):Ne===2?(192&(Te=X[fe+1]))==128&&(Fe=(31&Re)<<6|63&Te)<=127&&(Fe=null):Ne===3?(_e=X[fe+2],(192&(Te=X[fe+1]))==128&&(192&_e)==128&&((Fe=(15&Re)<<12|(63&Te)<<6|63&_e)<=2047||Fe>=55296&&Fe<=57343)&&(Fe=null)):Ne===4&&(_e=X[fe+2],Ee=X[fe+3],(192&(Te=X[fe+1]))==128&&(192&_e)==128&&(192&Ee)==128&&((Fe=(15&Re)<<18|(63&Te)<<12|(63&_e)<<6|63&Ee)<=65535||Fe>=1114112)&&(Fe=null)),Fe===null?(Fe=65533,Ne=1):Fe>65535&&(Fe-=65536,ge+=String.fromCharCode(Fe>>>10&1023|55296),Fe=56320|1023&Fe),ge+=String.fromCharCode(Fe),fe+=Ne}return ge}(this.buf,Z,j)},readBytes:function(){var j=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,j);return this.pos=j,Z},readPackedVarint:function(j,Z){if(this.type!==r.Bytes)return j.push(this.readVarint(Z));var X=h(this);for(j=j||[];this.pos<X;)j.push(this.readVarint(Z));return j},readPackedSVarint:function(j){if(this.type!==r.Bytes)return j.push(this.readSVarint());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==r.Bytes)return j.push(this.readBoolean());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==r.Bytes)return j.push(this.readFloat());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==r.Bytes)return j.push(this.readDouble());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==r.Bytes)return j.push(this.readFixed32());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==r.Bytes)return j.push(this.readSFixed32());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==r.Bytes)return j.push(this.readFixed64());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==r.Bytes)return j.push(this.readSFixed64());var Z=h(this);for(j=j||[];this.pos<Z;)j.push(this.readSFixed64());return j},skip:function(j){var Z=7&j;if(Z===r.Varint)for(;this.buf[this.pos++]>127;);else if(Z===r.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===r.Fixed32)this.pos+=4;else{if(Z!==r.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(j,Z){this.writeVarint(j<<3|Z)},realloc:function(j){for(var Z=this.length||16;Z<this.pos+j;)Z*=2;if(Z!==this.length){var X=new Uint8Array(Z);X.set(this.buf),this.buf=X,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),G(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),G(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),G(this.buf,-1&j,this.pos),G(this.buf,Math.floor(j*u),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),G(this.buf,-1&j,this.pos),G(this.buf,Math.floor(j*u),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function(Z,X){var ce,pe;if(Z>=0?(ce=Z%4294967296|0,pe=Z/4294967296|0):(pe=~(-Z/4294967296),4294967295^(ce=~(-Z%4294967296))?ce=ce+1|0:(ce=0,pe=pe+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");X.realloc(10),function(ge,fe,Te){Te.buf[Te.pos++]=127&ge|128,ge>>>=7,Te.buf[Te.pos++]=127&ge|128,ge>>>=7,Te.buf[Te.pos++]=127&ge|128,ge>>>=7,Te.buf[Te.pos++]=127&ge|128,Te.buf[Te.pos]=127&(ge>>>=7)}(ce,0,X),function(ge,fe){var Te=(7&ge)<<4;fe.buf[fe.pos++]|=Te|((ge>>>=3)?128:0),ge&&(fe.buf[fe.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(fe.buf[fe.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(fe.buf[fe.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(fe.buf[fe.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(fe.buf[fe.pos++]=127&ge)))))}(pe,X)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var Z=this.pos;this.pos=function(ce,pe,ge){for(var fe,Te,_e=0;_e<pe.length;_e++){if((fe=pe.charCodeAt(_e))>55295&&fe<57344){if(!Te){fe>56319||_e+1===pe.length?(ce[ge++]=239,ce[ge++]=191,ce[ge++]=189):Te=fe;continue}if(fe<56320){ce[ge++]=239,ce[ge++]=191,ce[ge++]=189,Te=fe;continue}fe=Te-55296<<10|fe-56320|65536,Te=null}else Te&&(ce[ge++]=239,ce[ge++]=191,ce[ge++]=189,Te=null);fe<128?ce[ge++]=fe:(fe<2048?ce[ge++]=fe>>6|192:(fe<65536?ce[ge++]=fe>>12|224:(ce[ge++]=fe>>18|240,ce[ge++]=fe>>12&63|128),ce[ge++]=fe>>6&63|128),ce[ge++]=63&fe|128)}return ge}(this.buf,j,this.pos);var X=this.pos-Z;X>=128&&b(Z,X,this),this.pos=Z-1,this.writeVarint(X),this.pos+=X},writeFloat:function(j){this.realloc(4),c.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),c.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var Z=j.length;this.writeVarint(Z),this.realloc(Z);for(var X=0;X<Z;X++)this.buf[this.pos++]=j[X]},writeRawMessage:function(j,Z){this.pos++;var X=this.pos;j(Z,this);var ce=this.pos-X;ce>=128&&b(X,ce,this),this.pos=X-1,this.writeVarint(ce),this.pos+=ce},writeMessage:function(j,Z,X){this.writeTag(j,r.Bytes),this.writeRawMessage(Z,X)},writePackedVarint:function(j,Z){Z.length&&this.writeMessage(j,E,Z)},writePackedSVarint:function(j,Z){Z.length&&this.writeMessage(j,I,Z)},writePackedBoolean:function(j,Z){Z.length&&this.writeMessage(j,P,Z)},writePackedFloat:function(j,Z){Z.length&&this.writeMessage(j,v,Z)},writePackedDouble:function(j,Z){Z.length&&this.writeMessage(j,S,Z)},writePackedFixed32:function(j,Z){Z.length&&this.writeMessage(j,A,Z)},writePackedSFixed32:function(j,Z){Z.length&&this.writeMessage(j,M,Z)},writePackedFixed64:function(j,Z){Z.length&&this.writeMessage(j,k,Z)},writePackedSFixed64:function(j,Z){Z.length&&this.writeMessage(j,R,Z)},writeBytesField:function(j,Z){this.writeTag(j,r.Bytes),this.writeBytes(Z)},writeFixed32Field:function(j,Z){this.writeTag(j,r.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(j,Z){this.writeTag(j,r.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(j,Z){this.writeTag(j,r.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(j,Z){this.writeTag(j,r.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(j,Z){this.writeTag(j,r.Varint),this.writeVarint(Z)},writeSVarintField:function(j,Z){this.writeTag(j,r.Varint),this.writeSVarint(Z)},writeStringField:function(j,Z){this.writeTag(j,r.Bytes),this.writeString(Z)},writeFloatField:function(j,Z){this.writeTag(j,r.Fixed32),this.writeFloat(Z)},writeDoubleField:function(j,Z){this.writeTag(j,r.Fixed64),this.writeDouble(Z)},writeBooleanField:function(j,Z){this.writeVarintField(j,!!Z)}},pw}var Sv=L($I());const gw=3;function j2(c,r,s){r.glyphs=[],c===1&&s.readMessage($2,r)}function $2(c,r,s){if(c===3){const{id:u,bitmap:m,width:h,height:g,left:b,top:E,advance:I}=s.readMessage(U2,{});r.glyphs.push({id:u,bitmap:new Ec({width:h+2*gw,height:g+2*gw},m),metrics:{width:h,height:g,left:b,top:E,advance:I}})}else c===4?r.ascender=s.readSVarint():c===5&&(r.descender=s.readSVarint())}function U2(c,r,s){c===1?r.id=s.readVarint():c===2?r.bitmap=s.readBytes():c===3?r.width=s.readVarint():c===4?r.height=s.readVarint():c===5?r.left=s.readSVarint():c===6?r.top=s.readSVarint():c===7&&(r.advance=s.readVarint())}const UI=gw,ta={horizontal:1,vertical:2,horizontalOnly:3};class Gm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,s){const u=new Gm;return u.scale=r||1,u.fontStack=s,u}static forImage(r){const s=new Gm;return s.imageName=r,s}}class jf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const u=new jf;for(let m=0;m<r.sections.length;m++){const h=r.sections[m];h.image?u.addImageSection(h):u.addTextSection(h,s)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(s,u){let m="";for(let h=0;h<s.length;h++){const g=s.charCodeAt(h+1)||null,b=s.charCodeAt(h-1)||null;m+=!u&&(g&&Lu(g)&&!Vm[s[h+1]]||b&&Lu(b)&&!Vm[s[h-1]])||!Vm[s[h]]?s[h]:Vm[s[h]]}return m}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Av[this.text.charCodeAt(u)];u++)r++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Av[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const u=new jf;return u.text=this.text.substring(r,s),u.sectionIndex=this.sectionIndex.slice(r,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Gm.forText(r.scale,r.fontStack||s));const u=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(u)}addImageSection(r){const s=r.image?r.image.namePrimary:"";if(s.length===0)return void zr("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Gm.forImage(s)),this.sectionIndex.push(this.sections.length-1)):zr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yw(c,r,s,u,m,h,g,b,E,I,v,S,P,A,M){const k=jf.fromFeature(c,m);S===ta.vertical&&k.verticalizePunctuation(P);let R=[];const N=function(X,ce,pe,ge,fe,Te){if(!X)return[];const _e=[],Ee=function(je,Xe,Ue,it,dt,Qe){let Rt=0;for(let Pt=0;Pt<je.length();Pt++){const wt=je.getSection(Pt);Rt+=VI(je.getCodePoint(Pt),wt,it,dt,Xe,Qe)}return Rt/Math.max(1,Math.ceil(Rt/Ue))}(X,ce,pe,ge,fe,Te),Re=X.text.indexOf("​")>=0;let Fe=0;for(let je=0;je<X.length();je++){const Xe=X.getSection(je),Ue=X.getCodePoint(je);if(Av[Ue]||(Fe+=VI(Ue,Xe,ge,fe,ce,Te)),je<X.length()-1){const it=!((Ne=Ue)<11904||!(Ht["Bopomofo Extended"](Ne)||Ht.Bopomofo(Ne)||Ht["CJK Compatibility Forms"](Ne)||Ht["CJK Compatibility Ideographs"](Ne)||Ht["CJK Compatibility"](Ne)||Ht["CJK Radicals Supplement"](Ne)||Ht["CJK Strokes"](Ne)||Ht["CJK Symbols and Punctuation"](Ne)||Ht["CJK Unified Ideographs Extension A"](Ne)||Ht["CJK Unified Ideographs"](Ne)||Ht["Enclosed CJK Letters and Months"](Ne)||Ht["Halfwidth and Fullwidth Forms"](Ne)||Ht.Hiragana(Ne)||Ht["Ideographic Description Characters"](Ne)||Ht["Kangxi Radicals"](Ne)||Ht["Katakana Phonetic Extensions"](Ne)||Ht.Katakana(Ne)||Ht["Vertical Forms"](Ne)||Ht["Yi Radicals"](Ne)||Ht["Yi Syllables"](Ne)));(V2[Ue]||it||Xe.imageName)&&_e.push(qI(je+1,Fe,Ee,_e,G2(Ue,X.getCodePoint(je+1),it&&Re),!1))}}var Ne;return WI(qI(X.length(),Fe,Ee,_e,0,!0))}(k,I,h,r,u,A),{processBidirectionalText:G,processStyledBidirectionalText:W}=io;if(G&&k.sections.length===1){const X=G(k.toString(),N);for(const ce of X){const pe=new jf;pe.text=ce,pe.sections=k.sections;for(let ge=0;ge<ce.length;ge++)pe.sectionIndex.push(0);R.push(pe)}}else if(W){const X=W(k.text,k.sectionIndex,N);for(const ce of X){const pe=new jf;pe.text=ce[0],pe.sectionIndex=ce[1],pe.sections=k.sections,R.push(pe)}}else R=function(X,ce){const pe=[],ge=X.text;let fe=0;for(const Te of ce)pe.push(X.substring(fe,Te)),fe=Te;return fe<ge.length&&pe.push(X.substring(fe,ge.length)),pe}(k,N);const j=[],Z={positionedLines:j,text:k.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(X,ce,pe,ge,fe,Te,_e,Ee,Re,Fe,Ne,je){let Xe=0,Ue=0,it=0;const dt=Ee==="right"?1:Ee==="left"?0:.5;let Qe=!1;for(const Dt of fe){const jt=Dt.getSections();for(const ar of jt){if(ar.imageName)continue;const wr=ce[ar.fontStack];if(wr&&(Qe=wr.ascender!==void 0&&wr.descender!==void 0,!Qe))break}if(!Qe)break}let Rt=0;for(const Dt of fe){Dt.trim();const jt=Dt.getMaxScale(),ar=(jt-1)*Ti,wr={positionedGlyphs:[],lineOffset:0};X.positionedLines[Rt]=wr;const mr=wr.positionedGlyphs;let gr=0;if(!Dt.length()){Ue+=Te,++Rt;continue}let Ar=0,Er=0;for(let qr=0;qr<Dt.length();qr++){const lr=Dt.getSection(qr),jr=Dt.getSectionIndex(qr),$r=Dt.getCodePoint(qr);let dn=lr.scale,Rn=null,Wn=null,zn=null,Mn=Ti,mi=0;const Jn=!(Re===ta.horizontal||!Ne&&!vf($r)||Ne&&(Av[$r]||(Pt=$r,Ht.Arabic(Pt)||Ht["Arabic Supplement"](Pt)||Ht["Arabic Extended-A"](Pt)||Ht["Arabic Presentation Forms-A"](Pt)||Ht["Arabic Presentation Forms-B"](Pt))));if(lr.imageName){const Si=ge[lr.imageName];if(!Si)continue;zn=lr.imageName,X.iconsInText=X.iconsInText||!0,Wn=Si.paddedRect;const un=Si.displaySize;dn=dn*Ti/je,Rn={width:un[0],height:un[1],left:0,top:-UI,advance:Jn?un[1]:un[0],localGlyph:!1},mi=Qe?-Rn.height*dn:jt*Ti-17-un[1]*dn,Mn=Rn.advance;const wo=(Jn?un[0]:un[1])*dn-Ti*jt;wo>0&&wo>gr&&(gr=wo)}else{const Si=pe[lr.fontStack];if(!Si)continue;Si[$r]&&(Wn=Si[$r]);const un=ce[lr.fontStack];if(!un)continue;const wo=un.glyphs[$r];if(!wo)continue;if(Rn=wo.metrics,Mn=$r!==8203?Ti:0,Qe){const is=un.ascender!==void 0?Math.abs(un.ascender):0,Sa=un.descender!==void 0?Math.abs(un.descender):0,Aa=(is+Sa)*dn;Ar<Aa&&(Ar=Aa,Er=(is-Sa)/2*dn),mi=-is*dn}else mi=(jt-dn)*Ti-17}Jn?(X.verticalizable=!0,mr.push({glyph:$r,imageName:zn,x:Xe,y:Ue+mi,vertical:Jn,scale:dn,localGlyph:Rn.localGlyph,fontStack:lr.fontStack,sectionIndex:jr,metrics:Rn,rect:Wn}),Xe+=Mn*dn+Fe):(mr.push({glyph:$r,imageName:zn,x:Xe,y:Ue+mi,vertical:Jn,scale:dn,localGlyph:Rn.localGlyph,fontStack:lr.fontStack,sectionIndex:jr,metrics:Rn,rect:Wn}),Xe+=Rn.advance*dn+Fe)}mr.length!==0&&(it=Math.max(Xe-Fe,it),Qe?HI(mr,dt,gr,Er,Te*jt/2):HI(mr,dt,gr,0,Te/2)),Xe=0;const nn=Te*jt+gr;wr.lineOffset=Math.max(gr,ar),Ue+=nn,++Rt}var Pt;const wt=Ue,{horizontalAlign:gt,verticalAlign:Jt}=_w(_e);(function(Dt,jt,ar,wr,mr,gr){const Ar=(jt-ar)*mr,Er=-gr*wr;for(const nn of Dt)for(const qr of nn.positionedGlyphs)qr.x+=Ar,qr.y+=Er})(X.positionedLines,dt,gt,Jt,it,wt),X.top+=-Jt*wt,X.bottom=X.top+wt,X.left+=-gt*it,X.right=X.left+it,X.hasBaseline=Qe}(Z,r,s,u,R,g,b,E,S,I,P,M),!function(X){for(const ce of X)if(ce.positionedGlyphs.length!==0)return!1;return!0}(j)&&Z}const Av={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},V2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function VI(c,r,s,u,m,h){if(r.imageName){const g=u[r.imageName];return g?g.displaySize[0]*r.scale*Ti/h+m:0}{const g=s[r.fontStack],b=g&&g.glyphs[c];return b?b.metrics.advance*r.scale+m:0}}function GI(c,r,s,u){const m=Math.pow(c-r,2);return u?c<r?m/2:2*m:m+Math.abs(s)*s}function G2(c,r,s){let u=0;return c===10&&(u-=1e4),s&&(u+=150),c!==40&&c!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function qI(c,r,s,u,m,h){let g=null,b=GI(r,s,m,h);for(const E of u){const I=GI(r-E.x,s,m,h)+E.badness;I<=b&&(g=E,b=I)}return{index:c,x:r,priorBreak:g,badness:b}}function WI(c){return c?WI(c.priorBreak).concat(c.index):[]}function _w(c){let r=.5,s=.5;switch(c){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function HI(c,r,s,u,m){if(!(r||s||u||m))return;const h=c.length-1,g=c[h],b=(g.x+g.metrics.advance*g.scale)*r;for(let E=0;E<=h;E++)c[E].x-=b,c[E].y+=s+u+m}function q2(c,r,s,u){const{horizontalAlign:m,verticalAlign:h}=_w(u),g=s[0]-c.displaySize[0]*m,b=s[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:r,top:b,bottom:b+c.displaySize[1],left:g,right:g+c.displaySize[0]}}function ZI(c,r,s,u,m,h){const g=c.imagePrimary;let b;if(g.content){const R=g.content,N=g.pixelRatio||1;b=[R[0]/N,R[1]/N,g.displaySize[0]-R[2]/N,g.displaySize[1]-R[3]/N]}const E=r.left*h,I=r.right*h;let v,S,P,A;s==="width"||s==="both"?(A=m[0]+E-u[3],S=m[0]+I+u[1]):(A=m[0]+(E+I-g.displaySize[0])/2,S=A+g.displaySize[0]);const M=r.top*h,k=r.bottom*h;return s==="height"||s==="both"?(v=m[1]+M-u[0],P=m[1]+k+u[2]):(v=m[1]+(M+k-g.displaySize[1])/2,P=v+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:v,right:S,bottom:P,left:A,collisionPadding:b}}class pl extends _t{constructor(r,s,u,m,h){super(r,s),this.angle=m,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new pl(this.x,this.y,this.z,this.angle,this.segment)}}function XI(c,r,s,u,m){if(r.segment===void 0)return!0;let h=r,g=r.segment+1,b=0;for(;b>-s/2;){if(g--,g<0)return!1;b-=c[g].dist(h),h=c[g]}b+=c[g].dist(c[g+1]),g++;const E=[];let I=0;for(;b<s/2;){const v=c[g],S=c[g+1];if(!S)return!1;let P=c[g-1].angleTo(v)-v.angleTo(S);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:P}),I+=P;b-E[0].distance>u;)I-=E.shift().angleDelta;if(I>m)return!1;g++,b+=v.dist(S)}return!0}function YI(c){let r=0;for(let s=0;s<c.length-1;s++)r+=c[s].dist(c[s+1]);return r}function KI(c,r,s){return c?.6*r*s:0}function JI(c,r){return Math.max(c?c.right-c.left:0,r?r.right-r.left:0)}function W2(c,r,s,u,m,h){const g=KI(s,m,h),b=JI(s,u)*h;let E=0;const I=YI(c)/2;for(let v=0;v<c.length-1;v++){const S=c[v],P=c[v+1],A=S.dist(P);if(E+A>I){const M=(I-E)/A,k=nr(S.x,P.x,M),R=nr(S.y,P.y,M),N=new pl(k,R,0,P.angleTo(S),v);return!g||XI(c,N,b,g,r)?N:void 0}E+=A}}function H2(c,r,s,u,m,h,g,b,E){const I=KI(u,h,g),v=JI(u,m),S=v*g,P=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return r-S<r/4&&(r=S+r/4),QI(c,P?r/2*b%r:(v/2+2*h)*g*b%r,r,I,s,S,P,!1,E)}function QI(c,r,s,u,m,h,g,b,E){const I=h/2,v=YI(c);let S=0,P=r-s,A=[];for(let M=0;M<c.length-1;M++){const k=c[M],R=c[M+1],N=k.dist(R),G=R.angleTo(k);for(;P+s<S+N;){P+=s;const W=(P-S)/N,j=nr(k.x,R.x,W),Z=nr(k.y,R.y,W);if(j>=0&&j<E&&Z>=0&&Z<E&&P-I>=0&&P+I<=v){const X=new pl(j,Z,0,G,M);u&&!XI(c,X,h,u,m)||A.push(X)}}S+=N}return b||A.length||g||(A=QI(c,S/2,s,u,m,h,g,!0,E)),A}function eC(c,r,s,u,m){const h=[];for(let g=0;g<c.length;g++){const b=c[g];let E;for(let I=0;I<b.length-1;I++){let v=b[I],S=b[I+1];v.x<r&&S.x<r||(v.x<r?v=new _t(r,v.y+(r-v.x)/(S.x-v.x)*(S.y-v.y))._round():S.x<r&&(S=new _t(r,v.y+(r-v.x)/(S.x-v.x)*(S.y-v.y))._round()),v.y<s&&S.y<s||(v.y<s?v=new _t(v.x+(s-v.y)/(S.y-v.y)*(S.x-v.x),s)._round():S.y<s&&(S=new _t(v.x+(s-v.y)/(S.y-v.y)*(S.x-v.x),s)._round()),v.x>=u&&S.x>=u||(v.x>=u?v=new _t(u,v.y+(u-v.x)/(S.x-v.x)*(S.y-v.y))._round():S.x>=u&&(S=new _t(u,v.y+(u-v.x)/(S.x-v.x)*(S.y-v.y))._round()),v.y>=m&&S.y>=m||(v.y>=m?v=new _t(v.x+(m-v.y)/(S.y-v.y)*(S.x-v.x),m)._round():S.y>=m&&(S=new _t(v.x+(m-v.y)/(S.y-v.y)*(S.x-v.x),m)._round()),E&&v.equals(E[E.length-1])||(E=[v],h.push(E)),E.push(S)))))}}return h}function tC(c){let r=0,s=0;for(const g of c)r+=g.w*g.h,s=Math.max(s,g.w);c.sort((g,b)=>b.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let m=0,h=0;for(const g of c)for(let b=u.length-1;b>=0;b--){const E=u[b];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,h=Math.max(h,g.y+g.h),m=Math.max(m,g.x+g.w),g.w===E.w&&g.h===E.h){const I=u.pop();b<u.length&&(u[b]=I)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(u.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:m,h,fill:r/(m*h)||0}}$t(pl,"Anchor");const qm=1;class vw{constructor(r,{pixelRatio:s,version:u,stretchX:m,stretchY:h,content:g},b){this.paddedRect=r,this.pixelRatio=s,this.stretchX=m,this.stretchY=h,this.content=g,this.version=u,this.padding=b}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class rC{constructor(r,s,u){const m={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,m,qm,g),this.addImages(s,h,2,g);const{w:b,h:E}=tC(g),I=new Wi({width:b||1,height:E||1});for(const v in r){const S=r[v],P=m[v].paddedRect;Wi.copy(S.data,I,{x:0,y:0},{x:P.x+qm,y:P.y+qm},S.data,u,S.sdf)}for(const v in s){const S=s[v],P=h[v].paddedRect;let A=h[v].padding;const M=P.x+A,k=P.y+A,R=S.data.width,N=S.data.height;A=A>1?A-1:A,Wi.copy(S.data,I,{x:0,y:0},{x:M,y:k},S.data,u),Wi.copy(S.data,I,{x:0,y:N-A},{x:M,y:k-A},{width:R,height:A},u),Wi.copy(S.data,I,{x:0,y:0},{x:M,y:k+N},{width:R,height:A},u),Wi.copy(S.data,I,{x:R-A,y:0},{x:M-A,y:k},{width:A,height:N},u),Wi.copy(S.data,I,{x:0,y:0},{x:M+R,y:k},{width:A,height:N},u),Wi.copy(S.data,I,{x:R-A,y:N-A},{x:M-A,y:k-A},{width:A,height:A},u),Wi.copy(S.data,I,{x:0,y:N-A},{x:M+R,y:k-A},{width:A,height:A},u),Wi.copy(S.data,I,{x:0,y:0},{x:M+R,y:k+N},{width:A,height:A},u),Wi.copy(S.data,I,{x:R-A,y:0},{x:M-A,y:k+N},{width:A,height:A},u)}this.image=I,this.iconPositions=m,this.patternPositions=h}addImages(r,s,u,m){for(const h in r){const g=r[h],b={x:0,y:0,w:g.data.width+2*u,h:g.data.height+2*u};m.push(b),s[h]=new vw(b,g,u),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>r.hasImage(m,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const m in r.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[m],r.getImage(m,u),s),this.patchUpdatedImage(this.patternPositions[m],r.getImage(m,u),s)}patchUpdatedImage(r,s,u){if(!r||!s||r.version===s.version)return;r.version=s.version;const[m,h]=r.tl;u.update(s.data,{position:{x:m,y:h}})}}$t(vw,"ImagePosition"),$t(rC,"ImageAtlas");const Wm=1e20;function nC(c,r,s,u,m,h,g,b,E){for(let I=r;I<r+u;I++)iC(c,s*h+I,h,m,g,b,E);for(let I=s;I<s+m;I++)iC(c,I*h+r,1,u,g,b,E)}function iC(c,r,s,u,m,h,g){h[0]=0,g[0]=-Wm,g[1]=Wm,m[0]=c[r];for(let b=1,E=0,I=0;b<u;b++){m[b]=c[r+b*s];const v=b*b;do{const S=h[E];I=(m[b]-m[S]+v-S*S)/(b-S)/2}while(I<=g[E]&&--E>-1);E++,h[E]=b,g[E]=I,g[E+1]=Wm}for(let b=0,E=0;b<u;b++){for(;g[E+1]<b;)E++;const I=h[E],v=b-I;c[r+b*s]=m[I]+v*v}}const es=2,xw={none:0,ideographs:1,all:2};class $f{constructor(r,s,u){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r,s){this.urls[s]=r}getGlyphs(r,s,u){const m=[],h=this.urls[s]||De.GLYPHS_URL;for(const g in r)for(const b of r[g])m.push({stack:g,id:b});Xs(m,({stack:g,id:b},E)=>{let I=this.entries[g];I||(I=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=I.glyphs[b];if(v!==void 0)return void E(null,{stack:g,id:b,glyph:v});if(v=this._tinySDF(I,g,b),v)return I.glyphs[b]=v,void E(null,{stack:g,id:b,glyph:v});const S=Math.floor(b/256);if(256*S>65535)return void E(new Error("glyphs > 65535 not supported"));if(I.ranges[S])return void E(null,{stack:g,id:b,glyph:v});let P=I.requests[S];P||(P=I.requests[S]=[],$f.loadGlyphRange(g,S,h,this.requestManager,(A,M)=>{if(M){I.ascender=M.ascender,I.descender=M.descender;for(const k in M.glyphs)this._doesCharSupportLocalGlyph(+k)||(I.glyphs[+k]=M.glyphs[+k]);I.ranges[S]=!0}for(const k of P)k(A,M);delete I.requests[S]})),P.push((A,M)=>{A?E(A):M&&E(null,{stack:g,id:b,glyph:M.glyphs[b]||null})})},(g,b)=>{if(g)u(g);else if(b){const E={};for(const{stack:I,id:v,glyph:S}of b)E[I]===void 0&&(E[I]={}),E[I].glyphs===void 0&&(E[I].glyphs={}),E[I].glyphs[v]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},E[I].ascender=this.entries[I].ascender,E[I].descender=this.entries[I].descender;u(null,E)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==xw.none&&(this.localGlyphMode===xw.all?!!this.localFontFamily:!!this.localFontFamily&&(Ht["CJK Unified Ideographs"](r)||Ht["Hangul Syllables"](r)||Ht.Hiragana(r)||Ht.Katakana(r)||Ht["CJK Symbols and Punctuation"](r)||Ht["CJK Unified Ideographs Extension A"](r)||Ht["CJK Unified Ideographs Extension B"](r)))}_tinySDF(r,s,u){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(u))return;let h=r.tinySDF;if(!h){let k="400";/bold/i.test(s)?k="900":/medium/i.test(s)?k="500":/light/i.test(s)&&(k="200"),h=r.tinySDF=new $f.TinySDF({fontFamily:m,fontWeight:k,fontSize:24*es,buffer:3*es,radius:8*es}),h.fontWeight=k}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const g=String.fromCodePoint(u),{data:b,width:E,height:I,glyphWidth:v,glyphHeight:S,glyphLeft:P,glyphTop:A,glyphAdvance:M}=h.draw(g);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new Ec({width:E,height:I},b),metrics:{width:v/es,height:S/es,left:P/es,top:A/es-27,advance:M/es,localGlyph:!0}}}}$f.loadGlyphRange=function(c,r,s,u,m){const h=256*r,g=h+255,b=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",c).replace("{range}",`${h}-${g}`),Ul.Glyphs);Vl(b,(E,I)=>{if(E)m(E);else if(I){const v={},S=function(P){return new Sv(P).readFields(j2,{})}(I);for(const P of S.glyphs)v[P.id]=P;m(null,{glyphs:v,ascender:S.ascender,descender:S.descender})}})},$f.TinySDF=class{constructor({fontSize:c=24,buffer:r=3,radius:s=8,cutoff:u=.25,fontFamily:m="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=s;const b=this.size=c+4*r,E=this._createCanvas(b),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${g} ${h} ${c}px ${m}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(c){const r=document.createElement("canvas");return r.width=r.height=c,r}draw(c){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:m,actualBoundingBoxRight:h}=this.ctx.measureText(c),g=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-m))),E=Math.min(this.size-this.buffer,g+Math.ceil(u)),I=b+2*this.buffer,v=E+2*this.buffer,S=Math.max(I*v,0),P=new Uint8ClampedArray(S),A={data:P,width:I,height:v,glyphWidth:b,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:r};if(b===0||E===0)return A;const{ctx:M,buffer:k,gridInner:R,gridOuter:N}=this;M.clearRect(k,k,b,E),M.fillText(c,k,k+g);const G=M.getImageData(k,k,b,E);N.fill(Wm,0,S),R.fill(0,0,S);for(let W=0;W<E;W++)for(let j=0;j<b;j++){const Z=G.data[4*(W*b+j)+3]/255;if(Z===0)continue;const X=(W+k)*I+j+k;if(Z===1)N[X]=0,R[X]=Wm;else{const ce=.5-Z;N[X]=ce>0?ce*ce:0,R[X]=ce<0?ce*ce:0}}nC(N,0,0,I,v,I,this.f,this.v,this.z),nC(R,k,k,b,E,I,this.f,this.v,this.z);for(let W=0;W<S;W++){const j=Math.sqrt(N[W])-Math.sqrt(R[W]);P[W]=Math.round(255-255*(j/this.radius+this.cutoff))}return A}};const Pc=qm;function oC(c,r,s,u){const m=[],h=c.imagePrimary,g=h.pixelRatio,b=h.paddedRect.w-2*Pc,E=h.paddedRect.h-2*Pc,I=c.right-c.left,v=c.bottom-c.top,S=h.stretchX||[[0,b]],P=h.stretchY||[[0,E]],A=(Te,_e)=>Te+_e[1]-_e[0],M=S.reduce(A,0),k=P.reduce(A,0),R=b-M,N=E-k;let G=0,W=M,j=0,Z=k,X=0,ce=R,pe=0,ge=N;if(h.content&&u){const Te=h.content;G=Ev(S,0,Te[0]),j=Ev(P,0,Te[1]),W=Ev(S,Te[0],Te[2]),Z=Ev(P,Te[1],Te[3]),X=Te[0]-G,pe=Te[1]-j,ce=Te[2]-Te[0]-W,ge=Te[3]-Te[1]-Z}const fe=(Te,_e,Ee,Re)=>{const Fe=Mv(Te.stretch-G,W,I,c.left),Ne=Pv(Te.fixed-X,ce,Te.stretch,M),je=Mv(_e.stretch-j,Z,v,c.top),Xe=Pv(_e.fixed-pe,ge,_e.stretch,k),Ue=Mv(Ee.stretch-G,W,I,c.left),it=Pv(Ee.fixed-X,ce,Ee.stretch,M),dt=Mv(Re.stretch-j,Z,v,c.top),Qe=Pv(Re.fixed-pe,ge,Re.stretch,k),Rt=new _t(Fe,je),Pt=new _t(Ue,je),wt=new _t(Ue,dt),gt=new _t(Fe,dt),Jt=new _t(Ne/g,Xe/g),Dt=new _t(it/g,Qe/g),jt=r*Math.PI/180;if(jt){const Er=Math.sin(jt),nn=Math.cos(jt),qr=[nn,-Er,Er,nn];Rt._matMult(qr),Pt._matMult(qr),gt._matMult(qr),wt._matMult(qr)}const ar=Te.stretch+Te.fixed,wr=Ee.stretch+Ee.fixed,mr=_e.stretch+_e.fixed,gr=Re.stretch+Re.fixed,Ar=c.imageSecondary;return{tl:Rt,tr:Pt,bl:gt,br:wt,texPrimary:{x:h.paddedRect.x+Pc+ar,y:h.paddedRect.y+Pc+mr,w:wr-ar,h:gr-mr},texSecondary:Ar?{x:Ar.paddedRect.x+Pc+ar,y:Ar.paddedRect.y+Pc+mr,w:wr-ar,h:gr-mr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jt,pixelOffsetBR:Dt,minFontScaleX:ce/g/I,minFontScaleY:ge/g/v,isSDF:s}};if(u&&(h.stretchX||h.stretchY)){const Te=aC(S,R,M),_e=aC(P,N,k);for(let Ee=0;Ee<Te.length-1;Ee++){const Re=Te[Ee],Fe=Te[Ee+1];for(let Ne=0;Ne<_e.length-1;Ne++)m.push(fe(Re,_e[Ne],Fe,_e[Ne+1]))}}else m.push(fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:E+1}));return m}function Ev(c,r,s){let u=0;for(const m of c)u+=Math.max(r,Math.min(s,m[1]))-Math.max(r,Math.min(s,m[0]));return u}function aC(c,r,s){const u=[{fixed:-Pc,stretch:0}];for(const[m,h]of c){const g=u[u.length-1];u.push({fixed:m-g.stretch,stretch:g.stretch}),u.push({fixed:m-g.stretch,stretch:g.stretch+(h-m)})}return u.push({fixed:r+Pc,stretch:s}),u}function Mv(c,r,s,u){return c/r*s+u}function Pv(c,r,s,u){return c-r*s/u}function Z2(c,r,s,u){const m=r+c.positionedLines[u].lineOffset;return u===0?s+m/2:s+(m+(r+c.positionedLines[u-1].lineOffset))/2}function X2(c,r=1,s=!1){let u=1/0,m=1/0,h=-1/0,g=-1/0;const b=c[0];for(let A=0;A<b.length;A++){const M=b[A];(!A||M.x<u)&&(u=M.x),(!A||M.y<m)&&(m=M.y),(!A||M.x>h)&&(h=M.x),(!A||M.y>g)&&(g=M.y)}const E=Math.min(h-u,g-m);let I=E/2;const v=new Bp([],Y2);if(E===0)return new _t(u,m);for(let A=u;A<h;A+=E)for(let M=m;M<g;M+=E)v.push(new Uf(A+I,M+I,I,c));let S=function(A){let M=0,k=0,R=0;const N=A[0];for(let G=0,W=N.length,j=W-1;G<W;j=G++){const Z=N[G],X=N[j],ce=Z.x*X.y-X.x*Z.y;k+=(Z.x+X.x)*ce,R+=(Z.y+X.y)*ce,M+=3*ce}return new Uf(k/M,R/M,0,A)}(c),P=v.length;for(;v.length;){const A=v.pop();(A.d>S.d||!S.d)&&(S=A,s&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,P)),A.max-S.d<=r||(I=A.h/2,v.push(new Uf(A.p.x-I,A.p.y-I,I,c)),v.push(new Uf(A.p.x+I,A.p.y-I,I,c)),v.push(new Uf(A.p.x-I,A.p.y+I,I,c)),v.push(new Uf(A.p.x+I,A.p.y+I,I,c)),P+=4)}return s&&(console.log(`num probes: ${P}`),console.log(`best distance: ${S.d}`)),S.p}function Y2(c,r){return r.max-c.max}class Uf{constructor(r,s,u,m){this.p=new _t(r,s),this.h=u,this.d=function(h,g){let b=!1,E=1/0;for(let I=0;I<g.length;I++){const v=g[I];for(let S=0,P=v.length,A=P-1;S<P;A=S++){const M=v[S],k=v[A];M.y>h.y!=k.y>h.y&&h.x<(k.x-M.x)*(h.y-M.y)/(k.y-M.y)+M.x&&(b=!b),E=Math.min(E,Xr(h,M,k))}}return(b?1:-1)*Math.sqrt(E)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const bw=Number.POSITIVE_INFINITY,K2=Math.sqrt(2);function sC(c,[r,s]){let u=0,m=0;if(s===bw){r<0&&(r=0);const h=r/K2;switch(c){case"top-right":case"top-left":m=h-7;break;case"bottom-right":case"bottom-left":m=7-h;break;case"bottom":m=7-r;break;case"top":m=r-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),s=Math.abs(s),c){case"top-right":case"top-left":case"top":m=s-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-s}switch(c){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,m]}function ww(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function J2(c,r,s,u,m,h,g,b,E,I,v,S,P,A,M){let k=h.textMaxSize.evaluate(r,{},S);k===void 0&&(k=g);const R=c.layers[0].layout,N=R.get("icon-offset").evaluate(r,{},S),G=cC(s.horizontal)||s.vertical,W=P.name==="globe",j=Ti,Z=g/j,X=c.tilePixelRatio*k/j,ce=(Fe=c.overscaling,c.zoom>18&&Fe>2&&(Fe>>=1),Math.max(Ct/(512*Fe),1)*R.get("symbol-spacing")),pe=R.get("text-padding")*c.tilePixelRatio,ge=R.get("icon-padding")*c.tilePixelRatio,fe=Sr(R.get("text-max-angle")),Te=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",_e=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Ee=R.get("symbol-placement"),Re=ce/2;var Fe;const Ne=R.get("icon-text-fit").evaluate(r,{},S),je=R.get("icon-text-fit-padding").evaluate(r,{},S),Xe=Ne!=="none";let Ue;c.hasAnyIconTextFit===!1&&Xe&&(c.hasAnyIconTextFit=!0),u&&Xe&&(c.allowVerticalPlacement&&s.vertical&&(Ue=ZI(u,s.vertical,Ne,je,N,Z)),G&&(u=ZI(u,G,Ne,je,N,Z)));const it=(dt,Qe,Rt)=>{if(Qe.x<0||Qe.x>=Ct||Qe.y<0||Qe.y>=Ct)return;let Pt=null;if(W){const{x:wt,y:gt,z:Jt}=P.projectTilePoint(Qe.x,Qe.y,Rt);Pt={anchor:new pl(wt,gt,Jt,0,void 0),up:P.upVector(Rt,Qe.x,Qe.y)}}(function(wt,gt,Jt,Dt,jt,ar,wr,mr,gr,Ar,Er,nn,qr,lr,jr,$r,dn,Rn,Wn,zn,Mn,mi,Jn,Si,un,wo,is){const Sa=wt.addToLineVertexArray(gt,Dt);let Aa,Qu,Dc,eh,ug,CO,OO,kO=0,DO=0,LO=0,RO=0,Kw=-1,Jw=-1;const Ls={};let zO=eo("");const th=Jt?Jt.anchor:gt,Qw=gr.layout.get("icon-text-fit").evaluate(Mn,{},un)!=="none";let eT=0,tT=0;if(gr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[eT,tT]=gr.layout.get("text-offset").evaluate(Mn,{},un).map(Ro=>Ro*Ti):(eT=gr.layout.get("text-radial-offset").evaluate(Mn,{},un)*Ti,tT=bw),wt.allowVerticalPlacement&&jt.vertical){const Ro=jt.vertical;if(jr)CO=Tw(Ro),mr&&(OO=Tw(mr));else{const zo=gr.layout.get("text-rotate").evaluate(Mn,{},un)+90;Dc=Iv(Ar,th,gt,Er,nn,qr,Ro,lr,zo,$r),mr&&(eh=Iv(Ar,th,gt,Er,nn,qr,mr,Rn,zo))}}if(ar){const Ro=gr.layout.get("icon-rotate").evaluate(Mn,{},un),zo=oC(ar,Ro,Jn,Qw),Yf=mr?oC(mr,Ro,Jn,Qw):void 0;Qu=Iv(Ar,th,gt,Er,nn,qr,ar,Rn,Ro),kO=4*zo.length;const BO=wt.iconSizeData;let rh=null;BO.kind==="source"?(rh=[Qa*gr.layout.get("icon-size").evaluate(Mn,{},un)],rh[0]>Ic&&zr(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)):BO.kind==="composite"&&(rh=[Qa*mi.compositeIconSizes[0].evaluate(Mn,{},un),Qa*mi.compositeIconSizes[1].evaluate(Mn,{},un)],(rh[0]>Ic||rh[1]>Ic)&&zr(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,zo,rh,zn,Wn,Mn,!1,Jt,gt,Sa.lineStartIndex,Sa.lineLength,-1,Si,un,wo,is),Kw=wt.icon.placedSymbolArray.length-1,Yf&&(DO=4*Yf.length,wt.addSymbols(wt.icon,Yf,rh,zn,Wn,Mn,ta.vertical,Jt,gt,Sa.lineStartIndex,Sa.lineLength,-1,Si,un,wo,is),Jw=wt.icon.placedSymbolArray.length-1)}for(const Ro in jt.horizontal){const zo=jt.horizontal[Ro];Aa||(zO=eo(zo.text),jr?ug=Tw(zo):Aa=Iv(Ar,th,gt,Er,nn,qr,zo,lr,gr.layout.get("text-rotate").evaluate(Mn,{},un),$r));const Yf=zo.positionedLines.length===1;if(LO+=lC(wt,Jt,gt,zo,wr,gr,jr,Mn,$r,Sa,jt.vertical?ta.horizontal:ta.horizontalOnly,Yf?Object.keys(jt.horizontal):[Ro],Ls,Kw,mi,Si,un,wo),Yf)break}jt.vertical&&(RO+=lC(wt,Jt,gt,jt.vertical,wr,gr,jr,Mn,$r,Sa,ta.vertical,["vertical"],Ls,Jw,mi,Si,un,wo));let Lc=-1;const rT=(Ro,zo)=>Ro?Math.max(Ro,zo):zo;Lc=rT(ug,Lc),Lc=rT(CO,Lc),Lc=rT(OO,Lc);const d$=Lc>-1?1:0;wt.glyphOffsetArray.length>=65535&&zr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mn.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,Mn.sortKey),wt.symbolInstances.emplaceBack(gt.x,gt.y,th.x,th.y,th.z,Ls.right>=0?Ls.right:-1,Ls.center>=0?Ls.center:-1,Ls.left>=0?Ls.left:-1,Ls.vertical>=0?Ls.vertical:-1,Kw,Jw,zO,Aa!==void 0?Aa:wt.collisionBoxArray.length,Aa!==void 0?Aa+1:wt.collisionBoxArray.length,Dc!==void 0?Dc:wt.collisionBoxArray.length,Dc!==void 0?Dc+1:wt.collisionBoxArray.length,Qu!==void 0?Qu:wt.collisionBoxArray.length,Qu!==void 0?Qu+1:wt.collisionBoxArray.length,eh||wt.collisionBoxArray.length,eh?eh+1:wt.collisionBoxArray.length,Er,LO,RO,kO,DO,d$,0,eT,tT,Lc,0,Qw?1:0)})(c,Qe,Pt,dt,s,u,m,Ue,c.layers[0],c.collisionBoxArray,r.index,r.sourceLayerIndex,c.index,pe,Te,E,0,ge,_e,N,r,h,I,v,S,A,M)};if(Ee==="line")for(const dt of eC(r.geometry,0,0,Ct,Ct)){const Qe=H2(dt,ce,fe,s.vertical||G,u,j,X,c.overscaling,Ct);for(const Rt of Qe)G&&Q2(c,G.text,Re,Rt)||it(dt,Rt,S)}else if(Ee==="line-center"){for(const dt of r.geometry)if(dt.length>1){const Qe=W2(dt,fe,s.vertical||G,u,j,X);Qe&&it(dt,Qe,S)}}else if(r.type==="Polygon")for(const dt of gv(r.geometry,0)){const Qe=X2(dt,16);it(dt[0],new pl(Qe.x,Qe.y,0,0,void 0),S)}else if(r.type==="LineString")for(const dt of r.geometry)it(dt,new pl(dt[0].x,dt[0].y,0,0,void 0),S);else if(r.type==="Point")for(const dt of r.geometry)for(const Qe of dt)it([Qe],new pl(Qe.x,Qe.y,0,0,void 0),S)}const Hm=255,Ic=Hm*Qa;function lC(c,r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R,N){const G=function(Z,X,ce,pe,ge,fe,Te,_e){const Ee=[];if(X.positionedLines.length===0)return Ee;const Re=pe.layout.get("text-rotate").evaluate(fe,{})*Math.PI/180,Fe=function(it){const dt=it[0],Qe=it[1],Rt=dt*Qe;return Rt>0?[dt,-Qe]:Rt<0?[-dt,Qe]:dt===0?[Qe,dt]:[Qe,-dt]}(ce);let Ne=Math.abs(X.top-X.bottom);for(const it of X.positionedLines)Ne-=it.lineOffset;const je=X.positionedLines.length,Xe=Ne/je;let Ue=X.top-ce[1];for(let it=0;it<je;++it){const dt=X.positionedLines[it];Ue=Z2(X,Xe,Ue,it);for(const Qe of dt.positionedGlyphs){if(!Qe.rect)continue;const Rt=Qe.rect||{};let Pt=UI+1,wt=!0,gt=1,Jt=0;if(Qe.imageName){const zn=Te[Qe.imageName];if(!zn)continue;if(zn.sdf){zr("SDF images are not supported in formatted text and will be ignored.");continue}wt=!1,gt=zn.pixelRatio,Pt=qm/gt}const Dt=(ge||_e)&&Qe.vertical,jt=Qe.metrics.advance*Qe.scale/2,ar=Qe.metrics,wr=Qe.rect;if(wr===null)continue;_e&&X.verticalizable&&(Jt=Qe.imageName?jt-Qe.metrics.width*Qe.scale/2:0);const mr=ge?[Qe.x+jt,Qe.y]:[0,0];let gr=[0,0],Ar=[0,0],Er=!1;ge||(Dt?(Ar=[Qe.x+jt+Fe[0],Qe.y+Fe[1]-Jt],Er=!0):gr=[Qe.x+jt+ce[0],Qe.y+ce[1]-Jt]);const nn=wr.w*Qe.scale/(gt*(Qe.localGlyph?es:1)),qr=wr.h*Qe.scale/(gt*(Qe.localGlyph?es:1));let lr,jr,$r,dn;if(Dt){const zn=Qe.y-Ue,Mn=new _t(-jt,jt-zn),mi=-Math.PI/2,Jn=new _t(...Ar);lr=new _t(-jt+gr[0],gr[1]),lr._rotateAround(mi,Mn)._add(Jn),lr.x+=-zn+jt,lr.y-=(ar.left-Pt)*Qe.scale;const Si=Qe.imageName?ar.advance*Qe.scale:Ti*Qe.scale,un=String.fromCodePoint(Qe.glyph);B2(un)?lr.x+=(1-Pt)*Qe.scale:F2(un)?lr.x+=Si-ar.height*Qe.scale+(-Pt-1)*Qe.scale:lr.x+=Qe.imageName||ar.width+2*Pt===wr.w&&ar.height+2*Pt===wr.h?(Si-qr)/2:(Si-(ar.height+2*Pt)*Qe.scale)/2,jr=new _t(lr.x,lr.y-nn),$r=new _t(lr.x+qr,lr.y),dn=new _t(lr.x+qr,lr.y-nn)}else{const zn=(ar.left-Pt)*Qe.scale-jt+gr[0],Mn=(-ar.top-Pt)*Qe.scale+gr[1],mi=zn+nn,Jn=Mn+qr;lr=new _t(zn,Mn),jr=new _t(mi,Mn),$r=new _t(zn,Jn),dn=new _t(mi,Jn)}if(Re){let zn;zn=ge?new _t(0,0):Er?new _t(Fe[0],Fe[1]):new _t(ce[0],ce[1]),lr._rotateAround(Re,zn),jr._rotateAround(Re,zn),$r._rotateAround(Re,zn),dn._rotateAround(Re,zn)}const Rn=new _t(0,0),Wn=new _t(0,0);Ee.push({tl:lr,tr:jr,bl:$r,br:dn,texPrimary:Rt,texSecondary:void 0,writingMode:X.writingMode,glyphOffset:mr,sectionIndex:Qe.sectionIndex,isSDF:wt,pixelOffsetTL:Rn,pixelOffsetBR:Wn,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,u,E,h,g,b,m,c.allowVerticalPlacement),W=c.textSizeData;let j=null;W.kind==="source"?(j=[Qa*h.layout.get("text-size").evaluate(b,{},R)],j[0]>Ic&&zr(`${c.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)):W.kind==="composite"&&(j=[Qa*M.compositeTextSizes[0].evaluate(b,{},R),Qa*M.compositeTextSizes[1].evaluate(b,{},R)],(j[0]>Ic||j[1]>Ic)&&zr(`${c.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)),c.addSymbols(c.text,G,j,E,g,b,v,r,s,I.lineStartIndex,I.lineLength,A,k,R,N,!1);for(const Z of S)P[Z]=c.text.placedSymbolArray.length-1;return 4*G.length}function cC(c){for(const r in c)return c[r];return null}function Iv(c,r,s,u,m,h,g,b,E,I){let v=g.top,S=g.bottom,P=g.left,A=g.right;const M=g.collisionPadding;if(M&&(P-=M[0],v-=M[1],A+=M[2],S+=M[3]),E){const k=new _t(P,v),R=new _t(A,v),N=new _t(P,S),G=new _t(A,S),W=Sr(E);let j=new _t(0,0);I&&(j=new _t(I[0],I[1])),k._rotateAround(W,j),R._rotateAround(W,j),N._rotateAround(W,j),G._rotateAround(W,j),P=Math.min(k.x,R.x,N.x,G.x),A=Math.max(k.x,R.x,N.x,G.x),v=Math.min(k.y,R.y,N.y,G.y),S=Math.max(k.y,R.y,N.y,G.y)}return c.emplaceBack(r.x,r.y,r.z,s.x,s.y,P,v,A,S,b,u,m,h),c.length-1}function Tw(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const r=c.bottom-c.top;return r>0?Math.max(10,r):null}function Q2(c,r,s,u){const m=c.compareText;if(r in m){const h=m[r];for(let g=h.length-1;g>=0;g--)if(u.dist(h[g])<s)return!0}else m[r]=[];return m[r].push(u),!1}function uC(c,r){const s=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*r:0,m=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(s)*m/Math.sin(Math.max(Math.PI/2-c._pitch-s,.01));let g=Math.sin(c._pitch)*h+m;const b=m*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(g*=1+Math.max(c.zoom-17,0)),Math.min(1.01*g,b)}function Zm(c,r){if(!r.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:r};const s=Math.pow(2,-c.z),u=c.x*s,m=(c.x+1)*s,h=c.y*s,g=(c.y+1)*s,b=xe(u),E=xe(m),I=ve(h),v=ve(g),S=r.project(b,I),P=r.project(E,I),A=r.project(E,v),M=r.project(b,v);let k=Math.min(S.x,P.x,A.x,M.x),R=Math.min(S.y,P.y,A.y,M.y),N=Math.max(S.x,P.x,A.x,M.x),G=Math.max(S.y,P.y,A.y,M.y);const W=s/16;function j(X,ce,pe,ge,fe,Te){const _e=(pe+fe)/2,Ee=(ge+Te)/2,Re=r.project(xe(_e),ve(Ee)),Fe=Math.max(0,k-Re.x,R-Re.y,Re.x-N,Re.y-G);k=Math.min(k,Re.x),N=Math.max(N,Re.x),R=Math.min(R,Re.y),G=Math.max(G,Re.y),Fe>W&&(j(X,Re,pe,ge,_e,Ee),j(Re,ce,_e,Ee,fe,Te))}j(S,P,u,h,m,h),j(P,A,m,h,m,g),j(A,M,m,g,u,g),j(M,S,u,g,u,h),k-=W,R-=W,N+=W,G+=W;const Z=1/Math.max(N-k,G-R);return{scale:Z,x:k*Z,y:R*Z,x2:N*Z,y2:G*Z,projection:r}}function hC(c,{x:r,y:s},u=0){return new _t(((r-u)*c.scale-c.x)*Ct,(s*c.scale-c.y)*Ct)}const e6=Me.mat4.identity(new Float32Array(16));class Cc{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new q(0,0)}projectTilePoint(r,s,u){return{x:r,y:s,z:0}}locationPoint(r,s,u=!0){return r._coordinatePoint(r.locationCoordinate(s),u)}pixelsPerMeter(r,s){return de(1,r)*s}pixelSpaceConversion(r,s,u){return 1}farthestPixelDistance(r){return uC(r,r.pixelsPerMeter)}pointCoordinate(r,s,u,m){const h=r.horizonLineFromTop(!1),g=new _t(s,Math.max(h,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(g,m))}pointCoordinate3D(r,s,u){const m=new _t(s,u);if(r.elevation)return r.elevation.pointCoordinate(m);{const h=this.pointCoordinate(r,m.x,m.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(r,s){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,s.x,s.y);const u=r.horizonLineFromTop();return s.y<u}createInversionMatrix(r,s){return e6}createTileMatrix(r,s,u){let m,h,g;const b=u.canonical,E=Me.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=Zm(b,this);m=1,h=I.x+u.wrap*I.scale,g=I.y,Me.mat4.scale(E,E,[m/I.scale,m/I.scale,r.pixelsPerMeter/s])}else m=s/r.zoomScale(b.z),h=(b.x+Math.pow(2,b.z)*u.wrap)*m,g=b.y*m;return Me.mat4.translate(E,E,[h,g,0]),Me.mat4.scale(E,E,[m/Ct,m/Ct,1]),E}upVector(r,s,u){return[0,0,1]}upVectorScale(r,s,u){return{metersToTile:1}}}class t6 extends Cc{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,u]=this.parallels=r.parallels||[29.5,45.5],m=Math.sin(Sr(s));this.n=(m+Math.sin(Sr(u)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:u,c:m,r0:h}=this,g=Sr(r-this.center[0]),b=Sr(s),E=Math.sqrt(m-2*u*Math.sin(b))/u;return{x:E*Math.sin(g*u),y:E*Math.cos(g*u)-h,z:0}}unproject(r,s){const{n:u,c:m,r0:h}=this,g=h+s;let b=Math.atan2(r,Math.abs(g))*Math.sign(g);g*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(g));const E=Sr(this.center[0])*u;b=Ua(b,-Math.PI-E,Math.PI-E);const I=yr(An(b/u)+this.center[0],-180,180),v=Math.asin(yr((m-(r*r+g*g)*u*u)/(2*u),-1,1)),S=yr(An(v),-Se,Se);return new q(I,S)}}const Xm=1.340264,Ym=-.081106,Km=893e-6,Jm=.003796,Cv=Math.sqrt(3)/2;class r6 extends Cc{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(Cv*Math.sin(s)),m=u*u,h=m*m*m;return{x:.5*(r*Math.cos(u)/(Cv*(Xm+3*Ym*m+h*(7*Km+9*Jm*m)))/Math.PI+.5),y:1-.5*(u*(Xm+Ym*m+h*(Km+Jm*m))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=u*u,h=m*m*m;for(let v,S,P,A=0;A<12&&(S=u*(Xm+Ym*m+h*(Km+Jm*m))-s,P=Xm+3*Ym*m+h*(7*Km+9*Jm*m),v=S/P,u=yr(u-v,-Math.PI/3,Math.PI/3),m=u*u,h=m*m*m,!(Math.abs(v)<1e-12));++A);const g=Cv*r*(Xm+3*Ym*m+h*(7*Km+9*Jm*m))/Math.cos(u),b=Math.asin(Math.sin(u)/Cv),E=yr(180*g/Math.PI,-180,180),I=yr(180*b/Math.PI,-Se,Se);return new q(E,I)}}class n6 extends Cc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const u=360*(r-.5),m=yr(360*(.5-s),-Se,Se);return new q(u,m)}}const Vf=Math.PI/2;function Ov(c){return Math.tan((Vf+c)/2)}class i6 extends Cc{constructor(r){super(r),this.center=r.center||[0,30];const[s,u]=this.parallels=r.parallels||[30,30];let m=Sr(s),h=Sr(u);this.southernCenter=m+h<0,this.southernCenter&&(m=-m,h=-h);const g=Math.cos(m),b=Ov(m);this.n=m===h?Math.sin(m):Math.log(g/Math.cos(h))/Math.log(Ov(h)/b),this.f=g*Math.pow(Ov(m),this.n)/this.n}project(r,s){s=Sr(s),this.southernCenter&&(s=-s),r=Sr(r-this.center[0]);const u=1e-6,{n:m,f:h}=this;h>0?s<-Vf+u&&(s=-Vf+u):s>Vf-u&&(s=Vf-u);const g=h/Math.pow(Ov(s),m);let b=g*Math.sin(m*r),E=h-g*Math.cos(m*r);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:m}=this,h=m-s,g=Math.sign(h),b=Math.sign(u)*Math.sqrt(r*r+h*h);let E=Math.atan2(r,Math.abs(h))*g;h*u<0&&(E-=Math.PI*Math.sign(r)*g);const I=yr(An(E/u)+this.center[0],-180,180),v=yr(An(2*Math.atan(Math.pow(m/b,1/u))-Vf),-Se,Se);return new q(I,this.southernCenter?-v:v)}}class fC extends Cc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:me(r),y:ye(s),z:0}}unproject(r,s){const u=xe(r),m=ve(s);return new q(u,m)}}const dC=Sr(Se);class o6 extends Cc{project(r,s){const u=(s=Sr(s))*s,m=u*u;return{x:.5*((r=Sr(r))*(.8707-.131979*u+m*(m*(.003971*u-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+m*(.028874*u-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,m=25,h=0,g=u*u;do{g=u*u;const I=g*g;h=(u*(1.007226+g*(.015085+I*(.028874*g-.044475-.005916*I)))-s)/(1.007226+g*(.045255+I*(.259866*g-.311325-.005916*11*I))),u=yr(u-h,-dC,dC)}while(Math.abs(h)>1e-6&&--m>0);g=u*u;const b=yr(An(r/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=An(u);return new q(b,E)}}const pC=Sr(Se);class a6 extends Cc{project(r,s){s=Sr(s),r=Sr(r);const u=Math.cos(s),m=2/Math.PI,h=Math.acos(u*Math.cos(r/2)),g=Math.sin(h)/h,b=.5*(r*m+2*u*Math.sin(r/2)/g)||0,E=.5*(s+Math.sin(s)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,s){let u=r=(2*r-.5)*Math.PI,m=s=(2*(1-s)-1)*Math.PI,h=25;const g=1e-6;let b=0,E=0;do{const I=Math.cos(m),v=Math.sin(m),S=2*v*I,P=v*v,A=I*I,M=Math.cos(u/2),k=Math.sin(u/2),R=2*M*k,N=k*k,G=1-A*M*M,W=G?1/G:0,j=G?Math.acos(I*M)*Math.sqrt(1/G):0,Z=.5*(2*j*I*k+2*u/Math.PI)-r,X=.5*(j*v+m)-s,ce=.5*W*(A*N+j*I*M*P)+1/Math.PI,pe=W*(R*S/4-j*v*k),ge=.125*W*(S*k-j*v*A*R),fe=.5*W*(P*M+j*N*I)+.5,Te=pe*ge-fe*ce;b=(X*pe-Z*fe)/Te,E=(Z*ge-X*ce)/Te,u=yr(u-b,-Math.PI,Math.PI),m=yr(m-E,-pC,pC)}while((Math.abs(b)>g||Math.abs(E)>g)&&--h>0);return new q(An(u),An(m))}}class mC extends Cc{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:u,cosPhi:m}=this;return{x:Sr(r)*m*u+.5,y:-Math.sin(Sr(s))/m*u+.5,z:0}}unproject(r,s){const{scale:u,cosPhi:m}=this,h=-(s-.5)/u,g=yr(An((r-.5)/u)/m,-180,180),b=Math.asin(yr(h*m,-1,1)),E=yr(An(b),-Se,Se);return new q(g,E)}}class s6 extends fC{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,s,u){const m=km(r,s,u),h=fv(ks(u));return Me.vec3.transformMat4(m,m,h),{x:m[0],y:m[1],z:m[2]}}locationPoint(r,s){const u=B(s.lat,s.lng),m=Me.vec3.normalize([],u),h=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(s),r._centerAltitude):r._centerAltitude,g=de(1,0)*Ct*h;Me.vec3.scaleAndAdd(u,u,m,g);const b=Me.mat4.identity(new Float64Array(16));return Me.mat4.multiply(b,r.pixelMatrix,r.globeMatrix),Me.vec3.transformMat4(u,u,b),new _t(u[0],u[1])}pixelsPerMeter(r,s){return de(1,0)*s}pixelSpaceConversion(r,s,u){const m=de(1,r)*s,h=nr(de(1,45)*s,m,u);return this.pixelsPerMeter(r,s)/h}createTileMatrix(r,s,u){const m=Hb(ks(u.canonical));return Me.mat4.multiply(new Float64Array(16),r.globeMatrix,m)}createInversionMatrix(r,s){const{center:u}=r,m=fv(ks(s));return Me.mat4.rotateY(m,m,Sr(u.lng)),Me.mat4.rotateX(m,m,Sr(u.lat)),Me.mat4.scale(m,m,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(r,s,u,m){return cv(r,s,u,!0)||new Ve(0,0)}pointCoordinate3D(r,s,u){const m=this.pointCoordinate(r,s,u,0);return[m.x,m.y,m.z]}isPointAboveHorizon(r,s){return!cv(r,s.x,s.y,!1)}farthestPixelDistance(r){const s=function(m,h){const g=m.cameraToCenterDistance,b=m._centerAltitude*h,E=m._camera,I=m._camera.forward(),v=Me.vec3.add([],Me.vec3.scale([],I,-g),[0,0,b]),S=m.worldSize/(2*Math.PI),P=[0,0,-S],A=m.width/m.height,M=Math.tan(m.fovAboveCenter),k=Me.vec3.scale([],E.up(),M),R=Me.vec3.scale([],E.right(),M*A),N=Me.vec3.normalize([],Me.vec3.add([],Me.vec3.add([],I,k),R)),G=[];let W;if(new Ja(v,N).closestPointOnSphere(P,S,G)){const j=Me.vec3.add([],G,P),Z=Me.vec3.sub([],j,v);W=Math.cos(m.fovAboveCenter)*Me.vec3.length(Z)}else{const j=Me.vec3.sub([],v,P),Z=Me.vec3.sub([],P,v);Me.vec3.normalize(Z,Z);const X=Me.vec3.length(j)-S;W=Math.sqrt(X*(X+2*S));const ce=Math.acos(W/(S+X))-Math.acos(Me.vec3.dot(I,Z));W*=Math.cos(ce)}return 1.01*W}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Ac(r.zoom);if(u>0){const m=uC(r,de(1,r.center.lat)*r.worldSize),h=r.worldSize/(2*Math.PI),g=Math.max(r.width,r.height)/r.worldSize*Math.PI;return nr(s,m+h*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(r,s,u){return km(s,u,r,1)}upVectorScale(r){return{metersToTile:fl(hv(ks(r)))}}}function gC(c){const r=c.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(c.name){case"mercator":return new fC(c);case"equirectangular":return new n6(c);case"naturalEarth":return new o6(c);case"equalEarth":return new r6(c);case"winkelTripel":return new a6(c);case"albers":return s?new mC(c):new t6(c);case"lambertConformalConic":return s?new mC(c):new i6(c);case"globe":return new s6(c)}throw new Error(`Invalid projection name: ${c.name}`)}const l6=Ff.VectorTileFeature.types,c6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kv(c,r,s,u,m,h,g,b,E,I,v,S,P){const A=b?Math.min(Ic,Math.round(b[0])):0,M=b?Math.min(Ic,Math.round(b[1])):0;c.emplaceBack(r,s,Math.round(32*u),Math.round(32*m),h,g,(A<<1)+(E?1:0),M,16*I,16*v,256*S,256*P)}function Dv(c,r,s){c.emplaceBack(r,s)}function Lv(c,r,s,u,m,h,g){c.emplaceBack(r,s,u,m,h,g)}function Rv(c,r,s,u,m){c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m),c.emplaceBack(r,s,u,m)}function u6(c){for(const r of c.sections)if(Ib(r.text))return!0;return!1}class Sw{constructor(r){this.layoutVertexArray=new _m,this.indexArray=new _i,this.programConfigurations=r,this.segments=new On,this.dynamicLayoutVertexArray=new Za,this.opacityVertexArray=new xm,this.placedSymbolArray=new Am,this.iconTransitioningVertexArray=new Is,this.globeExtVertexArray=new vm,this.zOffsetVertexArray=new vc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,s,u,m,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,M2.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,I2.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,c6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,O2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,P2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,C2.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}$t(Sw,"SymbolBuffers");class Aw{constructor(r,s,u){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new u,this.segments=new On,this.collisionVertexArray=new _c,this.collisionVertexArrayExt=new Za}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,k2.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,D2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$t(Aw,"CollisionBuffers");class zv{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.lut=r.lut,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Me.mat4.identity([]),this.placementViewportMatrix=Me.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dw(this.zoom,s["text-size"]),this.iconSizeData=dw(this.zoom,s["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>ta[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Sw(new Cs(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new Sw(new Cs(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new ev,this.lineVertexArray=new Df,this.symbolInstances=new Em}calculateGlyphDependencies(r,s,u,m,h){for(let g=0;g<r.length;g++){const b=r.codePointAt(g);if(b===void 0)break;if(s[b]=!0,m&&h&&b<=65535){const E=Vm[r.charAt(g)];E&&(s[E.charCodeAt(0)]=!0)}}}updateFootprints(r,s){}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!sw(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,s,u,m){const h=this.layers[0],g=h.layout,b=this.projection.name==="globe",E=g.get("text-font"),I=g.get("text-field"),v=g.get("icon-image"),S=(I.value.kind!=="constant"||I.value.value instanceof Di&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),P=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,A=g.get("symbol-sort-key");if(this.features=[],!S&&!P)return;const M=s.iconDependencies,k=s.glyphDependencies,R=s.availableImages,N=new Cn(this.zoom);for(const{feature:G,id:W,index:j,sourceLayerIndex:Z}of r){const X=h._featureFilter.needGeometry,ce=St(G,X);if(!h._featureFilter.filter(N,ce,u))continue;if(X||(ce.geometry=bt(G,u,m)),b&&G.type!==1&&u.z<=5){const Te=ce.geometry,_e=.98078528056,Ee=(Re,Fe)=>{const Ne=km(Re.x,Re.y,u,1),je=km(Fe.x,Fe.y,u,1);return Me.vec3.dot(Ne,je)<_e};for(let Re=0;Re<Te.length;Re++)Te[Re]=vt(Te[Re],Ee)}let pe,ge;if(S){const Te=h.getValueAndResolveTokens("text-field",ce,u,R),_e=Di.factory(Te);u6(_e)&&(this.hasRTLText=!0),(!this.hasRTLText||fm()==="unavailable"||this.hasRTLText&&io.isParsed())&&(pe=z2(_e,h,ce))}if(P){const Te=h.getValueAndResolveTokens("icon-image",ce,u,R);ge=Te instanceof $i?Te:$i.fromString(Te)}if(!pe&&!ge)continue;const fe=this.sortFeaturesByKey?A.evaluate(ce,{},u):void 0;if(this.features.push({id:W,text:pe,icon:ge,index:j,sourceLayerIndex:Z,geometry:ce.geometry,properties:G.properties,type:l6[G.type],sortKey:fe}),ge&&(M[ge.namePrimary]=!0,ge.nameSecondary&&(M[ge.nameSecondary]=!0)),pe){const Te=E.evaluate(ce,{},u).join(","),_e=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ta.vertical)>=0;for(const Ee of pe.sections)if(Ee.image)M[Ee.image.namePrimary]=!0;else{const Re=yf(pe.toString()),Fe=Ee.fontStack||Te,Ne=k[Fe]=k[Fe]||{};this.calculateGlyphDependencies(Ee.text,Ne,_e,this.allowVerticalPlacement,Re)}}}g.get("symbol-placement")==="line"&&(this.features=function(G){const W={},j={},Z=[];let X=0;function ce(Te){Z.push(G[Te]),X++}function pe(Te,_e,Ee){const Re=j[Te];return delete j[Te],j[_e]=Re,Z[Re].geometry[0].pop(),Z[Re].geometry[0]=Z[Re].geometry[0].concat(Ee[0]),Re}function ge(Te,_e,Ee){const Re=W[_e];return delete W[_e],W[Te]=Re,Z[Re].geometry[0].shift(),Z[Re].geometry[0]=Ee[0].concat(Z[Re].geometry[0]),Re}function fe(Te,_e,Ee){const Re=Ee?_e[0][_e[0].length-1]:_e[0][0];return`${Te}:${Re.x}:${Re.y}`}for(let Te=0;Te<G.length;Te++){const _e=G[Te],Ee=_e.geometry,Re=_e.text?_e.text.toString():null;if(!Re){ce(Te);continue}const Fe=fe(Re,Ee),Ne=fe(Re,Ee,!0);if(Fe in j&&Ne in W&&j[Fe]!==W[Ne]){const je=ge(Fe,Ne,Ee),Xe=pe(Fe,Ne,Z[je].geometry);delete W[Fe],delete j[Ne],j[fe(Re,Z[Xe].geometry,!0)]=Xe,Z[je].geometry=null}else Fe in j?pe(Fe,Ne,Ee):Ne in W?ge(Fe,Ne,Ee):(ce(Te),W[Fe]=X-1,j[Ne]=X-1)}return Z.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,W)=>G.sortKey-W.sortKey)}update(r,s,u,m,h){const g=Object.keys(r).length!==0;if(g&&!this.stateDependentLayers.length)return;const b=g?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(r,s,b,u,m,h),this.icon.programConfigurations.updatePaintArrays(r,s,b,u,m,h)}updateZOffset(){const r=(h,g,b)=>{u+=g,u>h.length&&h.resize(u);for(let E=-g;E<0;E++)h.emplace(E+u,b)},s=(h,g,b)=>{m+=g,m>h.length&&h.resize(m);for(let E=-g;E<0;E++)h.emplace(E+m,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,m=0;for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:E,numIconVertices:I}=g,v=g.zOffset,S=I>0;if((b>0||E>0)&&(r(this.text.zOffsetVertexArray,b,v),r(this.text.zOffsetVertexArray,E,v)),S){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:A}=g;P>=0&&s(this.icon.zOffsetVertexArray,I,v),A>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=gC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:m,y:h}of s)this.lineVertexArray.emplaceBack(m,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,s,u,m,h,g,b,E,I,v,S,P,A,M,k,R){const N=r.indexArray,G=r.layoutVertexArray,W=r.globeExtVertexArray,j=r.segments.prepareSegment(4*s.length,G,N,this.canOverlap?g.sortKey:void 0),Z=this.glyphOffsetArray.length,X=j.vertexLength,ce=this.allowVerticalPlacement&&b===ta.vertical?Math.PI/2:0,pe=g.text&&g.text.sections;for(let fe=0;fe<s.length;fe++){const{tl:Te,tr:_e,bl:Ee,br:Re,texPrimary:Fe,texSecondary:Ne,pixelOffsetTL:je,pixelOffsetBR:Xe,minFontScaleX:Ue,minFontScaleY:it,glyphOffset:dt,isSDF:Qe,sectionIndex:Rt}=s[fe],Pt=j.vertexLength,wt=dt[1];if(kv(G,I.x,I.y,Te.x,wt+Te.y,Fe.x,Fe.y,u,Qe,je.x,je.y,Ue,it),kv(G,I.x,I.y,_e.x,wt+_e.y,Fe.x+Fe.w,Fe.y,u,Qe,Xe.x,je.y,Ue,it),kv(G,I.x,I.y,Ee.x,wt+Ee.y,Fe.x,Fe.y+Fe.h,u,Qe,je.x,Xe.y,Ue,it),kv(G,I.x,I.y,Re.x,wt+Re.y,Fe.x+Fe.w,Fe.y+Fe.h,u,Qe,Xe.x,Xe.y,Ue,it),E){const{x:gt,y:Jt,z:Dt}=E.anchor,[jt,ar,wr]=E.up;Lv(W,gt,Jt,Dt,jt,ar,wr),Lv(W,gt,Jt,Dt,jt,ar,wr),Lv(W,gt,Jt,Dt,jt,ar,wr),Lv(W,gt,Jt,Dt,jt,ar,wr),Rv(r.dynamicLayoutVertexArray,gt,Jt,Dt,ce)}else Rv(r.dynamicLayoutVertexArray,I.x,I.y,I.z,ce);if(R){const gt=Ne||Fe;Dv(r.iconTransitioningVertexArray,gt.x,gt.y),Dv(r.iconTransitioningVertexArray,gt.x+gt.w,gt.y),Dv(r.iconTransitioningVertexArray,gt.x,gt.y+gt.h),Dv(r.iconTransitioningVertexArray,gt.x+gt.w,gt.y+gt.h)}N.emplaceBack(Pt,Pt+1,Pt+2),N.emplaceBack(Pt+1,Pt+2,Pt+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),fe!==s.length-1&&Rt===s[fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(G.length,g,g.index,{},A,M,k,pe&&pe[Rt])}const ge=E?E.anchor:I;r.placedSymbolArray.emplaceBack(ge.x,ge.y,ge.z,I.x,I.y,Z,this.glyphOffsetArray.length-Z,X,v,S,I.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],b,0,!1,0,P,0)}_commitLayoutVertex(r,s,u,m,h,g,b){r.emplaceBack(s,u,m,h,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,s,u,m,h,g,b){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=E.vertexLength,v=b.tileAnchorX,S=b.tileAnchorY;for(let A=0;A<4;A++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new _t(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new _t(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new _t(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,m,h,g,v,S,new _t(r.x1,r.y2)),E.vertexLength+=4;const P=u.indexArray;P.emplaceBack(I,I+1),P.emplaceBack(I+1,I+2),P.emplaceBack(I+2,I+3),P.emplaceBack(I+3,I),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),I=this.getSymbolInstanceTextSize(r,g,s,b);this._addCollisionDebugVertices(E,I,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(r,s,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),I=this.getSymbolInstanceIconSize(r,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,I,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(r,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Aw(cl,FI.members,Is),this.iconCollisionBox=new Aw(cl,FI.members,Is);const u=Nf(this.iconSizeData,r),m=Nf(this.textSizeData,r);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(m,r,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(m,r,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,r,s,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,r,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(r,s,u,m){const h=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:m),g=Tv(this.textSizeData,r,h)/Ti;return this.tilePixelRatio*g}getSymbolInstanceIconSize(r,s,u){const m=this.icon.placedSymbolArray.get(u),h=Tv(this.iconSizeData,r,m);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(r,s,u,m){r.emplaceBack(s,-u,-u,m),r.emplaceBack(s,u,-u,m),r.emplaceBack(s,u,u,m),r.emplaceBack(s,-u,u,m)}_updateTextDebugCollisionBoxes(r,s,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),I=this.getSymbolInstanceTextSize(r,g,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,E.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(r,s,u,m,h,g){for(let b=m;b<h;b++){const E=u.get(b),I=this.getSymbolInstanceIconSize(r,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,E.padding,g.zOffset)}}updateCollisionDebugBuffers(r,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Nf(this.iconSizeData,r),m=Nf(this.textSizeData,r);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(m,r,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(m,r,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(u,r,s,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._updateIconDebugCollisionBoxes(u,r,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,u,m,h,g,b,E,I){const v={};if(s<u){const{x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j,featureIndex:Z}=r.get(s);v.textBox={x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j},v.textFeatureIndex=Z}if(m<h){const{x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j,featureIndex:Z}=r.get(m);v.verticalTextBox={x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j},v.verticalTextFeatureIndex=Z}if(g<b){const{x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j,featureIndex:Z}=r.get(g);v.iconBox={x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j},v.iconFeatureIndex=Z}if(E<I){const{x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j,featureIndex:Z}=r.get(E);v.verticalIconBox={x1:S,y1:P,x2:A,y2:M,padding:k,projectedAnchorX:R,projectedAnchorY:N,projectedAnchorZ:G,tileAnchorX:W,tileAnchorY:j},v.verticalIconFeatureIndex=Z}return v}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,s){const u=r.placedSymbolArray.get(s),m=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<m;h+=4)r.indexArray.emplaceBack(h,h+1,h+2),r.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),u=Math.cos(r),m=[],h=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const E=this.symbolInstances.get(b);m.push(0|Math.round(s*E.tileAnchorX+u*E.tileAnchorY)),h.push(E.featureIndex)}return g.sort((b,E)=>m[b]-m[E]||h[E]-h[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:I}=u;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),h>=0&&h!==m&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==m&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yC,_C,Ew;$t(zv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),zv.addDynamicAttributes=Rv;class vC{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Xo,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$t(vC,"FormatSectionOverride",{omit:["defaultValue"]});const Mw=()=>Ew||(Ew={layout:yC||(yC=new xn({"symbol-placement":new Et(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Ze.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Et(Ze.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Et(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Et(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(Ze.layout_symbol["icon-size"]),"icon-text-fit":new Xt(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(Ze.layout_symbol["icon-image"]),"icon-rotate":new Xt(Ze.layout_symbol["icon-rotate"]),"icon-padding":new Et(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(Ze.layout_symbol["icon-offset"]),"icon-anchor":new Xt(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(Ze.layout_symbol["text-field"]),"text-font":new Xt(Ze.layout_symbol["text-font"]),"text-size":new Xt(Ze.layout_symbol["text-size"]),"text-max-width":new Xt(Ze.layout_symbol["text-max-width"]),"text-line-height":new Xt(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(Ze.layout_symbol["text-justify"]),"text-radial-offset":new Xt(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(Ze.layout_symbol["text-anchor"]),"text-max-angle":new Et(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(Ze.layout_symbol["text-rotate"]),"text-padding":new Et(Ze.layout_symbol["text-padding"]),"text-keep-upright":new Et(Ze.layout_symbol["text-keep-upright"]),"text-transform":new Xt(Ze.layout_symbol["text-transform"]),"text-offset":new Xt(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Et(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Ze.layout_symbol["text-optional"]),visibility:new Et(Ze.layout_symbol.visibility)})),paint:_C||(_C=new xn({"icon-opacity":new Xt(Ze.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(Ze.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(Ze.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(Ze.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(Ze.paint_symbol["icon-color"]),"icon-halo-color":new Xt(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Ze.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Xt(Ze.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(Ze.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(Ze.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(Ze.paint_symbol["text-color"],{runtimeType:to,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Xt(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(Ze.paint_symbol["text-halo-blur"]),"text-translate":new Et(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Ze.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Et(Ze.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Et(Ze.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Et(Ze.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Et(Ze.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(Ze.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new Et(Ze.paint_symbol["symbol-elevation-reference"])}))},Ew);class Bv extends Li{constructor(r,s,u,m){super(r,Mw(),s,u,m),this._colorAdjustmentMatrix=Me.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}recalculate(r,s){super.recalculate(r,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const h of u)m.indexOf(h)<0&&m.push(h);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,s,u,m){return this._saturation===r&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(h,g,b,E){h=we(h),g=he(g);const I=Me.mat4.create(),v=h/3,S=1-2*v,P=[S,v,v,0,v,S,v,0,v,v,S,0,0,0,0,1],A=.5-.5*g,M=E-b;return Me.mat4.multiply(I,[M,0,0,0,0,M,0,0,0,0,M,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,A,A,A,1]),Me.mat4.multiply(I,I,P),I}(r,s,u,m),this._saturation=r,this._contrast=s,this._brightnessMin=u,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,s,u,m){const h=this.layout.get(r).evaluate(s,{},u,m),g=this._unevaluatedLayout._values[r];return g.isDataDriven()||df(g.value)||!h?h:function(b,E){return E.replace(/{([^{}]+)}/g,(I,v)=>v in b?String(b[v]):"")}(s.properties,h)}createBucket(r){return new zv(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Mw().paint.overridableProperties){if(!Bv.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),u=new vC(s),m=new ff(u,s.property.specification,this.scope,this.options);let h=null;h=s.value.kind==="constant"||s.value.kind==="source"?new am("source",m):new _a("composite",m,s.value.zoomStops,s.value._interpolationType),this.paint._values[r]=new dc(s.property,h,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&Bv.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const u=r.get("text-field"),m=Mw().paint.properties[s];let h=!1;const g=b=>{for(const E of b)if(m.overrides&&m.overrides.hasOverride(E))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Di)g(u.value.value.sections);else if(u.value.kind==="source"){const b=I=>{h||(I instanceof Yo&&Gn(I.value)===Hl?g(I.value.sections):I instanceof Kl?g(I.sections):I.eachChild(b))},E=u.value;E._styleExpression&&b(E._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,s,u){return{config:new hl(this,{zoom:s,lut:u}),overrideFog:!1}}}let xC,bC,wC,TC;var Pw=Fr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Iw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Cw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ow{constructor(r,s,u,m){this.context=r,this.format=u,this.useMipmap=m&&m.useMipmap,this.texture=r.gl.createTexture(),this.update(s,{premultiply:m&&m.premultiply})}update(r,s){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,m=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:h}=this,{gl:g}=h,{x:b,y:E}=s&&s.position?s.position:{x:0,y:0},I=Math.max(b+u,this.size?this.size[0]:0),v=Math.max(E+m,this.size?this.size[1]:0);!this.size||this.size[0]===I&&this.size[1]===v||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));const S=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&I>0&&v>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(I,v)))+1:1;g.texStorage2D(g.TEXTURE_2D,P,this.format,I,v),this.size=[I,v]}if(this.size)if(S)g.texSubImage2D(g.TEXTURE_2D,0,b,E,Iw(this.format),Cw(this.format),r);else{const P=r.data;P&&g.texSubImage2D(g.TEXTURE_2D,0,b,E,u,m,Iw(this.format),Cw(this.format),P)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(r,s,u=!1){const{context:m}=this,{gl:h}=m;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(r,s,u,m){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),s!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,s),this.magFilter=s),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),this.wrapS=u),m!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Fv{constructor(r,s){this.context=r,this.texture=s}bind(r,s){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,r),this.minFilter=r),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}}function Nv(c,r,s,u,m,h,g,b){const E=[c,r,1,s,u,1,m,h,1],I=[g,b,1],v=Me.mat3.adjoint([],E),[S,P,A]=Me.vec3.transformMat3(I,I,v);return Me.mat3.multiply(E,E,[S,0,0,0,P,0,0,0,A])}function SC(c,r,s,u,m,h,g,b){const E=function(I,v,S,P,A,M,k,R){const N=Nv(0,0,1,0,1,1,0,1),G=Nv(I,v,S,P,A,M,k,R),W=Me.mat3.adjoint([],N);return Me.mat3.multiply(G,G,W)}(c,r,s,u,m,h,g,b);return[E[2]/E[8]/Ct,E[5]/E[8]/Ct]}function jv(c){return[c[0],Math.min(Math.max(c[1],-Se),Se)]}class AC extends ql{constructor(r,s,u,m){super(),this.id=r,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=s,this._dirty=!1}load(r,s){if(this._loaded=s||!1,this.fire(new vs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=pa(this.map._requestManager.transformRequest(this.url,Ul.Image),(u,m)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new _u(u)):m&&(this.image=m instanceof HTMLImageElement?Ft.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Fv(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Fv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=r[0][1],u=r[0][1];for(const h of r)h[1]>u&&(u=h[1]),h[1]<s&&(s=h[1]);const m=(u+s)/2;if(m>Se?this.onNorthPole=!0:m<-Se&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=r.map(Ve.fromLngLat);this.tileID=function(g){let b=1/0,E=1/0,I=-1/0,v=-1/0;for(const k of g)b=Math.min(b,k.x),E=Math.min(E,k.y),I=Math.max(I,k.x),v=Math.max(v,k.y);const S=Math.max(I-b,v-E),P=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),A=Math.pow(2,P);let M=Math.floor((b+I)/2*A);return M>1&&(M-=1),new ci(P,M,Math.floor((E+v)/2*A))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new vs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const N in this.tiles){const G=this.tiles[N];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Zm(new ci(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const G=N[1].x-N[0].x,W=N[1].y-N[0].y,j=N[2].x-N[1].x,Z=N[2].y-N[1].y,X=N[3].x-N[2].x,ce=N[3].y-N[2].y,pe=N[0].x-N[3].x,ge=N[0].y-N[3].y,fe=G*Z-j*W,Te=j*ce-X*Z,_e=X*ge-pe*ce,Ee=pe*W-G*ge;return fe>0&&Te>0&&_e>0&&Ee>0||fe<0&&Te<0&&_e<0&&Ee<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=Zm(this.tileID,this.map.transform.projection),[h,g,b,E]=this.coordinates.map(N=>{const G=m.projection.project(N[0],N[1]);return hC(m,G)._round()});this.perspectiveTransform=SC(h.x,h.y,g.x,g.y,b.x,b.y,E.x,E.y);const I=this._boundsArray=new Ms;I.emplaceBack(h.x,h.y,0,0),I.emplaceBack(g.x,g.y,Ct,0),I.emplaceBack(E.x,E.y,0,Ct),I.emplaceBack(b.x,b.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(I,Pw.members),this.boundsSegments=On.simpleSegment(0,0,4,2);const v=[],S=[jv((P=this.coordinates)[0]),jv(P[1]),jv(P[2]),jv(P[3])];var P;const[A,M,k,R]=function(N){let G=N[0][0],W=G,j=N[0][1],Z=j;for(let X=1;X<N.length;X++)N[X][0]<G?G=N[X][0]:N[X][0]>W&&(W=N[X][0]),N[X][1]<j?j=N[X][1]:N[X][1]>Z&&(Z=N[X][1]);return[G,j,W-G,Z-j]}(S);{const N=new Ms,[G,W,j,Z]=function(je){let Xe=je[0].x,Ue=Xe,it=je[0].y,dt=it;for(let Qe=1;Qe<je.length;Qe++)je[Qe].x<Xe?Xe=je[Qe].x:je[Qe].x>Ue&&(Ue=je[Qe].x),je[Qe].y<it?it=je[Qe].y:je[Qe].y>dt&&(dt=je[Qe].y);return[Xe,it,Ue-Xe,dt-it]}(u),X=je=>[(je.x-G)/j,(je.y-W)/Z],[ce,pe,ge,fe]=u.map(X),Te=function(je,Xe,Ue,it,dt,Qe,Rt,Pt){const wt=Nv(0,0,1,0,1,1,0,1),gt=Nv(je,Xe,Ue,it,dt,Qe,Rt,Pt),Jt=Me.mat3.adjoint([],gt);return Me.mat3.multiply(wt,wt,Jt)}(ce[0],ce[1],pe[0],pe[1],ge[0],ge[1],fe[0],fe[1]);this.elevatedGlobePerspectiveTransform=SC(ce[0],ce[1],pe[0],pe[1],ge[0],ge[1],fe[0],fe[1]);const _e=(je,Xe)=>{v.push(je.lng);const Ue=Math.round((je.lng-A)/k*Ct),it=Math.round((je.lat-M)/R*Ct),dt=X(Xe),Qe=Me.vec3.transformMat3([],[dt[0],dt[1],1],Te),Rt=Math.round(Qe[0]/Qe[2]*Ct),Pt=Math.round(Qe[1]/Qe[2]*Ct);N.emplaceBack(Ue,it,Rt,Pt)},Ee=u[3].x-u[0].x,Re=u[3].y-u[0].y,Fe=u[2].x-u[1].x,Ne=u[2].y-u[1].y;for(let je=0;je<65;je++){const Xe=je/64,Ue=[u[0].x+Xe*Ee,u[0].y+Xe*Re],it=[u[1].x+Xe*Fe,u[1].y+Xe*Ne],dt=it[0]-Ue[0],Qe=it[1]-Ue[1];for(let Rt=0;Rt<65;Rt++){const Pt=Rt/64,wt={x:Ue[0]+dt*Pt,y:Ue[1]+Qe*Pt,z:0};_e(s.projection.unproject(wt.x,wt.y),wt)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(N,Pw.members)}{this.maxLongitudeTriangleSize=0;let N=[],G=new _i;const W=(j,Z,X)=>{G.emplaceBack(j,Z,X);const ce=v[j],pe=v[Z],ge=v[X],fe=Math.min(Math.min(ce,pe),ge),Te=Math.max(Math.max(ce,pe),ge)-fe;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),N.push(fe+Te/2)};for(let j=0;j<64;j++)for(let Z=0;Z<64;Z++){const X=65*j+Z,ce=X+1,pe=X+65,ge=pe+1;W(X,pe,ce),W(ce,pe,ge)}[N,G]=function(j,Z){const X=Array.from({length:j.length},(ge,fe)=>fe);X.sort((ge,fe)=>j[ge]-j[fe]);const ce=[],pe=new _i;for(let ge=0;ge<X.length;ge++){const fe=X[ge];ce.push(j[fe]);const Te=3*fe,_e=Te+1;pe.emplaceBack(Z.uint16[Te],Z.uint16[_e],Z.uint16[_e+1])}return[ce,pe]}(N,G),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(G)}this.elevatedGlobeSegments=On.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/Ct,0,R/Ct,0,0,M,A,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Fv||(this.texture?this.texture.update(this.image):(this.texture=new Ow(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(s)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let m=(h=r+180)+360*Math.round((u[0]-h)/360);var h;const g=new On,b=(S,P)=>{g.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:s.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-m)<=E){const S=ne(u,0,u.length,m+E);return S===u.length||b(S,Je(u,S+1,u.length,m+360-E)-S),g}m<u[0]&&(m+=360);const I=Je(u,0,u.length,m-E);if(I===u.length)return b(0,u.length),g;b(0,I-0);const v=ne(u,I+1,u.length,m+E);return v!==u.length&&b(v,u.length-v),g}}const h6=(Math.pow(256,2)-1)/16907520;class EC extends Li{constructor(r,s,u,m){super(r,{layout:wC||(wC=new xn({visibility:new Et(Ze.layout_raster.visibility)})),paint:TC||(TC=new xn({"raster-opacity":new Et(Ze.paint_raster["raster-opacity"]),"raster-color":new Jo(Ze.paint_raster["raster-color"]),"raster-color-mix":new Et(Ze.paint_raster["raster-color-mix"]),"raster-color-range":new Et(Ze.paint_raster["raster-color-range"]),"raster-hue-rotate":new Et(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Ze.paint_raster["raster-saturation"]),"raster-contrast":new Et(Ze.paint_raster["raster-contrast"]),"raster-resampling":new Et(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Ze.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Et(Ze.paint_raster["raster-emissive-strength"]),"raster-array-band":new Et(Ze.paint_raster["raster-array-band"]),"raster-elevation":new Et(Ze.paint_raster["raster-elevation"])}))},s,u,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof AC&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,m]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(m)||u===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Dm({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,m])}}let MC,PC,IC,CC,OC;class kC extends Li{constructor(r,s,u,m){super(r,{layout:MC||(MC=new xn({visibility:new Et(Ze["layout_raster-particle"].visibility)})),paint:PC||(PC=new xn({"raster-particle-array-band":new Et(Ze["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Et(Ze["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Jo(Ze["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Et(Ze["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Et(Ze["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Et(Ze["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Et(Ze["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Et(Ze["paint_raster-particle"]["raster-particle-elevation"])}))},s,u,m),this._updateColorRamp(),this.lastInvalidatedAt=Ft.now()}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Dm({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ft.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class f6 extends Li{constructor(r,s){super(r,{},s,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function kw(c,r,s){const u=[0,0,1],m=Me.quat.identity([]);return Me.quat.rotateY(m,m,s?-Sr(c)+Math.PI:Sr(c)),Me.quat.rotateX(m,m,-Sr(r)),Me.vec3.transformQuat(u,u,m),Me.vec3.normalize(u,u)}function DC(c,r){const s=$v(c.projection,c.zoom,c.width,c.height),u=function(h,g,b,E,I){const v=new q(b.lng-180*Oc,b.lat),S=new q(b.lng+180*Oc,b.lat),P=h.project(v.lng,v.lat),A=h.project(S.lng,S.lat),M=-Math.atan2(A.y-P.y,A.x-P.x),k=Ve.fromLngLat(b);k.y=yr(k.y,-1+Oc,1-Oc);const R=k.toLngLat(),N=h.project(R.lng,R.lat),G=Ve.fromLngLat(R);G.x+=Oc;const W=G.toLngLat(),j=h.project(W.lng,W.lat),Z=RC(j.x-N.x,j.y-N.y,M),X=Ve.fromLngLat(R);X.y+=Oc;const ce=X.toLngLat(),pe=h.project(ce.lng,ce.lat),ge=RC(pe.x-N.x,pe.y-N.y,M),fe=Math.abs(Z.x)/Math.abs(ge.y),Te=Me.mat4.identity([]);Me.mat4.rotateZ(Te,Te,-M*(1-(I?0:E)));const _e=Me.mat4.identity([]);return Me.mat4.scale(_e,_e,[1,1-(1-fe)*E,1]),_e[4]=-ge.x/ge.y*E,Me.mat4.rotateZ(_e,_e,M),Me.mat4.multiply(_e,Te,_e),_e}(c.projection,0,c.center,s,r),m=LC(c);return Me.mat4.scale(u,u,[m,m,1]),u}function LC(c){const r=c.projection,s=$v(c.projection,c.zoom,c.width,c.height),u=Dw(r,c.center),m=Dw(r,q.convert(r.center));return Math.pow(2,u*s+(1-s)*m)}function $v(c,r,s,u,m=1/0){const h=c.range;if(!h)return 0;const g=Math.min(m,Math.max(s,u)),b=Math.log(g/1024)/Math.LN2;return Bl(h[0]+b,h[1]+b,r)}const Oc=1/4e4;function Dw(c,r){const s=yr(r.lat,-Se,Se),u=new q(r.lng-180*Oc,s),m=new q(r.lng+180*Oc,s),h=c.project(u.lng,s),g=c.project(m.lng,s),b=Ve.fromLngLat(u),E=Ve.fromLngLat(m),I=g.x-h.x,v=g.y-h.y,S=E.x-b.x,P=E.y-b.y,A=Math.sqrt((S*S+P*P)/(I*I+v*v));return Math.log(A)/Math.LN2}function RC(c,r,s){const u=Math.cos(s),m=Math.sin(s);return{x:c*u-r*m,y:c*m+r*u}}function zC(c,r,s){Me.mat4.identity(c),Me.mat4.rotateZ(c,c,Sr(r[2])),Me.mat4.rotateX(c,c,Sr(r[0])),Me.mat4.rotateY(c,c,Sr(r[1])),Me.mat4.scale(c,c,s),Me.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Uv(c,r,s,u,m,h,g,b){const E=[s[0]-r[0],s[1]-r[1],0],I=[u[0]-r[0],u[1]-r[1],0];if(Me.vec3.length(E)<1e-12||Me.vec3.length(I)<1e-12)return Me.quat.identity(c);const v=Me.vec3.cross([],E,I);Me.vec3.normalize(v,v),Me.vec3.subtract(I,u,r),E[2]=(h-m)*b,I[2]=(g-m)*b;const S=E;return Me.vec3.cross(S,E,I),Me.vec3.normalize(S,S),Me.quat.rotationTo(c,v,S)}function Lw(c,r,s=!1){const u=Ac(r.zoom),m=function(h,g,b){const E=g.worldSize,I=[h[12],h[13],h[14]],v=ve(I[1]/E),S=xe(I[0]/E),P=Me.mat4.identity([]),A=de(1,v)*E,M=de(1,0)*E*Be(v,g.zoom),k=1/Zb(E);let R=M*k;if(b){const j=$v(g.projection,g.zoom,g.width,g.height,1024);R=k*g.projection.pixelSpaceConversion(g.center.lat,E,j)}const N=B(v,S);Me.vec3.add(N,N,Me.vec3.scale([],Me.vec3.normalize([],N),A*R*I[2]));const G=function(j){const Z=[j[0],j[1],j[2]];let X=[0,1,0];const ce=Me.vec3.cross([],X,Z);return Me.vec3.cross(X,Z,ce),Me.vec3.squaredLength(X)===0&&(X=[0,1,0],Me.vec3.cross(ce,Z,X)),Me.vec3.normalize(ce,ce),Me.vec3.normalize(X,X),Me.vec3.normalize(Z,Z),[ce[0],ce[1],ce[2],0,X[0],X[1],X[2],0,Z[0],Z[1],Z[2],0,j[0],j[1],j[2],1]}(N);Me.mat4.scale(P,P,[R,R,R*A]),Me.mat4.translate(P,P,[-I[0],-I[1],-I[2]]);const W=Me.mat4.multiply([],g.globeMatrix,G);return Me.mat4.multiply(W,W,P),Me.mat4.multiply(W,W,h),W}(c,r,s);if(u>0){const h=function(g,b){const E=b.worldSize,I=de(1,0)*E*Be(b.center.lat,b.zoom)/Zb(E),v=de(1,b.center.lat)*E,S=Me.mat4.identity([]);return Me.mat4.rotateY(S,S,Sr(b.center.lng)),Me.mat4.rotateX(S,S,Sr(b.center.lat)),Me.mat4.translate(S,S,[0,0,n]),Me.mat4.scale(S,S,[I,I,I*v]),Me.mat4.translate(S,S,[b.point.x-.5*E,b.point.y-.5*E,0]),Me.mat4.multiply(S,S,g),Me.mat4.multiply(S,b.globeMatrix,S)}(c,r);return function(g,b,E){const I=(M,k,R)=>{const N=Me.vec3.length(M),G=Me.vec3.length(k),W=dl(M,k,R);return Me.vec3.scale(W,W,1/Me.vec3.length(W)*nr(N,G,R))},v=I([g[0],g[1],g[2]],[b[0],b[1],b[2]],E),S=I([g[4],g[5],g[6]],[b[4],b[5],b[6]],E),P=I([g[8],g[9],g[10]],[b[8],b[9],b[10]],E),A=dl([g[12],g[13],g[14]],[b[12],b[13],b[14]],E);return[v[0],v[1],v[2],0,S[0],S[1],S[2],0,P[0],P[1],P[2],0,A[0],A[1],A[2],1]}(m,h,u)}return m}function BC(c,r,s,u){const m=cn.projectAabbCorners(u,s);let h=Number.MAX_VALUE,g=-1;for(let I=0;I<m.length;++I){const v=m[I];v[0]=(.5*v[0]+.5)*r.width,v[1]=(.5-.5*v[1])*r.height,v[2]<h&&(g=I,h=v[2])}const b=I=>new _t(m[I][0],m[I][1]);let E;switch(g){case 0:case 6:E=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:E=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:E=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:E=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(Mt(c,E))return h}const d6=Fr([{name:"a_pos_3f",components:3,type:"Float32"}]),p6=Fr([{name:"a_color_3f",components:3,type:"Float32"}]),m6=Fr([{name:"a_color_4f",components:4,type:"Float32"}]),g6=Fr([{name:"a_uv_2f",components:2,type:"Float32"}]),y6=Fr([{name:"a_normal_3f",components:3,type:"Float32"}]),_6=Fr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),v6=Fr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),FC={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Vv{constructor(r,s,u,m){this.message=(r?`${r}: `:"")+u,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function NC(c,r){const s=c.indexOf("://")===-1;try{return new URL(c,s&&r?"http://example.com":void 0),!0}catch{return!1}}class jC{constructor(r,s){this.feature=r,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $C{constructor(){this.instancedDataArray=new Vu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Rw{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=r.projection,this.index=r.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(r,s){}populate(r,s,u,m){this.tileToMeter=ke(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:b,index:E,sourceLayerIndex:I}of r){const v=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),S=St(g,h);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),S,u))continue;const P={id:v,sourceLayerIndex:I,index:E,geometry:h?S.geometry:bt(g,u,m),properties:g.properties,type:g.type,patterns:{}},A=this.addFeature(P,P.geometry,S);A&&s.featureIndex.insert(g,P.geometry,E,I,this.index,this.instancesPerModel[A].instancedDataArray.length,Ct/32)}this.lookup=null}update(r,s,u,m){for(const h in this.instancesPerModel){const g=this.instancesPerModel[h];for(const b in r)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],r[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const m of u.features){const h=this.layers[0],g=m.feature,b=this.canonical,E=h.paint.get("model-rotation").evaluate(g,{},b),I=h.paint.get("model-scale").evaluate(g,{},b),v=h.paint.get("model-translation").evaluate(g,{},b);Me.vec3.exactEquals(m.rotation,E)&&Me.vec3.exactEquals(m.scale,I)&&Me.vec3.exactEquals(m.translation,v)||(this.evaluate(m,m.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,s,u,m){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(sw(this.activeReplacements,h))return!1;this.activeReplacements=h;let g=!1;for(const b in this.instancesPerModel){const E=this.instancesPerModel[b],I=E.instancedDataArray;for(const v of E.features){const S=v.instancedDataOffset,P=v.instancedDataCount;for(let A=0;A<P;A++){const M=16*(A+S);let k=I.float32[M+0];const R=k>Ct;k=R?k-Ct:k;const N=Math.floor(k),G=I.float32[M+1];let W=!1;for(const j of this.activeReplacements)if(!rI(j,u,FC.Model,m)&&!(j.min.x>N||N>j.max.x||j.min.y>G||G>j.max.y)&&(W=lI(sI(N,G,r.canonical,j.footprintTileId.canonical),j.footprint),W))break;I.float32[M]=W?k+Ct:k,g=g||W!==R}}}return g}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,_6.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris)for(const s of this.modelUris)r.removeModel(s,"")}addFeature(r,s,u){const m=this.layers[0],h=m.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return zr(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),h;NC(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new $C);const g=this.instancesPerModel[h],b=g.instancedDataArray,E=new jC(u,b.length);for(const I of s)for(const v of I){if(v.x<0||v.x>=Ct||v.y<0||v.y>=Ct)continue;const S=(this.lookupDim-1)/Ct,P=this.lookupDim*(v.y*S|0)+v.x*S|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const A=b.length;b.resize(A+1),g.instancesEvaluatedElevation.push(0),b.float32[16*A]=v.x,b.float32[16*A+1]=v.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(r.id&&(g.idToFeaturesIndex[r.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(r,s,u,m){const h=this.layers[0],g=r.feature,b=this.canonical,E=r.rotation=h.paint.get("model-rotation").evaluate(g,s,b),I=r.scale=h.paint.get("model-scale").evaluate(g,s,b),v=r.translation=h.paint.get("model-translation").evaluate(g,s,b),S=h.paint.get("model-color").evaluate(g,s,b);S.a=h.paint.get("model-color-mix-intensity").evaluate(g,s,b);const P=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),zC(P,E,I);const A=Math.round(100*S.a)+S.b/1.05;for(let M=0;M<r.instancedDataCount;++M){const k=r.instancedDataOffset+M,R=16*k,N=u.instancedDataArray.float32;let G=0;m&&(G=N[R+6]-u.instancesEvaluatedElevation[k]);const W=0|N[R+1];N[R]=(0|N[R])+S.r/1.05,N[R+1]=W+S.g/1.05,N[R+2]=A,N[R+3]=1/(b.z>10?this.tileToMeter:ke(b,W)),N[R+4]=v[0],N[R+5]=v[1],N[R+6]=v[2]+G,N[R+7]=P[0],N[R+8]=P[1],N[R+9]=P[2],N[R+10]=P[4],N[R+11]=P[5],N[R+12]=P[6],N[R+13]=P[8],N[R+14]=P[9],N[R+15]=P[10],u.instancesEvaluatedElevation[k]=v[2]}}}let UC,VC;$t(Rw,"ModelBucket",{omit:["layers"]}),$t($C,"PerModelAttributes"),$t(jC,"ModelFeature");const Yu=64,Gf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function GC(c,r,s,u,m,h,g,b,E,I=!1){const v=s.zoom,S=s.project(u),P=Be(u.lat,v),A=1/P;Me.mat4.identity(c),Me.mat4.translate(c,c,[S.x+g[0]*A,S.y+g[1]*A,g[2]]);let M=1,k=1;const R=s.worldSize;if(I){if(s.projection.name==="mercator"){let j=0;s.elevation&&(j=s.elevation.getAtPointOrZero(new Ve(S.x/R,S.y/R),0));const Z=Me.vec4.transformMat4([],[S.x,S.y,j,1],s.projMatrix)[3]/s.cameraToCenterDistance;M=Z,k=Z*Be(s.center.lat,v)}else if(s.projection.name==="globe"){const j=Lw(c,s),Z=Me.mat4.multiply([],s.projMatrix,j),X=[0,0,0,1];Me.vec4.transformMat4(X,X,Z);const ce=X[3]/s.cameraToCenterDistance,pe=Ac(v),ge=s.projection.pixelsPerMeter(u.lat,R)*Be(u.lat,v),fe=s.projection.pixelsPerMeter(s.center.lat,R)*Be(s.center.lat,v);M=ce/nr(ge,Ce(s.center.lat),pe),k=ce*P/ge,M*=fe,k*=fe}}else M=A;Me.mat4.scale(c,c,[M,M,k]);const N=[...c],G=r.orientation,W=[];if(zC(W,[G[0]+m[0],G[1]+m[1],G[2]+m[2]],h),Me.mat4.multiply(c,N,W),b&&s.elevation){let j=0;const Z=[];if(E&&s.elevation){j=function(pe,ge,fe,Te,_e){const Ee=ge.elevation;if(!Ee)return 0;const Re=cn.projectAabbCorners(fe,Te),Fe=de(1,_e.lat)*ge.worldSize,Ne=function(Jt,Dt){const jt=[0,0,1],ar=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const wr of ar){const mr=Jt[wr.corners[0]],gr=Jt[wr.corners[1]],Ar=Jt[wr.corners[2]],Er=[gr[0]-mr[0],gr[1]-mr[1],Dt*(gr[2]-mr[2])],nn=Me.vec3.cross(Er,Er,[Ar[0]-mr[0],Ar[1]-mr[1],Dt*(Ar[2]-mr[2])]);Me.vec3.normalize(nn,nn),wr.dotProductWithUp=Me.vec3.dot(nn,jt)}return ar.sort((wr,mr)=>wr.dotProductWithUp-mr.dotProductWithUp),ar[0].corners}(Re,Fe),je=Re[Ne[0]],Xe=Re[Ne[1]],Ue=Re[Ne[2]],it=Re[Ne[3]],dt=Ee.getAtPointOrZero(new Ve(je[0]/ge.worldSize,je[1]/ge.worldSize),0),Qe=Ee.getAtPointOrZero(new Ve(Xe[0]/ge.worldSize,Xe[1]/ge.worldSize),0),Rt=Ee.getAtPointOrZero(new Ve(Ue[0]/ge.worldSize,Ue[1]/ge.worldSize),0),Pt=Ee.getAtPointOrZero(new Ve(it[0]/ge.worldSize,it[1]/ge.worldSize),0),wt=(dt+Pt)/2,gt=(Qe+Rt)/2;return wt>gt?Qe<Rt?Uv(pe,Xe,it,je,Qe,Pt,dt,Fe):Uv(pe,Ue,je,it,Rt,dt,Pt,Fe):dt<Pt?Uv(pe,je,Xe,Ue,dt,Qe,Rt,Fe):Uv(pe,it,Ue,Xe,Pt,Rt,Qe,Fe),Math.max(wt,gt)}(Z,s,r.aabb,c,u);const X=Me.mat4.fromQuat([],Z),ce=Me.mat4.multiply([],X,W);Me.mat4.multiply(c,N,ce)}else j=s.elevation.getAtPointOrZero(new Ve(S.x/R,S.y/R),0);j!==0&&(c[14]+=j)}}function Qm(c,r,s=!1){c.uploaded||(c.gfxTexture=new Ow(r,c.image,s?r.gl.R8:r.gl.RGBA8,{useMipmap:c.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function x6(c,r,s){c.indexBuffer=r.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=r.createVertexBuffer(c.vertexArray,d6.members,!1,!0),c.normalArray&&(c.normalBuffer=r.createVertexBuffer(c.normalArray,y6.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=r.createVertexBuffer(c.texcoordArray,g6.members,!1,!0)),c.colorArray&&(c.colorBuffer=r.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?p6:m6).members,!1,!0)),c.featureArray&&(c.pbrBuffer=r.createVertexBuffer(c.featureArray,v6.members,!0)),c.segments=On.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&Qm(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Qm(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Qm(u.normalTexture,r),u.occlusionTexture&&Qm(u.occlusionTexture,r,s),u.emissionTexture&&Qm(u.emissionTexture,r)}function zw(c,r,s){if(c.meshes)for(const u of c.meshes)x6(u,r,s);if(c.children)for(const u of c.children)zw(u,r,s)}function Gv(c){if(c.meshes)for(const r of c.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(c.children)for(const r of c.children)Gv(r)}function Bw(c){if(c.meshes)for(const s of c.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((r=s.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(c.children)for(const s of c.children)Bw(s)}class qf{constructor(r,s,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(r,s,u){const m=u||r.findDEMTileFor(s);if(!m||!m.dem)return;const h=m.dem,g=m.tileID,b=1<<s.canonical.z-g.canonical.z;return new qf(m,h.dim/Ct/b,[(s.canonical.x/b-g.canonical.x)*h.dim,(s.canonical.y/b-g.canonical.y)*h.dim])}tileCoordToPixel(r,s){const u=s*this._scale+this._offset[1],m=Math.floor(r*this._scale+this._offset[0]),h=Math.floor(u);return new _t(m,h)}getElevationAt(r,s,u,m){const h=r*this._scale+this._offset[0],g=s*this._scale+this._offset[1],b=Math.floor(h),E=Math.floor(g),I=this._dem;return m=!!m,u?nr(nr(I.get(b,E,m),I.get(b,E+1,m),g-E),nr(I.get(b+1,E,m),I.get(b+1,E+1,m),g-E),h-b):I.get(b,E,m)}getElevationAtPixel(r,s,u){return this._dem.get(r,s,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*de(1,r)*this._dem.stride}}const Fw=new Float32Array(262144),Ku=new Uint8Array(262144);function qC(c){let r=0;if(c.meshes)for(const s of c.meshes)r=Math.max(r,s.aabb.max[2]);if(c.children)for(const s of c.children)r=Math.max(r,qC(s));return r}function WC(c,r,s){if(c.meshes)for(const u of c.meshes)u.aabb.min[0]!==1/0&&s.insert(r,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(c.children)for(const u of c.children)WC(u,r,s)}const HC=["","wall","door","roof","window","lamp","logo"];class ZC{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:qC(r)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new cn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const s=new cn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=cn.applyTransformFast(u.aabb,this.node.matrix),s.encapsulate(u.transformedAabb)),r++;this.aabb=s}return this.aabb}}class qv{constructor(r,s,u,m,h,g){this.id=s,this.modelTraits|=Gf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Gf.HasMapboxMeshFeatures),m&&(this.modelTraits|=Gf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of r)this.nodesInfo.push(new ZC(b)),WC(b,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}updateFootprints(r,s){for(const u of this.getNodesInfo()){const m=u.node;m.footprint&&s.push({footprint:m.footprint,id:r})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const m=u.node;this.uploaded?this.updatePbrBuffer(m):zw(m,r,!0)}for(const u of s)Gv(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let s=!1;if(!r.meshes)return s;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(r,s,u){const m=r.transform.projectionOptions,h=r.style.getBrightness(),g=this.brightness!==h;return!!(!this.uploaded||this.dirty||m.name!==this.projection.name||eg(u.paint.get("model-color").value,g)||eg(u.paint.get("model-color-mix-intensity").value,g)||eg(u.paint.get("model-roughness").value,g)||eg(u.paint.get("model-emissive-strength").value,g)||eg(u.paint.get("model-height-based-emissive-strength-multiplier").value,g))&&(this.projection=m,this.brightness=h,!0)}evaluateScale(r,s){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),m=this.id.canonical;for(const h of u){const g=h.feature;h.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},m)}}evaluate(r){const s=this.getNodesInfo();for(const u of s){if(!u.node.meshes)continue;const m=u.feature,h=u.node.meshes&&u.node.meshes[0].featureData,g=u.evaluatedColor[2],b=u.evaluatedRMEA[2],E=this.id.canonical;if(u.hasTranslucentParts=!1,h){for(let I=0;I<HC.length;I++){const v=HC[I];v.length&&(m.properties.part=v);const S=r.paint.get("model-color").evaluate(m,{},E).toRenderColor(null),P=r.paint.get("model-color-mix-intensity").evaluate(m,{},E);u.evaluatedColor[I]=[S.r,S.g,S.b,P],u.evaluatedRMEA[I][0]=r.paint.get("model-roughness").evaluate(m,{},E),u.evaluatedRMEA[I][2]=r.paint.get("model-emissive-strength").evaluate(m,{},E),u.evaluatedRMEA[I][3]=S.a,u.emissionHeightBasedParams[I]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,{},E),!u.hasTranslucentParts&&S.a<1&&(u.hasTranslucentParts=!0)}delete m.properties.part,w6(u,g!==u.evaluatedColor[2]||b!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(m,{},E);u.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},E),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,s,u,m){const h=r.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const g=qf.create(r,u,h);if(!g)return;this.modelTraits&Gf.HasMapboxMeshFeatures&&this.updateDEM(r,g,u,m);for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const I=E.footprint.vertices;let v=g.getElevationAt(I[0].x,I[0].y,!0,!0);for(let S=1;S<I.length;S++)v=Math.min(v,g.getElevationAt(I[S].x,I[S].y,!0,!0));E.elevation=v}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=s}}updateDEM(r,s,u,m){let h=s._dem._modifiedForSources[m];if(h===void 0&&(s._dem._modifiedForSources[m]=[],h=s._dem._modifiedForSources[m]),h.includes(u.canonical))return;const g=s._dem.dim;h.push(u.canonical);let b=!1;for(const E of this.getNodesInfo()){const I=E.node;if(!I.footprint||!I.footprint.grid)continue;const v=I.footprint.grid,S=s.tileCoordToPixel(v.min.x,v.min.y),P=s.tileCoordToPixel(v.max.x,v.max.y),A=Math.min(Math.min(g-P.y,S.x),Math.min(S.y,g-P.x));if(A<0)continue;const M=yr(A,2,5);let k=Math.max(0,S.x-M),R=Math.max(0,S.y-M),N=Math.min(P.x+M,g-1),G=Math.min(P.y+M,g-1);for(let X=R;X<=G;++X)for(let ce=k;ce<=N;++ce)Ku[X*g+ce]=255;let W=0,j=0;for(let X=0;X<v.cellsY;++X)for(let ce=0;ce<v.cellsX;++ce){if(!v.cells[X*v.cellsX+ce])continue;const pe=s.tileCoordToPixel(v.min.x+ce/v.xScale,v.min.y+X/v.yScale),ge=s.tileCoordToPixel(v.min.x+(ce+1)/v.xScale,v.min.y+(X+1)/v.yScale);for(let fe=pe.y;fe<=Math.min(ge.y+1,g-1);++fe)for(let Te=pe.x;Te<=Math.min(ge.x+1,g-1);++Te)Ku[fe*g+Te]===255&&(Ku[fe*g+Te]=0,W+=s.getElevationAtPixel(Te,fe),j++)}const Z=W/j;k=Math.max(1,S.x-M),R=Math.max(1,S.y-M),N=Math.min(P.x+M,g-2),G=Math.min(P.y+M,g-2),b=!0;for(let X=R;X<=G;++X)for(let ce=k;ce<=N;++ce)Ku[X*g+ce]===0&&(Fw[X*g+ce]=s._dem.set(ce,X,Z));for(let X=1;X<M;++X){k=Math.max(1,S.x-X),R=Math.max(1,S.y-X),N=Math.min(P.x+X,g-2),G=Math.min(P.y+X,g-2);for(let ce=R;ce<=G;++ce)for(let pe=k;pe<=N;++pe){const ge=ce*g+pe;if(Ku[ge]===255){let fe=0,Te=0,_e=-1,Ee=-1;for(let Re=-1;Re<=1;++Re)for(let Fe=-1;Fe<=1;++Fe){const Ne=(ce+Re)*g+pe+Fe;if(Ku[Ne]>=X)continue;const je=Fw[Ne],Xe=Math.abs(je);Xe>Te&&(fe=je,Te=Xe,_e=Fe,Ee=Re)}if(Te>.1){const Re=1-(X+.5*Math.abs(_e*Ee))/M;let Fe=s._dem.get(pe,ce)+fe*Re;const Ne=s._dem.get(pe+_e,ce+Ee),je=s._dem.get(pe-_e,ce-Ee,!0);(Fe-Ne)*(Fe-je)>0&&(Fe=(Ne+je)/2),Fw[ge]=s._dem.set(pe,ce,Fe),Ku[ge]=X}}}}}b&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Ft.now())}getNodesInfo(){return this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const s of r)Gv(s.node),Bw(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped()),m=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const g=m[h].node;m[h].hiddenByReplacement=!!g.footprint&&!u.find(b=>b.footprint===g.footprint)}}getHeightAtTileCoord(r,s){const u=this.getNodesInfo(),m=[],h=[0,0,0],g=Me.mat4.identity([]);for(let b=0;b<this.nodesInfo.length;b++){const E=u[b],I=E.node.meshes[0],v=I.transformedAabb;if(r<v.min[0]||s<v.min[1]||r>v.max[0]||s>v.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};Me.mat4.invert(g,E.node.matrix),h[0]=r,h[1]=s,Me.vec3.transformMat4(h,h,g);const S=(h[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*Yu|0,P=Math.min(63,(h[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*Yu|0)*Yu+Math.min(63,S),A=I.heightmap[P];if(!(A<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:A,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new _t(r,s),new _t(r,s),m),m.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function eg(c,r){return!c.isLightConstant&&r}function b6(c,r,s,u,m,h,g,b){let E=(61440&r|(61440&r)>>4)>>8,I=(3840&r|(3840&r)>>4)>>4,v=240&r|(240&r)>>4;s[3]>0&&(E=nr(E,255*s[0],s[3]),I=nr(I,255*s[1],s[3]),v=nr(v,255*s[2],s[3]));const S=E<<8|I,P=v<<8|Math.floor(255*u[3]),A=function(X){const ce=yr(X,0,2);return Math.min(Math.round(.5*ce*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],M=yr(m[0],0,1),k=yr(m[1],0,1),R=yr(m[2],0,1),N=yr(m[3],0,1);let G,W,j,Z;if(M!==k&&g!==h&&k!==M){const X=g-h;W=1/(X*(k-M)),j=-(h+X*M)/(X*(k-M));const ce=yr(m[4],-1,1);Z=Math.pow(10,ce),G=255*R<<8|255*N}else G=65535,W=0,j=1,Z=1;if(c.emplaceBack(S,P,A,G,W,j,Z),b){const X=b.length;b.clear();for(let ce=0;ce<X;ce++)b.emplaceBack(S,P,A,G,W,j,Z)}}function w6(c,r,s){const u=c.node;let m=0;const h=s&Gf.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===m||!g.featureData)continue;g.featureArray=new If,g.featureArray.reserve(g.featureData.length);let b=r;for(const E of g.featureData){const I=h?65535&E:E>>16&65535,v=h?E>>16&65535:65535&E,S=(15&v)<8?15&v:0,P=c.evaluatedRMEA[S],A=c.evaluatedColor[S],M=c.emissionHeightBasedParams[S];let k;if(b&&S===2&&u.lights&&(k=new If,k.resize(10*u.lights.length)),b6(g.featureArray,I,A,P,M,g.aabb.min[2],g.aabb.max[2],k),k&&b){b=!1;const R=u.meshes[u.lightMeshIndex];R.featureArray=k,R.featureArray._trim()}}g.featureArray._trim(),m++}}function XC(c,r,s,u){const m=1<<c.z;r.lat=ve((u/Ct+c.y)/m),r.lng=xe((s/Ct+c.x)/m)}$t(qv,"Tiled3dModelBucket",{omit:["layers"]}),$t(ZC,"Tiled3dModelFeature");const T6={circle:class extends Li{constructor(c,r,s,u){super(c,{layout:Gr||(Gr=new xn({"circle-sort-key":new Xt(Ze.layout_circle["circle-sort-key"]),visibility:new Et(Ze.layout_circle.visibility)})),paint:kn||(kn=new xn({"circle-radius":new Xt(Ze.paint_circle["circle-radius"]),"circle-color":new Xt(Ze.paint_circle["circle-color"]),"circle-blur":new Xt(Ze.paint_circle["circle-blur"]),"circle-opacity":new Xt(Ze.paint_circle["circle-opacity"]),"circle-translate":new Et(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(Ze.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Et(Ze.paint_circle["circle-emissive-strength"])}))},r,s,u)}createBucket(c){return new Kt(c)}queryRadius(c){const r=c;return bn("circle-radius",this,r)+bn("circle-stroke-width",this,r)+Jr(this.paint.get("circle-translate"))}queryIntersectsFeature(c,r,s,u,m,h,g,b){const E=Nr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return MP(c,u,h,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,r,s){const u=EP(this);return{config:new hl(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}},heatmap:class extends Li{createBucket(c){return new IP(c)}constructor(c,r,s,u){super(c,{layout:CP||(CP=new xn({visibility:new Et(Ze.layout_heatmap.visibility)})),paint:OP||(OP=new xn({"heatmap-radius":new Xt(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Jo(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Ze.paint_heatmap["heatmap-opacity"])}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return bn("heatmap-radius",this,c)}queryIntersectsFeature(c,r,s,u,m,h,g,b){const E=this.paint.get("heatmap-radius").evaluate(r,s);return MP(c,u,h,g,b,!0,!0,new _t(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,r,s){return c==="heatmap"?{config:new hl(this,{zoom:r,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Li{constructor(c,r,s,u){super(c,{layout:kP||(kP=new xn({visibility:new Et(Ze.layout_hillshade.visibility)})),paint:DP||(DP=new xn({"hillshade-illumination-direction":new Et(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Ze.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Et(Ze.paint_hillshade["hillshade-emissive-strength"])}))},r,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,r,s){return{overrideFog:!1}}},fill:class extends Li{constructor(c,r,s,u){super(c,{layout:$P||($P=new xn({"fill-sort-key":new Xt(Ze.layout_fill["fill-sort-key"]),visibility:new Et(Ze.layout_fill.visibility)})),paint:UP||(UP=new xn({"fill-antialias":new Et(Ze.paint_fill["fill-antialias"]),"fill-opacity":new Xt(Ze.paint_fill["fill-opacity"]),"fill-color":new Xt(Ze.paint_fill["fill-color"]),"fill-outline-color":new Xt(Ze.paint_fill["fill-outline-color"]),"fill-translate":new Et(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(Ze.paint_fill["fill-pattern"]),"fill-emissive-strength":new Et(Ze.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(Ze.paint_fill["fill-z-offset"])}))},r,s,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),r=c&&c.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(c,r,s){return{config:new hl(this,{zoom:r,lut:s}),overrideFog:!1}}recalculate(c,r){super.recalculate(c,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new tw(c)}queryRadius(){return Jr(this.paint.get("fill-translate"))}queryIntersectsFeature(c,r,s,u,m,h){return!c.queryGeometry.isAboveHorizon&&ir(br(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Li{constructor(c,r,s,u){super(c,{layout:TI||(TI=new xn({visibility:new Et(Ze["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Et(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:SI||(SI=new xn({"fill-extrusion-opacity":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(Ze["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Et(Ze["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new wv(c)}queryRadius(){return Jr(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,r,s,u,m,h,g,b,E){const I=Nr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(r,s),S=this.paint.get("fill-extrusion-base").evaluate(r,s),P=[0,0],A=b&&h.elevation,M=h.elevation?h.elevation.exaggeration():1,k=c.tile.getBucket(this);if(A&&k instanceof wv){const j=k.centroidVertexArray,Z=E+1;Z<j.length&&(P[0]=j.geta_centroid_pos0(Z),P[1]=j.geta_centroid_pos1(Z))}if(P[0]===0&&P[1]===1)return!1;h.projection.name==="globe"&&(u=wI([u],[new _t(0,0),new _t(Ct,Ct)],c.tileID.canonical).map(j=>j.polygon).flat());const R=A?b:null,[N,G]=function(j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re){return j.projection.name==="globe"?function(Fe,Ne,je,Xe,Ue,it,dt,Qe,Rt,Pt,wt){const gt=[],Jt=[],Dt=Fe.projection.upVectorScale(wt,Fe.center.lat,Fe.worldSize).metersToTile,jt=[0,0,0,1],ar=[0,0,0,1],wr=(gr,Ar,Er,nn)=>{gr[0]=Ar,gr[1]=Er,gr[2]=nn,gr[3]=1},mr=bI();je>0&&(je+=mr),Xe+=mr;for(const gr of Ne){const Ar=[],Er=[];for(const nn of gr){const qr=nn.x+Ue.x,lr=nn.y+Ue.y,jr=Fe.projection.projectTilePoint(qr,lr,wt),$r=Fe.projection.upVector(wt,nn.x,nn.y);let dn=je,Rn=Xe;if(dt){const Wn=EI(qr,lr,je,Xe,dt,Qe,Rt,Pt);dn+=Wn.base,Rn+=Wn.top}je!==0?wr(jt,jr.x+$r[0]*Dt*dn,jr.y+$r[1]*Dt*dn,jr.z+$r[2]*Dt*dn):wr(jt,jr.x,jr.y,jr.z),wr(ar,jr.x+$r[0]*Dt*Rn,jr.y+$r[1]*Dt*Rn,jr.z+$r[2]*Dt*Rn),Me.vec3.transformMat4(jt,jt,it),Me.vec3.transformMat4(ar,ar,it),Ar.push(new Xu(jt[0],jt[1],jt[2])),Er.push(new Xu(ar[0],ar[1],ar[2]))}gt.push(Ar),Jt.push(Er)}return[gt,Jt]}(j,Z,X,ce,pe,ge,fe,Te,_e,Ee,Re):fe?function(Fe,Ne,je,Xe,Ue,it,dt,Qe,Rt){const Pt=[],wt=[],gt=[0,0,0,1];for(const Jt of Fe){const Dt=[],jt=[];for(const ar of Jt){const wr=ar.x+Xe.x,mr=ar.y+Xe.y,gr=EI(wr,mr,Ne,je,it,dt,Qe,Rt);gt[0]=wr,gt[1]=mr,gt[2]=gr.base,gt[3]=1,Me.vec4.transformMat4(gt,gt,Ue),gt[3]=Math.max(gt[3],1e-5);const Ar=new Xu(gt[0]/gt[3],gt[1]/gt[3],gt[2]/gt[3]);gt[0]=wr,gt[1]=mr,gt[2]=gr.top,gt[3]=1,Me.vec4.transformMat4(gt,gt,Ue),gt[3]=Math.max(gt[3],1e-5);const Er=new Xu(gt[0]/gt[3],gt[1]/gt[3],gt[2]/gt[3]);Dt.push(Ar),jt.push(Er)}Pt.push(Dt),wt.push(jt)}return[Pt,wt]}(Z,X,ce,pe,ge,fe,Te,_e,Ee):function(Fe,Ne,je,Xe,Ue){const it=[],dt=[],Qe=Ue[8]*Ne,Rt=Ue[9]*Ne,Pt=Ue[10]*Ne,wt=Ue[11]*Ne,gt=Ue[8]*je,Jt=Ue[9]*je,Dt=Ue[10]*je,jt=Ue[11]*je;for(const ar of Fe){const wr=[],mr=[];for(const gr of ar){const Ar=gr.x+Xe.x,Er=gr.y+Xe.y,nn=Ue[0]*Ar+Ue[4]*Er+Ue[12],qr=Ue[1]*Ar+Ue[5]*Er+Ue[13],lr=Ue[2]*Ar+Ue[6]*Er+Ue[14],jr=Ue[3]*Ar+Ue[7]*Er+Ue[15],$r=nn+Qe,dn=qr+Rt,Rn=lr+Pt,Wn=Math.max(jr+wt,1e-5),zn=nn+gt,Mn=qr+Jt,mi=lr+Dt,Jn=Math.max(jr+jt,1e-5);wr.push(new Xu($r/Wn,dn/Wn,Rn/Wn)),mr.push(new Xu(zn/Jn,Mn/Jn,mi/Jn))}it.push(wr),dt.push(mr)}return[it,dt]}(Z,X,ce,pe,ge)}(h,u,S,v,I,g,R,P,M,h.center.lat,c.tileID.canonical),W=c.queryGeometry;return function(j,Z,X){let ce=1/0;ir(X,Z)&&(ce=AI(X,Z[0]));for(let pe=0;pe<Z.length;pe++){const ge=Z[pe],fe=j[pe];for(let Te=0;Te<ge.length-1;Te++){const _e=ge[Te],Ee=[_e,ge[Te+1],fe[Te+1],fe[Te],_e];Mt(X,Ee)&&(ce=Math.min(ce,AI(X,Ee)))}}return ce!==1/0&&ce}(N,G,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Li{constructor(c,r,s,u){const m=zI();super(c,m,r,s,u),m.layout&&(this.layout=new pc(m.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Mu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,r){super.recalculate(c,r),this.paint._values["line-floorwidth"]=(()=>{if(Um)return Um;const s=zI();return Um=new E2(s.paint.properties["line-width"].specification),Um.useIntegerZoom=!0,Um})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new hw(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,r,s){const u=LI(this);return{config:new hl(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}queryRadius(c){const r=c,s=BI(bn("line-width",this,r),bn("line-gap-width",this,r)),u=bn("line-offset",this,r);return s/2+Math.abs(u)+Jr(this.paint.get("line-translate"))}queryIntersectsFeature(c,r,s,u,m,h){if(c.queryGeometry.isAboveHorizon)return!1;const g=br(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),b=c.pixelToTileUnitsFactor/2*BI(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),E=this.paint.get("line-offset").evaluate(r,s);return E&&(u=function(I,v){const S=[],P=new _t(0,0);for(let A=0;A<I.length;A++){const M=I[A],k=[];for(let R=0;R<M.length;R++){const N=M[R],G=M[R+1],W=R===0?P:N.sub(M[R-1])._unit()._perp(),j=R===M.length-1?P:G.sub(N)._unit()._perp(),Z=W._add(j)._unit();Z._mult(1/(Z.x*j.x+Z.y*j.y)),k.push(Z._mult(v)._add(N))}S.push(k)}return S}(u,E*c.pixelToTileUnitsFactor)),function(I,v,S){for(let P=0;P<v.length;P++){const A=v[P];if(I.length>=3){for(let M=0;M<A.length;M++)if(fn(I,A[M]))return!0}if(Gt(I,A,S))return!0}return!1}(g,u,b)}isTileClipped(){return!0}isDraped(c){const r=this.layout.get("line-z-offset");return r.isConstant()&&!r.constantOr(0)}},symbol:Bv,background:class extends Li{constructor(c,r,s,u){super(c,{layout:xC||(xC=new xn({visibility:new Et(Ze.layout_background.visibility)})),paint:bC||(bC=new xn({"background-pitch-alignment":new Et(Ze.paint_background["background-pitch-alignment"]),"background-color":new Et(Ze.paint_background["background-color"]),"background-pattern":new Et(Ze.paint_background["background-pattern"]),"background-opacity":new Et(Ze.paint_background["background-opacity"]),"background-emissive-strength":new Et(Ze.paint_background["background-emissive-strength"])}))},r,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,r,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:EC,"raster-particle":kC,sky:class extends Li{constructor(c,r,s,u){super(c,{layout:IC||(IC=new xn({visibility:new Et(Ze.layout_sky.visibility)})),paint:CC||(CC=new xn({"sky-type":new Et(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new Et(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Et(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Et(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Et(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new Jo(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Et(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Et(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Et(Ze.paint_sky["sky-opacity"])}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(c,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),m=!u,h=c.style.light,g=h.properties.get("position");return m&&h.properties.get("anchor")==="viewport"&&zr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?kw(g.azimuthal,90-g.polar,r):kw(u[0],90-u[1],r)}const s=this.paint.get("sky-gradient-center");return kw(s[0],90-s[1],r)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Li{constructor(c,r,s,u){super(c,{paint:OC||(OC=new xn({}))},r,null)}},model:class extends Li{constructor(c,r,s,u){super(c,{layout:UC||(UC=new xn({visibility:new Et(Ze.layout_model.visibility),"model-id":new Xt(Ze.layout_model["model-id"])})),paint:VC||(VC=new xn({"model-opacity":new Et(Ze.paint_model["model-opacity"]),"model-rotation":new Xt(Ze.paint_model["model-rotation"]),"model-scale":new Xt(Ze.paint_model["model-scale"]),"model-translation":new Xt(Ze.paint_model["model-translation"]),"model-color":new Xt(Ze.paint_model["model-color"]),"model-color-mix-intensity":new Xt(Ze.paint_model["model-color-mix-intensity"]),"model-type":new Et(Ze.paint_model["model-type"]),"model-cast-shadows":new Et(Ze.paint_model["model-cast-shadows"]),"model-receive-shadows":new Et(Ze.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Et(Ze.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(Ze.paint_model["model-emissive-strength"]),"model-roughness":new Xt(Ze.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(Ze.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Et(Ze.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Et(Ze.paint_model["model-front-cutoff"])}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Rw(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof qv?Ct-1:0}queryIntersectsFeature(c,r,s,u,m,h){if(!this.modelManager)return!1;const g=this.modelManager,b=c.tile.getBucket(this);if(!(b&&b instanceof Rw))return!1;const E=b;for(const I in E.instancesPerModel){const v=E.instancesPerModel[I],S=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(v.idToFeaturesIndex.hasOwnProperty(S)){const P=v.features[v.idToFeaturesIndex[S]],A=g.getModel(I,this.scope);if(!A)return!1;let M=Me.mat4.create();const k=new q(0,0),R=E.canonical;let N=Number.MAX_VALUE;for(let G=0;G<P.instancedDataCount;++G){const W=16*(P.instancedDataOffset+G),j=v.instancedDataArray.float32,Z=[j[W+4],j[W+5],j[W+6]];XC(R,k,j[W],0|j[W+1]),GC(M,A,h,k,P.rotation,P.scale,Z,!1,!1,!1),h.projection.name==="globe"&&(M=Lw(M,h));const X=Me.mat4.multiply([],h.projMatrix,M),ce=c.queryGeometry,pe=BC(ce.isPointQuery()?ce.screenBounds:ce.screenGeometry,h,X,A.aabb);pe!=null&&(N=Math.min(pe,N))}return N!==Number.MAX_VALUE&&N}}return!1}_handleOverridablePaintPropertyUpdate(c,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const r=this._transitionablePaint._values[c];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof _a}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(c,r,s,u){const m=c.tile,h=m.getBucket(this);let g=null,b=Number.MAX_VALUE;if(!(h&&h instanceof qv))return{queryFeature:g,intersectionZ:b};const E=h.getNodesInfo()[r];if(E.hiddenByReplacement||!E.node.meshes||!s.filter(new Cn(m.tileID.overscaledZ),E.feature,m.tileID.canonical))return{queryFeature:g,intersectionZ:b};const I=E.node,v=u.calculatePosMatrix(m.tileID.toUnwrapped(),u.worldSize),S=E.evaluatedScale;let P=0;u.elevation&&I.elevation&&(P=I.elevation*u.elevation.exaggeration()),Me.mat4.translate(v,v,[(I.anchor?I.anchor[0]:0)*(S[0]-1),(I.anchor?I.anchor[1]:0)*(S[1]-1),P]),Me.mat4.scale(v,v,S),Me.mat4.multiply(v,v,I.matrix);const A=c.queryGeometry,M=A.isPointQuery()?A.screenBounds:A.screenGeometry,k=function(N){const G=Me.mat4.multiply([],v,N.matrix),W=Me.mat4.multiply(G,u.expandedFarZProjMatrix,G);for(let j=0;j<N.meshes.length;++j){const Z=N.meshes[j];if(j===N.lightMeshIndex)continue;const X=BC(M,u,W,Z.aabb);X!=null&&(b=Math.min(X,b))}if(N.children)for(const j of N.children)k(j)};if(k(I),b===Number.MAX_VALUE)return{queryFeature:g,intersectionZ:b};const R=new q(0,0);return XC(m.tileID.canonical,R,E.node.anchor[0],E.node.anchor[1]),g={type:"Feature",geometry:{type:"Point",coordinates:[R.lng,R.lat]},properties:E.feature.properties,id:E.feature.id,state:{},layer:this.serialize()},{queryFeature:g,intersectionZ:b}}},clip:class extends Li{constructor(c,r,s,u){super(c,{layout:VP||(VP=new xn({"clip-layer-types":new Et(Ze.layout_clip["clip-layer-types"]),"clip-layer-scope":new Et(Ze.layout_clip["clip-layer-scope"])})),paint:GP||(GP=new xn({}))},r,s,u)}recalculate(c,r){super.recalculate(c,r)}createBucket(c){return new qP(c)}isTileClipped(){return!0}is3D(){return!0}}};class S6{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class A6{constructor(){this.tasks={},this.taskQueue=[],Fl(["process"],this),this.invoker=new S6(this.process),this.nextId=0}add(r,s){const u=this.nextId++,m=function({type:h,isSymbolTile:g,zoom:b}){return b=b||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-b:h==="maybePrepare"&&g?400-b:500:200-b:100-b}(s);if(m===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:s,priority:m,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let m=0;m<this.taskQueue.length;m++){const h=this.tasks[this.taskQueue[m]];h.priority<s&&(s=h.priority,r=m)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class YC{constructor(r,s,u){this.target=r,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Fl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new A6}send(r,s,u,m,h=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[b]=u);const E=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:m,mustQueue:h,sourceMapId:this.mapId,data:no(s,E)},E),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(r){const s=r.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const m=this.cancelCallbacks[u];delete this.cancelCallbacks[u],m&&m.cancel()}else if(s.mustQueue||Ks()){const m=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,s),m&&m.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,s)}processTask(r,s){if(delete this.cancelCallbacks[r],s.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(s.error?u(al(s.error)):u(null,al(s.data)))}else{const u=new Set,m=s.hasCallback?(g,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:g?no(g):null,data:no(b,u)},u)}:g=>{},h=al(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,h,m);else if(this.parent.getWorkerSource){const g=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,g[0],h.source,h.scope)[g[1]](h,m)}else m(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Wf{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=uu();const u=this.workerPool.acquire(this.id);for(let m=0;m<u.length;m++){const h=new Wf.Actor(u[m],s,this.id);h.name=`Worker ${m}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,u){Xs(this.actors,(m,h)=>{m.send(r,s,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}Wf.Actor=YC;class KC{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const u=this.toIdx(r,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function JC(c,r,s,u){let m=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<c[g]||s[g]>r[g])return null}else{const b=1/u[g];let E=(c[g]-s[g])*b,I=(r[g]-s[g])*b;if(E>I){const v=E;E=I,I=v}if(E>m&&(m=E),I<h&&(h=I),m>h)return null}return m}function QC(c,r,s,u,m,h,g,b,E,I,v){const S=u-c,P=m-r,A=h-s,M=g-c,k=b-r,R=E-s,N=v[1]*R-v[2]*k,G=v[2]*M-v[0]*R,W=v[0]*k-v[1]*M,j=S*N+P*G+A*W;if(Math.abs(j)<1e-15)return null;const Z=1/j,X=I[0]-c,ce=I[1]-r,pe=I[2]-s,ge=(X*N+ce*G+pe*W)*Z;if(ge<0||ge>1)return null;const fe=ce*A-pe*P,Te=pe*S-X*A,_e=X*P-ce*S,Ee=(v[0]*fe+v[1]*Te+v[2]*_e)*Z;return Ee<0||ge+Ee>1?null:(M*fe+k*Te+R*_e)*Z}function eO(c,r,s){return(c-r)/(s-r)}function tO(c,r,s,u,m,h,g,b,E){const I=1<<s,v=h-u,S=g-m,P=(c+1)/I*v+u,A=(r+0)/I*S+m,M=(r+1)/I*S+m;b[0]=(c+0)/I*v+u,b[1]=A,E[0]=P,E[1]=M}class rO{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(h){const g=Math.ceil(Math.log2(h.dim/8)),b=[];let E=Math.ceil(Math.pow(2,g));const I=1/E,v=(A,M,k,R,N)=>{const G=R?1:0,W=(A+1)*k-G,j=M*k,Z=(M+1)*k-G;N[0]=A*k,N[1]=j,N[2]=W,N[3]=Z};let S=new KC(E);const P=[];for(let A=0;A<E*E;A++){v(A%E,Math.floor(A/E),I,!1,P);const M=kc(P[0],P[1],h),k=kc(P[2],P[1],h),R=kc(P[2],P[3],h),N=kc(P[0],P[3],h);S.minimums.push(Math.min(M,k,R,N)),S.maximums.push(Math.max(M,k,R,N)),S.leaves.push(1)}for(b.push(S),E/=2;E>=1;E/=2){const A=b[b.length-1];S=new KC(E);for(let M=0;M<E*E;M++){v(M%E,Math.floor(M/E),2,!0,P);const k=A.getElevation(P[0],P[1]),R=A.getElevation(P[2],P[1]),N=A.getElevation(P[2],P[3]),G=A.getElevation(P[0],P[3]),W=A.isLeaf(P[0],P[1]),j=A.isLeaf(P[2],P[1]),Z=A.isLeaf(P[2],P[3]),X=A.isLeaf(P[0],P[3]),ce=Math.min(k.min,R.min,N.min,G.min),pe=Math.max(k.max,R.max,N.max,G.max),ge=W&&j&&Z&&X;S.maximums.push(pe),S.minimums.push(ce),S.leaves.push(pe-ce<=5&&ge?1:0)}b.push(S)}return b}(this.dem),u=s.length-1,m=s[u];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(r,s,u,m,h,g,b=1){return JC([r,s,-100],[u,m,this.maximums[0]*b],h,g)}raycast(r,s,u,m,h,g,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,s,u,m,h,g,b);if(E==null)return null;const I=[],v=[],S=[],P=[],A=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:M,t:k,nodex:R,nodey:N,depth:G}=A.pop();if(this.leaves[M]){tO(R,N,G,r,s,u,m,S,P);const j=1<<G,Z=(R+0)/j,X=(R+1)/j,ce=(N+0)/j,pe=(N+1)/j,ge=kc(Z,ce,this.dem)*b,fe=kc(X,ce,this.dem)*b,Te=kc(X,pe,this.dem)*b,_e=kc(Z,pe,this.dem)*b,Ee=QC(S[0],S[1],ge,P[0],S[1],fe,P[0],P[1],Te,h,g),Re=QC(P[0],P[1],Te,S[0],P[1],_e,S[0],S[1],ge,h,g),Fe=Math.min(Ee!==null?Ee:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(Fe!==Number.MAX_VALUE)return Fe;{const Ne=Me.vec3.scaleAndAdd([],h,g,k);if(nO(ge,fe,_e,Te,eO(Ne[0],S[0],P[0]),eO(Ne[1],S[1],P[1]))>=Ne[2])return k}continue}let W=0;for(let j=0;j<this._siblingOffset.length;j++){tO((R<<1)+this._siblingOffset[j][0],(N<<1)+this._siblingOffset[j][1],G+1,r,s,u,m,S,P),S[2]=-100,P[2]=this.maximums[this.childOffsets[M]+j]*b;const Z=JC(S,P,h,g);if(Z!=null){const X=Z;I[j]=X;let ce=!1;for(let pe=0;pe<W&&!ce;pe++)X>=I[v[pe]]&&(v.splice(pe,0,j),ce=!0);ce||(v[W]=j),W++}}for(let j=0;j<W;j++){const Z=v[j];A.push({idx:this.childOffsets[M]+Z,t:I[Z],nodex:(R<<1)+this._siblingOffset[Z][0],nodey:(N<<1)+this._siblingOffset[Z][1],depth:G+1})}}return null}_addNode(r,s,u){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,u,m,h){if(r[m].isLeaf(s,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const g=m-1,b=r[g];let E=0,I=0;for(let v=0;v<this._siblingOffset.length;v++){const S=2*s+this._siblingOffset[v][0],P=2*u+this._siblingOffset[v][1],A=b.getElevation(S,P),M=b.isLeaf(S,P),k=this._addNode(A.min,A.max,M);M&&(E|=1<<v),I||(I=k)}for(let v=0;v<this._siblingOffset.length;v++)E&1<<v||this._construct(r,2*s+this._siblingOffset[v][0],2*u+this._siblingOffset[v][1],g,I+v)}}function nO(c,r,s,u,m,h){return nr(nr(c,s,h),nr(r,u,h),m)}function kc(c,r,s){const u=s.dim,m=yr(c*u-.5,0,u-1),h=yr(r*u-.5,0,u-1),g=Math.floor(m),b=Math.floor(h),E=Math.min(g+1,u-1),I=Math.min(b+1,u-1);return nO(s.get(g,b),s.get(E,b),s.get(g,I),s.get(E,I),m-g,h-b)}const E6={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function M6(c,r,s){return(256*c*256+256*r+s)/10-1e4}function P6(c,r,s){return 256*c+r+s/256-32768}class Wv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,u,m=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void zr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const h=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let E=0;E<h;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(h,E)]=g[this._idx(h-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,h)]=g[this._idx(E,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}const b=u==="terrarium"?P6:M6;for(let E=0;E<g.length;++E){const I=4*E;this.floatView[E]=b(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Ft.now()}_buildQuadTree(){this._tree=new rO(this)}get(r,s,u=!1){u&&(r=yr(r,-1,this.dim),s=yr(s,-1,this.dim));const m=this._idx(r,s);return this.floatView[m]}set(r,s,u){const m=this._idx(r,s),h=this.floatView[m];return this.floatView[m]=u,u-h}static getUnpackVector(r){return E6[r]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}static pack(r,s){const u=[0,0,0,0],m=Wv.getUnpackVector(s);let h=Math.floor((r+m[3])/m[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new zP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,h=s*this.dim+this.dim,g=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:m=h-1;break;case 1:h=m+1}switch(u){case-1:g=b-1;break;case 1:b=g+1}const E=-s*this.dim,I=-u*this.dim;for(let v=g;v<b;v++)for(let S=m;S<h;S++){const P=4*this._idx(S,v),A=4*this._idx(S+E,v+I);this.pixels[P+0]=r.pixels[A+0],this.pixels[P+1]=r.pixels[A+1],this.pixels[P+2]=r.pixels[A+2],this.pixels[P+3]=r.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function I6(c,r,s){c===1?r.header_length=s.readFixed32():c===2?r.x=s.readVarint():c===3?r.y=s.readVarint():c===4?r.z=s.readVarint():c===5&&r.layers.push(function(u,m){return u.readFields(L6,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},m)}(s,s.readVarint()+s.pos))}function C6(c,r,s){c===1?(r.delta_filter=function(u,m){return u.readFields(O6,{block_size:0},m)}(s,s.readVarint()+s.pos),r.filter="delta_filter"):c===2?(s.readVarint(),r.filter="zigzag_filter"):c===3?(s.readVarint(),r.filter="bitshuffle_filter"):c===4&&(s.readVarint(),r.filter="byteshuffle_filter")}function O6(c,r,s){c===1&&(r.block_size=s.readVarint())}function k6(c,r,s){c===1?(s.readVarint(),r.codec="gzip_data"):c===2?(s.readVarint(),r.codec="jpeg_image"):c===3?(s.readVarint(),r.codec="webp_image"):c===4&&(s.readVarint(),r.codec="png_image")}function D6(c,r,s){c===1?r.first_byte=s.readFixed64():c===2?r.last_byte=s.readFixed64():c===3?r.filters.push(function(u,m){return u.readFields(C6,{},m)}(s,s.readVarint()+s.pos)):c===4?r.codec=function(u,m){return u.readFields(k6,{},m)}(s,s.readVarint()+s.pos):c===5?r.deprecated_offset=s.readFloat():c===6?r.deprecated_scale=s.readFloat():c===7?r.bands.push(s.readString()):c===8?r.offset=s.readDouble():c===9&&(r.scale=s.readDouble())}function L6(c,r,s){c===1?r.version=s.readVarint():c===2?r.name=s.readString():c===3?r.units=s.readString():c===4?r.tilesize=s.readVarint():c===5?r.buffer=s.readVarint():c===6?r.pixel_format=s.readVarint():c===7&&r.data_index.push(function(u,m){return u.readFields(D6,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},m)}(s,s.readVarint()+s.pos))}function R6(c,r,s){if(c===2)(function(u,m,h){u.readFields(z6,h,m)})(s,s.readVarint()+s.pos,r);else if(c===3)throw new Error("Not implemented")}function z6(c,r,s){if(c===1){let u=0;const m=s.readVarint()+s.pos;for(;s.pos<m;)r[u++]=s.readVarint()}}$t(Wv,"DEMData"),$t(rO,"DemMinMaxQuadTree",{omit:["dem"]});class B6{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const s=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,s),s}put(r,s){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,s)}}function F6(c,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let s=r[3];for(let u=2;u>=1;u--){const m=u===1?1:0,h=u===2?1:0;for(let g=0;g<r[0];g++){const b=r[1]*g;for(let E=m;E<r[1];E++){const I=r[2]*(E+b);for(let v=h;v<r[2];v++){const S=r[3]*(v+I);for(let P=0;P<r[3];P++){const A=S+P;c[A]+=c[A-s]}}}}s*=r[u]}return c}function N6(c){for(let r=0,s=c.length;r<s;r++)c[r]=c[r]>>>1^-(1&c[r]);return c}function j6(c,r){switch(r){case"uint32":return c;case"uint16":for(let s=0;s<c.length;s+=2){const u=c[s],m=c[s+1];c[s]=(240&u)>>4|(61440&u)>>8|(240&m)<<4|61440&m,c[s+1]=15&u|(3840&u)>>4|(15&m)<<8|(3840&m)<<4}return c;case"uint8":for(let s=0;s<c.length;s+=4){const u=c[s],m=c[s+1],h=c[s+2],g=c[s+3];c[s+0]=(192&u)>>6|(192&m)>>4|(192&h)>>2|192&g,c[s+1]=(48&u)>>4|(48&m)>>2|48&h|(48&g)<<2,c[s+2]=(12&u)>>2|12&m|(12&h)<<2|(12&g)<<4,c[s+3]=3&u|(3&m)<<2|(3&h)<<4|(3&g)<<6}return c;default:throw new Error(`Invalid pixel format, "${r}"`)}}var ra=Uint8Array,tg=Uint16Array,$6=Int32Array,iO=new ra([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oO=new ra([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),U6=new ra([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),aO=function(c,r){for(var s=new tg(31),u=0;u<31;++u)s[u]=r+=1<<c[u-1];var m=new $6(s[30]);for(u=1;u<30;++u)for(var h=s[u];h<s[u+1];++h)m[h]=h-s[u]<<5|u;return{b:s,r:m}},sO=aO(iO,2),lO=sO.b,V6=sO.r;lO[28]=258,V6[258]=28;for(var G6=aO(oO,0).b,cO=new tg(32768),qn=0;qn<32768;++qn){var Hf=(43690&qn)>>1|(21845&qn)<<1;cO[qn]=((65280&(Hf=(61680&(Hf=(52428&Hf)>>2|(13107&Hf)<<2))>>4|(3855&Hf)<<4))>>8|(255&Hf)<<8)>>1}var rg=function(c,r,s){for(var u=c.length,m=0,h=new tg(r);m<u;++m)c[m]&&++h[c[m]-1];var g,b=new tg(r);for(m=1;m<r;++m)b[m]=b[m-1]+h[m-1]<<1;g=new tg(1<<r);var E=15-r;for(m=0;m<u;++m)if(c[m])for(var I=m<<4|c[m],v=r-c[m],S=b[c[m]-1]++<<v,P=S|(1<<v)-1;S<=P;++S)g[cO[S]>>E]=I;return g},ng=new ra(288);for(qn=0;qn<144;++qn)ng[qn]=8;for(qn=144;qn<256;++qn)ng[qn]=9;for(qn=256;qn<280;++qn)ng[qn]=7;for(qn=280;qn<288;++qn)ng[qn]=8;var uO=new ra(32);for(qn=0;qn<32;++qn)uO[qn]=5;var q6=rg(ng,9),W6=rg(uO,5),Nw=function(c){for(var r=c[0],s=1;s<c.length;++s)c[s]>r&&(r=c[s]);return r},ts=function(c,r,s){var u=r/8|0;return(c[u]|c[u+1]<<8)>>(7&r)&s},jw=function(c,r){var s=r/8|0;return(c[s]|c[s+1]<<8|c[s+2]<<16)>>(7&r)},H6=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rs=function(c,r,s){var u=new Error(r||H6[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,rs),!s)throw u;return u},Z6=new ra(0),X6=typeof TextDecoder<"u"&&new TextDecoder;try{X6.decode(Z6,{stream:!0})}catch{}const Y6={gzip_data:"gzip"};class Ta extends Error{constructor(r){super(r),this.name="MRTError"}}const K6={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},hO={uint32:1,uint16:2,uint8:4},J6={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let $w;class Uw{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const s=this.layers[r];if(!s)throw new Ta(`Layer '${r}' not found`);return s}getHeaderLength(r){const s=new Uint8Array(r),u=new DataView(r);if(s[0]!==13)throw new Ta("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const s=new Uint8Array(r),u=this.getHeaderLength(r);if(s.length<u)throw new Ta(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const m=function(h,g){return h.readFields(I6,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new $w(s.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Ta(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const h of m.layers)this.layers[h.name]=new Q6(h,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const s=[],u=this.getLayer(r.layerName);for(let m of r.blockIndices){const h=u.dataIndex[m],g=h.first_byte-r.firstByte,b=h.last_byte-r.firstByte;if(u._blocksInProgress.has(m))continue;const E={layerName:u.name,firstByte:g,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:m,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(I=>I.filter)};u._blocksInProgress.add(m),s.push(E)}return new fO(s,()=>{s.forEach(m=>u._blocksInProgress.delete(m.blockIndex))},(m,h)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),m)throw m;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class Q6{constructor({version:r,name:s,units:u,tilesize:m,pixel_format:h,buffer:g,data_index:b},E){if(this.version=r,this.version!==1)throw new Ta(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=s,this.units=u,this.tileSize=m,this.buffer=g,this.pixelFormat=K6[h],this.dataIndex=b,this.bandShape=[m+2*g,m+2*g,hO[this.pixelFormat]],this._decodedBlocks=new B6(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return hO[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const s=r.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,r.data)}getBlockForBand(r){let s=0;switch(typeof r){case"string":for(const[u,m]of this.dataIndex.entries()){for(const[h,g]of m.bands.entries())if(g===r)return{bandIndex:s+h,blockIndex:u,blockBandIndex:h};s+=m.bands.length}break;case"number":for(const[u,m]of this.dataIndex.entries()){if(r>=s&&r<s+m.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-s};s+=m.bands.length}break;default:throw new Ta(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}throw new Ta(`Band not found: ${JSON.stringify(r)}`)}getDataRange(r){let s=1/0,u=-1/0;const m=[],h=new Set;for(const g of r){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new Ta(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[b];m.includes(b)||m.push(b),h.add(b),s=Math.min(s,E.first_byte),u=Math.max(u,E.last_byte)}if(h.size>this.cacheSize)throw new Ta(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:m}}hasBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0}hasDataForBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(r){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(r),m=this._decodedBlocks.get(s.toString());if(!m)throw new Ta(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[s],g=this.bandShape.reduce((I,v)=>I*v,1),b=u*g,E=m.subarray(b,b+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset!==0?h.offset:h.deprecated_offset,scale:h.scale!==0?h.scale:h.deprecated_scale}}}Uw.setPbf=function(c){$w=c};class fO{constructor(r,s,u){this.tasks=r,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,s){this._finalized||(this._onComplete(r,s),this._finalized=!0)}}Uw.performDecoding=function(c,r){const s=new Uint8Array(c);return Promise.all(r.tasks.map(u=>{const{layerName:m,firstByte:h,lastByte:g,pixelFormat:b,blockShape:E,blockIndex:I,filters:v,codec:S}=u,P=s.subarray(h,g+1),A=new Uint32Array(E[0]*E[1]*E[2]);let M;if(S!=="gzip_data")throw new Ta(`Unhandled codec: ${S}`);return M=function(k,R){if(!globalThis.DecompressionStream&&R==="gzip_data")return Promise.resolve(((j=function(ce){ce[0]==31&&ce[1]==139&&ce[2]==8||rs(6,"invalid gzip data");var pe=ce[3],ge=10;4&pe&&(ge+=2+(ce[10]|ce[11]<<8));for(var fe=(pe>>3&1)+(pe>>4&1);fe>0;fe-=!ce[ge++]);return ge+(2&pe)}(W=k))+8>W.length&&rs(6,"invalid gzip data"),function(ce,pe,ge,fe){var Te=ce.length;if(!Te||pe.f&&!pe.l)return ge||new ra(0);var _e=!ge,Ee=_e||pe.i!=2,Re=pe.i;_e&&(ge=new ra(3*Te));var Fe,Ne,je=function(Dc){var eh=ge.length;if(Dc>eh){var ug=new ra(Math.max(2*eh,Dc));ug.set(ge),ge=ug}},Xe=pe.f||0,Ue=pe.p||0,it=pe.b||0,dt=pe.l,Qe=pe.d,Rt=pe.m,Pt=pe.n,wt=8*Te;do{if(!dt){Xe=ts(ce,Ue,1);var gt=ts(ce,Ue+1,3);if(Ue+=3,!gt){var Jt=ce[(lr=4+((Ue+7)/8|0))-4]|ce[lr-3]<<8,Dt=lr+Jt;if(Dt>Te){Re&&rs(0);break}Ee&&je(it+Jt),ge.set(ce.subarray(lr,Dt),it),pe.b=it+=Jt,pe.p=Ue=8*Dt,pe.f=Xe;continue}if(gt==1)dt=q6,Qe=W6,Rt=9,Pt=5;else if(gt==2){var jt=ts(ce,Ue,31)+257,ar=ts(ce,Ue+10,15)+4,wr=jt+ts(ce,Ue+5,31)+1;Ue+=14;for(var mr=new ra(wr),gr=new ra(19),Ar=0;Ar<ar;++Ar)gr[U6[Ar]]=ts(ce,Ue+3*Ar,7);Ue+=3*ar;var Er=Nw(gr),nn=(1<<Er)-1,qr=rg(gr,Er);for(Ar=0;Ar<wr;){var lr,jr=qr[ts(ce,Ue,nn)];if(Ue+=15&jr,(lr=jr>>4)<16)mr[Ar++]=lr;else{var $r=0,dn=0;for(lr==16?(dn=3+ts(ce,Ue,3),Ue+=2,$r=mr[Ar-1]):lr==17?(dn=3+ts(ce,Ue,7),Ue+=3):lr==18&&(dn=11+ts(ce,Ue,127),Ue+=7);dn--;)mr[Ar++]=$r}}var Rn=mr.subarray(0,jt),Wn=mr.subarray(jt);Rt=Nw(Rn),Pt=Nw(Wn),dt=rg(Rn,Rt),Qe=rg(Wn,Pt)}else rs(1);if(Ue>wt){Re&&rs(0);break}}Ee&&je(it+131072);for(var zn=(1<<Rt)-1,Mn=(1<<Pt)-1,mi=Ue;;mi=Ue){var Jn=($r=dt[jw(ce,Ue)&zn])>>4;if((Ue+=15&$r)>wt){Re&&rs(0);break}if($r||rs(2),Jn<256)ge[it++]=Jn;else{if(Jn==256){mi=Ue,dt=null;break}var Si=Jn-254;Jn>264&&(Si=ts(ce,Ue,(1<<(is=iO[Ar=Jn-257]))-1)+lO[Ar],Ue+=is);var un=Qe[jw(ce,Ue)&Mn],wo=un>>4;if(un||rs(3),Ue+=15&un,Wn=G6[wo],wo>3){var is=oO[wo];Wn+=jw(ce,Ue)&(1<<is)-1,Ue+=is}if(Ue>wt){Re&&rs(0);break}Ee&&je(it+131072);var Sa=it+Si;if(it<Wn){var Aa=0-Wn,Qu=Math.min(Wn,Sa);for(Aa+it<0&&rs(3);it<Qu;++it)ge[it]=(void 0)[Aa+it]}for(;it<Sa;++it)ge[it]=ge[it-Wn]}}pe.l=dt,pe.p=mi,pe.b=it,pe.f=Xe,dt&&(Xe=1,pe.m=Rt,pe.d=Qe,pe.n=Pt)}while(!Xe);return it!=ge.length&&_e?(Fe=ge,((Ne=it)==null||Ne>Fe.length)&&(Ne=Fe.length),new ra(Fe.subarray(0,Ne))):ge.subarray(0,it)}(W.subarray(j,-8),{i:2},new ra(((N=W)[(G=N.length)-4]|N[G-3]<<8|N[G-2]<<16|N[G-1]<<24)>>>0))));var N,G,W,j;const Z=Y6[R];if(!Z)throw new Error(`Unhandled codec: ${R}`);const X=new globalThis.DecompressionStream(Z);return new Response(new Blob([k]).stream().pipeThrough(X)).arrayBuffer().then(ce=>new Uint8Array(ce))}(P,S).then(k=>(function(R,N){R.readFields(R6,N)}(new $w(k),A),new J6[b](A.buffer))),M.then(k=>{for(let R=v.length-1;R>=0;R--)switch(v[R]){case"delta_filter":F6(k,E);break;case"zigzag_filter":N6(k);break;case"bitshuffle_filter":j6(k,b);break;default:throw new Ta(`Unhandled filter "${v[R]}"`)}return{layerName:m,blockIndex:I,data:k}}).catch(k=>{throw k})}))},$t(fO,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var ig={workerUrl:"",workerClass:null,workerParams:void 0};const Vw="mapboxgl_preloaded_worker_pool";class og{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<og.workerCount;)this.workers.push(ig.workerClass!=null?new ig.workerClass:new self.Worker(ig.workerUrl,ig.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vw]}numActive(){return Object.keys(this.active).length}}let ag;function Hv(){return ag||(ag=new og),ag}og.workerCount=2;let sg,Gw,ns,Zf,qw,Xf=null;function dO(){return Ks()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Gw||De.DRACO_URL}function pO(){if(Ks()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Zf)return Zf;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Zf=WebAssembly.validate(c)?De.MESHOPT_SIMD_URL:De.MESHOPT_URL,Zf}const Zv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e$={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},lg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mO(c,r,s){const u=s.json.bufferViews.length,m=s.buffers.length;r.bufferView=u,s.json.bufferViews[u]={buffer:m,byteLength:c.byteLength},s.buffers[m]=c}const Ww="KHR_draco_mesh_compression";function t$(c,r){const s=c.extensions&&c.extensions[Ww];if(!s)return;const u=new ns.Decoder,m=vO(r,s.bufferView),h=new ns.Mesh;if(!u.DecodeArrayToMesh(m,m.byteLength,h))throw new Error("Failed to decode Draco mesh");const g=r.json.accessors[c.indices],b=Zv[g.componentType],E=g.count*b.BYTES_PER_ELEMENT,I=ns._malloc(E);b===Uint16Array?u.GetTrianglesUInt16Array(h,E,I):u.GetTrianglesUInt32Array(h,E,I),mO(ns.memory.buffer.slice(I,I+E),g,r),ns._free(I);for(const v of Object.keys(s.attributes)){const S=u.GetAttributeByUniqueId(h,s.attributes[v]),P=r.json.accessors[c.attributes[v]],A=e$[P.componentType],M=P.count*lg[P.type]*Zv[P.componentType].BYTES_PER_ELEMENT,k=ns._malloc(M);u.GetAttributeDataArrayForAllPoints(h,S,ns[A],M,k),mO(ns.memory.buffer.slice(k,k+M),P,r),ns._free(k)}u.destroy(),h.destroy(),delete c.extensions[Ww]}const Xv="EXT_meshopt_compression";function r$(c,r){if(!c.extensions||!c.extensions[Xv])return;const s=c.extensions[Xv],u=new Uint8Array(r.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),m=new Uint8Array(s.count*s.byteStride);qw.decodeGltfBuffer(m,s.count,s.byteStride,u,s.mode,s.filter),c.buffer=r.buffers.length,c.byteOffset=0,r.buffers[c.buffer]=m.buffer,delete c.extensions[Xv]}const gO=1179937895,yO=new TextDecoder("utf8");function _O(c,r){return new URL(c,r).href}function n$(c,r,s,u){return fetch(_O(c.uri,u)).then(m=>m.arrayBuffer()).then(m=>{r.buffers[s]=m})}function vO(c,r){const s=c.json.bufferViews[r];return new Uint8Array(c.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function i$(c,r,s,u){if(c.uri){const m=_O(c.uri,u);return fetch(m).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{r.images[s]=h})}if(c.bufferView!==void 0){const m=vO(r,c.bufferView),h=new Blob([m],{type:c.mimeType});return createImageBitmap(h).then(g=>{r.images[s]=g})}}function xO(c,r=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,r,1)[0]===gO){const v=new Uint32Array(c,r);let S=2;const P=(v[S++]>>2)-3,A=v[S++]>>2;if(S++,u.json=JSON.parse(yO.decode(v.subarray(S,S+A))),S+=A,S<P){const M=v[S++];S++;const k=r+(S<<2);u.buffers[0]=c.slice(k,k+M)}}else u.json=JSON.parse(yO.decode(new Uint8Array(c,r)));const{buffers:m,images:h,meshes:g,extensionsUsed:b,bufferViews:E}=u.json;let I=Promise.resolve();if(m){const v=[];for(let S=0;S<m.length;S++){const P=m[S];P.uri?v.push(n$(P,u,S,s)):u.buffers[S]||(u.buffers[S]=null)}I=Promise.all(v)}return I.then(()=>{const v=[],S=b&&b.includes(Ww),P=b&&b.includes(Xv);if(S&&v.push(function(){if(!ns)return sg??(sg=function(A){let M,k=null;function R(){M=new Uint8Array(k.buffer)}function N(){throw new Error("Unexpected Draco error.")}const G={a:{a:N,d:function(W,j,Z){return M.copyWithin(W,j,j+Z)},c:function(W){const j=M.length,Z=Math.max(W>>>0,Math.ceil(1.2*j)),X=Math.ceil((Z-j)/65536);try{return k.grow(X),R(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,G):A.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,G))).then(W=>{const{Rb:j,Qb:Z,P:X,T:ce,X:pe,Ja:ge,La:fe,Qa:Te,Va:_e,Wa:Ee,eb:Re,jb:Fe,f:Ne,e:je,yb:Xe,zb:Ue,Ab:it,Bb:dt,Db:Qe,Gb:Rt}=W.instance.exports;k=je;const Pt=(()=>{let wt=0,gt=0,Jt=0,Dt=0;return jt=>{Jt&&(j(Dt),j(wt),gt+=Jt,Jt=wt=0),wt||(gt+=128,wt=Z(gt));const ar=jt.length+7&-8;let wr=wt;ar>=gt&&(Jt=ar,wr=Dt=Z(ar));for(let mr=0;mr<jt.length;mr++)M[wr+mr]=jt[mr];return wr}})();return R(),Ne(),{memory:je,_free:j,_malloc:Z,Mesh:class{constructor(){this.ptr=X()}destroy(){ce(this.ptr)}},Decoder:class{constructor(){this.ptr=ge()}destroy(){Fe(this.ptr)}DecodeArrayToMesh(wt,gt,Jt){const Dt=Pt(wt),jt=fe(this.ptr,Dt,gt,Jt.ptr);return!!pe(jt)}GetAttributeByUniqueId(wt,gt){return{ptr:Te(this.ptr,wt.ptr,gt)}}GetTrianglesUInt16Array(wt,gt,Jt){_e(this.ptr,wt.ptr,gt,Jt)}GetTrianglesUInt32Array(wt,gt,Jt){Ee(this.ptr,wt.ptr,gt,Jt)}GetAttributeDataArrayForAllPoints(wt,gt,Jt,Dt,jt){Re(this.ptr,wt.ptr,gt.ptr,Jt,Dt,jt)}},DT_INT8:Xe(),DT_UINT8:Ue(),DT_INT16:it(),DT_UINT16:dt(),DT_UINT32:Qe(),DT_FLOAT32:Rt()}})}(fetch(dO())),sg.then(A=>{ns=A,sg=void 0}))}()),P&&v.push(function(){if(qw)return;const A=function(M){let k;const R=WebAssembly.instantiateStreaming(M,{}).then(W=>{k=W.instance,k.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},G={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:R,supported:!0,decodeGltfBuffer(W,j,Z,X,ce,pe){(function(ge,fe,Te,_e,Ee,Re,Fe){const Ne=ge.exports.sbrk,je=_e+3&-4,Xe=Ne(je*Ee),Ue=Ne(Re.length),it=new Uint8Array(ge.exports.memory.buffer);it.set(Re,Ue);const dt=fe(Xe,_e,Ee,Ue,Re.length);if(dt===0&&Fe&&Fe(Xe,je,Ee),Te.set(it.subarray(Xe,Xe+_e*Ee)),Ne(Xe-Ne(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(k,k.exports[G[ce]],W,j,Z,X,k.exports[N[pe]])}}}(fetch(pO()));return A.ready.then(()=>{qw=A})}()),h)for(let A=0;A<h.length;A++)v.push(i$(h[A],u,A,s));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(S&&g)for(const{primitives:A}of g)for(const M of A)t$(M,u);if(P&&g&&E)for(const A of E)r$(A,u);return u})})}function Ju(c,r){const s=c.json.bufferViews[r.bufferView],u=Zv[r.componentType];return new u(c.buffers[s.buffer],(r.byteOffset||0)+(s.byteOffset||0),r.count*(s.byteStride&&s.byteStride!==lg[r.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:lg[r.type]))}function Hw(c,r,s,u){const m=Zv[r.componentType],h=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),g=c.json.bufferViews[r.bufferView],b=g.byteStride?g.byteStride/m.BYTES_PER_ELEMENT:lg[r.type],E=s.float32,I=E.length/s.capacity;for(let v=0,S=0;v<r.count*b;v+=b,S+=I)for(let P=0;P<I;P++)E[S+P]=u[v+P]*h;s._trim()}function o$(c,r,s){const u=c.indices,m=c.attributes,h={};h.indexArray=new _i;const g=r.json.accessors[u],b=g.count/3;h.indexArray.reserve(b);const E=Ju(r,g);for(let P=0;P<b;P++)h.indexArray.emplaceBack(E[3*P],E[3*P+1],E[3*P+2]);h.indexArray._trim(),h.vertexArray=new Ps;const I=r.json.accessors[m.POSITION];h.vertexArray.reserve(I.count);const v=Ju(r,I);for(let P=0;P<I.count;P++)h.vertexArray.emplaceBack(v[3*P],v[3*P+1],v[3*P+2]);if(h.vertexArray._trim(),h.aabb=new cn(I.min,I.max),h.centroid=function(P,A){const M=[0,0,0],k=P.length;if(k>0){for(let R=0;R<k;R++){const N=3*P[R];M[0]+=A[N],M[1]+=A[N+1],M[2]+=A[N+2]}M[0]/=k,M[1]/=k,M[2]/=k}return M}(E,v),m.COLOR_0!==void 0){const P=r.json.accessors[m.COLOR_0],A=lg[P.type],M=Ju(r,P);h.colorArray=A===3?new Ps:new Za,h.colorArray.resize(P.count),Hw(r,P,h.colorArray,M)}if(m.NORMAL!==void 0){h.normalArray=new Ps;const P=r.json.accessors[m.NORMAL];h.normalArray.resize(P.count);const A=Ju(r,P);Hw(r,P,h.normalArray,A)}if(m.TEXCOORD_0!==void 0&&s.length>0){h.texcoordArray=new Uu;const P=r.json.accessors[m.TEXCOORD_0];h.texcoordArray.resize(P.count);const A=Ju(r,P);Hw(r,P,h.texcoordArray,A)}if(m._FEATURE_ID_RGBA4444!==void 0){const P=r.json.accessors[m._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Ju(r,P))}m._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Ju(r,r.json.accessors[m._FEATURE_RGBA4444]).buffer));const S=c.material;return h.material=function(P,A){const{emissiveFactor:M=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:R=.5,normalTexture:N,occlusionTexture:G,emissiveTexture:W,doubleSided:j}=P,{baseColorFactor:Z=[1,1,1,1],metallicFactor:X=1,roughnessFactor:ce=1,baseColorTexture:pe,metallicRoughnessTexture:ge}=P.pbrMetallicRoughness||{},fe=G?A[G.index]:void 0;if(G&&G.extensions&&G.extensions.KHR_texture_transform&&fe){const Te=G.extensions.KHR_texture_transform;fe.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Vr(...Z),metallicFactor:X,roughnessFactor:ce,baseColorTexture:pe?A[pe.index]:void 0,metallicRoughnessTexture:ge?A[ge.index]:void 0},doubleSided:j,emissiveFactor:M,alphaMode:k,alphaCutoff:R,normalTexture:N?A[N.index]:void 0,occlusionTexture:fe,emissionTexture:W?A[W.index]:void 0,defined:P.defined===void 0}}(S!==void 0?r.json.materials[S]:{defined:!1},s),h}function bO(c,r,s){const{matrix:u,rotation:m,translation:h,scale:g,mesh:b,extras:E,children:I}=c,v={};if(v.matrix=u||Me.mat4.fromRotationTranslationScale([],m||[0,0,0,1],h||[0,0,0],g||[1,1,1]),b!==void 0){v.meshes=s[b];const S=v.anchor=[0,0];for(const P of v.meshes){const{min:A,max:M}=P.aabb;S[0]+=A[0]+M[0],S[1]+=A[1]+M[1]}S[0]=Math.floor(S[0]/v.meshes.length/2),S[1]=Math.floor(S[1]/v.meshes.length/2)}if(E&&(E.id&&(v.id=E.id),E.lights&&(v.lights=function(S){if(!S.length)return[];const P=function(N){const G=atob(N),W=new Uint8Array(G.length);for(let j=0;j<G.length;j++)W[j]=G.codePointAt(j);return W}(S),A=[],M=P.length/24,k=new Uint16Array(P.buffer),R=new Float32Array(P.buffer);for(let N=0;N<M;N++){const G=k[2*N*6]/30,W=k[2*N*6+1]/30,j=k[2*N*6+10]/100,Z=R[6*N+1],X=R[6*N+2],ce=R[6*N+3],pe=R[6*N+4],ge=ce-Z,fe=pe-X,Te=Math.hypot(ge,fe);A.push({pos:[Z+.5*ge,X+.5*fe,W],normal:[fe/Te,-ge/Te,0],width:Te,height:G,depth:j,points:[Z,X,ce,pe]})}return A}(E.lights))),I){const S=[];for(const P of I)S.push(bO(r.json.nodes[P],r,s));v.children=S}return v}function a$(c){if(c.vertices.length===0||c.indices.length===0)return null;const r=new rw(c.vertices,c.indices,8,256),[s,u]=[r.min.clone(),r.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:r,min:s,max:u}}function s$(c){if(!c.extras||!c.extras.ground)return null;const r=c.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const s=r[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const g of s){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],E=g[1];typeof b=="number"&&typeof E=="number"&&u.push(new _t(b,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let m=0;for(let g=0;g<u.length;g++){const b=u[g],E=u[(g+1)%u.length],I=u[(g+2)%u.length];m+=(b.x-E.x)*(I.y-E.y)-(I.x-E.x)*(b.y-E.y)}m>0&&u.reverse();const h=Lm(u.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function l$(c,r){const s=[],u=[];let m=0;const h=[];for(const g of c){m=s.length;const b=g.vertexArray.float32,E=g.indexArray.uint16;for(let I=0;I<g.vertexArray.length;I++)h[0]=b[3*I+0],h[1]=b[3*I+1],h[2]=b[3*I+2],Me.vec3.transformMat4(h,h,r),s.push(new _t(h[0],h[1]));for(let I=0;I<3*g.indexArray.length;I++)u.push(E[I]+m)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const b=s[u[g+0]],E=s[u[g+1]],I=s[u[g+2]];(b.x-E.x)*(I.y-E.y)-(I.x-E.x)*(b.y-E.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function wO(c){const r=function(E,I){const v=[],S=WebGL2RenderingContext;if(E.json.textures)for(const P of E.json.textures){const A={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};P.sampler!==void 0&&Object.assign(A,E.json.samplers[P.sampler]),v.push({image:I[P.source],sampler:A,uploaded:!1})}return v}(c,c.images),s=function(E,I){const v=[];for(const S of E.json.meshes){const P=[];for(const A of S.primitives)P.push(o$(A,E,I));v.push(P)}return v}(c,r),{scenes:u,scene:m,nodes:h}=c.json,g=u?u[m||0].nodes:h,b=[];for(const E of g)b.push(bO(h[E],c,s));return function(E,I,v){const S={},P=new Set;for(let A=0;A<E.length;A++){const M=v[I[A]];if(!M.extras)continue;const k=M.extras["mapbox:footprint:version"],R=M.extras["mapbox:footprint:id"];(k||R)&&P.add(A),k==="1.0.0"&&R&&(S[R]=A)}for(let A=0;A<E.length;A++){if(P.has(A))continue;const M=E[A],k=v[I[A]];if(!k.extras)continue;let R=null;M.id in S&&(R=l$(E[S[M.id]].meshes,M.matrix)),R||(R=s$(k)),R&&(M.footprint=a$(R))}if(P.size>0){const A=Array.from(P.values()).sort((M,k)=>M-k);for(let M=A.length-1;M>=0;M--)E.splice(A[M],1)}}(b,g,c.json.nodes),b}function c$(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const r=c.vertexArray.float32,s=c.aabb.min[0]-1,u=c.aabb.min[1]-1,m=Yu/(c.aabb.max[0]-s+2),h=Yu/(c.aabb.max[1]-u+2);for(let g=0;g<r.length;g+=3){const b=r[g+2],E=(r[g+0]-s)*m|0,I=(r[g+1]-u)*h|0;b>c.heightmap[I*Yu+E]&&(c.heightmap[I*Yu+E]=b)}}function u$(c,r){const s={};s.indexArray=new _i,s.indexArray.reserve(4*c.length),s.vertexArray=new Ps,s.vertexArray.reserve(10*c.length),s.colorArray=new Za,s.vertexArray.reserve(10*c.length);let u=0;for(const g of c){const b=Math.min(10,Math.max(4,1.3*g.height))*r,E=[-g.normal[1],g.normal[0],0],I=Math.min(.29,.1*g.width/g.depth),v=g.width-2*g.depth*r*(I+.01),S=Me.vec3.scaleAndAdd([],g.pos,E,v/2),P=Me.vec3.scaleAndAdd([],g.pos,E,-v/2),A=[S[0],S[1],S[2]+g.height],M=[P[0],P[1],P[2]+g.height],k=Me.vec3.scaleAndAdd([],g.normal,E,I);Me.vec3.scale(k,k,b);const R=Me.vec3.scaleAndAdd([],g.normal,E,-I);Me.vec3.scale(R,R,b),Me.vec3.add(k,S,k),Me.vec3.add(R,P,R),S[2]+=.1,P[2]+=.1,s.vertexArray.emplaceBack(k[0],k[1],k[2]),s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(S[0],S[1],S[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(S[0],S[1],S[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(k[0],k[1],k[2]),s.vertexArray.emplaceBack(R[0],R[1],R[2]);const N=v/b/2;s.colorArray.emplaceBack(-N-I,-1,N,.8),s.colorArray.emplaceBack(N+I,-1,N,.8),s.colorArray.emplaceBack(-N,0,N,1.3),s.colorArray.emplaceBack(N,0,N,1.3),s.colorArray.emplaceBack(N+I,-.8,N,.7),s.colorArray.emplaceBack(N+I,-.8,N,.7),s.colorArray.emplaceBack(0,0,N,1.3),s.colorArray.emplaceBack(0,0,N,1.3),s.colorArray.emplaceBack(N+I,-1.2,N,.8),s.colorArray.emplaceBack(N+I,-1.2,N,.8),s.indexArray.emplaceBack(6+u,4+u,8+u),s.indexArray.emplaceBack(7+u,9+u,5+u),s.indexArray.emplaceBack(0+u,1+u,2+u),s.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const m={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Vr.white,m.pbrMetallicRoughness=h,s.material=m,s.aabb=new cn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class TO{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const u=r[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const h$=["id","tile","layer","source","sourceLayer","state"];class SO{constructor(r,s,u,m,h){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=u,this._y=m,this.properties=r.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of h$)this[s]!==void 0&&(r[s]=this[s]);return r}}class AO{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ol(Ct,16,0),this.featureIndexArray=new rv,this.promoteId=s,this.is3DTile=!1}insert(r,s,u,m,h,g=0,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,h,g);const I=this.grid;for(let v=0;v<s.length;v++){const S=s[v],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<S.length;A++){const M=S[A];P[0]=Math.min(P[0],M.x),P[1]=Math.min(P[1],M.y),P[2]=Math.max(P[2],M.x),P[3]=Math.max(P[3],M.y)}b!==0&&(P[0]-=b,P[1]-=b,P[2]+=b,P[3]+=b),P[0]<Ct&&P[1]<Ct&&P[2]>=0&&P[3]>=0&&I.insert(E,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ff.VectorTile(new Sv(this.rawTileData)).layers,this.sourceLayerCoder=new TO(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s,u,m){this.loadVTLayers();const h=r.params||{},g=Qo(h.filter),b=r.tileResult,E=r.transform,I=b.bufferedTilespaceBounds,v=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(M,k,R,N)=>ko(b.bufferedTilespaceGeometry,M,k,R,N));v.sort(f$);let S=null;E.elevation&&v.length>0&&(S=qf.create(E.elevation,this.tileID));const P={};let A;for(let M=0;M<v.length;M++){const k=v[M];if(k===A)continue;A=k;const R=this.featureIndexArray.get(k);let N=null;if(this.is3DTile){const G=this.bucketLayerIDs[0][0],W=s[G];if(W.type!=="model")continue;const{queryFeature:j,intersectionZ:Z}=W.queryIntersectsMatchingFeature(b,R.featureIndex,g,E);j&&this.appendToResult(P,G,R.featureIndex,j,Z)}else this.loadMatchingFeature(P,R,g,h.layers,h.availableImages,s,u,m,(G,W,j,Z=0)=>(N||(N=bt(G,this.tileID.canonical,r.tileTransform)),W.queryIntersectsFeature(b,G,j,N,this.z,r.transform,r.pixelPosMatrix,S,Z)))}return P}loadMatchingFeature(r,s,u,m,h,g,b,E,I){const{featureIndex:v,bucketIndex:S,sourceLayerIndex:P,layoutVertexArrayOffset:A}=s,M=this.bucketLayerIDs[S];if(m&&!function(G,W){for(let j=0;j<G.length;j++)if(W.indexOf(G[j])>=0)return!0;return!1}(m,M))return;const k=this.sourceLayerCoder.decode(P),R=this.vtLayers[k].feature(v);if(u.needGeometry){const G=St(R,!0);if(!u.filter(new Cn(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!u.filter(new Cn(this.tileID.overscaledZ),R))return;const N=this.getId(R,k);for(let G=0;G<M.length;G++){const W=M[G];if(m&&m.indexOf(W)<0)continue;const j=g[W];if(!j)continue;let Z={};N!==void 0&&E&&(Z=E.getState(j.sourceLayer||"_geojsonTileLayer",N));const X=!I||I(R,j,Z,A);if(!X)continue;const ce=new SO(R,this.z,this.x,this.y,N),pe=Oi({},b[W]);pe.paint=EO(pe.paint,j.paint,R,Z,h),pe.layout=EO(pe.layout,j.layout,R,Z,h),ce.layer=pe,this.appendToResult(r,W,v,ce,X)}}appendToResult(r,s,u,m,h){let g=r[s];g===void 0&&(g=r[s]=[]),g.push({featureIndex:u,feature:m,intersectionZ:h})}lookupSymbolFeatures(r,s,u,m,h,g,b,E){const I={};this.loadVTLayers();const v=Qo(h);for(const S of r)this.loadMatchingFeature(I,{bucketIndex:u,sourceLayerIndex:m,featureIndex:S,layoutVertexArrayOffset:0},v,g,b,E,s);return I}loadFeature(r){const{featureIndex:s,sourceLayerIndex:u}=r;this.loadVTLayers();const m=this.sourceLayerCoder.decode(u),h=this.vtFeatures[m];if(h[s])return h[s];const g=this.vtLayers[m].feature(s);return h[s]=g,g}hasLayer(r){for(const s of this.bucketLayerIDs)for(const u of s)if(r===u)return!0;return!1}getId(r,s){let u=r.id;if(this.promoteId){const m=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];m!=null&&(u=r.properties[m]),typeof u=="boolean"&&(u=Number(u))}return u}}function EO(c,r,s,u,m){return Ys(c,(h,g)=>{const b=r instanceof pc?r.get(g):null;return b&&b.evaluate?b.evaluate(s,u,m):b})}function f$(c,r){return r-c}$t(AO,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const MO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zw{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const h=MO[15&u];if(!h)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new Zw(b,g,h,r)}constructor(r,s=64,u=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const h=MO.indexOf(this.ArrayType),g=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-b%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=s,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Xw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:b}=this,E=[0,h.length-1,0],I=[];for(;E.length;){const v=E.pop()||0,S=E.pop()||0,P=E.pop()||0;if(S-P<=b){for(let R=P;R<=S;R++){const N=g[2*R],G=g[2*R+1];N>=r&&N<=u&&G>=s&&G<=m&&I.push(h[R])}continue}const A=P+S>>1,M=g[2*A],k=g[2*A+1];M>=r&&M<=u&&k>=s&&k<=m&&I.push(h[A]),(v===0?r<=M:s<=k)&&(E.push(P),E.push(A-1),E.push(1-v)),(v===0?u>=M:m>=k)&&(E.push(A+1),E.push(S),E.push(1-v))}return I}within(r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:h,nodeSize:g}=this,b=[0,m.length-1,0],E=[],I=u*u;for(;b.length;){const v=b.pop()||0,S=b.pop()||0,P=b.pop()||0;if(S-P<=g){for(let R=P;R<=S;R++)IO(h[2*R],h[2*R+1],r,s)<=I&&E.push(m[R]);continue}const A=P+S>>1,M=h[2*A],k=h[2*A+1];IO(M,k,r,s)<=I&&E.push(m[A]),(v===0?r-u<=M:s-u<=k)&&(b.push(P),b.push(A-1),b.push(1-v)),(v===0?r+u>=M:s+u>=k)&&(b.push(A+1),b.push(S),b.push(1-v))}return E}}function Xw(c,r,s,u,m,h){if(m-u<=s)return;const g=u+m>>1;PO(c,r,g,u,m,h),Xw(c,r,s,u,g-1,1-h),Xw(c,r,s,g+1,m,1-h)}function PO(c,r,s,u,m,h){for(;m>u;){if(m-u>600){const I=m-u+1,v=s-u+1,S=Math.log(I),P=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*P*(I-P)/I)*(v-I/2<0?-1:1);PO(c,r,s,Math.max(u,Math.floor(s-v*P/I+A)),Math.min(m,Math.floor(s+(I-v)*P/I+A)),h)}const g=r[2*s+h];let b=u,E=m;for(cg(c,r,u,s),r[2*m+h]>g&&cg(c,r,u,m);b<E;){for(cg(c,r,b,E),b++,E--;r[2*b+h]<g;)b++;for(;r[2*E+h]>g;)E--}r[2*u+h]===g?cg(c,r,u,E):(E++,cg(c,r,E,m)),E<=s&&(u=E+1),s<=E&&(m=E-1)}}function cg(c,r,s,u){Yw(c,s,u),Yw(r,2*s,2*u),Yw(r,2*s+1,2*u+1)}function Yw(c,r,s){const u=c[r];c[r]=c[s],c[s]=u}function IO(c,r,s,u){const m=c-s,h=r-u;return m*m+h*h}o.$=W_,o.A=class extends Vv{},o.B=tl,o.C=Wl,o.D=Bu,o.E=ql,o.F=om,o.G=uf,o.H=B_,o.I=vw,o.J=df,o.K=wf,o.L=U_,o.M=Du,o.N=tf,o.O=Eu,o.P=_t,o.Q=Au,o.R=Ul,o.S=ro,o.T=Ow,o.U=Op,o.V=Vv,o.W=mm,o.X=hf,o.Y=im,o.Z=function(c){const r=c.value;let s=[];if(!r)return s;const u=tl(r);return u!=="string"?(s=s.concat([new Vv(c.key,r,`string expected, "${u}" found`)]),s):(NC(r,!0)||(s=s.concat([new Vv(c.key,r,`invalid url "${r}"`)])),s)},o._=Ze,o.a=function(c){return De.API_CDN_URL_REGEX.test(c)},o.a$=Sm,o.a0=xn,o.a1=Et,o.a2=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return po(c.expression.evaluate(r))}interpolate(c,r,s){return{x:nr(c.x,r.x,s),y:nr(c.y,r.y,s),z:nr(c.z,r.z,s),azimuthal:nr(c.azimuthal,r.azimuthal,s),polar:nr(c.polar,r.polar,s)}}},o.a3=Cn,o.a4=_a,o.a5=Ve,o.a6=Me,o.a7=Bl,o.a8=pc,o.a9=Ac,o.aA=ln,o.aB=EC,o.aC=kC,o.aD=AC,o.aE=function(c,r){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let u=0;u<c.length;u++){const m=document.createElement("source");Oo(c[u])||(s.crossOrigin="Anonymous"),m.src=c[u],s.appendChild(m)}return{cancel:()=>{}}},o.aF=Fv,o.aG=function(c){return fetch(c).then(r=>r.arrayBuffer()).then(r=>xO(r,0,c))},o.aH=wO,o.aI=class{constructor(c,r,s,u){this.id=c,this.position=r!=null?new q(r[0],r[1]):new q(0,0),this.orientation=s??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new cn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,r){if(Me.mat4.multiply(c.matrix,r,c.matrix),c.meshes)for(const s of c.meshes){const u=cn.applyTransformFast(s.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const s of c.children)this._applyTransformations(s,c.matrix)}computeBoundsAndApplyParent(){const c=Me.mat4.identity([]);for(const r of this.nodes)this._applyTransformations(r,c)}computeModelMatrix(c,r,s,u,m,h,g=!1){GC(this.matrix,this,c.transform,this.position,r,s,u,m,h,g)}upload(c){if(!this.uploaded){for(const r of this.nodes)zw(r,c);for(const r of this.nodes)Gv(r);this.uploaded=!0}}destroy(){for(const c of this.nodes)Bw(c)}},o.aJ=Fl,o.aK=Zm,o.aL=xe,o.aM=ve,o.aN=Ms,o.aO=_i,o.aP=uu,o.aQ=kf,o.aR=zv,o.aS=function(){io.isLoading()||io.isLoaded()||fm()!=="deferred"||dm()},o.aT=Qo,o.aU=St,o.aV=SO,o.aW=du,o.aX=hw,o.aY=tw,o.aZ=bt,o.a_=Es,o.aa=nr,o.ab=Ct,o.ac=vu,o.ad=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return function([s,u]){const m=po([1,s,u]);return{x:m.x,y:m.y,z:m.z}}(c.expression.evaluate(r))}interpolate(c,r,s){return{x:nr(c.x,r.x,s),y:nr(c.y,r.y,s),z:nr(c.z,r.z,s)}}},o.ae=function(c,r,s=0,u=!0){const m=new _t(s,s),h=c.sub(m),g=r.add(m),b=[h,new _t(g.x,h.y),g,new _t(h.x,g.y)];return u&&b.push(h.clone()),b},o.af=function(c,r){const s=[];for(let u=0;u<c.length;u++){const m=Ua(u-1,-1,c.length-1),h=Ua(u+1,-1,c.length-1),g=c[u],b=c[h],E=c[m].sub(g).unit(),I=b.sub(g).unit(),v=I.angleWithSep(E.x,E.y),S=E.add(I).unit().mult(-1*r/Math.sin(v/2));s.push(g.add(S))}return s},o.ag=hC,o.ah=ko,o.ai=function(c,r,s=0){return Me.vec3.fromValues(((r.x-s)*c.scale-c.x)*Ct,(r.y*c.scale-c.y)*Ct,Pe(r.z,r.y))},o.aj=Ja,o.ak=OI,o.al=function(c){let r=1/0,s=1/0,u=-1/0,m=-1/0;for(const h of c)r=Math.min(r,h.x),s=Math.min(s,h.y),u=Math.max(u,h.x),m=Math.max(m,h.y);return{min:new _t(r,s),max:new _t(u,m)}},o.am=me,o.an=fn,o.ao=ft,o.ap=yr,o.aq=n,o.ar=function(c,r){const s={};for(let u=0;u<r.length;u++){const m=r[u];m in c&&(s[m]=c[m])}return s},o.as=K,o.at=ye,o.au=class{constructor(c){this.entries={},this.scheduler=c}request(c,r,s,u){const m=this.entries[c]=this.entries[c]||{callbacks:[]};if(m.result){const[h,g]=m.result;return this.scheduler?this.scheduler.add(()=>{u(h,g)},r):u(h,g),()=>{}}return m.callbacks.push(u),m.cancel||(m.cancel=s((h,g)=>{m.result=[h,g];for(const b of m.callbacks)this.scheduler?this.scheduler.add(()=>{b(h,g)},r):b(h,g);setTimeout(()=>delete this.entries[c],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(h=>h!==u),m.callbacks.length||(m.cancel(),delete this.entries[c]))}}},o.av=Y_,o.aw=function(c,r,s){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},m=>{const h=Vl(c.request,(g,b,E,I)=>{g?m(g):b&&m(null,{vectorTile:s?void 0:new Ff.VectorTile(new Sv(b)),rawData:b,cacheControl:E,expires:I})});return()=>{h.cancel(),m()}},r)},o.ax=function(c){ti++,ti>Ur&&(c.getActor().send("enforceCacheSizeLimit",ur),ti=0)},o.ay=zt,o.az=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},o.b=function(c){return De.API_FONTS_REGEX.test(c)},o.b$=function(c){const{x:r,y:s}=c.point,{lng:u,lat:m}=c._center;return TP(r,s,c.worldSize,u,m)},o.b0=Lo,o.b1=On,o.b2=Lm,o.b3=Pw,o.b4=function(c,r){const s=Ac(r.zoom);if(s===0)return ks(c);const u=uv(c),m=Wb(u),h=me(u.getWest())*r.worldSize,g=me(u.getEast())*r.worldSize,b=ye(u.getNorth())*r.worldSize,E=ye(u.getSouth())*r.worldSize,I=[h,b,0],v=[g,b,0],S=[h,E,0],P=[g,E,0],A=Me.mat4.invert([],r.globeMatrix);return Me.vec3.transformMat4(I,I,A),Me.vec3.transformMat4(v,v,A),Me.vec3.transformMat4(S,S,A),Me.vec3.transformMat4(P,P,A),m[0]=dl(m[0],S,s),m[1]=dl(m[1],P,s),m[2]=dl(m[2],v,s),m[3]=dl(m[3],I,s),cn.fromPoints(m)},o.b5=fv,o.b6=km,o.b7=dl,o.b8=Ef,o.b9=oo,o.bA=Ua,o.bB=Sr,o.bC=Js,o.bD=de,o.bE=function(c,r,s){c[4*r+0]=s[0],c[4*r+1]=s[1],c[4*r+2]=s[2],c[4*r+3]=s[3]},o.bF=Wu,o.bG=va,o.bH=Pm,o.bI=Ri,o.bJ=ul,o.bK=q,o.bL=gC,o.bM=ni,o.bN=Sc,o.bO=LC,o.bP=ci,o.bQ=xP,o.bR=function(c,r,s,u,m,h,g,b,E){if(E.name==="globe")return xP(c,r,new ci(s,u,m),!1);const I=Zm({z:s,x:u,y:m},E);return new cn([(h+I.x/I.scale)*r,r*(I.y/I.scale),g],[(h+I.x2/I.scale)*r,r*(I.y2/I.scale),b])},o.bS=function(c,r,s){let u=0;for(let m=0;m<2;++m)c[m]>0&&(u+=(c[m]-0)*(c[m]-0)),r[m]<0&&(u+=(0-r[m])*(0-r[m]));return u},o.bT=Se,o.bU=p,o.bV=function(c){const r=Me.mat4.identity(new Float64Array(16));Me.mat4.multiply(r,c.pixelMatrix,c.globeMatrix);const s=[0,C,0],u=[0,D,0];return Me.vec3.transformMat4(s,s,r),Me.vec3.transformMat4(u,u,r),[s[0]>0&&s[0]<=c.width&&s[1]>0&&s[1]<=c.height&&!Xb(c,new q(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!Xb(c,new q(c.center.lat,-90))]},o.bW=function(c,r){const{scale:s}=c.tileTransform,u=s*Ct/(c.tileSize*Math.pow(2,r.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return Me.mat2.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},o.bX=$v,o.bY=DC,o.bZ=function(c){const r=DC(c,!0);return Me.mat2.invert([],[r[0],r[1],r[4],r[5]])},o.b_=Os,o.ba=Uw,o.bb=Sv,o.bc=Vl,o.bd=function(c){const r=[];for(const s in c)r.push(c[s]);return r},o.be=function(c,r){const s=[];for(const u in c)u in r||s.push(u);return s},o.bf=Xs,o.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bh=wn,o.bi=function(c,r){const{x:s,y:u}=c.point,m=TP(s,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Me.mat4.multiply(m,m,Hb(ks(r)))},o.bj=Nf,o.bk=ta,o.bl=Tv,o.bm=function(c,r,s,u,m){const h=5*r+2;c.float32[h+0]=s,c.float32[h+1]=u,c.float32[h+2]=m},o.bn=Rv,o.bo=eC,o.bp=Mt,o.bq=Ti,o.br=rI,o.bs=FC,o.bt=sI,o.bu=lI,o.bv=ww,o.bw=sC,o.bx=_w,o.by=Zw,o.bz=Vr,o.c=$e,o.c$=qi,o.c0=An,o.c1=Gi,o.c2=l,o.c3=function(c){const r=Math.round((c+45+360)%360/90)%4;return di[r]},o.c4=45,o.c5=re,o.c6=Rf,o.c7=function(c,r,s){const u=Math.sqrt(c*c+r*r+s*s),m=u>0?Math.acos(s/u)*fi:0;let h=c!==0||r!==0?Math.atan2(-r,-c)*fi+90:0;return h<0&&(h+=360),[u,h,m]},o.c8=ke,o.c9=cn,o.cA=function(c){const r=Se-5;c=yr(c,-r,r)/r*90;const s=Math.pow(Math.abs(Math.sin(Sr(c))),3);return Math.round(s*(T.length-1))},o.cB=function(c,r,s,u){const m=r.getNorth(),h=r.getSouth(),g=r.getWest(),b=r.getEast(),E=1<<c.z,I=b-g,v=m-h,S=I/x,P=-v/T[s],A=[0,S,0,P,0,0,m,g,0];if(c.z>0){const M=180/u;Me.mat3.multiply(A,A,[M/I+1,0,0,0,M/v+1,0,-.5*M/S,.5*M/P,1])}return A[2]=E,A[5]=c.x,A[8]=c.y,A},o.cC=ks,o.cD=function(c,r,s){const u=Me.mat4.identity(new Float64Array(16)),m=(r/(1<<c)-.5)*Math.PI*2;return Me.mat4.rotateY(u,s.globeMatrix,m),Float32Array.from(u)},o.cE=class{isDataAvailableAtPoint(c){const r=this._source();if(this.isUsingMockSource()||!r||c.y<0||c.y>1)return!1;const s=r.getSource().maxzoom,u=1<<s,m=Math.floor(c.x),h=Math.floor((c.x-m)*u),g=Math.floor(c.y*u),b=this.findDEMTileFor(new ln(s,m,s,h,g));return!(!b||!b.dem)}getAtPointOrZero(c,r=0){return this.getAtPoint(c,r)||0}getAtPoint(c,r,s=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||c.y<0||c.y>1)return r;const m=u.getSource().maxzoom,h=1<<m,g=Math.floor(c.x),b=c.x-g,E=new ln(m,g,m,Math.floor(b*h),Math.floor(c.y*h)),I=this.findDEMTileFor(E);if(!I||!I.dem)return r;const v=I.dem,S=1<<I.tileID.canonical.z,P=(b*S-I.tileID.canonical.x)*v.dim,A=(c.y*S-I.tileID.canonical.y)*v.dim,M=Math.floor(P),k=Math.floor(A);return(s?this.exaggeration():1)*nr(nr(v.get(M,k),v.get(M,k+1),A-k),nr(v.get(M+1,k),v.get(M+1,k+1),A-k),P-M)}getAtTileOffset(c,r,s){const u=1<<c.canonical.z;return this.getAtPointOrZero(new Ve(c.wrap+(c.canonical.x+r/Ct)/u,(c.canonical.y+s/Ct)/u))}getAtTileOffsetFunc(c,r,s,u){return m=>{const h=this.getAtTileOffset(c,m.x,m.y),g=u.upVector(c.canonical,m.x,m.y),b=u.upVectorScale(c.canonical,r,s).metersToTile;return Me.vec3.scale(g,g,h*b),g}}getForTilePoints(c,r,s,u){if(this.isUsingMockSource())return!1;const m=qf.create(this,c,u);return!!m&&(r.forEach(h=>{h[2]=this.exaggeration()*m.getElevationAt(h[0],h[1],s)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(c);if(!r||!r.dem)return null;const s=r.dem.tree,u=r.tileID,m=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/m-u.canonical.x,g=c.canonical.y/m-u.canonical.y,b=0;for(let E=0;E<c.canonical.z-u.canonical.z&&!s.leaves[b];E++){h*=2,g*=2;const I=2*Math.floor(g)+Math.floor(h);b=s.childOffsets[b]+I,h%=1,g%=1}return{min:this.exaggeration()*s.minimums[b],max:this.exaggeration()*s.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let r=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const m of c){const h=this.getMinMaxForTile(m.tileID);h&&(s=Math.min(s,h.min),u=Math.max(u,h.max),r=!0)}return r?{min:s,max:u}:null}},o.cF=zP,o.cG=fl,o.cH=function(c,r){return[Math.pow(c[0],2.2)*r,Math.pow(c[1],2.2)*r,Math.pow(c[2],2.2)*r]},o.cI=wP,o.cJ=we,o.cK=he,o.cL=256,o.cM=function(c,r){const s=[0,0,0],u=fv(ks(r.canonical));return Me.vec3.transformMat4(s,s,u),Me.vec3.transformMat4(s,s,c),s},o.cN=c=>({u_camera_to_center_distance:new Ri(c),u_extrude_scale:new Cm(c),u_device_pixel_ratio:new Ri(c),u_matrix:new Wu(c),u_inv_rot_matrix:new Wu(c),u_merc_center:new va(c),u_tile_id:new Pm(c),u_zoom_transition:new Ri(c),u_up_dir:new Pm(c),u_emissive_strength:new Ri(c)}),o.cO=c=>({u_matrix:new Wu(c),u_pixels_to_tile_units:new Cm(c),u_device_pixel_ratio:new Ri(c),u_units_to_pixels:new va(c),u_dash_image:new ul(c),u_gradient_image:new ul(c),u_image_height:new Ri(c),u_texsize:new va(c),u_tile_units_to_pixels:new Ri(c),u_alpha_discard_threshold:new Ri(c),u_trim_offset:new va(c),u_trim_fade_range:new va(c),u_trim_color:new Rf(c),u_emissive_strength:new Ri(c)}),o.cP=c=>({u_matrix:new Wu(c),u_texsize:new va(c),u_pixels_to_tile_units:new Cm(c),u_device_pixel_ratio:new Ri(c),u_image:new ul(c),u_units_to_pixels:new va(c),u_tile_units_to_pixels:new Ri(c),u_alpha_discard_threshold:new Ri(c),u_trim_offset:new va(c)}),o.cQ=Vi,o.cR=L2,o.cS=R2,o.cT=EP,o.cU=(c,r,s,u,m,h)=>{const g=c.transform,b=g.projection.name==="globe";let E;if(h.paint.get("circle-pitch-alignment")==="map")if(b){const v=wP(g.zoom,r.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([v,0,0,v])}else E=g.calculatePixelsToTileUnitsMatrix(s);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(g.projection),u_matrix:c.translatePosMatrix(r.projMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ft.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Fj,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(b){I.u_inv_rot_matrix=u,I.u_merc_center=m,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=Ac(g.zoom);const v=m[0]*Ct,S=m[1]*Ct;I.u_up_dir=g.projection.upVector(new ci(0,0,0),v,S)}return I},o.cV=LI,o.cW=(c,r,s,u,m,h)=>{const g=c.transform;return{u_matrix:DI(c,r,s,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:m,u_image:0,u_tile_units_to_pixels:kI(r,g),u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},o.cX=(c,r,s,u,m,h,g)=>{const b=c.transform,E=b.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:DI(c,r,s,u),u_pixels_to_tile_units:E,u_device_pixel_ratio:h,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:RI(s)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kI(r,c.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength")}},o.cY=hu,o.cZ=Dm,o.c_=bI,o.ca=po,o.cb=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},o.cc=function(c){return c({pluginStatus:pi,pluginURL:As}),hm.on("pluginStateChange",c),c},o.cd=Wf,o.ce=Hv,o.cf=$f,o.cg=xw,o.ch=Ep,o.ci=q_,o.cj=cr,o.ck=eo,o.cl=Co,o.cm=function(c){const r=c.indexOf(gc);return r>=0?c.slice(0,r):c},o.cn=function(c){return c.indexOf(gc)>=0},o.co=function(c){const r=c.indexOf(gc);return r>=0?c.slice(r+1):""},o.cp=function(c){const r=[],s=c.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),c.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},o.cq=function(c,r,s,u){return c.type==="custom"?new f6(c,r):new T6[c.type](c,r,s,u)},o.cr=Nl,o.cs=hm,o.ct=gu,o.cu=Im,o.cv=class extends Ka{constructor(c){super(c),this.current=Nb}set(c,r,s){if(this.fetchUniformLocation(c,r)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.cw=Go,o.cx=function(c,r,s){const u=Ac(s.zoom),m=c.style.map._antialias,h=r.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return u===0&&!m&&!h},o.cy=function(c){const r=c.pixelsPerMeter,s=r/de(1,c.center.lat),u=Me.mat4.identity(new Float64Array(16));return Me.mat4.translate(u,u,[c.point.x,c.point.y,0]),Me.mat4.scale(u,u,[s,s,r]),Float32Array.from(u)},o.cz=uv,o.d=function(c){return De.API_TILEJSON_REGEX.test(c)},o.d$=L,o.d0=wv,o.d1=Mc,o.d2=450,o.d3=7,o.d4=h6,o.d5=Fr,o.d6=Cf,o.d7=256,o.d8=Hb,o.d9=Ps,o.dA=SP,o.dB=function(c){const r=[0,0,0],s=Me.mat4.identity(new Float64Array(16));return Me.mat4.multiply(s,c.pixelMatrix,c.globeMatrix),Me.vec3.transformMat4(r,r,s),new _t(r[0],r[1])},o.dC=function(c,r,s=!1){if(pi===Ru||pi===zu||pi===xf)throw new Error("setRTLTextPlugin cannot be called multiple times.");As=Ft.resolveURL(c),pi=Ru,fc=r,um(),s||dm()},o.dD=fm,o.dE=function(){Hv().acquire(Vw)},o.dF=function(){const c=ag;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Vw),ag=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dG=og,o.dH=function(c){const r=Tn();if(!r)return;const s=r.delete(hr);c&&s.catch(c).then(()=>c())},o.dI=ig,o.dJ=dO,o.dK=function(c){Gw=Ft.resolveURL(c),Xf||(Xf=new Wf(Hv(),new ql)),Xf.broadcast("setDracoUrl",Gw)},o.dL=pO,o.dM=function(c){Zf=Ft.resolveURL(c),Xf||(Xf=new Wf(Hv(),new ql)),Xf.broadcast("setMeshoptUrl",Zf)},o.dN=$t,o.dO=Ec,o.dP=es,o.dQ=TO,o.dR=AO,o.dS=MI,o.dT=Ys,o.dU=rC,o.dV=function(c,r,s,u,m,h,g,b,E,I,v){c.createArrays(),c.tilePixelRatio=Ct/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const S=c.layers[0].layout,P=c.layers[0]._unevaluatedLayout._values,A={};if(c.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:G}=c.textSizeData;A.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Cn(N),b),P["text-size"].possiblyEvaluate(new Cn(G),b)]}if(c.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:G}=c.iconSizeData;A.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Cn(N),b),P["icon-size"].possiblyEvaluate(new Cn(G),b)]}A.layoutTextSize=P["text-size"].possiblyEvaluate(new Cn(E+1),b),A.layoutIconSize=P["icon-size"].possiblyEvaluate(new Cn(E+1),b),A.textMaxSize=P["text-size"].possiblyEvaluate(new Cn(18),b);const M=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",k=S.get("text-size");let R=!1;for(const N of c.features)if(N.icon&&N.icon.nameSecondary){R=!0;break}for(const N of c.features){const G=S.get("text-font").evaluate(N,{},b).join(","),W=k.evaluate(N,{},b),j=A.layoutTextSize.evaluate(N,{},b),Z=(A.layoutIconSize.evaluate(N,{},b),{horizontal:{},vertical:void 0}),X=N.text;let ce,pe=[0,0];if(X){const Te=X.toString(),_e=S.get("text-letter-spacing").evaluate(N,{},b)*Ti,Ee=S.get("text-line-height").evaluate(N,{},b)*Ti,Re=Mb(Te)?_e:0,Fe=S.get("text-anchor").evaluate(N,{},b),Ne=S.get("text-variable-anchor");if(!Ne){const dt=S.get("text-radial-offset").evaluate(N,{},b);pe=dt?sC(Fe,[dt*Ti,bw]):S.get("text-offset").evaluate(N,{},b).map(Qe=>Qe*Ti)}let je=M?"center":S.get("text-justify").evaluate(N,{},b);const Xe=S.get("symbol-placement")==="point",Ue=Xe?S.get("text-max-width").evaluate(N,{},b)*Ti:1/0,it=dt=>{c.allowVerticalPlacement&&yf(Te)&&(Z.vertical=yw(X,r,s,m,G,Ue,Ee,Fe,dt,Re,pe,ta.vertical,!0,j,W))};if(!M&&Ne){const dt=je==="auto"?Ne.map(Rt=>ww(Rt)):[je];let Qe=!1;for(let Rt=0;Rt<dt.length;Rt++){const Pt=dt[Rt];if(!Z.horizontal[Pt])if(Qe)Z.horizontal[Pt]=Z.horizontal[0];else{const wt=yw(X,r,s,m,G,Ue,Ee,"center",Pt,Re,pe,ta.horizontal,!1,j,W);wt&&(Z.horizontal[Pt]=wt,Qe=wt.positionedLines.length===1)}}it("left")}else{if(je==="auto"&&(je=ww(Fe)),Xe||S.get("text-writing-mode").indexOf("horizontal")>=0||!yf(Te)){const dt=yw(X,r,s,m,G,Ue,Ee,Fe,je,Re,pe,ta.horizontal,!1,j,W);dt&&(Z.horizontal[je]=dt)}it(Xe?"left":je)}}let ge=!1;if(N.icon&&N.icon.namePrimary){const Te=u[N.icon.namePrimary];Te&&(ce=q2(m[N.icon.namePrimary],N.icon.nameSecondary?m[N.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(N,{},b),S.get("icon-anchor").evaluate(N,{},b)),ge=Te.sdf,c.sdfIcons===void 0?c.sdfIcons=Te.sdf:c.sdfIcons!==Te.sdf&&zr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==c.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const fe=cC(Z.horizontal)||Z.vertical;c.iconsInText||(c.iconsInText=!!fe&&fe.iconsInText),(fe||ce)&&J2(c,N,Z,ce,u,A,j,0,pe,ge,g,b,I,v,R)}h&&c.generateCollisionDebugBuffers(E,c.collisionBoxArray)},o.dW=Ff,o.dX=Wv,o.dY=Hr,o.dZ=JP,o.d_=$I,o.da=Ya,o.db=Tm,o.dc=function(c,r,s,u,m){return yr((c-r)/(s-r)*(m-u)+u,u,m)},o.dd=cf,o.de=Be,o.df=class{constructor(c,r,s,u){this.context=c,this.format=u,this.size=s,this.texture=c.gl.createTexture();const[m,h,g]=this.size,{gl:b}=c;b.bindTexture(b.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,m,h,g,0,Iw(this.format),Cw(this.format),r.data)}bind(c,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},o.dg=Lw,o.dh=[1,1,1],o.di=qf,o.dj=Gf,o.dk=Is,o.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _t(1/0,1/0),max:new _t(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,r=!1){const s=iI(new _t(0,0),new _t(Ct,Ct),c),u=[];if(r&&!aw(s,this._globalClipBounds))return u;for(const m of this._activeRegions){if(m.hiddenByOverlap||!aw(s,m))continue;const h=s2(m.min,m.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return u}setSources(c){this._setSources(c.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const u of r.cache.getVisibleCoordinates()){const m=r.cache.getTile(u).buckets[r.layer];m&&m.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(c){const r=c.getFootprints();if(r.length===0)return;const s=c.getOrder(),u=c.getClipMask(),m=c.getClipScope();for(const h of r){if(!h.footprint)continue;const g=iI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:s,clipMask:u,clipScope:m})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||xv(r.min,s.min)||xv(r.max,s.max)||r.order-s.order||r.clipMask-s.clipMask||function(u,m){const h=(g,b)=>g+b;return u.length-m.length||u.reduce(h,"").localeCompare(m.reduce(h,""))}(r.clipScope,s.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let r=0;for(;!c&&r!==this._activeRegions.length;){const s=this._activeRegions[r],u=this._prevRegions[r];c=s.priority!==u.priority||!nI(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!wn(s.clipScope,u.clipScope),++r}}if(c){++this._updateTime;for(const s of this._activeRegions)s.order!==vv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const r=s=>{const u=this._activeRegions;if(s>=u.length)return s;const m=u[s].priority;for(;s<u.length&&u[s].priority===m;)++s;return s};if(this._sourceIds.length>1){let s=0,u=r(s);for(;s!==u;){let m=s;const h=s;for(;m!==u;){const g=this._activeRegions[m];g.hiddenByOverlap=!1;for(let b=0;b<h;b++){const E=this._activeRegions[b];if(!E.hiddenByOverlap&&g.order===vv&&aw(g,E)&&(g.hiddenByOverlap=aI(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++m}s=u,u=r(s)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=c.length-1;r>=0;r--)this._addSource(c[r]);this._computeReplacement()}},o.dm=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,r){const s=new Es,u=new _i,m=[],h=c+1+2,g=r[0]+1,b=r[0]+1+(1+r.length),E=(I,v,S)=>{let P=I===h-1?I-2:I===0?I:I-1;return P+=S?24575:0,[P,v]};for(let I=0;I<h;++I)s.emplaceBack(...E(I,0,!0));for(let I=0;I<g;++I)for(let v=0;v<h;++v)s.emplaceBack(...E(v,I,(v===0||v===h-1)&&!0));for(let I=0;I<r.length;++I){const v=r[I];for(let S=0;S<h;++S)s.emplaceBack(...E(S,v,!0))}for(let I=0;I<r.length;++I){const v=u.length,S=r[I]+1+2,P=new _i;for(let k=0;k<S-1;k++){const R=k===S-2,N=R?h*(b-r.length+I-k):h;for(let G=0;G<h-1;G++){const W=k*h+G;k===0||R||G===0||G===h-2?(P.emplaceBack(W+1,W,W+N),P.emplaceBack(W+N,W+N+1,W+1)):(u.emplaceBack(W+1,W,W+N),u.emplaceBack(W+N,W+N+1,W+1))}}const A=On.simpleSegment(0,v,s.length,u.length-v);for(let k=0;k<P.uint16.length;k+=3)u.emplaceBack(P.uint16[k],P.uint16[k+1],P.uint16[k+2]);const M=On.simpleSegment(0,v,s.length,u.length-v);m.push({withoutSkirts:A,withSkirts:M})}return{vertices:s,indices:u,segments:m}}_createGrid(c){const r=this._fillGridMeshWithLods(x,T);this._gridSegments=r.segments,this._gridBuffer=c.createVertexBuffer(r.vertices,Lo.members),this._gridIndexBuffer=c.createIndexBuffer(r.indices,!0)}_createPoles(c){const r=new _i;for(let g=0;g<=x;g++)r.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=c.createIndexBuffer(r,!0);const s=new Ya,u=new Ya,m=new Ya,h=new Ya;this._poleSegments=[];for(let g=0,b=0;g<l;g++){const E=360/(1<<g);s.emplaceBack(0,-n,0,.5,0),u.emplaceBack(0,-n,0,.5,1),m.emplaceBack(0,-n,0,.5,.5),h.emplaceBack(0,-n,0,.5,.5);for(let I=0;I<=x;I++){let v=I/x,S=0;const P=nr(0,E,v),[A,M,k]=z(zj,Bj,P,n);s.emplaceBack(A,M,k,v,S),u.emplaceBack(A,M,k,v,1-S);const R=Sr(P);v=.5+.5*Math.sin(R),S=.5+.5*Math.cos(R),m.emplaceBack(A,M,k,v,S),h.emplaceBack(A,M,k,v,1-S)}this._poleSegments.push(On.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(s,bo,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,bo,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(m,bo,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,bo,!1)}getGridBuffers(c,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},o.dn=vv,o.dp=qo,o.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.dr=$a,o.ds=Le,o.dt=B,o.du=function([c,r,s]){const u=Math.hypot(c,r,s),m=Math.atan2(c,s),h=.5*Math.PI-Math.acos(-r/u);return new q(An(m),An(h))},o.dv=Dw,o.dw=U,o.dx=function(c){const r=c.navigator?c.navigator.userAgent:null;return!!function(s){if(pu==null){const u=s.navigator?s.navigator.userAgent:null;pu=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return pu}(c)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dy=function(c,r){ur=c,Ur=r},o.dz=Xb,o.e=De,o.e0=function(c){let r=0;if(new Uint32Array(c,0,1)[0]!==gO){const s=new Uint32Array(c,0,7),[,,u,m,h,g]=s;r=s.byteLength+m+h+g+h,(u!==c.byteLength||r>=c.byteLength)&&zr("Invalid b3dm header information.")}return xO(c,r)},o.e1=function(c,r){const s=wO(c);for(const u of s){for(const m of u.meshes)c$(m);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(u$(u.lights,r)))}return s},o.e2=qv,o.e3=YC,o.e4=io,o.e5=function(c){Kn(),_r!=null&&_r.then(r=>{r.keys().then(s=>{for(let u=0;u<s.length-c;u++)r.delete(s[u])})})},o.f=function(c){return c.indexOf("mapbox:")===0},o.g=function(c,r){return gu(Oi(c,{method:"GET"}),r)},o.h=Oe,o.i=function(c){return De.API_STYLE_REGEX.test(c)&&!$e(c)},o.j=function(c){return decodeURIComponent(atob(c).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(+("0x"+s))))},o.l=Oi,o.m=yi,o.n=function(c,r){return gu(Oi(c,{type:"json"}),r)},o.o=pa,o.p=function(c,r){return gu(Oi(c,{method:"POST"}),r)},o.q=Ft,o.r=Wi,o.s=function(c){try{const r=self[c];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=_u,o.u=function(){return function c(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},o.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},o.w=zr,o.x=vs,o.y=2,o.z=tC}),w(["./shared"],function(o){function L(Je){const ne=Je?Je.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function $(Je){if(typeof Je=="number"||typeof Je=="boolean"||typeof Je=="string"||Je==null)return JSON.stringify(Je);if(Array.isArray(Je)){let he="[";for(const we of Je)he+=`${$(we)},`;return`${he}]`}let ne="{";for(const he of Object.keys(Je).sort())ne+=`${he}:${$(Je[he])},`;return`${ne}}`}function F(Je){let ne="";for(const he of o.bg)ne+=`/${$(Je[he])}`;return ne}class H{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,he){this._layerConfigs={},this._layers={},this.update(ne,[],he)}update(ne,he,we){this._options=we;for(const Oe of ne)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=o.cq(Oe,this.scope,null,this._options)).compileFilter(we),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of he)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const De=function(Oe,$e){const Ye={};for(let Ke=0;Ke<Oe.length;Ke++){const at=$e&&$e[Oe[Ke].id]||F(Oe[Ke]);$e&&($e[Oe[Ke].id]=at);let nt=Ye[at];nt||(nt=Ye[at]=[]),nt.push(Oe[Ke])}const qe=[];for(const Ke in Ye)qe.push(Ye[Ke]);return qe}(o.bd(this._layerConfigs),this.keyCache);for(const Oe of De){const $e=Oe.map(xt=>this._layers[xt.id]),Ye=$e[0];if(Ye.visibility==="none")continue;const qe=Ye.source||"";let Ke=this.familiesBySource[qe];Ke||(Ke=this.familiesBySource[qe]={});const at=Ye.sourceLayer||"_geojsonTileLayer";let nt=Ke[at];nt||(nt=Ke[at]=[]),nt.push($e)}}}const Y=1*o.dP;class oe{constructor(ne){const he={},we=[];for(const Ye in ne){const qe=ne[Ye],Ke=he[Ye]={};for(const at in qe.glyphs){const nt=qe.glyphs[+at];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const xt=nt.metrics.localGlyph?Y:1,zt={x:0,y:0,w:nt.bitmap.width+2*xt,h:nt.bitmap.height+2*xt};we.push(zt),Ke[at]=zt}}const{w:De,h:Oe}=o.z(we),$e=new o.dO({width:De||1,height:Oe||1});for(const Ye in ne){const qe=ne[Ye];for(const Ke in qe.glyphs){const at=qe.glyphs[+Ke];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const nt=he[Ye][Ke],xt=at.metrics.localGlyph?Y:1;o.dO.copy(at.bitmap,$e,{x:0,y:0},{x:nt.x+xt,y:nt.y+xt},at.bitmap)}}this.image=$e,this.positions=he}}o.dN(oe,"GlyphAtlas");class te{constructor(ne){this.tileID=new o.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=o.aK(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep}parse(ne,he,we,De,Oe){this.status="parsing",this.data=ne,this.collisionBoxArray=new o.aQ;const $e=new o.dQ(Object.keys(ne.layers).sort()),Ye=new o.dR(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const qe={},Ke=new o.dS(256,256),at={featureIndex:Ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ke,availableImages:we,brightness:this.brightness},nt=he.familiesBySource[this.source];for(const ur in nt){const Ur=ne.layers[ur];if(!Ur)continue;let Kr=!1,_r=!1,Zr=!1;for(const ti of nt[ur])ti[0].type==="symbol"?Kr=!0:_r=!0,ti[0].is3D()&&ti[0].type!=="model"&&(Zr=!0);if(this.extraShadowCaster&&!Zr||this.isSymbolTile===!0&&!Kr||this.isSymbolTile===!1&&!_r)continue;Ur.version===1&&o.w(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Tn=$e.encode(ur),Kn=[];for(let ti=0;ti<Ur.length;ti++){const yi=Ur.feature(ti),Wo=Ye.getId(yi,ur);Kn.push({feature:yi,id:Wo,index:ti,sourceLayerIndex:Tn})}for(const ti of nt[ur]){const yi=ti[0];(!this.extraShadowCaster||yi.is3D()&&yi.type!=="model")&&(this.isSymbolTile!==void 0&&yi.type==="symbol"!==this.isSymbolTile||yi.minzoom&&this.zoom<Math.floor(yi.minzoom)||yi.maxzoom&&this.zoom>=yi.maxzoom||yi.visibility!=="none"&&(ie(ti,this.zoom,at.brightness,we),(qe[yi.id]=yi.createBucket({index:Ye.bucketLayerIDs.length,layers:ti,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Kn,at,this.tileID.canonical,this.tileTransform),Ye.bucketLayerIDs.push(ti.map(Wo=>Wo.id))))}}let xt,zt,Ft,sr;Ke.trim();const cr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hr=()=>{if(xt)return this.status="done",Oe(xt);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:o.bd(qe).filter(ur=>!ur.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:at.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(zt&&Ft&&sr){const ur=new oe(zt),Ur=new o.dU(Ft,sr,this.lut);for(const Kr in qe){const _r=qe[Kr];_r instanceof o.aR?(ie(_r.layers,this.zoom,at.brightness,we),o.dV(_r,zt,ur.positions,Ft,Ur.iconPositions,this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):_r.hasPattern&&(_r instanceof o.aX||_r instanceof o.aY||_r instanceof o.d0)&&(ie(_r.layers,this.zoom,at.brightness,we),_r.addFeatures(at,this.tileID.canonical,Ur.patternPositions,we,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:o.bd(qe).filter(Kr=>!Kr.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ur.image,lineAtlas:Ke,imageAtlas:Ur,brightness:at.brightness})}};if(!this.extraShadowCaster){const ur=o.dT(at.glyphDependencies,_r=>Object.keys(_r).map(Number));Object.keys(ur).length?De.send("getGlyphs",{uid:this.uid,stacks:ur,scope:this.scope},(_r,Zr)=>{xt||(xt=_r,zt=Zr,hr())},void 0,!1,cr):zt={};const Ur=Object.keys(at.iconDependencies);Ur.length?De.send("getImages",{icons:Ur,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(_r,Zr)=>{xt||(xt=_r,Ft=Zr,hr())},void 0,!1,cr):Ft={};const Kr=Object.keys(at.patternDependencies);Kr.length?De.send("getImages",{icons:Kr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(_r,Zr)=>{xt||(xt=_r,sr=Zr,hr())},void 0,!1,cr):sr={}}hr()}}function ie(Je,ne,he,we){const De=new o.a3(ne,{brightness:he});for(const Oe of Je)Oe.recalculate(De,we)}class ae extends o.E{constructor(ne,he,we,De,Oe,$e){super(),this.actor=ne,this.layerIndex=he,this.availableImages=we,this.loadVectorData=Oe||o.aw,this.loading={},this.loaded={},this.deduped=new o.au(ne.scheduler),this.isSpriteLoaded=De,this.scheduler=ne.scheduler,this.brightness=$e}loadTile(ne,he){const we=ne.uid,De=ne&&ne.request,Oe=De&&De.collectResourceTiming,$e=this.loading[we]=new te(ne);$e.abort=this.loadVectorData(ne,(Ye,qe)=>{const Ke=!this.loading[we];if(delete this.loading[we],Ke||Ye||!qe)return $e.status="done",Ke||(this.loaded[we]=$e),he(Ye);const at=qe.rawData,nt={};qe.expires&&(nt.expires=qe.expires),qe.cacheControl&&(nt.cacheControl=qe.cacheControl),$e.vectorTile=qe.vectorTile||new o.dW.VectorTile(new o.bb(at));const xt=()=>{$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,(zt,Ft)=>{if(zt||!Ft)return he(zt);const sr={};if(Oe){const cr=L(De);cr.length>0&&(sr.resourceTiming=JSON.parse(JSON.stringify(cr)))}he(null,o.l({rawTileData:at.slice(0)},Ft,nt,sr))})};this.isSpriteLoaded?xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(xt,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):xt()}),this.loaded=this.loaded||{},this.loaded[we]=$e})}reloadTile(ne,he){const we=this.loaded,De=ne.uid;if(we&&we[De]){const Oe=we[De];Oe.showCollisionBoxes=ne.showCollisionBoxes,Oe.projection=ne.projection,Oe.brightness=ne.brightness,Oe.tileTransform=o.aK(ne.tileID.canonical,ne.projection),Oe.extraShadowCaster=ne.extraShadowCaster,Oe.lut=ne.lut;const $e=(Ye,qe)=>{const Ke=Oe.reloadCallback;Ke&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ke)),he(Ye,qe)};Oe.status==="parsing"?Oe.reloadCallback=$e:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,$e):$e())}else he(null,void 0)}abortTile(ne,he){const we=ne.uid,De=this.loading[we];De&&(De.abort&&De.abort(),delete this.loading[we]),he()}removeTile(ne,he){const we=this.loaded,De=ne.uid;we&&we[De]&&delete we[De],he()}}class J{loadTile(ne,he){const{uid:we,encoding:De,rawImageData:Oe,padding:$e}=ne,Ye=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,$e):Oe;he(null,new o.dX(we,Ye,De,$e<1))}getImageData(ne,he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const we=this.offscreenCanvasContext.getImageData(-he,-he,ne.width+2*he,ne.height+2*he);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}o.ba.setPbf(o.bb);class ue{decodeRasterArray({task:ne,buffer:he},we){o.ba.performDecoding(he,ne).then(De=>{we(null,De)},De=>{we(De)})}}const le=o.dW.VectorTileFeature.prototype.toGeoJSON;class se{constructor(ne){this._feature=ne,this.extent=o.ab,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const he of this._feature.geometry)ne.push([new o.P(he[0],he[1])]);return ne}{const ne=[];for(const he of this._feature.geometry){const we=[];for(const De of he)we.push(new o.P(De[0],De[1]));ne.push(we)}return ne}}toGeoJSON(ne,he,we){return le.call(this,ne,he,we)}}class be{constructor(ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.ab,this.length=ne.length,this._features=ne}feature(ne){return new se(this._features[ne])}}const Ie=64/4096,Ae=128;class ht{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],he){for(const we of ne){const De=we.id;if(De==null)continue;let Oe=this.features.get(De);Oe&&this.updateCache(Oe,he),we.geometry?(Oe=We(we),this.updateCache(Oe,he),this.features.set(De,Oe)):this.features.delete(De),this.updateCache(Oe,he)}}updateCache(ne,he){for(const{canonical:we,uid:De}of Object.values(he)){const{z:Oe,x:$e,y:Ye}=we;st(ne,Math.pow(2,Oe),$e,Ye)&&delete he[De]}}getTile(ne,he,we){const De=Math.pow(2,ne),Oe=[];for(const $e of this.features.values())st($e,De,he,we)&&Oe.push(kt($e,De,he,we));return{features:Oe}}getFeatures(){return[...this.features.values()]}}function st({minX:Je,minY:ne,maxX:he,maxY:we},De,Oe,$e){return Je<(Oe+1+Ie)/De&&ne<($e+1+Ie)/De&&he>(Oe-Ie)/De&&we>($e-Ie)/De}function We(Je){const{id:ne,geometry:he,properties:we}=Je;if(!he)return;if(he.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Oe}=he,$e={id:ne,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=$e.geometry;if(De==="Point")He(Oe,Ye,$e);else if(De==="MultiPoint")for(const qe of Oe)He(qe,Ye,$e);else if(De==="LineString")$e.type=2,At(Oe,Ye,$e);else if(De==="MultiLineString")$e.type=2,Tt(Oe,Ye,$e);else if(De==="Polygon")$e.type=3,Tt(Oe,Ye,$e,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");$e.type=3;for(const qe of Oe)Tt(qe,Ye,$e,!0)}return $e}function He([Je,ne],he,we){const De=o.am(Je);let Oe=o.at(ne);Oe=Oe<0?0:Oe>1?1:Oe,he.push(De,Oe),we.minX=Math.min(we.minX,De),we.minY=Math.min(we.minY,Oe),we.maxX=Math.max(we.maxX,De),we.maxY=Math.max(we.maxY,Oe)}function At(Je,ne,he,we=!1,De=!1){const Oe=[];for(const $e of Je)He($e,Oe,he);ne.push(Oe),we&&function($e,Ye){let qe=0;for(let Ke=0,at=$e.length,nt=at-2;Ke<at;nt=Ke,Ke+=2)qe+=($e[Ke]-$e[nt])*($e[Ke+1]+$e[nt+1]);if(qe>0===Ye)for(let Ke=0,at=$e.length;Ke<at/2;Ke+=2){const nt=$e[Ke],xt=$e[Ke+1];$e[Ke]=$e[at-2-Ke],$e[Ke+1]=$e[at-1-Ke],$e[at-2-Ke]=nt,$e[at-1-Ke]=xt}}(Oe,De)}function Tt(Je,ne,he,we=!1){for(let De=0;De<Je.length;De++)At(Je[De],ne,he,we,De===0)}function kt(Je,ne,he,we){const{id:De,type:Oe,geometry:$e,tags:Ye}=Je,qe=[];if(Oe===1)(function(Ke,at,nt,xt,zt){for(let Ft=0;Ft<Ke.length;Ft+=2){const sr=Math.round(o.ab*(Ke[Ft+0]*at-nt)),cr=Math.round(o.ab*(Ke[Ft+1]*at-xt));zt.push([sr,cr])}})($e,ne,he,we,qe);else for(const Ke of $e)ct(Ke,ne,he,we,qe);return{id:De,type:Oe,geometry:qe,tags:Ye}}function ct(Je,ne,he,we,De){const Oe=-Ae,$e=o.ab+Ae;let Ye;for(let qe=0;qe<Je.length-2;qe+=2){let Ke=Math.round(o.ab*(Je[qe+0]*ne-he)),at=Math.round(o.ab*(Je[qe+1]*ne-we)),nt=Math.round(o.ab*(Je[qe+2]*ne-he)),xt=Math.round(o.ab*(Je[qe+3]*ne-we));const zt=nt-Ke,Ft=xt-at;Ke<Oe&&nt<Oe||(Ke<Oe?(at+=Math.round(Ft*((Oe-Ke)/zt)),Ke=Oe):nt<Oe&&(xt=at+Math.round(Ft*((Oe-Ke)/zt)),nt=Oe),at<Oe&&xt<Oe||(at<Oe?(Ke+=Math.round(zt*((Oe-at)/Ft)),at=Oe):xt<Oe&&(nt=Ke+Math.round(zt*((Oe-at)/Ft)),xt=Oe),Ke>=$e&&nt>=$e||(Ke>=$e?(at+=Math.round(Ft*(($e-Ke)/zt)),Ke=$e):nt>=$e&&(xt=at+Math.round(Ft*(($e-Ke)/zt)),nt=$e),at>=$e&&xt>=$e||(at>=$e?(Ke+=Math.round(zt*(($e-at)/Ft)),at=$e):xt>=$e&&(nt=Ke+Math.round(zt*(($e-at)/Ft)),xt=$e),Ye&&Ke===Ye[Ye.length-1][0]&&at===Ye[Ye.length-1][1]||(Ye=[[Ke,at]],De.push(Ye)),Ye.push([nt,xt])))))}}var Ot,mt,Lt,yt={exports:{}},Zt=function(){if(Lt)return yt.exports;Lt=1;var Je=o.d_(),ne=function(){if(mt)return Ot;mt=1;var at=o.dY(),nt=o.dZ().VectorTileFeature;function xt(Ft,sr){this.options=sr||{},this.features=Ft,this.length=Ft.length}function zt(Ft,sr){this.id=typeof Ft.id=="number"?Ft.id:void 0,this.type=Ft.type,this.rawGeometry=Ft.type===1?[Ft.geometry]:Ft.geometry,this.properties=Ft.tags,this.extent=sr||4096}return Ot=xt,xt.prototype.feature=function(Ft){return new zt(this.features[Ft],this.options.extent)},zt.prototype.loadGeometry=function(){var Ft=this.rawGeometry;this.geometry=[];for(var sr=0;sr<Ft.length;sr++){for(var cr=Ft[sr],hr=[],ur=0;ur<cr.length;ur++)hr.push(new at(cr[ur][0],cr[ur][1]));this.geometry.push(hr)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ft=this.geometry,sr=1/0,cr=-1/0,hr=1/0,ur=-1/0,Ur=0;Ur<Ft.length;Ur++)for(var Kr=Ft[Ur],_r=0;_r<Kr.length;_r++){var Zr=Kr[_r];sr=Math.min(sr,Zr.x),cr=Math.max(cr,Zr.x),hr=Math.min(hr,Zr.y),ur=Math.max(ur,Zr.y)}return[sr,hr,cr,ur]},zt.prototype.toGeoJSON=nt.prototype.toGeoJSON,Ot}();function he(at){var nt=new Je;return function(xt,zt){for(var Ft in xt.layers)zt.writeMessage(3,we,xt.layers[Ft])}(at,nt),nt.finish()}function we(at,nt){var xt;nt.writeVarintField(15,at.version||1),nt.writeStringField(1,at.name||""),nt.writeVarintField(5,at.extent||4096);var zt={keys:[],values:[],keycache:{},valuecache:{}};for(xt=0;xt<at.length;xt++)zt.feature=at.feature(xt),nt.writeMessage(2,De,zt);var Ft=zt.keys;for(xt=0;xt<Ft.length;xt++)nt.writeStringField(3,Ft[xt]);var sr=zt.values;for(xt=0;xt<sr.length;xt++)nt.writeMessage(4,Ke,sr[xt])}function De(at,nt){var xt=at.feature;xt.id!==void 0&&nt.writeVarintField(1,xt.id),nt.writeMessage(2,Oe,at),nt.writeVarintField(3,xt.type),nt.writeMessage(4,qe,xt)}function Oe(at,nt){var xt=at.feature,zt=at.keys,Ft=at.values,sr=at.keycache,cr=at.valuecache;for(var hr in xt.properties){var ur=xt.properties[hr],Ur=sr[hr];if(ur!==null){Ur===void 0&&(zt.push(hr),sr[hr]=Ur=zt.length-1),nt.writeVarint(Ur);var Kr=typeof ur;Kr!=="string"&&Kr!=="boolean"&&Kr!=="number"&&(ur=JSON.stringify(ur));var _r=Kr+":"+ur,Zr=cr[_r];Zr===void 0&&(Ft.push(ur),cr[_r]=Zr=Ft.length-1),nt.writeVarint(Zr)}}}function $e(at,nt){return(nt<<3)+(7&at)}function Ye(at){return at<<1^at>>31}function qe(at,nt){for(var xt=at.loadGeometry(),zt=at.type,Ft=0,sr=0,cr=xt.length,hr=0;hr<cr;hr++){var ur=xt[hr],Ur=1;zt===1&&(Ur=ur.length),nt.writeVarint($e(1,Ur));for(var Kr=zt===3?ur.length-1:ur.length,_r=0;_r<Kr;_r++){_r===1&&zt!==1&&nt.writeVarint($e(2,Kr-1));var Zr=ur[_r].x-Ft,Tn=ur[_r].y-sr;nt.writeVarint(Ye(Zr)),nt.writeVarint(Ye(Tn)),Ft+=Zr,sr+=Tn}zt===3&&nt.writeVarint($e(7,1))}}function Ke(at,nt){var xt=typeof at;xt==="string"?nt.writeStringField(1,at):xt==="boolean"?nt.writeBooleanField(7,at):xt==="number"&&(at%1!=0?nt.writeDoubleField(3,at):at<0?nt.writeSVarintField(6,at):nt.writeVarintField(5,at))}return yt.exports=he,yt.exports.fromVectorTileJs=he,yt.exports.fromGeojsonVt=function(at,nt){nt=nt||{};var xt={};for(var zt in at)xt[zt]=new ne(at[zt].features,nt),xt[zt].name=zt,xt[zt].version=nt.version,xt[zt].extent=nt.extent;return he({layers:xt})},yt.exports.GeoJSONWrapper=ne,yt.exports}(),Yt=o.d$(Zt);const xr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Je=>Je},Vt=Math.fround||(Sn=new Float32Array(1),Je=>(Sn[0]=+Je,Sn[0]));var Sn;const vn=3,sn=5,Ci=6;class rr{constructor(ne){this.options=Object.assign(Object.create(xr),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:he,minZoom:we,maxZoom:De}=this.options;he&&console.time("total time");const Oe=`prepare ${ne.length} points`;he&&console.time(Oe),this.points=ne;const $e=[];for(let qe=0;qe<ne.length;qe++){const Ke=ne[qe];if(!Ke.geometry)continue;const[at,nt]=Ke.geometry.coordinates,xt=Vt(Bt(at)),zt=Vt(yn(nt));$e.push(xt,zt,1/0,qe,-1,1),this.options.reduce&&$e.push(0)}let Ye=this.trees[De+1]=this._createTree($e);he&&console.timeEnd(Oe);for(let qe=De;qe>=we;qe--){const Ke=+Date.now();Ye=this.trees[qe]=this._createTree(this._cluster(Ye,qe)),he&&console.log("z%d: %d clusters in %dms",qe,Ye.numItems,+Date.now()-Ke)}return he&&console.timeEnd("total time"),this}getClusters(ne,he){let we=((ne[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ne[1]));let Oe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)we=-180,Oe=180;else if(we>Oe){const nt=this.getClusters([we,De,180,$e],he),xt=this.getClusters([-180,De,Oe,$e],he);return nt.concat(xt)}const Ye=this.trees[this._limitZoom(he)],qe=Ye.range(Bt(we),yn($e),Bt(Oe),yn(De)),Ke=Ye.data,at=[];for(const nt of qe){const xt=this.stride*nt;at.push(Ke[xt+sn]>1?Pr(Ke,xt,this.clusterProps):this.points[Ke[xt+vn]])}return at}getChildren(ne){const he=this._getOriginId(ne),we=this._getOriginZoom(ne),De="No cluster with the specified id.",Oe=this.trees[we];if(!Oe)throw new Error(De);const $e=Oe.data;if(he*this.stride>=$e.length)throw new Error(De);const Ye=this.options.radius/(this.options.extent*Math.pow(2,we-1)),qe=Oe.within($e[he*this.stride],$e[he*this.stride+1],Ye),Ke=[];for(const at of qe){const nt=at*this.stride;$e[nt+4]===ne&&Ke.push($e[nt+sn]>1?Pr($e,nt,this.clusterProps):this.points[$e[nt+vn]])}if(Ke.length===0)throw new Error(De);return Ke}getLeaves(ne,he,we){const De=[];return this._appendLeaves(De,ne,he=he||10,we=we||0,0),De}getTile(ne,he,we){const De=this.trees[this._limitZoom(ne)],Oe=Math.pow(2,ne),{extent:$e,radius:Ye}=this.options,qe=Ye/$e,Ke=(we-qe)/Oe,at=(we+1+qe)/Oe,nt={features:[]};return this._addTileFeatures(De.range((he-qe)/Oe,Ke,(he+1+qe)/Oe,at),De.data,he,we,Oe,nt),he===0&&this._addTileFeatures(De.range(1-qe/Oe,Ke,1,at),De.data,Oe,we,Oe,nt),he===Oe-1&&this._addTileFeatures(De.range(0,Ke,qe/Oe,at),De.data,-1,we,Oe,nt),nt.features.length?nt:null}getClusterExpansionZoom(ne){let he=this._getOriginZoom(ne)-1;for(;he<=this.options.maxZoom;){const we=this.getChildren(ne);if(he++,we.length!==1)break;ne=we[0].properties.cluster_id}return he}_appendLeaves(ne,he,we,De,Oe){const $e=this.getChildren(he);for(const Ye of $e){const qe=Ye.properties;if(qe&&qe.cluster?Oe+qe.point_count<=De?Oe+=qe.point_count:Oe=this._appendLeaves(ne,qe.cluster_id,we,De,Oe):Oe<De?Oe++:ne.push(Ye),ne.length===we)break}return Oe}_createTree(ne){const he=new o.by(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ne.length;we+=this.stride)he.add(ne[we],ne[we+1]);return he.finish(),he.data=ne,he}_addTileFeatures(ne,he,we,De,Oe,$e){for(const Ye of ne){const qe=Ye*this.stride,Ke=he[qe+sn]>1;let at,nt,xt;if(Ke)at=Me(he,qe,this.clusterProps),nt=he[qe],xt=he[qe+1];else{const sr=this.points[he[qe+vn]];at=sr.properties;const[cr,hr]=sr.geometry.coordinates;nt=Bt(cr),xt=yn(hr)}const zt={type:1,geometry:[[Math.round(this.options.extent*(nt*Oe-we)),Math.round(this.options.extent*(xt*Oe-De))]],tags:at};let Ft;Ft=Ke||this.options.generateId?he[qe+vn]:this.points[he[qe+vn]].id,Ft!==void 0&&(zt.id=Ft),$e.features.push(zt)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,he){const{radius:we,extent:De,reduce:Oe,minPoints:$e}=this.options,Ye=we/(De*Math.pow(2,he)),qe=ne.data,Ke=[],at=this.stride;for(let nt=0;nt<qe.length;nt+=at){if(qe[nt+2]<=he)continue;qe[nt+2]=he;const xt=qe[nt],zt=qe[nt+1],Ft=ne.within(qe[nt],qe[nt+1],Ye),sr=qe[nt+sn];let cr=sr;for(const hr of Ft){const ur=hr*at;qe[ur+2]>he&&(cr+=qe[ur+sn])}if(cr>sr&&cr>=$e){let hr,ur=xt*sr,Ur=zt*sr,Kr=-1;const _r=(nt/at<<5)+(he+1)+this.points.length;for(const Zr of Ft){const Tn=Zr*at;if(qe[Tn+2]<=he)continue;qe[Tn+2]=he;const Kn=qe[Tn+sn];ur+=qe[Tn]*Kn,Ur+=qe[Tn+1]*Kn,qe[Tn+4]=_r,Oe&&(hr||(hr=this._map(qe,nt,!0),Kr=this.clusterProps.length,this.clusterProps.push(hr)),Oe(hr,this._map(qe,Tn)))}qe[nt+4]=_r,Ke.push(ur/cr,Ur/cr,1/0,_r,-1,cr),Oe&&Ke.push(Kr)}else{for(let hr=0;hr<at;hr++)Ke.push(qe[nt+hr]);if(cr>1)for(const hr of Ft){const ur=hr*at;if(!(qe[ur+2]<=he)){qe[ur+2]=he;for(let Ur=0;Ur<at;Ur++)Ke.push(qe[ur+Ur])}}}}return Ke}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,he,we){if(ne[he+sn]>1){const $e=this.clusterProps[ne[he+Ci]];return we?Object.assign({},$e):$e}const De=this.points[ne[he+vn]].properties,Oe=this.options.map(De);return we&&Oe===De?Object.assign({},Oe):Oe}}function Pr(Je,ne,he){return{type:"Feature",id:Je[ne+vn],properties:Me(Je,ne,he),geometry:{type:"Point",coordinates:[(we=Je[ne],360*(we-.5)),Hr(Je[ne+1])]}};var we}function Me(Je,ne,he){const we=Je[ne+sn],De=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Oe=Je[ne+Ci],$e=Oe===-1?{}:Object.assign({},he[Oe]);return Object.assign($e,{cluster:!0,cluster_id:Je[ne+vn],point_count:we,point_count_abbreviated:De})}function Bt(Je){return Je/360+.5}function yn(Je){const ne=Math.sin(Je*Math.PI/180),he=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return he<0?0:he>1?1:he}function Hr(Je){const ne=(180-360*Je)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function _t(Je,ne,he,we){let De=we;const Oe=ne+(he-ne>>1);let $e,Ye=he-ne;const qe=Je[ne],Ke=Je[ne+1],at=Je[he],nt=Je[he+1];for(let xt=ne+3;xt<he;xt+=3){const zt=wn(Je[xt],Je[xt+1],qe,Ke,at,nt);if(zt>De)$e=xt,De=zt;else if(zt===De){const Ft=Math.abs(xt-Oe);Ft<Ye&&($e=xt,Ye=Ft)}}De>we&&($e-ne>3&&_t(Je,ne,$e,we),Je[$e+2]=De,he-$e>3&&_t(Je,$e,he,we))}function wn(Je,ne,he,we,De,Oe){let $e=De-he,Ye=Oe-we;if($e!==0||Ye!==0){const qe=((Je-he)*$e+(ne-we)*Ye)/($e*$e+Ye*Ye);qe>1?(he=De,we=Oe):qe>0&&(he+=$e*qe,we+=Ye*qe)}return $e=Je-he,Ye=ne-we,$e*$e+Ye*Ye}function hn(Je,ne,he,we){const De={id:Je??null,type:ne,geometry:he,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")fi(De,he);else if(ne==="Polygon")fi(De,he[0]);else if(ne==="MultiLineString")for(const Oe of he)fi(De,Oe);else if(ne==="MultiPolygon")for(const Oe of he)fi(De,Oe[0]);return De}function fi(Je,ne){for(let he=0;he<ne.length;he+=3)Je.minX=Math.min(Je.minX,ne[he]),Je.minY=Math.min(Je.minY,ne[he+1]),Je.maxX=Math.max(Je.maxX,ne[he]),Je.maxY=Math.max(Je.maxY,ne[he+1])}function Sr(Je,ne,he,we){if(!ne.geometry)return;const De=ne.geometry.coordinates;if(De&&De.length===0)return;const Oe=ne.geometry.type,$e=Math.pow(he.tolerance/((1<<he.maxZoom)*he.extent),2);let Ye=[],qe=ne.id;if(he.promoteId?qe=ne.properties[he.promoteId]:he.generateId&&(qe=we||0),Oe==="Point")An(De,Ye);else if(Oe==="MultiPoint")for(const Ke of De)An(Ke,Ye);else if(Oe==="LineString")di(De,Ye,$e,!1);else if(Oe==="MultiLineString"){if(he.lineMetrics){for(const Ke of De)Ye=[],di(Ke,Ye,$e,!1),Je.push(hn(qe,"LineString",Ye,ne.properties));return}Go(De,Ye,$e,!1)}else if(Oe==="Polygon")Go(De,Ye,$e,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const Ke of ne.geometry.geometries)Sr(Je,{id:qe,geometry:Ke,properties:ne.properties},he,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ke of De){const at=[];Go(Ke,at,$e,!0),Ye.push(at)}}Je.push(hn(qe,Oe,Ye,ne.properties))}function An(Je,ne){ne.push(qo(Je[0]),$a(Je[1]),0)}function di(Je,ne,he,we){let De,Oe,$e=0;for(let qe=0;qe<Je.length;qe++){const Ke=qo(Je[qe][0]),at=$a(Je[qe][1]);ne.push(Ke,at,0),qe>0&&($e+=we?(De*at-Ke*Oe)/2:Math.sqrt(Math.pow(Ke-De,2)+Math.pow(at-Oe,2))),De=Ke,Oe=at}const Ye=ne.length-3;ne[2]=1,_t(ne,0,Ye,he),ne[Ye+2]=1,ne.size=Math.abs($e),ne.start=0,ne.end=ne.size}function Go(Je,ne,he,we){for(let De=0;De<Je.length;De++){const Oe=[];di(Je[De],Oe,he,we),ne.push(Oe)}}function qo(Je){return Je/360+.5}function $a(Je){const ne=Math.sin(Je*Math.PI/180),he=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return he<0?0:he>1?1:he}function yr(Je,ne,he,we,De,Oe,$e,Ye){if(we/=ne,Oe>=(he/=ne)&&$e<we)return Je;if($e<he||Oe>=we)return null;const qe=[];for(const Ke of Je){const at=Ke.geometry;let nt=Ke.type;const xt=De===0?Ke.minX:Ke.minY,zt=De===0?Ke.maxX:Ke.maxY;if(xt>=he&&zt<we){qe.push(Ke);continue}if(zt<he||xt>=we)continue;let Ft=[];if(nt==="Point"||nt==="MultiPoint")Bl(at,Ft,he,we,De);else if(nt==="LineString")Ua(at,Ft,he,we,De,!1,Ye.lineMetrics);else if(nt==="MultiLineString")Oi(at,Ft,he,we,De,!1);else if(nt==="Polygon")Oi(at,Ft,he,we,De,!0);else if(nt==="MultiPolygon")for(const sr of at){const cr=[];Oi(sr,cr,he,we,De,!0),cr.length&&Ft.push(cr)}if(Ft.length){if(Ye.lineMetrics&&nt==="LineString"){for(const sr of Ft)qe.push(hn(Ke.id,nt,sr,Ke.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(Ft.length===1?(nt="LineString",Ft=Ft[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=Ft.length===3?"Point":"MultiPoint"),qe.push(hn(Ke.id,nt,Ft,Ke.tags))}}return qe.length?qe:null}function Bl(Je,ne,he,we,De){for(let Oe=0;Oe<Je.length;Oe+=3){const $e=Je[Oe+De];$e>=he&&$e<=we&&fo(ne,Je[Oe],Je[Oe+1],Je[Oe+2])}}function Ua(Je,ne,he,we,De,Oe,$e){let Ye=Xs(Je);const qe=De===0?uu:hu;let Ke,at,nt=Je.start;for(let cr=0;cr<Je.length-3;cr+=3){const hr=Je[cr],ur=Je[cr+1],Ur=Je[cr+2],Kr=Je[cr+3],_r=Je[cr+4],Zr=De===0?hr:ur,Tn=De===0?Kr:_r;let Kn=!1;$e&&(Ke=Math.sqrt(Math.pow(hr-Kr,2)+Math.pow(ur-_r,2))),Zr<he?Tn>he&&(at=qe(Ye,hr,ur,Kr,_r,he),$e&&(Ye.start=nt+Ke*at)):Zr>we?Tn<we&&(at=qe(Ye,hr,ur,Kr,_r,we),$e&&(Ye.start=nt+Ke*at)):fo(Ye,hr,ur,Ur),Tn<he&&Zr>=he&&(at=qe(Ye,hr,ur,Kr,_r,he),Kn=!0),Tn>we&&Zr<=we&&(at=qe(Ye,hr,ur,Kr,_r,we),Kn=!0),!Oe&&Kn&&($e&&(Ye.end=nt+Ke*at),ne.push(Ye),Ye=Xs(Je)),$e&&(nt+=Ke)}let xt=Je.length-3;const zt=Je[xt],Ft=Je[xt+1],sr=De===0?zt:Ft;sr>=he&&sr<=we&&fo(Ye,zt,Ft,Je[xt+2]),xt=Ye.length-3,Oe&&xt>=3&&(Ye[xt]!==Ye[0]||Ye[xt+1]!==Ye[1])&&fo(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ne.push(Ye)}function Xs(Je){const ne=[];return ne.size=Je.size,ne.start=Je.start,ne.end=Je.end,ne}function Oi(Je,ne,he,we,De,Oe){for(const $e of Je)Ua($e,ne,he,we,De,Oe,!1)}function fo(Je,ne,he,we){Je.push(ne,he,we)}function uu(Je,ne,he,we,De,Oe){const $e=(Oe-ne)/(we-ne);return fo(Je,Oe,he+(De-he)*$e,1),$e}function hu(Je,ne,he,we,De,Oe){const $e=(Oe-he)/(De-he);return fo(Je,ne+(we-ne)*$e,Oe,1),$e}function Fl(Je,ne){const he=[];for(let we=0;we<Je.length;we++){const De=Je[we],Oe=De.type;let $e;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")$e=Va(De.geometry,ne);else if(Oe==="MultiLineString"||Oe==="Polygon"){$e=[];for(const Ye of De.geometry)$e.push(Va(Ye,ne))}else if(Oe==="MultiPolygon"){$e=[];for(const Ye of De.geometry){const qe=[];for(const Ke of Ye)qe.push(Va(Ke,ne));$e.push(qe)}}he.push(hn(De.id,Oe,$e,De.tags))}return he}function Va(Je,ne){const he=[];he.size=Je.size,Je.start!==void 0&&(he.start=Je.start,he.end=Je.end);for(let we=0;we<Je.length;we+=3)he.push(Je[we]+ne,Je[we+1],Je[we+2]);return he}function Ys(Je,ne){if(Je.transformed)return Je;const he=1<<Je.z,we=Je.x,De=Je.y;for(const Oe of Je.features){const $e=Oe.geometry,Ye=Oe.type;if(Oe.geometry=[],Ye===1)for(let qe=0;qe<$e.length;qe+=2)Oe.geometry.push(Nl($e[qe],$e[qe+1],ne,he,we,De));else for(let qe=0;qe<$e.length;qe++){const Ke=[];for(let at=0;at<$e[qe].length;at+=2)Ke.push(Nl($e[qe][at],$e[qe][at+1],ne,he,we,De));Oe.geometry.push(Ke)}}return Je.transformed=!0,Je}function Nl(Je,ne,he,we,De,Oe){return[Math.round(he*(Je*we-De)),Math.round(he*(ne*we-Oe))]}function Co(Je,ne,he,we,De){const Oe=ne===De.maxZoom?0:De.tolerance/((1<<ne)*De.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:Je.length,source:null,x:he,y:we,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Je)fu($e,Ye,Oe,De);return $e}function fu(Je,ne,he,we){const De=ne.geometry,Oe=ne.type,$e=[];if(Je.minX=Math.min(Je.minX,ne.minX),Je.minY=Math.min(Je.minY,ne.minY),Je.maxX=Math.max(Je.maxX,ne.maxX),Je.maxY=Math.max(Je.maxY,ne.maxY),Oe==="Point"||Oe==="MultiPoint")for(let Ye=0;Ye<De.length;Ye+=3)$e.push(De[Ye],De[Ye+1]),Je.numPoints++,Je.numSimplified++;else if(Oe==="LineString")zr($e,De,Je,he,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let Ye=0;Ye<De.length;Ye++)zr($e,De[Ye],Je,he,Oe==="Polygon",Ye===0);else if(Oe==="MultiPolygon")for(let Ye=0;Ye<De.length;Ye++){const qe=De[Ye];for(let Ke=0;Ke<qe.length;Ke++)zr($e,qe[Ke],Je,he,!0,Ke===0)}if($e.length){let Ye=ne.tags||null;if(Oe==="LineString"&&we.lineMetrics){Ye={};for(const Ke in ne.tags)Ye[Ke]=ne.tags[Ke];Ye.mapbox_clip_start=De.start/De.size,Ye.mapbox_clip_end=De.end/De.size}const qe={geometry:$e,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Ye};ne.id!==null&&(qe.id=ne.id),Je.features.push(qe)}}function zr(Je,ne,he,we,De,Oe){const $e=we*we;if(we>0&&ne.size<(De?$e:we))return void(he.numPoints+=ne.length/3);const Ye=[];for(let qe=0;qe<ne.length;qe+=3)(we===0||ne[qe+2]>$e)&&(he.numSimplified++,Ye.push(ne[qe],ne[qe+1])),he.numPoints++;De&&function(qe,Ke){let at=0;for(let nt=0,xt=qe.length,zt=xt-2;nt<xt;zt=nt,nt+=2)at+=(qe[nt]-qe[zt])*(qe[nt+1]+qe[zt+1]);if(at>0===Ke)for(let nt=0,xt=qe.length;nt<xt/2;nt+=2){const zt=qe[nt],Ft=qe[nt+1];qe[nt]=qe[xt-2-nt],qe[nt+1]=qe[xt-1-nt],qe[xt-2-nt]=zt,qe[xt-1-nt]=Ft}}(Ye,Oe),Je.push(Ye)}const da={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Rh{constructor(ne,he){const we=(he=this.options=function(Oe,$e){for(const Ye in $e)Oe[Ye]=$e[Ye];return Oe}(Object.create(da),he)).debug;if(we&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Oe,$e){const Ye=[];if(Oe.type==="FeatureCollection")for(let qe=0;qe<Oe.features.length;qe++)Sr(Ye,Oe.features[qe],$e,qe);else Sr(Ye,Oe.type==="Feature"?Oe:{geometry:Oe},$e);return Ye}(ne,he);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Oe,$e){const Ye=$e.buffer/$e.extent;let qe=Oe;const Ke=yr(Oe,1,-1-Ye,Ye,0,-1,2,$e),at=yr(Oe,1,1-Ye,2+Ye,0,-1,2,$e);return(Ke||at)&&(qe=yr(Oe,1,-Ye,1+Ye,0,-1,2,$e)||[],Ke&&(qe=Fl(Ke,1).concat(qe)),at&&(qe=qe.concat(Fl(at,-1)))),qe}(De,he),De.length&&this.splitTile(De,0,0,0),we&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,he,we,De,Oe,$e,Ye){const qe=[ne,he,we,De],Ke=this.options,at=Ke.debug;for(;qe.length;){De=qe.pop(),we=qe.pop(),he=qe.pop(),ne=qe.pop();const nt=1<<he,xt=po(he,we,De);let zt=this.tiles[xt];if(!zt&&(at>1&&console.time("creation"),zt=this.tiles[xt]=Co(ne,he,we,De,Ke),this.tileCoords.push({z:he,x:we,y:De}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,we,De,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));const Kn=`z${he}`;this.stats[Kn]=(this.stats[Kn]||0)+1,this.total++}if(zt.source=ne,Oe==null){if(he===Ke.indexMaxZoom||zt.numPoints<=Ke.indexMaxPoints)continue}else{if(he===Ke.maxZoom||he===Oe)continue;if(Oe!=null){const Kn=Oe-he;if(we!==$e>>Kn||De!==Ye>>Kn)continue}}if(zt.source=null,ne.length===0)continue;at>1&&console.time("clipping");const Ft=.5*Ke.buffer/Ke.extent,sr=.5-Ft,cr=.5+Ft,hr=1+Ft;let ur=null,Ur=null,Kr=null,_r=null,Zr=yr(ne,nt,we-Ft,we+cr,0,zt.minX,zt.maxX,Ke),Tn=yr(ne,nt,we+sr,we+hr,0,zt.minX,zt.maxX,Ke);ne=null,Zr&&(ur=yr(Zr,nt,De-Ft,De+cr,1,zt.minY,zt.maxY,Ke),Ur=yr(Zr,nt,De+sr,De+hr,1,zt.minY,zt.maxY,Ke),Zr=null),Tn&&(Kr=yr(Tn,nt,De-Ft,De+cr,1,zt.minY,zt.maxY,Ke),_r=yr(Tn,nt,De+sr,De+hr,1,zt.minY,zt.maxY,Ke),Tn=null),at>1&&console.timeEnd("clipping"),qe.push(ur||[],he+1,2*we,2*De),qe.push(Ur||[],he+1,2*we,2*De+1),qe.push(Kr||[],he+1,2*we+1,2*De),qe.push(_r||[],he+1,2*we+1,2*De+1)}}getTile(ne,he,we){ne=+ne,he=+he,we=+we;const De=this.options,{extent:Oe,debug:$e}=De;if(ne<0||ne>24)return null;const Ye=1<<ne,qe=po(ne,he=he+Ye&Ye-1,we);if(this.tiles[qe])return Ys(this.tiles[qe],Oe);$e>1&&console.log("drilling down to z%d-%d-%d",ne,he,we);let Ke,at=ne,nt=he,xt=we;for(;!Ke&&at>0;)at--,nt>>=1,xt>>=1,Ke=this.tiles[po(at,nt,xt)];return Ke&&Ke.source?($e>1&&(console.log("found parent tile z%d-%d-%d",at,nt,xt),console.time("drilling down")),this.splitTile(Ke.source,at,nt,xt,ne,he,we),$e>1&&console.timeEnd("drilling down"),this.tiles[qe]?Ys(this.tiles[qe],Oe):null):null}}function po(Je,ne,he){return 32*((1<<Je)*he+ne)+Je}function Ks(Je,ne){const he=Je.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const we=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!we)return void ne(null,null);const De=new be(we.features);let Oe=Yt(De);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),ne(null,{vectorTile:De,rawData:Oe.buffer})}class du extends ae{constructor(ne,he,we,De,Oe,$e){super(ne,he,we,De,Ks,$e),Oe&&(this.loadGeoJSON=Oe),this._dynamicIndex=new ht}loadData(ne,he){const we=ne&&ne.request,De=we&&we.collectResourceTiming;this.loadGeoJSON(ne,(Oe,$e)=>{if(Oe||!$e)return he(Oe);if(typeof $e!="object")return he(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const qe=o.M(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));$e.features=$e.features.filter(Ke=>qe.value.evaluate({zoom:0},Ke))}ne.dynamic?($e.type==="Feature"&&($e={type:"FeatureCollection",features:[$e]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load($e.features,this.loaded),ne.cluster&&($e.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new rr(function({superclusterOptions:qe,clusterProperties:Ke}){if(!Ke||!qe)return qe;const at={},nt={},xt={accumulated:null,zoom:0},zt={properties:null},Ft=Object.keys(Ke);for(const sr of Ft){const[cr,hr]=Ke[sr],ur=o.M(hr),Ur=o.M(typeof cr=="string"?[cr,["accumulated"],["get",sr]]:cr);at[sr]=ur.value,nt[sr]=Ur.value}return qe.map=sr=>{zt.properties=sr;const cr={};for(const hr of Ft)cr[hr]=at[hr].evaluate(xt,zt);return cr},qe.reduce=(sr,cr)=>{zt.properties=cr;for(const hr of Ft)xt.accumulated=sr[hr],sr[hr]=nt[hr].evaluate(xt,zt)},qe}(ne)).load($e.features):ne.dynamic?this._dynamicIndex:function(qe,Ke){return new Rh(qe,Ke)}($e,ne.geojsonVtOptions)}catch(qe){return he(qe)}const Ye={};if(De){const qe=L(we);qe&&(Ye.resourceTiming={},Ye.resourceTiming[ne.source]=JSON.parse(JSON.stringify(qe)))}he(null,Ye)}})}reloadTile(ne,he){const we=this.loaded;return we&&we[ne.uid]?ne.partial?he(null,void 0):super.reloadTile(ne,he):this.loadTile(ne,he)}loadGeoJSON(ne,he){if(ne.request)o.n(ne.request,he);else{if(typeof ne.data!="string")return he(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return he(null,JSON.parse(ne.data))}catch{return he(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(we){he(we)}}getClusterChildren(ne,he){try{he(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(we){he(we)}}getClusterLeaves(ne,he){try{he(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(we){he(we)}}}class jl{constructor(ne,he){this.tileID=new o.aA(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=he}parse(ne,he,we,De){this.status="parsing";const Oe=new o.aA(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),$e={},Ye=he.familiesBySource[we.source],qe=new o.dR(Oe,we.promoteId);return qe.bucketLayerIDs=[],qe.is3DTile=!0,o.e0(ne).then(Ke=>{if(!Ke)return De(new Error("Could not parse tile"));const at=o.e1(Ke,1/o.c8(we.tileID.canonical)),nt=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ke.json.asset.extras&&Ke.json.asset.extras.MAPBOX_mesh_features,xt=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("EXT_meshopt_compression"),zt=new o.a3(this.zoom,{brightness:this.brightness});for(const Ft in Ye)for(const sr of Ye[Ft]){const cr=sr[0];qe.bucketLayerIDs.push(sr.map(ur=>ur.id)),cr.recalculate(zt,[]);const hr=new o.e2(at,Oe,nt,xt,this.brightness,qe);nt||(hr.needsUpload=!0),$e[cr.fqid]=hr,hr.evaluate(cr)}this.status="done",De(null,{buckets:$e,featureIndex:qe})}).catch(Ke=>De(new Error(Ke.message)))}}class pu{constructor(ne,he,we,De,Oe,$e){this.actor=ne,this.layerIndex=he,this.brightness=$e,this.loading={},this.loaded={}}loadTile(ne,he){const we=ne.uid,De=this.loading[we]=new jl(ne,this.brightness);o.bc(ne.request,(Oe,$e)=>{const Ye=!this.loading[we];return delete this.loading[we],Ye||Oe?(De.status="done",Ye||(this.loaded[we]=De),he(Oe)):$e&&$e.byteLength!==0?void De.parse($e,this.layerIndex,ne,(qe,Ke)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[we]=De,qe||!Ke?he(qe):he(null,Ke)}):(De.status="done",this.loaded[we]=De,he())})}reloadTile(ne,he){const we=this.loaded,De=ne.uid;if(we&&we[De]){const Oe=we[De];Oe.projection=ne.projection,Oe.brightness=ne.brightness;const $e=(Ye,qe)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(ne,he)),he(Ye,qe)};Oe.status==="parsing"?Oe.reloadCallback=$e:Oe.status==="done"&&this.loadTile(ne,he)}}abortTile(ne,he){const we=ne.uid;this.loading[we]&&delete this.loading[we],he()}removeTile(ne,he){const we=this.loaded,De=ne.uid;we&&we[De]&&delete we[De],he()}}class Js{constructor(ne){this.self=ne,this.actor=new o.e3(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bL({name:"mercator"}),this.workerSourceTypes={vector:ae,geojson:du,"batched-model":pu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(he,we)=>{if(this.workerSourceTypes[he])throw new Error(`Worker source with name "${he}" already registered.`);this.workerSourceTypes[he]=we},this.self.registerRTLTextPlugin=he=>{if(o.e4.isParsed())throw new Error("RTL text plugin already registered.");o.e4.applyArabicShaping=he.applyArabicShaping,o.e4.processBidirectionalText=he.processBidirectionalText,o.e4.processStyledBidirectionalText=he.processStyledBidirectionalText}}clearCaches(ne,he,we){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],delete this.rasterArrayWorkerSource,we()}checkIfReady(ne,he,we){we()}setReferrer(ne,he){this.referrer=he}spriteLoaded(ne,{scope:he,isLoaded:we}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][he]=we,this.workerSources[ne]&&this.workerSources[ne][he])for(const De in this.workerSources[ne][he]){const Oe=this.workerSources[ne][he][De];for(const $e in Oe){const Ye=Oe[$e];Ye instanceof ae&&(Ye.isSpriteLoaded=we,Ye.fire(new o.x("isSpriteLoaded")))}}}setImages(ne,{scope:he,images:we},De){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][he]=we,this.workerSources[ne]&&this.workerSources[ne][he]){for(const Oe in this.workerSources[ne][he]){const $e=this.workerSources[ne][he][Oe];for(const Ye in $e)$e[Ye].availableImages=we}De()}else De()}setProjection(ne,he){this.projections[ne]=o.bL(he)}setBrightness(ne,he,we){this.brightness=he,we()}setLayers(ne,he,we){this.getLayerIndex(ne,he.scope).replace(he.layers,he.options),we()}updateLayers(ne,he,we){this.getLayerIndex(ne,he.scope).update(he.layers,he.removedIds,he.options),we()}loadTile(ne,he,we){he.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,he.type,he.source,he.scope).loadTile(he,we)}loadDEMTile(ne,he,we){this.getDEMWorkerSource(ne,he.source,he.scope).loadTile(he,we)}decodeRasterArray(ne,he,we){this.getRasterArrayWorkerSource().decodeRasterArray(he,we)}reloadTile(ne,he,we){he.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,he.type,he.source,he.scope).reloadTile(he,we)}abortTile(ne,he,we){this.getWorkerSource(ne,he.type,he.source,he.scope).abortTile(he,we)}removeTile(ne,he,we){this.getWorkerSource(ne,he.type,he.source,he.scope).removeTile(he,we)}removeSource(ne,he,we){if(!(this.workerSources[ne]&&this.workerSources[ne][he.scope]&&this.workerSources[ne][he.scope][he.type]&&this.workerSources[ne][he.scope][he.type][he.source]))return;const De=this.workerSources[ne][he.scope][he.type][he.source];delete this.workerSources[ne][he.scope][he.type][he.source],De.removeSource!==void 0?De.removeSource(he,we):we()}loadWorkerSource(ne,he,we){try{this.self.importScripts(he.url),we()}catch(De){we(De.toString())}}syncRTLPluginState(ne,he,we){try{o.e4.setState(he);const De=o.e4.getPluginURL();if(o.e4.isLoaded()&&!o.e4.isParsed()&&De!=null){this.self.importScripts(De);const Oe=o.e4.isParsed();we(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Oe)}}catch(De){we(De.toString())}}setDracoUrl(ne,he){this.dracoUrl=he}getAvailableImages(ne,he){this.availableImages[ne]||(this.availableImages[ne]={});let we=this.availableImages[ne][he];return we||(we=[]),we}getLayerIndex(ne,he){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let we=this.layerIndexes[ne][he];return we||(we=this.layerIndexes[ne][he]=new H,we.scope=he),we}getWorkerSource(ne,he,we,De){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][De]||(this.workerSources[ne][De]={}),this.workerSources[ne][De][he]||(this.workerSources[ne][De][he]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.workerSources[ne][De][he][we]||(this.workerSources[ne][De][he][we]=new this.workerSourceTypes[he]({send:(Oe,$e,Ye,qe,Ke,at)=>{this.actor.send(Oe,$e,Ye,ne,Ke,at)},scheduler:this.actor.scheduler},this.getLayerIndex(ne,De),this.getAvailableImages(ne,De),this.isSpriteLoaded[ne][De],void 0,this.brightness)),this.workerSources[ne][De][he][we]}getDEMWorkerSource(ne,he,we){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][we]||(this.demWorkerSources[ne][we]={}),this.demWorkerSources[ne][we][he]||(this.demWorkerSources[ne][we][he]=new J),this.demWorkerSources[ne][we][he]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ue),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ne,he){o.e5(he)}getWorkerPerformanceMetrics(ne,he,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Js(self)),Js}),w(["./shared"],function(o){var L="3.7.0";const $={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(d){performance.mark(d)},measure(d,n,l){performance.measure(d,n,l)}};function H(d){const n=d.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var Y,oe={},te=function(){if(Y)return oe;function d(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,T,C=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(C);try{T=new Worker(D),x=!0}catch{x=!1}return T&&T.terminate(),URL.revokeObjectURL(D),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var T=x.getContext("2d");if(!T)return!1;var C=T.getImageData(0,0,1,1);return C&&C.width===x.width}()?(l[_=p&&p.failIfMajorPerformanceCaveat]===void 0&&(l[_]=function(x){var T,C=function(D){var z=document.createElement("canvas"),B=Object.create(d.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=D,z.getContext("webgl2",B)}(x);if(!C)return!1;try{T=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!T||C.isContextLost())&&(C.shaderSource(T,"void main() {}"),C.compileShader(T),C.getShaderParameter(T,C.COMPILE_STATUS)===!0)}(_)),l[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}Y=1,oe.supported=d,oe.notSupportedReason=n;var l={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},oe}();function ie(d,n,l){const p=document.createElement(d);return n!=null&&(p.className=n),l&&l.appendChild(p),p}function ae(d,n,l){const p=document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(n))p.setAttributeNS(null,_,String(n[_]));return l&&l.appendChild(p),p}const J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ue=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect";let le;function se(){J&&ue&&(le=J[ue],J[ue]="none")}function be(){J&&ue&&(J[ue]=le)}function Ie(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Ie,!0)}function Ae(){window.addEventListener("click",Ie,!0),window.setTimeout(()=>{window.removeEventListener("click",Ie,!0)},0)}function ht(d,n){const l=d.getBoundingClientRect();return He(d,l,n)}function st(d,n){const l=d.getBoundingClientRect(),p=[];for(let _=0;_<n.length;_++)p.push(He(d,l,n[_]));return p}function We(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function He(d,n,l){const p=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new o.P((l.clientX-n.left)*p,(l.clientY-n.top)*p)}const At="01",Tt="NO_ACCESS_TOKEN";class kt{constructor(n,l,p){this._transformRequestFn=n,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",At,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}normalizeStyleURL(n,l){if(!o.f(n))return n;const p=Ot(n);return p.params.push(`sdk=js-${L}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(n,l){if(!o.f(n))return n;const p=Ot(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(n,l){if(!o.f(n))return n;const p=Ot(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(n,l,p,_){if(!o.f(n))return n;const x=Ot(n);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),p&&x.params.push(`language=${p}`),_&&x.params.push(`worldview=${_}`),this._makeAPIURL(x,this._customAccessToken||l)}normalizeSpriteURL(n,l,p,_){const x=Ot(n);return o.f(n)?(x.path=`/styles/v1${x.path}/sprite${l}${p}`,this._makeAPIURL(x,this._customAccessToken||_)):(x.path+=`${l}${p}`,mt(x))}normalizeTileURL(n,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.f(n))return n;const _=Ot(n);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&_.authority!=="raster"&&p===512?"@2x":""}${o.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${o.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${o.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${o.e.TILE_URL_VERSION}${_.path}`);const x=this._customAccessToken||function(T){for(const C of T){const D=C.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(_.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,x)}canonicalizeTileURL(n,l){const p=Ot(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let _="mapbox://";p.path.match(/^\/raster\/v1\//)?_+=`raster/${p.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${p.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${p.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=p.params;return l&&(x=x.filter(T=>!T.match(/^access_token=/))),x.length&&(_+=`?${x.join("&")}`),_}canonicalizeTileset(n,l){const p=!!l&&o.f(l),_=[];for(const x of n.tiles||[])o.h(x)?_.push(this.canonicalizeTileURL(x,p)):_.push(x);return _}_makeAPIURL(n,l){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Ot(o.e.API_URL);if(n.protocol=_.protocol,n.authority=_.authority,n.protocol==="http"){const x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(_.path!=="/"&&(n.path=`${_.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return mt(n);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(x=>x.indexOf("access_token")===-1),n.params.push(`access_token=${l||""}`),mt(n)}}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ot(d){const n=d.match(ct);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function mt(d){const n=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${n}`}const Lt="mapbox.eventData";function yt(d){if(!d)return null;const n=d.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.j(n[1]))}catch{return null}}class Zt{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const l=yt(o.e.ACCESS_TOKEN);let p="";return p=l&&l.u?o.k(l.u):o.e.ACCESS_TOKEN||"",n?`${Lt}.${n}:${p}`:`${Lt}:${p}`}fetchEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const _=localStorage.getItem(l);_&&(this.eventData=JSON.parse(_));const x=localStorage.getItem(p);x&&(this.anonId=x)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),_=this.anonId;if(n&&_)try{localStorage.setItem(p,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,p,_){if(!o.e.EVENTS_URL)return;const x=Ot(o.e.EVENTS_URL);x.params.push(`access_token=${_||o.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(n).toISOString()},C=l?o.l(T,l):T,D={url:mt(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=o.p(D,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(_)})}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}const Yt=new class extends Zt{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(l=>o.f(l)||o.h(l))&&this.queueRequest(Date.now(),n)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=yt(o.e.ACCESS_TOKEN),l=n?n.u:o.e.ACCESS_TOKEN;let p=l!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),p=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),T=new Date(_),C=(_-this.eventData.lastSuccess)/864e5;p=p||C>=1||C<-1||x.getDate()!==T.getDate()}else p=!0;p?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:At,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=_,this.eventData.tokenU=l)},d):this.processRequests()}},xr=Yt.postTurnstileEvent.bind(Yt),Vt=new class extends Zt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,n,l,p){this.skuToken=n,this.errorCb=p,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},l):this.errorCb(new Error(Tt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:At,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},d))}remove(){this.errorCb=null}},Sn=Vt.postMapLoadEvent.bind(Vt),vn=new class extends Zt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let n=this.mapInstanceIdMap.get(d);return n||(n=o.u(),this.mapInstanceIdMap.set(d,n)),n}getEventId(d){const n=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,n+1),n}postStyleLoadEvent(d,n){const{map:l,style:p,importedStyles:_}=n;if(!o.e.EVENTS_URL||!d&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(l),T={mapInstanceId:x,eventId:this.getEventId(x),style:p};_.length&&(T.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:T},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,()=>{},d)}},sn=vn.postStyleLoadEvent.bind(vn),Ci=new class extends Zt{constructor(){super("gljs.performance")}postPerformanceEvent(d,n){o.e.EVENTS_URL&&(d||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:l}=this.queue.shift(),p=function(_){const x=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),C=function(q){const K={};if(q){for(const Q in q)if(Q!=="other")for(const ee of q[Q]){const re=`${Q}ResolveRangeMin`,me=`${Q}ResolveRangeMax`,ye=`${Q}RequestCount`,de=`${Q}RequestCachedCount`;K[re]=Math.min(K[re]||1/0,ee.startTime),K[me]=Math.max(K[me]||-1/0,ee.responseEnd);const xe=ve=>{K[ve]===void 0&&(K[ve]=0),++K[ve]};ee.transferSize!==void 0&&ee.transferSize===0&&xe(de),xe(ye)}}return K}(function(q,K){const Q={};if(q)for(const ee of q){const re=K(ee);Q[re]===void 0&&(Q[re]=[]),Q[re].push(ee)}return Q}(x,H)),D=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=z?z.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},V=(q,K,Q)=>{Q!=null&&q.push({name:K,value:Q.toString()})};for(const q in C)V(U.counters,q,C[q]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(V(U.counters,"interactionRangeMin",_.interactionRange[0]),V(U.counters,"interactionRangeMax",_.interactionRange[1])),T)for(const q of Object.keys($)){const K=$[q],Q=T.find(ee=>ee.name===K);Q&&V(U.counters,K,Q.startTime)}return V(U.counters,"visibilityHidden",_.visibilityHidden),V(U.attributes,"style",function(q){if(q)for(const K of q){const Q=K.name.split("?")[0];if(o.i(Q)){const ee=Q.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(x)),V(U.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),V(U.attributes,"fogEnabled",_.fogEnabled?"true":"false"),V(U.attributes,"projection",_.projection),V(U.attributes,"zoom",_.zoom),V(U.metadata,"devicePixelRatio",D),V(U.metadata,"connectionEffectiveType",B),V(U.metadata,"navigatorUserAgent",navigator.userAgent),V(U.metadata,"screenWidth",window.screen.width),V(U.metadata,"screenHeight",window.screen.height),V(U.metadata,"windowWidth",window.innerWidth),V(U.metadata,"windowHeight",window.innerHeight),V(U.metadata,"mapWidth",_.width/D),V(U.metadata,"mapHeight",_.height/D),V(U.metadata,"webglRenderer",_.renderer),V(U.metadata,"webglVendor",_.vendor),V(U.metadata,"sdkVersion",L),V(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(l);for(const _ of p.metadata);for(const _ of p.counters);for(const _ of p.attributes);this.postEvent(n,p,()=>{},d)}},rr=Ci.postPerformanceEvent.bind(Ci),Pr=new class extends Zt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,n,l,p){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const _=Ot(o.e.API_URL+o.e.SESSION_PATH);_.params.push(`sku=${n||""}`),_.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const x={url:mt(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,T=>{this.pendingRequest=null,l(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(d,n,l,p){this.skuToken=n,this.errorCb=p,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},l):this.errorCb(new Error(Tt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},d)}remove(){this.errorCb=null}},Me=Pr.getSessionAPI.bind(Pr),Bt=new Set;function yn(d,n){n?Bt.add(d):Bt.delete(d)}class Hr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function _t(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class wn extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new o.r({width:1,height:1})}isLoaded(){for(const n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,l){if(this.loaded[l]!==n&&(this.loaded[l]=n,n)){for(const{ids:p,callback:_}of this.requestors)this._notify(p,l,_);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images[l][n]}addImage(n,l,p){this._validate(n,p)&&(this.images[l][n]=p)}_validate(n,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.t(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.t(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.t(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,l){if(!n)return!0;let p=0;for(const _ of n){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l,p){p.version=this.images[l][n].version+1,this.images[l][n]=p,this.updatedImages[l][n]=!0}removeImage(n,l){const p=this.images[l][n];delete this.images[l][n],delete this.patterns[l][n],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,l,p){let _=!0;const x=!!this.loaded[l];if(!x)for(const T of n)this.images[l][T]||(_=!1);x||_?this._notify(n,l,p):this.requestors.push({ids:n,scope:l,callback:p})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,l,p){const _={};for(const x of n){this.images[l][x]||this.fire(new o.x("styleimagemissing",{id:x}));const T=this.images[l][x];T?_[x]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:o.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,_)}getPixelSize(n){const{width:l,height:p}=this.atlasImage[n];return{width:l,height:p}}getPattern(n,l,p){const _=this.patterns[l][n],x=this.getImage(n,l);if(!x)return null;if(_&&_.position.version===x.version)return _.position;if(_)_.position.version=x.version;else{const T={w:x.data.width+2*o.y,h:x.data.height+2*o.y,x:0,y:0},C=new o.I(T,x,o.y);this.patterns[l][n]={bin:T,position:C}}return this._updatePatternAtlas(l,p),this.patterns[l][n].position}bind(n,l){const p=n.gl;let _=this.atlasTexture[l];_?this.dirty&&(_.update(this.atlasImage[l]),this.dirty=!1):(_=new o.T(n,this.atlasImage[l],p.RGBA8),this.atlasTexture[l]=_),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const p=[];for(const C in this.patterns[n])p.push(this.patterns[n][C].bin);const{w:_,h:x}=o.z(p),T=this.atlasImage[n];T.resize({width:_||1,height:x||1});for(const C in this.patterns[n]){const{bin:D,position:z}=this.patterns[n][C];let B=z.padding;const U=D.x+B,V=D.y+B,q=this.images[n][C].data,K=q.width,Q=q.height;B=B>1?B-1:B,o.r.copy(q,T,{x:0,y:0},{x:U,y:V},{width:K,height:Q},l),o.r.copy(q,T,{x:0,y:Q-B},{x:U,y:V-B},{width:K,height:B},l),o.r.copy(q,T,{x:0,y:0},{x:U,y:V+Q},{width:K,height:B},l),o.r.copy(q,T,{x:K-B,y:0},{x:U-B,y:V},{width:B,height:Q},l),o.r.copy(q,T,{x:0,y:0},{x:U+K,y:V},{width:B,height:Q},l),o.r.copy(q,T,{x:K-B,y:Q-B},{x:U-B,y:V-B},{width:B,height:B},l),o.r.copy(q,T,{x:0,y:Q-B},{x:U+K,y:V-B},{width:B,height:B},l),o.r.copy(q,T,{x:0,y:0},{x:U+K,y:V+Q},{width:B,height:B},l),o.r.copy(q,T,{x:K-B,y:0},{x:U-B,y:V+Q},{width:B,height:B},l)}this.dirty=!0}beginFrame(){for(const n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,l){for(const p of n){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;const _=this.images[l][p];_t(_)&&this.updateImage(p,l,_)}}}function hn(d){const n=d.key,l=d.value,p=d.valueSpec||{},_=d.objectElementValidators||{},x=d.style,T=d.styleSpec;let C=[];const D=o.B(l);if(D!=="object")return[new o.V(n,l,`object expected, ${D} found`)];for(const z in l){const B=z.split(".")[0];let U;_[B]?U=_[B]:p[B]?U=zr:_["*"]?U=_["*"]:p["*"]&&(U=zr),U?C=C.concat(U({key:(n&&`${n}.`)+z,value:l[z],valueSpec:p[B]||p["*"],style:x,styleSpec:T,object:l,objectKey:z},l)):C.push(new o.A(n,l[z],`unknown property "${z}"`))}for(const z in p)_[z]||p[z].required&&p[z].default===void 0&&l[z]===void 0&&C.push(new o.V(n,l,`missing required property "${z}"`));return C}function fi(d){const n=d.value,l=d.valueSpec,p=d.style,_=d.styleSpec,x=d.key,T=d.arrayElementValidator||zr;if(o.B(n)!=="array")return[new o.V(x,n,`array expected, ${o.B(n)} found`)];if(l.length&&n.length!==l.length)return[new o.V(x,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new o.V(x,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(C.function=l.function),o.B(l.value)==="object"&&(C=l.value);let D=[];for(let z=0;z<n.length;z++)D=D.concat(T({array:n,arrayIndex:z,value:n[z],valueSpec:C,style:p,styleSpec:_,key:`${x}[${z}]`},!0));return D}function Sr(d){const n=d.key,l=d.value,p=d.valueSpec;let _=o.B(l);if(_==="number"&&l!=l&&(_="NaN"),_!=="number")return[new o.V(n,l,`number expected, ${_} found`)];if("minimum"in p){let x=p.minimum;if(o.B(p.minimum)==="array"&&(x=p.minimum[d.arrayIndex]),l<x)return[new o.V(n,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(o.B(p.maximum)==="array"&&(x=p.maximum[d.arrayIndex]),l>x)return[new o.V(n,l,`${l} is greater than the maximum value ${x}`)]}return[]}function An(d){const n=d.valueSpec,l=o.D(d.value.type);let p,_,x,T={};const C=l!=="categorical"&&d.value.property===void 0,D=!C,z=o.B(d.value.stops)==="array"&&o.B(d.value.stops[0])==="array"&&o.B(d.value.stops[0][0])==="object",B=hn({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(q){if(l==="identity")return[new o.V(q.key,q.value,'identity function may not have a "stops" property')];let K=[];const Q=q.value;return K=K.concat(fi({key:q.key,value:Q,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:U})),o.B(Q)==="array"&&Q.length===0&&K.push(new o.V(q.key,Q,"array must have at least one stop")),K},default:function(q){return zr({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return l==="identity"&&C&&B.push(new o.V(d.key,d.value,'missing required property "property"')),l==="identity"||d.value.stops||B.push(new o.V(d.key,d.value,'missing required property "stops"')),l==="exponential"&&d.valueSpec.expression&&!o.F(d.valueSpec)&&B.push(new o.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(D&&!o.G(d.valueSpec)?B.push(new o.V(d.key,d.value,"property functions not supported")):C&&!o.H(d.valueSpec)&&B.push(new o.V(d.key,d.value,"zoom functions not supported"))),l!=="categorical"&&!z||d.value.property!==void 0||B.push(new o.V(d.key,d.value,'"property" property is required')),B;function U(q){let K=[];const Q=q.value,ee=q.key;if(o.B(Q)!=="array")return[new o.V(ee,Q,`array expected, ${o.B(Q)} found`)];if(Q.length!==2)return[new o.V(ee,Q,`array length 2 expected, length ${Q.length} found`)];if(z){if(o.B(Q[0])!=="object")return[new o.V(ee,Q,`object expected, ${o.B(Q[0])} found`)];if(Q[0].zoom===void 0)return[new o.V(ee,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new o.V(ee,Q,"object stop key must have value")];const re=o.D(Q[0].zoom);if(typeof re!="number")return[new o.V(ee,Q[0].zoom,"stop zoom values must be numbers")];if(x&&x>re)return[new o.V(ee,Q[0].zoom,"stop zoom values must appear in ascending order")];re!==x&&(x=re,_=void 0,T={}),K=K.concat(hn({key:`${ee}[0]`,value:Q[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Sr,value:V}}))}else K=K.concat(V({key:`${ee}[0]`,value:Q[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},Q));return o.J(o.K(Q[1]))?K.concat([new o.V(`${ee}[1]`,Q[1],"expressions are not allowed in function stops.")]):K.concat(zr({key:`${ee}[1]`,value:Q[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function V(q,K){const Q=o.B(q.value),ee=o.D(q.value),re=q.value!==null?q.value:K;if(p){if(Q!==p)return[new o.V(q.key,re,`${Q} stop domain type must match previous stop domain type ${p}`)]}else p=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new o.V(q.key,re,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&l!=="categorical"){let me=`number expected, ${Q} found`;return o.G(n)&&l===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(q.key,re,me)]}return l!=="categorical"||Q!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?l!=="categorical"&&Q==="number"&&typeof ee=="number"&&typeof _=="number"&&_!==void 0&&ee<_?[new o.V(q.key,re,"stop domain values must appear in ascending order")]:(_=ee,l==="categorical"&&ee in T?[new o.V(q.key,re,"stop domain values must be unique")]:(T[ee]=!0,[])):[new o.V(q.key,re,`integer expected, found ${String(ee)}`)]}}function di(d){const n=(d.expressionContext==="property"?o.L:o.M)(o.K(d.value),d.valueSpec);if(n.result==="error")return n.value.map(p=>new o.V(`${d.key}${p.key}`,d.value,p.message));const l=n.value.expression||n.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!o.N(l))return[new o.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Go(l,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!o.O(l,["zoom","feature-state"]))return[new o.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!o.Q(l))return[new o.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Go(d,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const _ of n.valueSpec.expression.parameters)l.delete(_);if(l.size===0)return[];const p=[];return d instanceof o.S&&l.has(d.name)?[new o.V(n.key,n.value,`["${d.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(d.eachChild(_=>{p.push(...Go(_,n))}),p)}function qo(d){const n=d.key,l=d.value,p=d.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(o.D(l))===-1&&_.push(new o.V(n,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(o.D(l))===-1&&_.push(new o.V(n,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function $a(d){return o.W(o.K(d.value))?di(o.C({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):yr(d)}function yr(d){const n=d.value,l=d.key;if(o.B(n)!=="array")return[new o.V(l,n,`array expected, ${o.B(n)} found`)];const p=d.styleSpec;let _,x=[];if(n.length<1)return[new o.V(l,n,"filter array must have at least 1 element")];switch(x=x.concat(qo({key:`${l}[0]`,value:n[0],valueSpec:p.filter_operator,style:d.style,styleSpec:d.styleSpec})),o.D(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.D(n[1])==="$type"&&x.push(new o.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&x.push(new o.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=o.B(n[1]),_!=="string"&&x.push(new o.V(`${l}[1]`,n[1],`string expected, ${_} found`)));for(let T=2;T<n.length;T++)_=o.B(n[T]),o.D(n[1])==="$type"?x=x.concat(qo({key:`${l}[${T}]`,value:n[T],valueSpec:p.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new o.V(`${l}[${T}]`,n[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)x=x.concat(yr({key:`${l}[${T}]`,value:n[T],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=o.B(n[1]),n.length!==2?x.push(new o.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new o.V(`${l}[1]`,n[1],`string expected, ${_} found`))}return x}function Bl(d,n){const l=d.key,p=d.style,_=d.layer,x=d.styleSpec,T=d.value,C=d.objectKey,D=x[`${n}_${d.layerType}`];if(!D)return[];const z=C.match(/^(.*)-transition$/);if(n==="paint"&&z&&D[z[1]]&&D[z[1]].transition)return zr({key:l,value:T,valueSpec:x.transition,style:p,styleSpec:x});const B=d.valueSpec||D[C];if(!B)return[new o.A(l,T,`unknown property "${C}"`)];let U;if(o.B(T)==="string"&&o.G(B)&&!B.tokens&&(U=/^{([^}]+)}$/.exec(T))){const q=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new o.V(l,T,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const V=[];if(d.layerType==="symbol")C!=="text-field"||!p||p.glyphs||p.imports||V.push(new o.V(l,T,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.X(o.K(T))&&o.D(T.type)==="identity"&&V.push(new o.V(l,T,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&n==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&o.G(B)&&(o.Y(B)||o.H(B))){const q=o.L(o.K(T),B),K=q.value.expression||q.value._styleExpression.expression;K&&!o.O(K,["measure-light"])&&(C==="model-emissive-strength"&&o.Q(K)&&o.N(K)||V.push(new o.V(l,T,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(zr({key:d.key,value:T,valueSpec:B,style:p,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:C}))}function Ua(d){return Bl(d,"paint")}function Xs(d){return Bl(d,"layout")}function Oi(d){let n=[];const l=d.value,p=d.key,_=d.style,x=d.styleSpec;l.type||l.ref||n.push(new o.V(p,l,'either "type" or "ref" is required'));let T=o.D(l.type);const C=o.D(l.ref);if(l.id){const D=o.D(l.id);for(let z=0;z<d.arrayIndex;z++){const B=_.layers[z];o.D(B.id)===D&&n.push(new o.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${B.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(z=>{z in l&&n.push(new o.V(p,l[z],`"${z}" is prohibited for ref layers`))}),_.layers.forEach(z=>{o.D(z.id)===C&&(D=z)}),D?D.ref?n.push(new o.V(p,l.ref,"ref cannot reference another ref layer")):T=o.D(D.type):typeof C=="string"&&n.push(new o.V(p,l.ref,`ref layer "${C}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(l.source){const D=_.sources&&_.sources[l.source],z=D&&o.D(D.type);D?z==="vector"&&T==="raster"?n.push(new o.V(p,l.source,`layer "${l.id}" requires a raster source`)):z==="raster"&&T!=="raster"?n.push(new o.V(p,l.source,`layer "${l.id}" requires a vector source`)):z!=="vector"||l["source-layer"]?z==="raster-dem"&&T!=="hillshade"?n.push(new o.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||z==="geojson"&&D.lineMetrics?T==="raster-particle"&&z!=="raster-array"&&n.push(new o.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new o.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new o.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new o.V(p,l.source,`source "${l.source}" not found`))}else n.push(new o.V(p,l,'missing required property "source"'));return n=n.concat(hn({key:p,value:l,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zr({key:`${p}.type`,value:l.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:l,objectKey:"type"}),filter:D=>$a(o.C({layerType:T},D)),layout:D=>hn({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":z=>Xs(o.C({layerType:T},z))}}),paint:D=>hn({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":z=>Ua(o.C({layerType:T,layer:l},z))}})}})),n}function fo(d){const n=d.value,l=d.key,p=o.B(n);return p!=="string"?[new o.V(l,n,`string expected, ${p} found`)]:[]}const uu={promoteId:function({key:d,value:n}){if(o.B(n)==="string")return fo({key:d,value:n});{const l=[];for(const p in n)l.push(...fo({key:`${d}.${p}`,value:n[p]}));return l}}};function hu(d){const n=d.value,l=d.key,p=d.styleSpec,_=d.style;if(!n.type)return[new o.V(l,n,'"type" is required')];const x=o.D(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(n.url||n.tiles||T.push(new o.A(l,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(hn({key:l,value:n,valueSpec:p[`source_${x.replace("-","_")}`],style:d.style,styleSpec:p,objectElementValidators:uu})),T;case"geojson":if(T=hn({key:l,value:n,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:uu}),n.cluster)for(const C in n.clusterProperties){const[D,z]=n.clusterProperties[C],B=typeof D=="string"?[D,["accumulated"],["get",C]]:D;T.push(...di({key:`${l}.${C}.map`,value:z,expressionContext:"cluster-map"})),T.push(...di({key:`${l}.${C}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return T;case"video":return hn({key:l,value:n,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return hn({key:l,value:n,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${l}.type`,value:n.type,valueSpec:{values:Fl(p)},style:_,styleSpec:p})}}function Fl(d){return d.source.reduce((n,l)=>{const p=d[l];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function Va(d){const n=d.value,l=d.styleSpec,p=l.light,_=d.style;let x=[];const T=o.B(n);if(n===void 0)return x;if(T!=="object")return x=x.concat([new o.V("light",n,`object expected, ${T} found`)]),x;for(const C in n){const D=C.match(/^(.*)-transition$/);x=x.concat(D&&p[D[1]]&&p[D[1]].transition?zr({key:C,value:n[C],valueSpec:l.transition,style:_,styleSpec:l}):p[C]?zr({key:C,value:n[C],valueSpec:p[C],style:_,styleSpec:l}):[new o.V(C,n[C],`unknown property "${C}"`)])}return x}function Ys(d){const n=d.value;let l=[];if(!n)return l;const p=o.B(n);if(p!=="object")return l=l.concat([new o.V("light-3d",n,`object expected, ${p} found`)]),l;const _=d.styleSpec,x=_["light-3d"],T=d.key,C=d.style,D=d.style.lights;for(const U of["type","id"])if(!(U in n))return l=l.concat([new o.V("light-3d",n,`missing property ${U} on light`)]),l;if(n.type&&D)for(let U=0;U<d.arrayIndex;U++){const V=o.D(n.type),q=D[U];o.D(q.type)===V&&l.push(new o.V(T,n.id,`duplicate light type "${n.type}", previously defined at line ${q.id.__line__}`))}const z=`properties_light_${n.type}`;if(!(z in _))return l=l.concat([new o.V("light-3d",n,`Invalid light type ${n.type}`)]),l;const B=_[z];for(const U in n)if(U==="properties"){const V=n[U],q=o.B(V);if(q!=="object")return l=l.concat([new o.V("properties",V,`object expected, ${q} found`)]),l;for(const K in V)l=l.concat(B[K]?zr({key:K,value:V[K],valueSpec:B[K],style:C,styleSpec:_}):[new o.A(d.key,V[K],`unknown property "${K}"`)])}else{const V=U.match(/^(.*)-transition$/);l=l.concat(V&&x[V[1]]&&x[V[1]].transition?zr({key:U,value:n[U],valueSpec:_.transition,style:C,styleSpec:_}):x[U]?zr({key:U,value:n[U],valueSpec:x[U],style:C,styleSpec:_}):[new o.A(U,n[U],`unknown property "${U}"`)])}return l}function Nl(d){const n=d.value,l=d.key,p=d.style,_=d.styleSpec,x=_.terrain;let T=[];const C=o.B(n);if(n===void 0||C==="null")return T;if(C!=="object")return T=T.concat([new o.V("terrain",n,`object expected, ${C} found`)]),T;for(const D in n){const z=D.match(/^(.*)-transition$/);T=T.concat(z&&x[z[1]]&&x[z[1]].transition?zr({key:D,value:n[D],valueSpec:_.transition,style:p,styleSpec:_}):x[D]?zr({key:D,value:n[D],valueSpec:x[D],style:p,styleSpec:_}):[new o.A(D,n[D],`unknown property "${D}"`)])}if(n.source){const D=p.sources&&p.sources[n.source],z=D&&o.D(D.type);D?z!=="raster-dem"&&T.push(new o.V(l,n.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):T.push(new o.V(l,n.source,`source "${n.source}" not found`))}else T.push(new o.V(l,n,'terrain is missing required property "source"'));return T}function Co(d){const n=d.value,l=d.style,p=d.styleSpec,_=p.fog;let x=[];const T=o.B(n);if(n===void 0)return x;if(T!=="object")return x=x.concat([new o.V("fog",n,`object expected, ${T} found`)]),x;for(const C in n){const D=C.match(/^(.*)-transition$/);x=x.concat(D&&_[D[1]]&&_[D[1]].transition?zr({key:C,value:n[C],valueSpec:p.transition,style:l,styleSpec:p}):_[C]?zr({key:C,value:n[C],valueSpec:_[C],style:l,styleSpec:p}):[new o.A(C,n[C],`unknown property "${C}"`)])}return x}const fu={"*":()=>[],array:fi,boolean:function(d){const n=d.value,l=d.key,p=o.B(n);return p!=="boolean"?[new o.V(l,n,`boolean expected, ${p} found`)]:[]},number:Sr,color:function(d){const n=d.key,l=d.value,p=o.B(l);return p!=="string"?[new o.V(n,l,`color expected, ${p} found`)]:o.U.parseCSSColor(l)===null?[new o.V(n,l,`color expected, "${l}" found`)]:[]},enum:qo,filter:$a,function:An,layer:Oi,object:hn,source:hu,model:o.Z,light:Va,"light-3d":Ys,terrain:Nl,fog:Co,string:fo,formatted:function(d){return fo(d).length===0?[]:di(d)},resolvedImage:function(d){return fo(d).length===0?[]:di(d)},projection:function(d){const n=d.value,l=d.styleSpec,p=l.projection,_=d.style;let x=[];const T=o.B(n);if(T==="object")for(const C in n)x=x.concat(zr({key:C,value:n[C],valueSpec:p[C],style:_,styleSpec:l}));else T!=="string"&&(x=x.concat([new o.V("projection",n,`object or string expected, ${T} found`)]));return x},import:function(d){const{value:n,styleSpec:l}=d,{data:p,..._}=n;Object.defineProperty(_,"__line__",{value:n.__line__,enumerable:!1});let x=hn(o.C({},d,{value:_,valueSpec:l.import}));return o.D(_.id)===""&&x.push(new o.V(`${d.key}.id`,_,"import id can't be an empty string")),p&&(x=x.concat(Rh(p,l,{key:`${d.key}.data`}))),x}};function zr(d,n=!1){const l=d.value,p=d.valueSpec,_=d.styleSpec;if(p.expression&&o.X(o.D(l)))return An(d);if(p.expression&&o.J(o.K(l)))return di(d);if(p.type&&fu[p.type]){const x=fu[p.type](d);return n===!0&&x.length>0&&o.B(d.value)==="array"?di(d):x}return hn(o.C({},d,{valueSpec:p.type?_[p.type]:p}))}function da(d){const n=d.value,l=d.key,p=fo(d);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new o.V(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new o.V(l,n,'"glyphs" url must include a "{range}" token'))),p}function Rh(d,n=o._,l={}){return zr({key:l.key||"",value:d,valueSpec:n.$root,styleSpec:n,style:d,objectElementValidators:{glyphs:da,"*":()=>[]}})}function po(d,n=o._){return Oe(Rh(d,n))}const Ks=d=>Oe(hu(d)),du=d=>Oe(Va(d)),jl=d=>Oe(Ys(d)),pu=d=>Oe(Nl(d)),Js=d=>Oe(Co(d)),Je=d=>Oe(Oi(d)),ne=d=>Oe($a(d)),he=d=>Oe(Ua(d)),we=d=>Oe(Xs(d)),De=d=>Oe(o.Z(d));function Oe(d){return d.slice().sort((n,l)=>n.line&&l.line?n.line-l.line:0)}function $e(d,n){let l=!1;if(n&&n.length)for(const p of n)p instanceof o.A?o.w(p.message):(d.fire(new o.t(new Error(p.message))),l=!0);return l}let Ye;class qe extends o.E{constructor(n,l="flat"){super(),this._transitionable=new o.$(Ye||(Ye=new o.a0({anchor:new o.a1(o._.light.anchor),position:new o.a2(o._.light.position),color:new o.a1(o._.light.color),intensity:new o.a1(o._.light.intensity)}))),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,p={}){this._validate(du,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&$e(this,n.call(po,o.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}const Ke=new o.a0({source:new o.a1(o._.terrain.source),exaggeration:new o.a1(o._.terrain.exaggeration)});let at=class extends o.E{constructor(d,n,l,p){super(),this.scope=l,this._transitionable=new o.$(Ke,l,p),this._transitionable.setTransitionOrValue(d,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d,n){this._transitionable.setTransitionOrValue(d,n)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new o.a3(d)).get("exaggeration")}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof o.a4}};const nt=45,xt=65,zt=.05;function Ft(d,n,l,p){const _=o.a7(nt,xt,l),[x,T]=sr(d,p);let C=1-Math.min(1,Math.exp((n-x)/(T-x)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*d.alpha}function sr(d,n){const l=.5/Math.tan(.5*n);return[d.range[0]+l,d.range[1]+l]}function cr(d,n,l,p,_){const x=o.a6.vec3.transformMat4([],[n,l,p],_.mercatorFogMatrix);return Ft(d,o.a6.vec3.length(x),_.pitch,_._fov)}function hr(d,n,l,p,_,x,T){const C=[[l,p,0],[_,p,0],[_,x,0],[l,x,0]];let D=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const B of C){const U=o.a6.vec3.transformMat4([],B,n),V=o.a6.vec3.length(U);D=Math.min(D,V),z=Math.max(z,V)}return[Ft(d,D,T.pitch,T._fov),Ft(d,z,T.pitch,T._fov)]}const ur=new o.a0({range:new o.a1(o._.fog.range),color:new o.a1(o._.fog.color),"high-color":new o.a1(o._.fog["high-color"]),"space-color":new o.a1(o._.fog["space-color"]),"horizon-blend":new o.a1(o._.fog["horizon-blend"]),"star-intensity":new o.a1(o._.fog["star-intensity"]),"vertical-range":new o.a1(o._.fog["vertical-range"])});class Ur extends o.E{constructor(n,l,p,_){super(),this._transitionable=new o.$(ur,p,new Map(_)),this.set(n,_),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.a8(ur),this.scope=p}get state(){const n=this._transform,l=n.projection.name==="globe",p=o.a9(n.zoom),_=this.properties.get("range"),x=[.5,3];return{range:l?[o.aa(x[0],_[0],p),o.aa(x[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,p={}){if(this._validate(Js,n,p))return;const _=o.l({},n);for(const x of Object.keys(o._.fog))_[x]===void 0&&(_[x]=o._.fog[x].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.a7(nt,xt,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(p,_,x){const T=o.a5.fromLngLat(_),C=x.elevation?x.elevation.getAtPointOrZero(T):0;return cr(p,T.x,T.y,C,x)}(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return hr(this.state,l,0,0,o.ab,o.ab,this._transform)}getOpacityForBounds(n,l,p,_,x){return this._transform.projection.supportsFog?hr(this.state,n,l,p,_,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?sr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const p of l){const _=n.points[p];let x;if(_[2]>=0)x=_;else{const T=n.points[p-4];x=o.ac(T,_,T[2]/(T[2]-_[2]))}if(cr(this.state,x[0],x[1],0,this._transform)>=zt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||p.validate!==!1)&&$e(this,n.call(po,o.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}class Kr extends o.E{constructor(n,l,p,_){super(),this.scope=p,this._options=n,this.properties=new o.a8(l),this._transitionable=new o.$(l,p,new Map(_)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let _r,Zr;class Tn{constructor(n,l,p,_){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,l){let p,_;if(n instanceof o.P||typeof n[0]=="number"){const x=o.P.convert(n);p=[x],_=l.isPointAboveHorizon(x)}else{const x=o.P.convert(n[0]),T=o.P.convert(n[1]);p=[x,T],_=o.ae(x,T).every(C=>l.isPointAboveHorizon(C))}return new Tn(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.ae(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),o.af(_,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.ae(l,p,n),x=this.cameraPoint.clone();switch(3*((x.y>l.y)+(x.y>p.y))+((x.x>l.x)+(x.x>p.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(n,l,p,_=0){const x=n.queryPadding/l._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(x,l):this._bufferedScreenMercator(x,l);let C=n.tileID.wrap+(T.unwrapped?_:0);const D=T.polygon.map(ee=>o.ag(n.tileTransform,ee,C));if(!o.ah(D,0,0,o.ab,o.ab))return;C=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const z=this.screenGeometryMercator.polygon.map(ee=>o.ai(n.tileTransform,ee,C)),B=z.map(ee=>new o.P(ee[0],ee[1])),U=l.getFreeCameraOptions().position||new o.a5(0,0,0),V=o.ai(n.tileTransform,U,C),q=z.map(ee=>{const re=o.a6.vec3.sub(ee,ee,V);return o.a6.vec3.normalize(re,re),new o.aj(V,re)}),K=o.ak(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:q,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Q=o.al(D),Q.min.x=o.ap(Q.min.x,0,o.ab),Q.min.y=o.ap(Q.min.y,0,o.ab),Q.max.x=o.ap(Q.max.x,0,o.ab),Q.max.y=o.ap(Q.max.y,0,o.ab),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:K};var Q}_bufferedScreenMercator(n,l){const p=yi(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(n,l){const p=yi(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(n,l){const p=function(x,T){const C=o.a6.mat4.multiply([],T.pixelMatrix,T.globeMatrix),D=[0,-o.aq,0,1],z=[0,o.aq,0,1],B=[0,0,0,1];o.a6.vec4.transformMat4(D,D,C),o.a6.vec4.transformMat4(z,z,C),o.a6.vec4.transformMat4(B,B,C);const U=new o.P(D[0]/D[3],D[1]/D[3]),V=new o.P(z[0]/z[3],z[1]/z[3]),q=o.an(x,U)&&D[3]<B[3],K=o.an(x,V)&&z[3]<B[3];if(!q&&!K)return null;const Q=function(Pe,Se,Ce){for(let Be=1;Be<Pe.length;Be++){const Le=ti(Se.pointCoordinate3D(Pe[Be-1]).x),ke=ti(Se.pointCoordinate3D(Pe[Be]).x);if(Ce<0){if(Le<ke)return{idx:Be,t:-Le/(ke-1-Le)}}else if(ke<Le)return{idx:Be,t:(1-Le)/(ke+1-Le)}}return null}(x,T,q?-1:1);if(!Q)return null;const{idx:ee,t:re}=Q;let me=ee>1?Kn(x.slice(0,ee),T):[],ye=ee<x.length?Kn(x.slice(ee),T):[];me=me.map(Pe=>new o.P(ti(Pe.x),Pe.y)),ye=ye.map(Pe=>new o.P(ti(Pe.x),Pe.y));const de=[...me];de.length===0&&de.push(ye[ye.length-1]);const xe=o.aa(de[de.length-1].y,(ye.length===0?me[0]:ye[0]).y,re);let ve;return ve=q?[new o.P(0,xe),new o.P(0,0),new o.P(1,0),new o.P(1,xe)]:[new o.P(1,xe),new o.P(1,1),new o.P(0,1),new o.P(0,xe)],de.push(...ve),ye.length===0?de.push(me[0]):de.push(...ye),{polygon:de.map(Pe=>new o.a5(Pe.x,Pe.y)),unwrapped:!1}}(n,l);if(p)return p;const _=function(x,T){let C=!1,D=-1/0,z=0;for(let U=0;U<x.length-1;U++)x[U].x>D&&(D=x[U].x,z=U);for(let U=0;U<x.length-1;U++){const V=(z+U)%(x.length-1),q=x[V],K=x[V+1];Math.abs(q.x-K.x)>.5&&(q.x<K.x?(q.x+=1,V===0&&(x[x.length-1].x+=1)):(K.x+=1,V+1===x.length-1&&(x[0].x+=1)),C=!0)}const B=o.am(T.center.lng);return C&&B<Math.abs(B-1)&&x.forEach(U=>{U.x-=1}),{polygon:x,unwrapped:C}}(Kn(n,l).map(x=>new o.P(ti(x.x),x.y)),l);return{polygon:_.polygon.map(x=>new o.a5(x.x,x.y)),unwrapped:_.unwrapped}}}function Kn(d,n){return o.ao(d,l=>{const p=n.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ti(d){return d<0?1+d%1:d%1}function yi(d){return 100*d|0}function Wo(d,n,l,p,_){const x=function(C,D){if(C)return _(C);if(D){if(d.url&&D.tiles&&d.tiles&&delete d.tiles,D.variants){if(!Array.isArray(D.variants))return _(new Error("variants must be an array"));for(const B of D.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return _(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){D=o.l(D,B);break}}}const z=o.ar(o.l(D,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(z.vectorLayers=D.vector_layers,z.vectorLayerIds=z.vectorLayers.map(B=>B.id)),D.raster_layers&&(z.rasterLayers=D.raster_layers,z.rasterLayerIds=z.rasterLayers.map(B=>B.id)),z.tiles=n.canonicalizeTileset(z,d.url),_(null,z)}},T=function(C,D,z){if(!C)return null;if(!D&&!z)return C;z=z||C.worldview_default;const B=Object.values(C.language||{});if(B.length===0)return null;const U=Object.values(C.worldview||{});if(U.length===0)return null;const V=B.every(K=>K===D),q=U.every(K=>K===z);return V&&q?C:D in(C.language_options||{})||z in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(d.data,l,p);return T?o.q.frame(()=>x(null,T)):d.url?o.n(n.transformRequest(n.normalizeSourceURL(d.url,null,l,p),o.R.Source),x):o.q.frame(()=>{const{data:C,...D}=d;x(null,D)})}class Ga{constructor(n,l,p){this.bounds=o.as.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),p=Math.floor(o.am(this.bounds.getWest())*l),_=Math.floor(o.at(this.bounds.getNorth())*l),x=Math.ceil(o.am(this.bounds.getEast())*l),T=Math.ceil(o.at(this.bounds.getSouth())*l);return n.x>=p&&n.x<x&&n.y>=_&&n.y<T}}class zh extends o.E{constructor(n,l,p,_){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.ar(l,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new o.au}load(n){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Wo(this._options,this.map._requestManager,l,p,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.t(_))):x&&(o.l(this,x),x.bounds&&(this.tileBounds=new Ga(x.bounds,this.minzoom,this.maxzoom)),xr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),n&&n(_)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(n,l){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),_=this.map._requestManager.transformRequest(p,o.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,T={request:_,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,lut:x?{image:x.image.clone()}:null,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(T.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",T,C.bind(this));else if(n.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",T,C.bind(this),void 0,!0);else{const D=o.aw.call({deduped:this._deduped},T,(z,B)=>{z||!B?C.call(this,z):(T.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},n.actor&&n.actor.send("loadTile",T,C.bind(this),void 0,!0))},!0);n.request={cancel:D}}function C(D,z){return delete n.request,n.aborted?l(null):D&&D.status!==404?l(D):(z&&z.resourceTiming&&(n.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&n.setExpiryData(z),n.loadVectorData(z,this.map.painter),o.ax(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mu extends o.E{constructor(n,l,p,_){super(),this.id=n,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},l),o.l(this,o.ar(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Wo(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.t(l)):p&&(o.l(this,p),p.bounds&&(this.tileBounds=new Ga(p.bounds,this.minzoom,this.maxzoom)),xr(p.tiles),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const p=o.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=o.o(this.map._requestManager.transformRequest(_,o.R.Tile),(x,T,C,D)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):x?(n.state="errored",l(x)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:C,expires:D}),n.setTexture(T,this.map.painter),n.state="loaded",o.ax(this.dispatcher),void l(null)):l(null)))}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $l extends mu{constructor(n,l,p,_){super(n,l,p,_),this.type="raster-array",this.maxzoom=22,this._options=o.l({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,o.R.Tile);n.requestParams=_,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(x,T,C,D)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(x)return x.code===20?void 0:(n.state="errored",l(x));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:C,expires:D}),n.state="empty",l(null)})}unloadTile(n,l){const p=n.texture;p&&p instanceof o.T?(n.destroy(!0),this.map.painter.saveTileTexture(p)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,l,p){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(l,p,(_,x)=>{if(_)return n.state="errored",this.fire(new o.t(_)),void this.triggerRepaint(n);x&&(n.setTexture(x,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:x})=>x===n),p=l&&l.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(n,l,p){if(!n)return;const _=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let x=null;l instanceof o.aB?x=l.paint.get("raster-array-band"):l instanceof o.aC&&(x=l.paint.get("raster-particle-array-band"));const T=x||this.getInitialBand(_);if(T!=null)if(n.textureDescriptor){if(!n.updateNeeded(_,T)||p)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,_,T)}}const Bh={vector:zh,raster:mu,"raster-dem":class extends mu{constructor(d,n,l,p){super(d,n,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(d.state="errored",n(_)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=o.o(this.map._requestManager.transformRequest(l,o.R.Tile),(function(_,x,T,C){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(_)d.state="errored",n(_);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:C});const D=ImageBitmap&&x instanceof ImageBitmap&&o.ay(),z=1-(x.width-o.az(x.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const B=D?x:o.q.getImageData(x,z),U={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,l=Math.pow(2,n.z),p=(n.x-1+l)%l,_=n.x===0?d.wrap-1:d.wrap,x=(n.x+1+l)%l,T=n.x+1===l?d.wrap+1:d.wrap,C={};return C[new o.aA(d.overscaledZ,_,n.z,p,n.y).key]={backfilled:!1},C[new o.aA(d.overscaledZ,T,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(C[new o.aA(d.overscaledZ,_,n.z,p,n.y-1).key]={backfilled:!1},C[new o.aA(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new o.aA(d.overscaledZ,T,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<l&&(C[new o.aA(d.overscaledZ,_,n.z,p,n.y+1).key]={backfilled:!1},C[new o.aA(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new o.aA(d.overscaledZ,T,n.z,x,n.y+1).key]={backfilled:!1}),C}},"raster-array":$l,geojson:class extends o.E{constructor(d,n,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=n.data,this._options=o.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=o.ab/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:o.ab,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.ab,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new o.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new o.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const l of this._data.features)n.set(l.id,l);for(const l of d.features)n.set(l.id,l);this._data.features=[...n.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},n),this}getClusterLeaves(d,n,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:n,offset:l},p),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.x("dataloading",{dataType:"source"})),this._loaded=!1;const n=o.l({append:d},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(o.q.resolveURL(l),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.t(p));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new o.x("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,_=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p?{image:p.image.clone()}:null,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:_};d.request=this.actor.send(l,x,(T,C)=>_&&!C?(d.state="loaded",n(null)):(delete d.request,d.destroy(),d.aborted?n(null):T?n(T):(d.loadVectorData(C,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,n){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aD{constructor(d,n,l,p){super(d,n,l,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aE(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new o.t(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new o.t(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(d,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aD,model:class extends o.E{constructor(d,n,l,p){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const d=[];for(const n in this._options.models){const l=this._options.models[n],p=o.aG(this.map._requestManager.transformRequest(l.uri,o.R.Model).url).then(_=>{if(!_)return;const x=o.aH(_),T=new o.aI(n,l.position,l.orientation,x);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(_=>{this.fire(new o.t(new Error(`Could not load model ${n} from ${l.uri}: ${_.message}`)))});d.push(p)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new o.t(new Error(`Could not load models: ${n.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,n){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(d,n,l,p){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=Wo(this._options,this.map._requestManager,n,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.t(p))):_&&(o.l(this,_),_.bounds&&(this.tileBounds=new Ga(_.bounds,this.minzoom,this.maxzoom)),xr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),d&&d(p)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,n){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=n;else{if(d.buckets){const x=Object.values(d.buckets);for(const T of x)T.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",p,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(x,T){return d.aborted?n(null):x&&x.status!==404?n(x):(T&&(T.resourceTiming&&(d.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(T),d.buckets={...d.buckets,...T.buckets},T.featureIndex&&(d.latestFeatureIndex=T.featureIndex)),d.state="loaded",void n(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aD{constructor(d,n,l,p){super(d,n,l,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new o.t(new o.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.t(new o.V(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.t(new o.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.t(new o.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.t(new o.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof o.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.E{constructor(d,n,l,p){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ga(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.ar(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:l,z:p}=d.canonical;return this._implementation.hasTile({x:n,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:l,y:p,z:_}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:x.signal})).then((function(T){return delete d.request,d.aborted?(d.state="unloaded",n(null)):T===void 0?(d.state="errored",n(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(T)?(this.loadTileData(d,T),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(d.state="errored",n(T))}),d.request.cancel=()=>x.abort()}loadTileData(d,n){d.setTexture(n,this.map.painter)}unloadTile(d,n){if(d.texture&&d.texture instanceof o.T?(d.destroy(!0),d.texture&&d.texture instanceof o.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:l,y:p,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}n&&n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=o.av(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}}},Ul=function(d,n,l,p){const _=new Bh[n.type](d,n,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return o.aJ(["load","abort","unload","serialize","prepare"],_),_};function Ap(d,n){const l=o.a6.mat4.identity([]);return o.a6.mat4.scale(l,l,[.5*d.width,.5*-d.height,1]),o.a6.mat4.translate(l,l,[1,-1,0]),o.a6.mat4.multiply(l,l,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(l)}function Ep(d,n,l,p,_,x,T,C=!1){const D=d.tilesIn(p,T,C);D.sort(Vl);const z=[];for(const U of D)z.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,l,d._state,U,_,x,Ap(d.transform,U.tile.tileID),C)});const B=function(U){const V={},q={};for(const K of U){const Q=K.queryResults,ee=K.wrappedTileID,re=q[ee]=q[ee]||{};for(const me in Q){const ye=Q[me],de=re[me]=re[me]||{},xe=V[me]=V[me]||[];for(const ve of ye)de[ve.featureIndex]||(de[ve.featureIndex]=!0,xe.push(ve))}}return V}(z);for(const U in B)B[U].forEach(V=>{const q=V.feature,K=q.layer;K&&K.type!=="background"&&K.type!=="sky"&&K.type!=="slot"&&(q.source=K.source,K["source-layer"]&&(q.sourceLayer=K["source-layer"]),q.state=q.id!==void 0?d.getFeatureState(K["source-layer"],q.id):{})});return B}function gu(d,n){const l=d.getRenderableIds().map(x=>d.getTileByID(x)),p=[],_={};for(let x=0;x<l.length;x++){const T=l[x],C=T.tileID.canonical.key;_[C]||(_[C]=!0,T.querySourceFeatures(p,n))}return p}function Vl(d,n){const l=d.tileID,p=n.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}const Oo=32,Ho=33,Zo=new Uint16Array(8184);for(let d=0;d<2046;d++){let n=d+2,l=0,p=0,_=0,x=0,T=0,C=0;for(1&n?_=x=T=Oo:l=p=C=Oo;(n>>=1)>1;){const z=l+_>>1,B=p+x>>1;1&n?(_=l,x=p,l=T,p=C):(l=_,p=x,_=T,x=C),T=z,C=B}const D=4*d;Zo[D+0]=l,Zo[D+1]=p,Zo[D+2]=_,Zo[D+3]=x}const Qi=new Uint16Array(2178),pa=new Uint8Array(1089),yu=new Uint16Array(1089);function Mp(d){return d===0?-.03125:d===32?.03125:0}const Pp={type:2,extent:o.ab,loadGeometry:()=>[[new o.P(0,0),new o.P(o.ab+1,0),new o.P(o.ab+1,o.ab+1),new o.P(0,o.ab+1),new o.P(0,0)]]};class ma{constructor(n,l,p,_,x){this.tileID=n,this.uid=o.aP(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(n){const l=n+this.timeAdded;l<o.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,l,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(_,x){const T={};if(!x)return T;for(const C of _){const D=C.layerIds.map(z=>x.getLayer(z)).filter(Boolean);if(D.length!==0){C.layers=D,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(z=>D.filter(B=>B.id===z)[0]));for(const z of D)T[z.fqid]=C}}return T}(n.buckets,l.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.aR){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.aR&&x.hasRTLText){this.hasRTLText=!0,o.aS();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_],T=l.style.getOwnLayer(_);if(!T)continue;const C=T.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,C)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.aQ}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const _ in this.buckets){const x=this.buckets[_];x.uploadPending()&&x.upload(n)}const l=n.gl,p=this.imageAtlas;if(p&&!p.uploaded){const _=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new o.T(n,p.image,l.RGBA8,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(n,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=l.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(l)))}queryRenderedFeatures(n,l,p,_,x,T,C,D){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:C,transform:T,params:x,tileTransform:this.tileTransform},n,l,p):{}}querySourceFeatures(n,l){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=l?l.sourceLayer:"",T=_._geojsonTileLayer||_[x];if(!T)return;const C=o.aT(l&&l.filter),{z:D,x:z,y:B}=this.tileID.canonical,U={z:D,x:z,y:B};for(let V=0;V<T.length;V++){const q=T.feature(V);if(C.needGeometry){const ee=o.aU(q,!0);if(!C.filter(new o.a3(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!C.filter(new o.a3(this.tileID.overscaledZ),q))continue;const K=p.getId(q,x),Q=new o.aV(q,D,z,B,K);Q.tile=U,n.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const p=o.aW(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{const x=this.expirationTime-l;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&l&&this.updateBuckets(l)}updateBuckets(n){if(!this.latestFeatureIndex)return;const l=this.latestFeatureIndex.loadVTLayers(),p=n.style.listImages(),_=n.style.getBrightness();for(const x in this.buckets){if(!n.style.hasLayer(x))continue;const T=this.buckets[x],C=T.layers[0].sourceLayer||"_geojsonTileLayer",D=l[C],z=n.style.getOwnSourceCache(T.layers[0].source);let B={};z&&(B=z._state.getState(C,void 0)),T.update(B,D,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),(T instanceof o.aX||T instanceof o.aY)&&n._terrain&&n._terrain.enabled&&z&&T.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(z.id,this.tileID);const U=n&&n.style&&n.style.getOwnLayer(x);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.q.now()+n}setTexture(n,l){const p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(p,n,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(n,l){const p={};for(const _ of l)p[_]=!0;this.dependencies[n]=p}hasDependency(n,l){for(const p of n){const _=this.dependencies[p];if(_){for(const x of l)if(_[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const p=o.aZ(Pp,this.tileID.canonical,this.tileTransform)[0],_=new o.a_,x=new o.a$;for(let T=0;T<p.length;T++){const{x:C,y:D}=p[T];_.emplaceBack(C,D),x.emplaceBack(T)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(_,o.b0.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,_.length,x.length)}_makeTileBoundsBuffers(n,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const p=o.aZ(Pp,this.tileID.canonical,this.tileTransform)[0];let _,x;if(this.isRaster){const T=function(C,D){const z=o.aK(C,D),B=Math.pow(2,C.z);for(let ee=0;ee<Ho;ee++)for(let re=0;re<Ho;re++){const me=o.aL((C.x+(re+Mp(re))/Oo)/B),ye=o.aM((C.y+(ee+Mp(ee))/Oo)/B),de=D.project(me,ye),xe=ee*Ho+re;Qi[2*xe+0]=Math.round((de.x*z.scale-z.x)*o.ab),Qi[2*xe+1]=Math.round((de.y*z.scale-z.y)*o.ab)}pa.fill(0),yu.fill(0);for(let ee=2045;ee>=0;ee--){const re=4*ee,me=Zo[re+0],ye=Zo[re+1],de=Zo[re+2],xe=Zo[re+3],ve=me+de>>1,Pe=ye+xe>>1,Se=ve+Pe-ye,Ce=Pe+me-ve,Be=ye*Ho+me,Le=xe*Ho+de,ke=Pe*Ho+ve,Ve=Math.hypot((Qi[2*Be+0]+Qi[2*Le+0])/2-Qi[2*ke+0],(Qi[2*Be+1]+Qi[2*Le+1])/2-Qi[2*ke+1])>=16;pa[ke]=pa[ke]||(Ve?1:0),ee<1022&&(pa[ke]=pa[ke]||pa[(ye+Ce>>1)*Ho+(me+Se>>1)]||pa[(xe+Ce>>1)*Ho+(de+Se>>1)])}const U=new o.aN,V=new o.aO;let q=0;function K(ee,re){const me=re*Ho+ee;return yu[me]===0&&(U.emplaceBack(Qi[2*me+0],Qi[2*me+1],ee*o.ab/Oo,re*o.ab/Oo),yu[me]=++q),yu[me]-1}function Q(ee,re,me,ye,de,xe){const ve=ee+me>>1,Pe=re+ye>>1;if(Math.abs(ee-de)+Math.abs(re-xe)>1&&pa[Pe*Ho+ve])Q(de,xe,ee,re,ve,Pe),Q(me,ye,de,xe,ve,Pe);else{const Se=K(ee,re),Ce=K(me,ye),Be=K(de,xe);V.emplaceBack(Se,Ce,Be)}}return Q(0,0,Oo,Oo,Oo,0),Q(Oo,Oo,0,0,0,Oo),{vertices:U,indices:V}}(this.tileID.canonical,l);_=T.vertices,x=T.indices}else{_=new o.aN,x=new o.aO;for(const{x:C,y:D}of p)_.emplaceBack(C,D,0,0);const T=o.b2(_.int16,void 0,4);for(let C=0;C<T.length;C+=3)x.emplaceBack(T[C],T[C+1],T[C+2])}this._tileBoundsBuffer=n.createVertexBuffer(_,o.b3.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=o.b1.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugBuffers(n,l){const p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;const _=this.tileID.canonical,x=o.b4(_,l),T=o.b5(x),C=o.a9(l.zoom);let D;C>0&&(D=o.a6.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,_,l,T,D,C),this._makeGlobeTileDebugTextBuffer(n,_,l,T,D,C)}_globePoint(n,l,p,_,x,T,C){let D=o.b6(n,l,p);if(T){const z=1<<p.z,B=o.am(_.center.lng),U=o.at(_.center.lat),V=(p.x+.5)/z-B;let q=0;V>.5?q=-1:V<-.5&&(q=1);let K=(n/o.ab+p.x)/z+q,Q=(l/o.ab+p.y)/z;K=(K-B)*_._pixelsPerMercatorPixel+B,Q=(Q-U)*_._pixelsPerMercatorPixel+U;const ee=[K*_.worldSize,Q*_.worldSize,0];o.a6.vec3.transformMat4(ee,ee,T),D=o.b7(D,ee,C)}return o.a6.vec3.transformMat4(D,D,x)}_makeGlobeTileDebugBorderBuffer(n,l,p,_,x,T){const C=new o.a_,D=new o.a$,z=new o.b8,B=(V,q,K,Q,ee)=>{const re=(K-V)/(ee-1),me=(Q-q)/(ee-1),ye=C.length;for(let de=0;de<ee;de++){const xe=V+de*re,ve=q+de*me;C.emplaceBack(xe,ve);const Pe=this._globePoint(xe,ve,l,p,_,x,T);z.emplaceBack(Pe[0],Pe[1],Pe[2]),D.emplaceBack(ye+de)}},U=o.ab;B(0,0,U,0,16),B(U,0,U,U,16),B(U,U,0,U,16),B(0,U,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(D),this._tileDebugBuffer=n.createVertexBuffer(C,o.b0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(z,o.b9.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,C.length,D.length)}_makeGlobeTileDebugTextBuffer(n,l,p,_,x,T){const C=o.ab/4,D=new o.a_,z=new o.aO,B=new o.b8,U=25;z.reserve(32),D.reserve(U),B.reserve(U);const V=(q,K)=>U*q+K;for(let q=0;q<U;q++){const K=q*C;for(let Q=0;Q<U;Q++){const ee=Q*C;D.emplaceBack(ee,K);const re=this._globePoint(ee,K,l,p,_,x,T);B.emplaceBack(re[0],re[1],re[2])}}for(let q=0;q<4;q++)for(let K=0;K<4;K++){const Q=V(q,K),ee=V(q,K+1),re=V(q+1,K),me=V(q+1,K+1);z.emplaceBack(Q,ee,re),z.emplaceBack(re,ee,me)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(z),this._tileDebugTextBuffer=n.createVertexBuffer(D,o.b0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(B,o.b9.members),this._tileDebugTextSegments=o.b1.simpleSegment(0,0,U,32)}destroy(n=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.ba.setPbf(o.bb);class Fh extends ma{constructor(n,l,p,_,x){super(n,l,p,_,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,l){const p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n,{premultiply:!1}):this.texture=new o.T(p,n,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,l){const p=this._mrt=new o.ba(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.bc(_,(x,T,C,D)=>{if(x)l(x);else try{const z=p.getHeaderLength(T);if(z>n)return void(this.request=this.fetchHeader(z,l));p.parseHeader(T),this._isHeaderLoaded=!0;let B=0;for(const U of Object.values(p.layers))B=Math.max(B,U.dataIndex[U.dataIndex.length-1].last_byte);T.byteLength>=B&&(this.entireBuffer=T),l(null,this.entireBuffer||T,C,D)}catch(z){l(z)}}),this.request}fetchBand(n,l,p){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void p(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void p(new Error("Can't fetch tile band without an actor"));let T;const C=(U,V)=>{T.complete(U,V),U?p(U):(this.updateTextureDescriptor(n,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(U,V)=>{if(U)return p(U);const q=x.send("decodeRasterArray",{buffer:V,task:T},C,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),T.cancel()})},z=_.getLayer(n);if(!z)return void p(new Error(`Unknown sourceLayer "${n}"`));if(z.hasDataForBand(l))return this.updateTextureDescriptor(n,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const B=z.getDataRange([l]);if(T=_.createDecodingTask(B),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),V=o.bc(U,D);this._fetchQueue.push(()=>{V.cancel(),T.cancel()})}else p(null)}updateNeeded(n,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,l){if(!this._mrt)return;const p=this._mrt.getLayer(n);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;const{bytes:_,tileSize:x,buffer:T,offset:C,scale:D}=p.getBandView(l),z=x+2*T,B={data:_,width:z,height:z},U=this.texture;U&&U instanceof o.T&&U.update(B,{premultiply:!1}),this.textureDescriptor={layer:n,band:l,img:B,buffer:T,offset:C,tileSize:x,format:p.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class s_{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,p){const _=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:l,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(n,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const p=n.wrapped().key,_=l===void 0?0:this.data[p].indexOf(l),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const p in this.data)for(const _ of this.data[p])n(_.value)||l.push(_);for(const p of l)this.remove(p.value.tileID,p)}}class pb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,p){const _=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][_]=this.stateChanges[n][_]||{},o.l(this.stateChanges[n][_],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==_&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][_]===null){this.deletedStates[n][_]={};for(const x in this.state[n][_])p[x]||(this.deletedStates[n][_][x]=null)}else for(const x in p)this.deletedStates[n]&&this.deletedStates[n][_]&&this.deletedStates[n][_][x]===null&&delete this.deletedStates[n][_][x]}removeFeatureState(n,l,p){if(this.deletedStates[n]===null)return;const _=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&l!==void 0)this.deletedStates[n][_]!==null&&(this.deletedStates[n][_]=this.deletedStates[n][_]||{},this.deletedStates[n][_][p]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][_])for(p in this.deletedStates[n][_]={},this.stateChanges[n][_])this.deletedStates[n][_][p]=null;else this.deletedStates[n][_]=null;else this.deletedStates[n]=null}getState(n,l){const p=this.state[n]||{},_=this.stateChanges[n]||{},x=this.deletedStates[n];if(x===null)return{};if(l!==void 0){const C=String(l),D=o.l({},p[C],_[C]);if(x){const z=x[l];if(z===null)return{};for(const B in z)delete D[B]}return D}const T=o.l({},p,_);if(x)for(const C in x)delete T[C];return T}initializeTileState(n,l){n.setFeatureState(this.state,l)}coalesceChanges(n,l){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const T in this.stateChanges[_])this.state[_][T]||(this.state[_][T]={}),o.l(this.state[_][T],this.stateChanges[_][T]),x[T]=this.state[_][T];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const T in this.state[_])x[T]={},this.state[_][T]={};else for(const T in this.deletedStates[_]){if(this.deletedStates[_][T]===null)this.state[_][T]={};else if(this.state[_][T])for(const C of Object.keys(this.deletedStates[_][T]))delete this.state[_][T][C];x[T]=this.state[_][T]}p[_]=p[_]||{},o.l(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in n)n[_].setFeatureState(p,l)}}class eo extends o.E{constructor(n,l,p){super(),this.id=n,this._onlySymbols=p,l.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new s_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pb,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const l=this._tiles[n];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,l){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,l)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const p=this._tiles[l];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.bd(this._tiles).map(n=>n.tileID).sort(vs).map(n=>n.key)}getRenderableIds(n,l){const p=[];for(const _ in this._tiles)this._isIdRenderable(+_,n,l)&&p.push(this._tiles[_]);return n?p.sort((_,x)=>{const T=_.tileID,C=x.tileID,D=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),z=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-C.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort(vs).map(_=>_.key)}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,l){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,n,l)))}_tileLoaded(n,l,p,_){if(_)if(n.state="errored",_.status!==404)this._source.fire(new o.t(_,{tile:n}));else{if(this._source.fire(new o.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=o.q.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new o.x("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const l=this.getRenderableIds();for(let _=0;_<l.length;_++){const x=l[_];if(n.neighboringTiles&&n.neighboringTiles[x]){const T=this.getTileByID(x);p(n,T),p(T,n)}}function p(_,x){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let T=x.tileID.canonical.x-_.tileID.canonical.x;const C=x.tileID.canonical.y-_.tileID.canonical.y,D=Math.pow(2,_.tileID.canonical.z),z=x.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+D)===1?T+=D:Math.abs(T-D)===1&&(T-=D)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,T,C),_.neighboringTiles&&_.neighboringTiles[z]&&(_.neighboringTiles[z].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,p,_){for(const x in this._tiles){let T=this._tiles[x];if(_[x]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>p)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const z=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[z.key],T&&T.hasData()&&(C=z)}let D=C;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){_[C.key]=C;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=n.overscaledZ-1;p>=l;p--){const _=n.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,l){l=l||this._source.tileSize;const p=Math.ceil(n.width/l)+1,_=Math.ceil(n.height/l)+1,x=Math.floor(p*_*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(C)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(n,l,p,_){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let T;if(this.used||this.usedForTerrain){if(this._source.tileID)T=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new o.aA(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=n.clone();z.tileCoverLift=this.tileCoverLift,T=z.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&n.projection.name==="globe"&&(T.push(new o.aA(1,0,1,0,0)),T.push(new o.aA(1,0,1,1,0)),T.push(new o.aA(1,0,1,0,1)),T.push(new o.aA(1,0,1,1,1)))}else if(T=n.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);T=T.filter(B=>z(B))}}else T=[];if(T.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!_u(this._source.type)){const z=n.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),B=Math.min(z,this._source.maxzoom);if(x){const U=n.extendTileCover(T,B);for(const V of U)T.push(V)}else{const U=n.extendTileCover(T,B,_);for(const V of U)this._shadowCasterTiles[V.key]=!0,T.push(V)}}const C=this._updateRetainedTiles(T);if(_u(this._source.type)&&T.length!==0){const z={},B={},U=Object.keys(C);for(const q of U){const K=C[q],Q=this._tiles[q];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=o.q.now())continue;const ee=this.findLoadedParent(K,Math.max(K.overscaledZ-eo.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),z[ee.tileID.key]=ee.tileID),B[q]=K}const V=T[T.length-1].overscaledZ;for(const q in this._tiles){const K=this._tiles[q];if(C[q]||!K.hasData())continue;let Q=K.tileID;for(;Q.overscaledZ>V;){Q=Q.scaledTo(Q.overscaledZ-1);const ee=this._tiles[Q.key];if(ee&&ee.hasData()&&B[Q.key]){C[q]=K.tileID;break}}}for(const q in z)C[q]||(this._coveredTiles[q]=!0,C[q]=z[q])}for(const z in C)this._tiles[z].clearFadeHold();const D=o.be(this._tiles,C);for(const z of D){const B=this._tiles[z];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const l={};if(n.length===0)return l;const p={},_=n.reduce((z,B)=>Math.min(z,B.overscaledZ),1/0),x=n[0].overscaledZ,T=Math.max(x-eo.maxOverzooming,this._source.minzoom),C=Math.max(x+eo.maxUnderzooming,this._source.minzoom),D={};for(const z of n){const B=this._addTile(z);l[z.key]=z,B.hasData()||_<this._source.maxzoom&&(D[z.key]=z)}this._retainLoadedChildren(D,_,C,l);for(const z of n){let B=this._tiles[z.key];if(B.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const V=z.children(this._source.maxzoom)[0],q=this.getTile(V);if(q&&q.hasData()){l[V.key]=V;continue}}else{const V=z.children(this._source.maxzoom);if(l[V[0].key]&&l[V[1].key]&&l[V[2].key]&&l[V[3].key])continue}let U=B.wasRequested();for(let V=z.overscaledZ-1;V>=T;--V){const q=z.scaledTo(V);if(p[q.key]||(p[q.key]=!0,B=this.getTile(q),!B&&U&&(B=this._addTile(q)),B&&(l[q.key]=q,U=B.wasRequested(),B.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let p,_=this._tiles[n].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}l.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of l)this._loadedParentTiles[x]=p}}_addTile(n){let l=this._tiles[n.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const p=!!l;if(!p){const _=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();l=this._source.type==="raster-array"?new Fh(n,x,this.transform.tileZoom,_,this._isRaster):new ma(n,x,this.transform.tileZoom,_,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,n.key,l.state))}return l?(l.uses++,this._tiles[n.key]=l,p||this._source.fire(new o.x("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=l.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,l,p){const _=[],x=this.transform;if(!x)return _;const T=x.projection.name==="globe",C=o.am(x.center.lng);for(const D in this._tiles){const z=this._tiles[D];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let B;if(T){const U=z.tileID.canonical;if(U.z===0){const V=[Math.abs(o.ap(C,...Gl(U,-1))-C),Math.abs(o.ap(C,...Gl(U,1))-C)];B=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(o.ap(C,...Gl(U,-1))-C),Math.abs(o.ap(C,...Gl(U,0))-C),Math.abs(o.ap(C,...Gl(U,1))-C)];B=[V.indexOf(Math.min(...V))-1]}}else B=[0];for(const U of B){const V=n.containsTile(z,x,l,U);V&&_.push(V)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,l){const p=this.getRenderableIds(n,l).map(x=>this._tiles[x].tileID),_=this.transform.projection.name==="globe";for(const x of p)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=_?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return p}sortCoordinatesByDistance(n){const l=n.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),x={};for(const T of l){const C=1/(1<<T.canonical.z);x[T.key]=((T.canonical.x+.5)*C+T.wrap-p[0])*_[0]+((T.canonical.y+.5)*C-p[1])*_[1]-p[2]*_[2]}return l.sort((T,C)=>x[T.key]-x[C.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(_u(this._source.type))for(const n in this._tiles){const l=this._tiles[n];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(n,l,p){this._state.updateState(n=n||"_geojsonTileLayer",l,p)}removeFeatureState(n,l,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,p)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,p){const _=this._tiles[n];_&&_.setDependencies(l,p)}reloadTilesForDependencies(n,l){for(const p in this._tiles)this._tiles[p].hasDependency(n,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,l))}_preloadTiles(n,l){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(n,l))};return void this._source.on("data",D)}const p=new Map,_=Array.isArray(n)?n:[n],x=this.map.painter.terrain,T=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const D of _){const z=D.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of z)p.set(B.key,B);this.usedForTerrain&&D.updateElevation(!1)}const C=Array.from(p.values());o.bf(C,(D,z)=>{const B=new ma(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,U=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),z(U,B)})},l)}}function vs(d,n){const l=Math.abs(2*d.wrap)-+(d.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return d.overscaledZ-n.overscaledZ||p-l||n.canonical.y-d.canonical.y||n.canonical.x-d.canonical.x}function _u(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Gl(d,n){const l=1<<d.z;return[d.x/l+n,(d.x+1)/l+n]}eo.maxOverzooming=10,eo.maxUnderzooming=3;class Ip{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const p in this.style._mergedLayers){const _=this.style._mergedLayers[p];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:n,visibilityChanged:l});else if(_.type==="model"){const x=this.style.getLayerSource(_);x&&x.type==="batched-model"&&this.layers.push({layer:_,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const p=l.layer;let _=!1;p.type==="fill-extrusion"?_=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(_=!p.isHidden(n)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&l.visible,l.visible=_}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const _ of this.layers){const x=_.layer,T=this.style.getLayerSourceCache(x);let C=1;x.type==="fill-extrusion"&&(C=_.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let D=T?T.getTile(l):null;if(!D&&T&&l.canonical.z>T.getSource().minzoom){let z=l.scaledTo(Math.min(T.getSource().maxzoom,l.overscaledZ-1));for(;z.overscaledZ>=T.getSource().minzoom&&(D=T.getTile(z),!D&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(x):null,tileID:D?D.tileID:l,verticalScale:C})}n.hasAnyZOffset=!1;let p=!1;for(let _=0;_<n.symbolInstances.length;_++){const x=n.symbolInstances.get(_),T=x.zOffset,C=this._getHeightAtTileOffset(l,x.tileAnchorX,x.tileAnchorY);x.zOffset=C!==Number.NEGATIVE_INFINITY?C:T,p||T===x.zOffset||(p=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,p,_){let x=l,T=p;if(n.canonical.z!==_.canonical.z){const C=_.canonical,D=1/(1<<n.canonical.z-C.z);x=(l+n.canonical.x*o.ab)*D-C.x*o.ab|0,T=(p+n.canonical.y*o.ab)*D-C.y*o.ab|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(n,l,p){let _,x;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:D,verticalScale:z}=this.currentBuildingBuckets[T];if(!C)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(n,l,p,D),V=C.getHeightAtTileCoord(B,U);V&&V.height!==void 0&&(V.hidden?_=V.height:x=Math.max(V.height*z,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){const C=this.layers[T];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:D,tileID:z}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(n,l,p,z),V=D.getHeightAtTileCoord(B,U);if(V&&!V.hidden)return V.height===void 0&&_!==void 0?Math.min(V.maxHeight,_)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ql(d,n){const l={};for(const p in d)p!=="ref"&&(l[p]=d[p]);return o.bg.forEach(p=>{p in n&&(l[p]=n[p])}),l}function Cp(d){d=d.slice();const n=Object.create(null);for(let l=0;l<d.length;l++)n[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=ql(d[l],n[d[l].ref]));return d}const Br={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Op(d,n,l){l.push({command:Br.addSource,args:[d,n[d]]})}function Vr(d,n,l){n.push({command:Br.removeSource,args:[d]}),l[d]=!0}function mb(d,n,l,p){Vr(d,l,p),Op(d,n,l)}function nr(d,n,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&p!=="data"&&!o.bh(d[l][p],n[l][p]))return!1;for(p in n[l])if(n[l].hasOwnProperty(p)&&p!=="data"&&!o.bh(d[l][p],n[l][p]))return!1;return!0}function vu(d,n,l,p,_,x){let T;for(T in n=n||{},d=d||{})d.hasOwnProperty(T)&&(o.bh(d[T],n[T])||l.push({command:x,args:[p,T,n[T],_]}));for(T in n)n.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(o.bh(d[T],n[T])||l.push({command:x,args:[p,T,n[T],_]}))}function Qs(d){return d.id}function Wl(d,n){return d[n.id]=n,d}class ga{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.ap(n,0,1);let l=1,p=this._distances[l];const _=n*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const x=l-1,T=this._distances[x],C=p-T,D=C>0?(_-T)/C:0;return this.points[x].mult(1-D).add(this.points[l].mult(D))}}class Nh{constructor(n,l,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(l/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,p,_,x){this._forEachCell(l,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(n,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(n,l,p,_,x,T){this.boxCells[x].push(T)}_insertCircleCell(n,l,p,_,x,T){this.circleCells[x].push(T)}_query(n,l,p,_,x,T){if(p<0||n>this.width||_<0||l>this.height)return!x&&[];const C=[];if(n<=0&&l<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const z=this.circles[3*D],B=this.circles[3*D+1],U=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:z-U,y1:B-U,x2:z+U,y2:B+U})}return T?C.filter(T):C}return this._forEachCell(n,l,p,_,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?C.length>0:C}_queryCircle(n,l,p,_,x){const T=n-p,C=n+p,D=l-p,z=l+p;if(C<0||T>this.width||z<0||D>this.height)return!_&&[];const B=[];return this._forEachCell(T,D,C,z,this._queryCellCircle,B,{hitTest:_,circle:{x:n,y:l,radius:p},seenUids:{box:{},circle:{}}},x),_?B.length>0:B}query(n,l,p,_,x){return this._query(n,l,p,_,!1,x)}hitTest(n,l,p,_,x){return this._query(n,l,p,_,!0,x)}hitTestCircle(n,l,p,_){return this._queryCircle(n,l,p,!0,_)}_queryCell(n,l,p,_,x,T,C,D){const z=C.seenUids,B=this.boxCells[x];if(B!==null){const V=this.bboxes;for(const q of B)if(!z.box[q]){z.box[q]=!0;const K=4*q;if(n<=V[K+2]&&l<=V[K+3]&&p>=V[K+0]&&_>=V[K+1]&&(!D||D(this.boxKeys[q]))){if(C.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[q],x1:V[K],y1:V[K+1],x2:V[K+2],y2:V[K+3]})}}}const U=this.circleCells[x];if(U!==null){const V=this.circles;for(const q of U)if(!z.circle[q]){z.circle[q]=!0;const K=3*q;if(this._circleAndRectCollide(V[K],V[K+1],V[K+2],n,l,p,_)&&(!D||D(this.circleKeys[q]))){if(C.hitTest)return T.push(!0),!0;{const Q=V[K],ee=V[K+1],re=V[K+2];T.push({key:this.circleKeys[q],x1:Q-re,y1:ee-re,x2:Q+re,y2:ee+re})}}}}}_queryCellCircle(n,l,p,_,x,T,C,D){const z=C.circle,B=C.seenUids,U=this.boxCells[x];if(U!==null){const q=this.bboxes;for(const K of U)if(!B.box[K]){B.box[K]=!0;const Q=4*K;if(this._circleAndRectCollide(z.x,z.y,z.radius,q[Q+0],q[Q+1],q[Q+2],q[Q+3])&&(!D||D(this.boxKeys[K])))return T.push(!0),!0}}const V=this.circleCells[x];if(V!==null){const q=this.circles;for(const K of V)if(!B.circle[K]){B.circle[K]=!0;const Q=3*K;if(this._circlesCollide(q[Q],q[Q+1],q[Q+2],z.x,z.y,z.radius)&&(!D||D(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(n,l,p,_,x,T,C,D){const z=this._convertToXCellCoord(n),B=this._convertToYCellCoord(l),U=this._convertToXCellCoord(p),V=this._convertToYCellCoord(_);for(let q=z;q<=U;q++)for(let K=B;K<=V;K++)if(x.call(this,n,l,p,_,this.xCellCount*K+q,T,C,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,p,_,x,T){const C=_-n,D=x-l,z=p+T;return z*z>C*C+D*D}_circleAndRectCollide(n,l,p,_,x,T,C){const D=(T-_)/2,z=Math.abs(n-(_+D));if(z>D+p)return!1;const B=(C-x)/2,U=Math.abs(l-(x+B));if(U>B+p)return!1;if(z<=D||U<=B)return!0;const V=z-D,q=U-B;return V*V+q*q<=p*p}}const Xo={unknown:0,flipRequired:1,flipNotRequired:2},Ut=Math.tan(85*Math.PI/180);function Cr(d,n,l,p,_,x,T){const C=o.a6.mat4.create();if(l)if(x.name==="globe"){const D=o.bi(_,n);o.a6.mat4.multiply(C,C,D)}else{const D=o.a6.mat2.invert([],T);C[0]=D[0],C[1]=D[1],C[4]=D[2],C[5]=D[3],p||o.a6.mat4.rotateZ(C,C,_.angle)}else o.a6.mat4.multiply(C,_.labelPlaneMatrix,d);return C}function Or(d,n,l,p,_,x,T){const C=Cr(d,n,l,p,_,x,T);return x.name==="globe"&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function to(d,n,l,p,_,x,T){if(l){if(x.name==="globe"){const C=Cr(d,n,l,p,_,x,T);return o.a6.mat4.invert(C,C),o.a6.mat4.multiply(C,d,C),C}{const C=o.a6.mat4.clone(d),D=o.a6.mat4.identity([]);return D[0]=T[0],D[1]=T[1],D[4]=T[2],D[5]=T[3],o.a6.mat4.multiply(C,C,D),p||o.a6.mat4.rotateZ(C,C,-_.angle),C}}return _.glCoordMatrix}function ki(d,n,l,p){const _=[d,n,l,1];l?o.a6.vec4.transformMat4(_,_,p):$h(_,_,p);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function Rr(d,n){return Math.min(.5+d/n*.5,1.5)}function jh(d,n){const l=d[0]/d[3],p=d[1]/d[3];return l>=-n[0]&&l<=n[0]&&p>=-n[1]&&p<=n[1]}function Hl(d,n,l,p,_,x,T,C,D,z){const B=l.transform,U=p?d.textSizeData:d.iconSizeData,V=o.bj(U,l.transform.zoom),q=B.projection.name==="globe",K=[256/l.width*2+1,256/l.height*2+1],Q=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Q.clear();let ee=null;q&&(ee=p?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const re=d.lineVertexArray,me=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,ye=l.transform.width/l.transform.height;let de,xe=!1;for(let ve=0;ve<me.length;ve++){const Pe=me.get(ve),{numGlyphs:Se,writingMode:Ce}=Pe;if(Ce!==o.bk.vertical||xe||de===o.bk.horizontal||(xe=!0),de=Ce,(Pe.hidden||Ce===o.bk.vertical)&&!xe){ya(Se,Q);continue}xe=!1;const Be=new o.P(Pe.tileAnchorX,Pe.tileAnchorY);let{x:Le,y:ke,z:Ve}=B.projection.projectTilePoint(Be.x,Be.y,z.canonical);if(D){const[ut,pt,Kt]=D(Be);Le+=ut,ke+=pt,Ve+=Kt}const rt=[Le,ke,Ve,1];if(o.a6.vec4.transformMat4(rt,rt,n),!jh(rt,K)){ya(Se,Q);continue}const ft=rt[3],et=Rr(l.transform.getCameraToCenterDistance(B.projection),ft),vt=o.bl(U,V,Pe),Ge=T?vt/et:vt*et,lt=ki(Le,ke,Ve,_);if(lt[3]<=0){ya(Se,Q);continue}let ot={};const bt=T?null:D,St=Ln(Pe,Ge,!1,C,n,_,x,d.glyphOffsetArray,re,Q,ee,lt,Be,ot,ye,bt,B.projection,z,T);xe=St.useVertical,bt&&St.needsFlipping&&(ot={}),(St.notEnoughRoom||xe||St.needsFlipping&&Ln(Pe,Ge,!0,C,n,_,x,d.glyphOffsetArray,re,Q,ee,lt,Be,ot,ye,bt,B.projection,z,T).notEnoughRoom)&&ya(Se,Q)}p?(d.text.dynamicLayoutVertexBuffer.updateData(Q),ee&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(ee)):(d.icon.dynamicLayoutVertexBuffer.updateData(Q),ee&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(ee))}function Zl(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q){const{lineStartIndex:ee,glyphStartIndex:re,segment:me}=C,ye=re+C.numGlyphs,de=ee+C.lineLength,xe=n.getoffsetX(re),ve=n.getoffsetX(ye-1),Pe=Yl(d*xe,l,p,_,x,T,me,ee,de,D,z,B,U,V,!0,q,K,Q);if(!Pe)return null;const Se=Yl(d*ve,l,p,_,x,T,me,ee,de,D,z,B,U,V,!0,q,K,Q);return Se?{first:Pe,last:Se}:null}function ji(d,n,l,p){return d===o.bk.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:d===o.bk.vertical?p>0?{needsFlipping:!0}:null:n!==Xo.unknown&&function(_,x){return _===0||Math.abs(x/_)>Ut}(l,p)?n===Xo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Ln(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re,me){const ye=n/24,de=d.lineOffsetX*ye,xe=d.lineOffsetY*ye,{lineStartIndex:ve,glyphStartIndex:Pe,numGlyphs:Se,segment:Ce,writingMode:Be,flipState:Le}=d,ke=ve+d.lineLength,Ve=rt=>{if(B){const[Ge,lt,ot]=rt.up,bt=z.length;o.bm(B,bt+0,Ge,lt,ot),o.bm(B,bt+1,Ge,lt,ot),o.bm(B,bt+2,Ge,lt,ot),o.bm(B,bt+3,Ge,lt,ot)}const[ft,et,vt]=rt.point;o.bn(z,ft,et,vt,rt.angle)};if(Se>1){const rt=Zl(ye,C,de,xe,l,U,V,d,D,x,q,Q,!1,ee,re,me);if(!rt)return{notEnoughRoom:!0};if(p&&!l){let[ft,et,vt]=rt.first.point,[Ge,lt,ot]=rt.last.point;[ft,et]=ki(ft,et,vt,T),[Ge,lt]=ki(Ge,lt,ot,T);const bt=ji(Be,Le,(Ge-ft)*K,lt-et);if(d.flipState=bt&&bt.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,bt)return bt}Ve(rt.first);for(let ft=Pe+1;ft<Pe+Se-1;ft++){const et=Yl(ye*C.getoffsetX(ft),de,xe,l,U,V,Ce,ve,ke,D,x,q,Q,!1,!1,ee,re,me);if(!et)return z.length-=4*(ft-Pe),{notEnoughRoom:!0};Ve(et)}Ve(rt.last)}else{if(p&&!l){const ft=ki(V.x,V.y,0,_),et=ve+Ce+1,vt=new o.P(D.getx(et),D.gety(et)),Ge=ki(vt.x,vt.y,0,_),lt=Ge[3]>0?Ge:Xl(V,vt,ft,1,_,void 0,ee,re.canonical),ot=ji(Be,Le,(lt[0]-ft[0])*K,lt[1]-ft[1]);if(d.flipState=ot&&ot.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,ot)return ot}const rt=Yl(ye*C.getoffsetX(Pe),de,xe,l,U,V,Ce,ve,ke,D,x,q,Q,!1,!1,ee,re,me);if(!rt)return{notEnoughRoom:!0};Ve(rt)}return{}}function l_(d,n,l,p,_){const{x,y:T,z:C}=p.projectTilePoint(d.x,d.y,n);if(!_)return ki(x,T,C,l);const[D,z,B]=_(d);return ki(x+D,T+z,C+B,l)}function Xl(d,n,l,p,_,x,T,C){const D=l_(d.sub(n)._unit()._add(d),C,_,T,x);return o.a6.vec3.sub(D,l,D),o.a6.vec3.normalize(D,D),o.a6.vec3.scaleAndAdd(D,l,D,p)}function Yl(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re){const me=p?d-n:d+n;let ye=me>0?1:-1,de=0;p&&(ye*=-1,de=Math.PI),ye<0&&(de+=Math.PI);let xe=C+T+(ye>0?0:1)|0,ve=_,Pe=_,Se=0,Ce=0;const Be=Math.abs(me),Le=[],ke=[];let Ve=x,rt=Ve;const ft=()=>Xl(rt,Ve,Pe,Be-Se+1,B,V,Q,ee.canonical);for(;Se+Ce<=Be;){if(xe+=ye,xe<C||xe>=D)return null;if(Pe=ve,rt=Ve,Le.push(Pe),q&&ke.push(rt),Ve=new o.P(z.getx(xe),z.gety(xe)),ve=U[xe],!ve){const pt=l_(Ve,ee.canonical,B,Q,V);ve=pt[3]>0?U[xe]=pt:ft()}Se+=Ce,Ce=o.a6.vec3.distance(Pe,ve)}K&&V&&(U[xe]&&(ve=ft(),Ce=o.a6.vec3.distance(Pe,ve)),U[xe]=ve);const et=(Be-Se)/Ce,vt=Ve.sub(rt)._mult(et)._add(rt),Ge=o.a6.vec3.sub([],ve,Pe),lt=o.a6.vec3.scaleAndAdd([],Pe,Ge,et);let ot=[0,0,1],bt=Ge[0],St=Ge[1];if(re&&(ot=Q.upVector(ee.canonical,vt.x,vt.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const pt=[ot[2],0,-ot[0]],Kt=o.a6.vec3.cross([],ot,pt);o.a6.vec3.normalize(pt,pt),o.a6.vec3.normalize(Kt,Kt),bt=o.a6.vec3.dot(Ge,pt),St=o.a6.vec3.dot(Ge,Kt)}if(l){const pt=o.a6.vec3.cross([],ot,Ge);o.a6.vec3.normalize(pt,pt),o.a6.vec3.scaleAndAdd(lt,lt,pt,l*ye)}const ut=de+Math.atan2(St,bt);return Le.push(lt),q&&ke.push(vt),{point:lt,angle:ut,path:Le,tilePath:ke,up:ot}}function ya(d,n){const l=n.length,p=l+4*d;n.resize(p),n.float32.fill(-1/0,4*l,4*p)}function $h(d,n,l){const p=n[0],_=n[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}const mo=100;class Di{constructor(n,l,p=new Nh(n.width+200,n.height+200,25),_=new Nh(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+mo,this.screenBottomBoundary=n.height+mo,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,p,_,x,T,C,D){let z=p.projectedAnchorX,B=p.projectedAnchorY,U=p.projectedAnchorZ;const V=p.elevation,q=p.tileID,K=n.getProjection();if(V&&q){const[ve,Pe,Se]=K.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Ce=K.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=ve*V*Ce,B+=Pe*V*Ce,U+=Se*V*Ce}const Q=this.projectAndGetPerspectiveRatio(C,z,B,U,p.tileID,K.name==="globe"||!!V||this.transform.pitch>0,K),ee=T*Q.perspectiveRatio,re=(p.x1*l+_.x-p.padding)*ee+Q.point.x,me=(p.y1*l+_.y-p.padding)*ee+Q.point.y,ye=(p.x2*l+_.x+p.padding)*ee+Q.point.x,de=(p.y2*l+_.y+p.padding)*ee+Q.point.y,xe=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(re,me,ye,de)||!x&&this.grid.hitTest(re,me,ye,de,D)||xe?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[re,me,ye,de],offscreen:this.isOffscreen(re,me,ye,de),occluded:!1}}placeCollisionCircles(n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q){const ee=[],re=this.transform.elevation,me=n.getProjection(),ye=re?re.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,me):null,de=new o.P(p.tileAnchorX,p.tileAnchorY);let{x:xe,y:ve,z:Pe}=me.projectTilePoint(de.x,de.y,Q.canonical);if(ye){const[vt,Ge,lt]=ye(de);xe+=vt,ve+=Ge,Pe+=lt}const Se=me.name==="globe",Ce=this.projectAndGetPerspectiveRatio(C,xe,ve,Pe,Q,Se||!!re||this.transform.pitch>0,me),{perspectiveRatio:Be}=Ce,Le=(U?T/Be:T*Be)/o.bq,ke=ki(xe,ve,Pe,D),Ve=Ce.signedDistanceFromCamera>0?Zl(Le,x,p.lineOffsetX*Le,p.lineOffsetY*Le,!1,ke,de,p,_,D,{},re&&!U?ye:null,U&&!!re,me,Q,U):null;let rt=!1,ft=!1,et=!0;if(Ve&&!Ce.occluded){const vt=.5*q*Be+K,Ge=new o.P(-100,-100),lt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ot=new ga,{first:bt,last:St}=Ve,ut=bt.path.length;let pt=[];for(let Nt=ut-1;Nt>=1;Nt--)pt.push(bt.path[Nt]);for(let Nt=1;Nt<St.path.length;Nt++)pt.push(St.path[Nt]);const Kt=2.5*vt;z&&(pt=pt.map(([Nt,ir,Gt],er)=>(ye&&!Se&&(Gt=ye(er<ut-1?bt.tilePath[ut-1-er]:St.tilePath[er-ut+2])[2]),ki(Nt,ir,Gt,z))),pt.some(Nt=>Nt[3]<=0)&&(pt=[]));let Mt=[];if(pt.length>0){let Nt=1/0,ir=-1/0,Gt=1/0,er=-1/0;for(const Tr of pt)Nt=Math.min(Nt,Tr[0]),Gt=Math.min(Gt,Tr[1]),ir=Math.max(ir,Tr[0]),er=Math.max(er,Tr[1]);ir>=Ge.x&&Nt<=lt.x&&er>=Ge.y&&Gt<=lt.y&&(Mt=[pt.map(Tr=>new o.P(Tr[0],Tr[1]))],(Nt<Ge.x||ir>lt.x||Gt<Ge.y||er>lt.y)&&(Mt=o.bo(Mt,Ge.x,Ge.y,lt.x,lt.y)))}for(const Nt of Mt){ot.reset(Nt,.25*vt);let ir=0;ir=ot.length<=.5*vt?1:Math.ceil(ot.paddedLength/Kt)+1;for(let Gt=0;Gt<ir;Gt++){const er=Gt/Math.max(ir-1,1),Tr=ot.lerp(er),vr=Tr.x+mo,Xr=Tr.y+mo;ee.push(vr,Xr,vt,0);const rn=vr-vt,fn=Xr-vt,ko=vr+vt,Nn=Xr+vt;if(et=et&&this.isOffscreen(rn,fn,ko,Nn),ft=ft||this.isInsideGrid(rn,fn,ko,Nn),!l&&this.grid.hitTestCircle(vr,Xr,vt,V)&&(rt=!0,!B))return{circles:[],offscreen:!1,collisionDetected:rt,occluded:!1}}}}return{circles:!B&&rt||!ft?[]:ee,offscreen:et,collisionDetected:rt,occluded:Ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,x=-1/0,T=-1/0;for(const B of n){const U=new o.P(B.x+mo,B.y+mo);p=Math.min(p,U.x),_=Math.min(_,U.y),x=Math.max(x,U.x),T=Math.max(T,U.y),l.push(U)}const C=this.grid.query(p,_,x,T).concat(this.ignoredGrid.query(p,_,x,T)),D={},z={};for(const B of C){const U=B.key;if(D[U.bucketInstanceId]===void 0&&(D[U.bucketInstanceId]={}),D[U.bucketInstanceId][U.featureIndex])continue;const V=[new o.P(B.x1,B.y1),new o.P(B.x2,B.y1),new o.P(B.x2,B.y2),new o.P(B.x1,B.y2)];o.bp(l,V)&&(D[U.bucketInstanceId][U.featureIndex]=!0,z[U.bucketInstanceId]===void 0&&(z[U.bucketInstanceId]=[]),z[U.bucketInstanceId].push(U.featureIndex))}return z}insertCollisionBox(n,l,p,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,p,_,x){const T=l?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let D=0;D<n.length;D+=4)T.insertCircle(C,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,l,p,_,x,T,C){const D=[l,p,_,1];let z=!1;_||this.transform.pitch>0?(o.a6.vec4.transformMat4(D,D,n),this.fogState&&x&&C.name!=="globe"&&(z=function(V,q,K,Q,ee,re){const me=re.calculateFogTileMatrix(ee),ye=[q,K,Q];return o.a6.vec3.transformMat4(ye,ye,me),Ft(V,o.a6.vec3.length(ye),re.pitch,re._fov)}(this.fogState,l,p,_,x.toUnwrapped(),this.transform)>.9)):$h(D,D,n);const B=D[3];return{point:new o.P((D[0]/B+1)/2*this.transform.width+mo,(-D[1]/B+1)/2*this.transform.height+mo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/B*.5,1.5),signedDistanceFromCamera:B,occluded:T&&D[2]>B||z}}isOffscreen(n,l,p,_){return p<mo||n>=this.screenRightBoundary||_<mo||l>this.screenBottomBoundary}isInsideGrid(n,l,p,_){return p>=0&&n<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.a6.mat4.identity([]);return o.a6.mat4.translate(n,n,[-100,-100,0]),n}}function $i(d,n,l){const p=n.createTileMatrix(d,d.worldSize,l.toUnwrapped());return o.a6.mat4.multiply(new Float32Array(16),d.projMatrix,p)}function c_(d,n,l){if(n.projection.name===l.projection.name)return d.projMatrix;const p=l.clone();return p.setProjection(n.projection),$i(p,n.getProjection(),d)}function xs(d,n,l){return n.name===l.projection.name?d.projMatrix:$i(l,n,d)}class Gn{constructor(n,l,p,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Ui{constructor(n,l,p,_,x,T=!1){this.text=new Gn(n?n.text:null,l,p,x),this.icon=new Gn(n?n.icon:null,l,_,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yo{constructor(n,l,p,_=!1){this.text=n,this.icon=l,this.skipFade=p,this.clipped=_}}class li{constructor(){this.invProjMatrix=o.a6.mat4.create(),this.viewportMatrix=o.a6.mat4.create(),this.circles=[]}}class kp{constructor(n,l,p,_,x){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class Ko{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[n]}}function Kl(d,n,l,p,_){const{horizontalAlign:x,verticalAlign:T}=o.bx(d),C=-(x-.5)*n,D=-(T-.5)*l,z=o.bw(d,p);return new o.P(C+z[0]*_,D+z[1]*_)}function el(d,n,l,p,_){const x=new o.P(d,n);return l&&x._rotate(p?_:-_),x}class tl{constructor(n,l,p,_,x,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Di(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ko(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,p,_){const x=p.getBucket(l),T=p.latestFeatureIndex;if(!x||!T||l.fqid!==x.layerIds[0])return;const C=x.layers[0].layout,D=x.layers[0].paint,z=p.collisionBoxArray,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/o.ab,V=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);const q=(K=p.tileID,Q=x.getProjection(),ee=this.transform,Q.name===this.projection?ee.calculateProjMatrix(K.toUnwrapped()):$i(ee,Q,K));var K,Q,ee;const re=C.get("text-pitch-alignment")==="map",me=C.get("text-rotation-alignment")==="map";l.compileFilter();const ye=l.dynamicFilter(),de=l.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(p),ve=Or(q,p.tileID.canonical,re,me,this.transform,x.getProjection(),xe);let Pe=null;if(re){const Be=to(q,p.tileID.canonical,re,me,this.transform,x.getProjection(),xe);Pe=o.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Be)}let Se=null;ye&&p.latestFeatureIndex&&(Se={unwrappedTileID:V,dynamicFilter:ye,dynamicFilterNeedsFeature:de}),this.retainedQueryData[x.bucketInstanceId]=new kp(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,p.tileID);const Ce={bucket:x,layout:C,paint:D,posMatrix:q,textLabelPlaneMatrix:ve,labelToScreenMatrix:Pe,clippingData:Se,scale:B,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:o.bj(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.bj(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(_)for(const Be of x.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:ke,symbolInstanceEnd:Ve}=Be;n.push({sortKey:Le,symbolInstanceStart:ke,symbolInstanceEnd:Ve,parameters:Ce})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re,me){const{textOffset0:ye,textOffset1:de,crossTileID:xe}=V,ve=[ye,de],Pe=Kl(n,p,_,ve,x),Se=this.collisionIndex.placeCollisionBox(K,x,l,el(Pe.x,Pe.y,T,C,this.transform.angle),U,D,z,B.predicate);if(ee){const Ce=K.getSymbolInstanceIconSize(me,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,Ce,ee,el(Pe.x,Pe.y,T,C,this.transform.angle),U,D,z,B.predicate).box.length===0)return}if(Se.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Ce=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ve,width:p,height:_,anchor:n,textScale:x,prevAnchor:Ce},this.markUsedJustification(K,n,V,Q),K.allowVerticalPlacement&&(this.markUsedOrientation(K,Q,V),this.placedOrientations[xe]=Q),{shift:Pe,placedGlyphBoxes:Se}}}placeLayerBucketPart(n,l,p,_){const{bucket:x,layout:T,paint:C,posMatrix:D,textLabelPlaneMatrix:z,labelToScreenMatrix:B,clippingData:U,textPixelRatio:V,holdingForFade:q,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:ee,collisionGroup:re,latestFeatureIndex:me}=n.parameters,ye=T.get("text-optional"),de=T.get("icon-optional"),xe=T.get("text-allow-overlap"),ve=T.get("icon-allow-overlap"),Pe=T.get("text-rotation-alignment")==="map",Se=T.get("text-pitch-alignment")==="map",Ce=T.get("symbol-z-elevate"),Be=C.get("symbol-z-offset"),Le=C.get("symbol-elevation-reference")==="sea";this.transform.setProjection(x.projection);let ke=xe&&(ve||!x.hasIconData()||de),Ve=ve&&(xe||!x.hasTextData()||ye);const rt=!Be.isConstant();!x.collisionArrays&&K&&x.deserializeCollisionBoxes(K),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,K);const ft=(et,vt,Ge)=>{const{crossTileID:lt,numVerticalGlyphVertices:ot}=et;let bt=null;if(U&&U.dynamicFilterNeedsFeature||rt){const br=this.retainedQueryData[x.bucketInstanceId];bt=me.loadFeature({featureIndex:et.featureIndex,bucketIndex:br.bucketIndex,sourceLayerIndex:br.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},bt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.P(et.tileAnchorX,et.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[lt]=new Yo(!1,!1,!1,!0),void l.add(lt);const St=Be.evaluate(bt,{});if(l.has(lt))return;if(q)return void(this.placements[lt]=new Yo(!1,!1,!1));let ut=!1,pt=!1,Kt=!0,Mt=!1,Nt=!1,ir=null,Gt={box:null,offscreen:null,occluded:null},er={box:null,offscreen:null,occluded:null},Tr=null,vr=null,Xr=null,rn=0,fn=0,ko=0;Ge.textFeatureIndex?rn=Ge.textFeatureIndex:et.useRuntimeCollisionCircles&&(rn=et.featureIndex),Ge.verticalTextFeatureIndex&&(fn=Ge.verticalTextFeatureIndex);const Nn=br=>{br.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Nr=this.transform.elevation;br.elevation=Le?St:St+(Nr?Nr.getAtTileOffset(br.tileID,br.tileAnchorX,br.tileAnchorY):0),br.elevation+=et.zOffset},Ir=Ge.textBox;if(Ir){Nn(Ir);const br=Gr=>{let kn=o.bk.horizontal;if(x.allowVerticalPlacement&&!Gr&&this.prevPlacement){const jn=this.prevPlacement.placedOrientations[lt];jn&&(this.placedOrientations[lt]=jn,kn=jn,this.markUsedOrientation(x,kn,et))}return kn},Nr=(Gr,kn)=>{if(x.allowVerticalPlacement&&ot>0&&Ge.verticalTextBox){for(const jn of x.writingModes)if(jn===o.bk.vertical?(Gt=kn(),er=Gt):Gt=Gr(),Gt&&Gt.box&&Gt.box.length)break}else Gt=Gr()};if(T.get("text-variable-anchor")){let Gr=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[lt]){const Dr=this.prevPlacement.variableOffsets[lt];Gr.indexOf(Dr.anchor)>0&&(Gr=Gr.filter(ri=>ri!==Dr.anchor),Gr.unshift(Dr.anchor))}const kn=(Dr,ri,ci)=>{const ni=x.getSymbolInstanceTextSize(Q,et,this.transform.zoom,vt),ln=(Dr.x2-Dr.x1)*ni+2*Dr.padding,Gi=(Dr.y2-Dr.y1)*ni+2*Dr.padding,qi=et.hasIconTextFit&&!ve?ri:null;qi&&Nn(qi);let Do={box:[],offscreen:!1,occluded:!1};const bo=xe?2*Gr.length:Gr.length;for(let oo=0;oo<bo;++oo){const Lo=this.attemptAnchorPlacement(Gr[oo%Gr.length],Dr,ln,Gi,ni,Pe,Se,V,D,re,oo>=Gr.length,et,vt,x,ci,qi,Q,ee);if(Lo&&(Do=Lo.placedGlyphBoxes,Do&&Do.box&&Do.box.length)){ut=!0,ir=Lo.shift;break}}return Do};Nr(()=>kn(Ir,Ge.iconBox,o.bk.horizontal),()=>{const Dr=Ge.verticalTextBox;return Dr&&Nn(Dr),x.allowVerticalPlacement&&!(Gt&&Gt.box&&Gt.box.length)&&ot>0&&Dr?kn(Dr,Ge.verticalIconBox,o.bk.vertical):{box:null,offscreen:null,occluded:null}}),Gt&&(ut=Gt.box,Kt=Gt.offscreen,Mt=Gt.occluded);const jn=br(!(!Gt||!Gt.box));if(!ut&&this.prevPlacement){const Dr=this.prevPlacement.variableOffsets[lt];Dr&&(this.variableOffsets[lt]=Dr,this.markUsedJustification(x,Dr.anchor,et,jn))}}else{const Gr=(kn,jn)=>{const Dr=x.getSymbolInstanceTextSize(Q,et,this.transform.zoom,vt),ri=this.collisionIndex.placeCollisionBox(x,Dr,kn,new o.P(0,0),xe,V,D,re.predicate);return ri&&ri.box&&ri.box.length&&(this.markUsedOrientation(x,jn,et),this.placedOrientations[lt]=jn),ri};Nr(()=>Gr(Ir,o.bk.horizontal),()=>{const kn=Ge.verticalTextBox;return x.allowVerticalPlacement&&ot>0&&kn?(Nn(kn),Gr(kn,o.bk.vertical)):{box:null,offscreen:null,occluded:null}}),br(!!(Gt&&Gt.box&&Gt.box.length))}}if(Tr=Gt,ut=Tr&&Tr.box&&Tr.box.length>0,Kt=Tr&&Tr.offscreen,Mt=Tr&&Tr.occluded,et.useRuntimeCollisionCircles){const br=x.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex>=0?et.centerJustifiedTextSymbolIndex:et.verticalPlacedTextSymbolIndex),Nr=o.bl(x.textSizeData,Q,br),Gr=T.get("text-padding");vr=this.collisionIndex.placeCollisionCircles(x,xe,br,x.lineVertexArray,x.glyphOffsetArray,Nr,D,z,B,p,Se,re.predicate,et.collisionCircleDiameter*Nr/o.bq,Gr,this.retainedQueryData[x.bucketInstanceId].tileID),ut=xe||vr.circles.length>0&&!vr.collisionDetected,Kt=Kt&&vr.offscreen,Mt=vr.occluded}if(Ge.iconFeatureIndex&&(ko=Ge.iconFeatureIndex),Ge.iconBox){const br=Nr=>{Nn(Nr);const Gr=et.hasIconTextFit&&ir?el(ir.x,ir.y,Pe,Se,this.transform.angle):new o.P(0,0),kn=x.getSymbolInstanceIconSize(ee,this.transform.zoom,et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,kn,Nr,Gr,ve,V,D,re.predicate)};er&&er.box&&er.box.length&&Ge.verticalIconBox?(Xr=br(Ge.verticalIconBox),pt=Xr.box.length>0):(Xr=br(Ge.iconBox),pt=Xr.box.length>0),Kt=Kt&&Xr.offscreen,Nt=Xr.occluded}const Qr=ye||et.numHorizontalGlyphVertices===0&&ot===0,bn=de||et.numIconVertices===0;if(Qr||bn?bn?Qr||(pt=pt&&ut):ut=pt&&ut:pt=ut=pt&&ut,ut&&Tr&&Tr.box&&this.collisionIndex.insertCollisionBox(Tr.box,T.get("text-ignore-placement"),x.bucketInstanceId,er&&er.box&&fn?fn:rn,re.ID),pt&&Xr&&this.collisionIndex.insertCollisionBox(Xr.box,T.get("icon-ignore-placement"),x.bucketInstanceId,ko,re.ID),vr&&(ut&&this.collisionIndex.insertCollisionCircles(vr.circles,T.get("text-ignore-placement"),x.bucketInstanceId,rn,re.ID),p)){const br=x.bucketInstanceId;let Nr=this.collisionCircleArrays[br];Nr===void 0&&(Nr=this.collisionCircleArrays[br]=new li);for(let Gr=0;Gr<vr.circles.length;Gr+=4)Nr.circles.push(vr.circles[Gr+0]),Nr.circles.push(vr.circles[Gr+1]),Nr.circles.push(vr.circles[Gr+2]),Nr.circles.push(vr.collisionDetected?1:0)}const Jr=x.projection.name!=="globe";ke=ke&&(Jr||!Mt),Ve=Ve&&(Jr||!Nt),this.placements[lt]=new Yo(ut||ke,pt||Ve,Kt||x.justReloaded),l.add(lt)};if(Ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){const et=x.getSortedSymbolIndexes(this.transform.angle);for(let vt=et.length-1;vt>=0;--vt){const Ge=et[vt];ft(x.symbolInstances.get(Ge),Ge,x.collisionArrays[Ge])}x.hasAnyZOffset&&o.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const et=x.getSortedIndexesByZOffset();for(let vt=0;vt<et.length;++vt){const Ge=et[vt];ft(x.symbolInstances.get(Ge),Ge,x.collisionArrays[Ge])}}else for(let et=n.symbolInstanceStart;et<n.symbolInstanceEnd;et++)ft(x.symbolInstances.get(et),et,x.collisionArrays[et]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[x.bucketInstanceId];o.a6.mat4.invert(et.invProjMatrix,D),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,l,p,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D,crossTileID:z}=p,B=o.bv(l),U=_===o.bk.vertical?D:B==="left"?x:B==="center"?T:B==="right"?C:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:z),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:z),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:z),D>=0&&(n.text.placedSymbolArray.get(D).crossTileID=U>=0&&D!==U?0:z)}markUsedOrientation(n,l,p){const _=l===o.bk.horizontal||l===o.bk.horizontalOnly?l:0,x=l===o.bk.vertical?l:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:z}=p,B=n.text.placedSymbolArray;T>=0&&(B.get(T).placedOrientation=_),C>=0&&(B.get(C).placedOrientation=_),D>=0&&(B.get(D).placedOrientation=_),z>=0&&(B.get(z).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(n):1,x=l?l.opacities:{},T=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const D in this.placements){const z=this.placements[D],B=x[D];B?(this.opacities[D]=new Ui(B,_,z.text,z.icon,null,z.clipped),p=p||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[D]=new Ui(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const D in x){const z=x[D];if(!this.opacities[D]){const B=new Ui(z,_,!1,!1);B.isHidden()||(this.opacities[D]=B,p=p||z.text.placed||z.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in C)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=C[D]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,p,_){const x=new Set;for(const T of l){const C=T.getBucket(n);C&&T.latestFeatureIndex&&n.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,x,T,T.collisionBoxArray,p,_,T.tileID,n.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,T.tileID),C.updateZOffset()))}}updateBucketOpacities(n,l,p,_,x,T,C,D){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const z=n.layers[0].layout,B=n.layers[0].paint,U=!!n.layers[0].dynamicFilter(),V=new Ui(null,0,!1,!1,!0),q=z.get("text-allow-overlap"),K=z.get("icon-allow-overlap"),Q=z.get("text-variable-anchor"),ee=z.get("text-rotation-alignment")==="map",re=z.get("text-pitch-alignment")==="map",me=B.get("symbol-z-offset"),ye=B.get("symbol-elevation-reference")==="sea",de=!me.isConstant(),xe=new Ui(null,0,q&&(K||!n.hasIconData()||z.get("icon-optional")),K&&(q||!n.hasTextData()||z.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const ve=(Se,Ce,Be)=>{for(let Le=0;Le<Ce/4;Le++)Se.opacityVertexArray.emplaceBack(Be)};let Pe=0;T&&n.updateReplacement(C,T);for(let Se=0;Se<n.symbolInstances.length;Se++){const Ce=n.symbolInstances.get(Se),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:Le,crossTileID:ke,numIconVertices:Ve,tileAnchorX:rt,tileAnchorY:ft}=Ce;let et=null;if(Ce&&de){const Mt=this.retainedQueryData[n.bucketInstanceId];et=p.latestFeatureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:Mt.bucketIndex,sourceLayerIndex:Mt.sourceLayerIndex,layoutVertexArrayOffset:0})}const vt=me.evaluate(et,{}),Ge=l.has(ke);let lt=this.opacities[ke];Ge?lt=V:lt||(lt=xe,this.opacities[ke]=lt),l.add(ke);const ot=Be>0||Le>0,bt=Ve>0,St=this.placedOrientations[ke],ut=St===o.bk.vertical,pt=St===o.bk.horizontal||St===o.bk.horizontalOnly;!ot&&!bt||lt.isHidden()||Pe++;let Kt=!1;if((ot||bt)&&T)for(const Mt of n.activeReplacements){if(o.br(Mt,x,o.bs.Symbol,D)||Mt.min.x>rt||rt>Mt.max.x||Mt.min.y>ft||ft>Mt.max.y)continue;const Nt=o.bt(rt,ft,C.canonical,Mt.footprintTileId.canonical);if(Kt=o.bu(Nt,Mt.footprint),Kt)break}if(ot){const Mt=Kt?Ql:Jl(lt.text);ve(n.text,Be,ut?Ql:Mt),ve(n.text,Le,pt?Ql:Mt);const Nt=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:ir,centerJustifiedTextSymbolIndex:Gt,rightJustifiedTextSymbolIndex:er,verticalPlacedTextSymbolIndex:Tr}=Ce,vr=n.text.placedSymbolArray,Xr=Nt||ut?1:0;ir>=0&&(vr.get(ir).hidden=Xr),Gt>=0&&(vr.get(Gt).hidden=Xr),er>=0&&(vr.get(er).hidden=Xr),Tr>=0&&(vr.get(Tr).hidden=Nt||pt?1:0);const rn=this.variableOffsets[ke];rn&&this.markUsedJustification(n,rn.anchor,Ce,St);const fn=this.placedOrientations[ke];fn&&(this.markUsedJustification(n,"left",Ce,fn),this.markUsedOrientation(n,fn,Ce))}if(bt){const Mt=Kt?Ql:Jl(lt.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:ir}=Ce,Gt=n.icon.placedSymbolArray,er=lt.icon.isHidden()?1:0;Nt>=0&&(ve(n.icon,Ve,ut?Ql:Mt),Gt.get(Nt).hidden=er),ir>=0&&(ve(n.icon,Ce.numVerticalIconVertices,pt?Ql:Mt),Gt.get(ir).hidden=er)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Mt=n.collisionArrays[Se];if(Mt){let Nt=new o.P(0,0),ir=!0;if(Mt.textBox||Mt.verticalTextBox){if(Q){const er=this.variableOffsets[ke];er?(Nt=Kl(er.anchor,er.width,er.height,er.textOffset,er.textScale),ee&&Nt._rotate(re?this.transform.angle:-this.transform.angle)):ir=!1}U&&(ir=!lt.clipped),Mt.textBox&&Uh(n.textCollisionBox.collisionVertexArray,lt.text.placed,!ir||ut,vt,ye,Nt.x,Nt.y),Mt.verticalTextBox&&Uh(n.textCollisionBox.collisionVertexArray,lt.text.placed,!ir||pt,vt,ye,Nt.x,Nt.y)}const Gt=ir&&!!(!pt&&Mt.verticalIconBox);Mt.iconBox&&Uh(n.iconCollisionBox.collisionVertexArray,lt.icon.placed,Gt,vt,ye,Ce.hasIconTextFit?Nt.x:0,Ce.hasIconTextFit?Nt.y:0),Mt.verticalIconBox&&Uh(n.iconCollisionBox.collisionVertexArray,lt.icon.placed,!Gt,vt,ye,Ce.hasIconTextFit?Nt.x:0,Ce.hasIconTextFit?Nt.y:0)}}}if(n.fullyClipped=Pe===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Se.invProjMatrix,n.placementViewportMatrix=Se.viewportMatrix,n.collisionCircleArray=Se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Uh(d,n,l,p,_,x,T){d.emplaceBack(n?1:0,l?1:0,x||0,T||0,p,_?1:0),d.emplaceBack(n?1:0,l?1:0,x||0,T||0,p,_?1:0),d.emplaceBack(n?1:0,l?1:0,x||0,T||0,p,_?1:0),d.emplaceBack(n?1:0,l?1:0,x||0,T||0,p,_?1:0)}const qa=Math.pow(2,25),gb=Math.pow(2,24),u_=Math.pow(2,17),ro=Math.pow(2,16),yb=Math.pow(2,9),Vh=Math.pow(2,8),h_=Math.pow(2,1);function Jl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,l=Math.floor(127*d.opacity);return l*qa+n*gb+l*u_+n*ro+l*yb+n*Vh+l*h_+n}const Ql=0;class _b{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,p,_,x){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(T,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,D)=>C.sortKey-D.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,p,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class xu{constructor(n,l,p,_,x,T,C,D,z){this.placement=new tl(n,x,T,C,D,z),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,l,p,_){const x=o.q.now(),T=()=>{const C=o.q.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=l[n[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=D)&&(!C.maxzoom||C.maxzoom>D)){const z=C,B=z.layout.get("symbol-z-elevate"),U=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=z.layout.get("symbol-z-order"),q=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&U),K=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),Q=q&&K,ee=this._inProgressLayer=this._inProgressLayer||new _b(z),re=o.av(C.source,C.scope);if(ee.continuePlacement(B||Q?_[re]:p[re],this.placement,this._showCollisionBoxes,C,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const rl=512/o.ab/2;class vb{constructor(n,l,p){this.tileID=n,this.bucketInstanceId=p,this.index=new o.by(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=n.canonical.x*o.ab,x=n.canonical.y*o.ab;for(let T=0;T<l.length;T++){const{key:C,crossTileID:D,tileAnchorX:z,tileAnchorY:B}=l.get(T),U=Math.floor((_+z)*rl),V=Math.floor((x+B)*rl);this.index.add(U,V),this.keys.push(C),this.crossTileIDs.push(D)}this.index.finish()}findMatches(n,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),x=rl/Math.pow(2,l.canonical.z-this.tileID.canonical.z),T=l.canonical.x*o.ab,C=l.canonical.y*o.ab;for(let D=0;D<n.length;D++){const z=n.get(D);if(z.crossTileID)continue;const{key:B,tileAnchorX:U,tileAnchorY:V}=z,q=Math.floor((T+U)*x),K=Math.floor((C+V)*x),Q=this.index.range(q-_,K-_,q+_,K+_);for(const ee of Q){const re=this.crossTileIDs[ee];if(this.keys[ee]===B&&!p.has(re)){p.add(re),z.crossTileID=re;break}}}}}class ec{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class f_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const T in _){const C=_[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),x[C.tileID.key]=C}this.indexes[p]=x}this.lng=n}addBucket(n,l,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const _=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>n.overscaledZ)for(const C in T){const D=T[C];D.tileID.isChildOf(n)&&D.findMatches(l.symbolInstances,n,_)}else{const C=T[n.scaledTo(Number(x)).key];C&&C.findMatches(l.symbolInstances,n,_)}}for(let x=0;x<l.symbolInstances.length;x++){const T=l.symbolInstances.get(x);T.crossTileID||(T.crossTileID=p.generate(),_.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new vb(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)n[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],l=!0)}return l}}class Gh{constructor(){this.layerIndexes={},this.crossTileIDs=new ec,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,p,_){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new f_);let T=!1;const C={};_.name!=="globe"&&x.handleWrapJump(p);for(const D of l){const z=D.getBucket(n);z&&n.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,z,this.crossTileIDs)&&(T=!0),C[z.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(T=!0),T}pruneUnusedLayers(n){const l={};n.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const go=771;class Mr{constructor(n,l,p,_){this.blendFunction=n,this.blendColor=l,this.mask=p,this.blendEquation=_}}Mr.Replace=[1,0,1,0],Mr.disabled=new Mr(Mr.Replace,o.bz.transparent,[!1,!1,!1,!1]),Mr.unblended=new Mr(Mr.Replace,o.bz.transparent,[!0,!0,!0,!0]),Mr.alphaBlended=new Mr([1,go,1,go],o.bz.transparent,[!0,!0,!0,!0]),Mr.alphaBlendedNonPremultiplied=new Mr([770,go,770,go],o.bz.transparent,[!0,!0,!0,!0]),Mr.multiply=new Mr([774,0,774,0],o.bz.transparent,[!0,!0,!0,!0]);class Qt{constructor(n,l,p){this.func=n,this.mask=l,this.range=p}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Dp=7680;class pr{constructor(n,l,p,_,x,T){this.test=n,this.ref=l,this.mask=p,this.fail=_,this.depthFail=x,this.pass=T}}pr.disabled=new pr({func:519,mask:0},0,0,Dp,Dp,Dp);const Lp=1029,bu=2305;class or{constructor(n,l,p){this.enable=n,this.mode=l,this.frontFace=p}}function Rp(d,n){const l=o.bC(d,3);o.a6.mat4.fromQuat(d,n),o.bE(d,3,l)}function qh(d,n){const l=o.a6.quat.identity([]);return o.a6.quat.rotateZ(l,l,-n),o.a6.quat.rotateX(l,l,-d),l}function zp(d,n){const l=[d[0],d[1],0],p=[n[0],n[1],0];if(o.a6.vec3.length(l)>=1e-15){const T=o.a6.vec3.normalize([],l);o.a6.vec3.scale(p,T,o.a6.vec3.dot(p,T)),n[0]=p[0],n[1]=p[1]}const _=o.a6.vec3.cross([],n,d);if(o.a6.vec3.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return qh(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}or.disabled=new or(!1,Lp,bu),or.backCCW=new or(!0,Lp,bu),or.backCW=new or(!0,Lp,2304),or.frontCW=new or(!0,1028,2304),or.frontCCW=new or(!0,1028,bu);class bs{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof o.a5?n:new o.a5(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=o.bA(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(o.a5.fromLngLat(n)):0,x=o.a5.fromLngLat(n,_),T=[x.x-p.x,x.y-p.y,x.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=zp(T,l)}setPitchBearing(n,l){this.orientation=qh(o.bB(n),o.bB(-l))}}class nl{constructor(n,l){this._transform=o.a6.mat4.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new o.a5(n[0],n[1],n[2])}get position(){const n=o.bC(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&o.bE(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.a6.quat.identity([]),n&&Rp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=qh(n,l),Rp(this._transform,this._orientation)}forward(){const n=o.bC(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.bC(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.bC(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const p=new Float64Array(16);return o.a6.mat4.invert(p,this.getWorldToCamera(n,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,p){const _=this.position;o.a6.vec3.scale(_,_,-n);const x=new Float64Array(16);return o.a6.mat4.fromScaling(x,[p,p,p]),o.a6.mat4.translate(x,x,_),x[10]*=l,x}getWorldToCamera(n,l){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return o.a6.quat.conjugate(_,this._orientation),o.a6.vec3.scale(x,x,-n),o.a6.mat4.fromQuat(p,_),o.a6.mat4.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(n,l,p,_){const x=new Float64Array(16);return o.a6.mat4.perspective(x,n,l,p,_),x}getCameraToClipOrthographic(n,l,p,_,x,T){const C=new Float64Array(16);return o.a6.mat4.ortho(C,n,l,p,_,x,T),C}getDistanceToElevation(n,l=!1){const p=n===0?0:o.bD(n,l?o.aM(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new nl([...this.position],[...this.orientation])}}const wi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Wh{constructor(n=0,l=0,p=0,_=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=p,this.right=_}interpolate(n,l,p){return l.top!=null&&n.top!=null&&(this.top=o.aa(n.top,l.top,p)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.aa(n.bottom,l.bottom,p)),l.left!=null&&n.left!=null&&(this.left=o.aa(n.left,l.left,p)),l.right!=null&&n.right!=null&&(this.right=o.aa(n.right,l.right,p)),this}getCenter(n,l){const p=o.ap((this.left+n-this.right)/2,0,n),_=o.ap((this.top+l-this.bottom)/2,0,l);return new o.P(p,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Wh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const tc=(d,n,l)=>(1-l)*d+l*n,rc=d=>d*d*d*d*d;class Hh{constructor(n,l,p,_,x,T,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(T),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new nl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const n=new Hh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.ar(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.bL(this.projectionOptions);const p=this.getProjection(),_=!o.bh(l,p);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bL({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bA(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.a6.mat2.create(),o.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.ap(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.bB(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let T=0;T<l.length;T++){const C=new o.P(l[T][0]*this.width,p+l[T][1]*(this.height-p)),D=n.pointCoordinate(C);if(!D)continue;const z=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);_+=D[3]*z,x+=z}return x===0?NaN:_/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const _=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,p));return o.ap(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.a6.quat.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];o.a6.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new bs;return l.position=new o.a5(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.a6.quat.length(n))return!1;o.a6.quat.normalize(n,n);const l=o.a6.vec3.transformQuat([],[0,0,-1],n),p=o.a6.vec3.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const _=zp(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=o.ap(n[2],_/p,_/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,p){this._unmodified=!1,this._edgeInsets.interpolate(n,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.bM(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),_=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(p.x,_.x,x.x,T.x)),D=Math.floor(Math.max(p.x,_.x,x.x,T.x)),z=1;for(let B=C-z;B<=D+z;B++)B!==0&&l.push(new o.bM(B,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,l,p){let _=[];const x=p!==void 0,T=!x;if(T&&this.zoom<l||x&&p[0]===0&&p[1]===0)return _;const C=new Set,D=(B,U,V,q,K)=>{const Q=o.c1(U,B,V,q,K);C.has(Q)||(_.push(new o.aA(B,U,V,q,K)),C.add(Q))};for(let B=0;B<n.length;B++){const U=n[B];if(T&&U.canonical.z!==l)continue;const V=U.canonical,q=U.overscaledZ,K=U.wrap,Q=1<<V.z,ee=V.x+1<Q,re=V.x>0,me=V.y+1<Q,ye=V.y>0,de=U.wrap-(re?0:1),xe=U.wrap+(ee?0:1),ve=re?V.x-1:Q-1,Pe=ee?V.x+1:0;if(x)p[0]<0?(D(q,xe,V.z,Pe,V.y),p[1]<0&&me&&(D(q,K,V.z,V.x,V.y+1),D(q,xe,V.z,Pe,V.y+1)),p[1]>0&&ye&&(D(q,K,V.z,V.x,V.y-1),D(q,xe,V.z,Pe,V.y-1))):p[0]>0?(D(q,de,V.z,ve,V.y),p[1]<0&&me&&(D(q,K,V.z,V.x,V.y+1),D(q,de,V.z,ve,V.y+1)),p[1]>0&&ye&&(D(q,K,V.z,V.x,V.y-1),D(q,de,V.z,ve,V.y-1))):p[1]<0&&me?D(q,K,V.z,V.x,V.y+1):ye&&D(q,K,V.z,V.x,V.y-1);else{const Se=U.visibleQuadrants;1&Se&&(D(q,de,V.z,ve,V.y),ye&&(D(q,K,V.z,V.x,V.y-1),D(q,de,V.z,ve,V.y-1))),2&Se&&(D(q,xe,V.z,Pe,V.y),ye&&(D(q,K,V.z,V.x,V.y-1),D(q,xe,V.z,Pe,V.y-1))),4&Se&&(D(q,de,V.z,ve,V.y),me&&(D(q,K,V.z,V.x,V.y+1),D(q,de,V.z,ve,V.y+1))),8&Se&&(D(q,xe,V.z,Pe,V.y),me&&(D(q,K,V.z,V.x,V.y+1),D(q,xe,V.z,Pe,V.y+1)))}}const z=[];for(const B of _)_.some(U=>B.isChildOf(U))||z.push(B);if(_=z.filter(B=>!n.some(U=>!!(B.overscaledZ<l&&U.isChildOf(B))||B.equals(U)||B.isChildOf(U))),T){const B=1<<l,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[B*U.x,B*U.y],q=4,K=q*q;_=_.filter(Q=>{const ee=Q.canonical.x+.5-V[0],re=Q.canonical.y+.5-V[1];return ee*ee+re*re<K})}return _}coveringTiles(n){let l=this.coveringZoomLevel(n);const p=l,_=this.elevation&&this.elevation.exaggeration(),x=_&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const C=this.locationCoordinate(this.center),D=this.center.lat,z=1<<l,B=[z*C.x,z*C.y,0],U=this.projection.name==="globe",V=!U,q=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,V),K=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=z*o.bD(1,this.center.lat),ee=this._camera.position[2]/o.bD(1,this.center.lat),re=[z*K.x,z*K.y,ee*(V?1:Q)],me=U||_,ye=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),de=this.isLODDisabled(!0)?l:0;let xe;if(this._elevation&&n.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ge=this._elevation.getMinMaxForVisibleTiles();xe=Ge?Ge.max:this._centerAltitude}else xe=this._centerAltitude;const ve=n.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=this.projection.isReprojectedInTileSpace?o.bO(this):1,Se=Ge=>{const ot=new o.a5(Ge.x+25e-6,Ge.y,Ge.z),bt=new o.a5(Ge.x,Ge.y+25e-6,Ge.z),St=Ge.toLngLat(),ut=ot.toLngLat(),pt=bt.toLngLat(),Kt=this.locationCoordinate(St),Mt=this.locationCoordinate(ut),Nt=this.locationCoordinate(pt),ir=Math.hypot(Mt.x-Kt.x,Mt.y-Kt.y),Gt=Math.hypot(Nt.x-Kt.x,Nt.y-Kt.y);return Math.sqrt(ir*Gt)*Pe/25e-6},Ce=Ge=>{const lt=xe,ot=ve;return{aabb:o.bR(this,z,0,0,0,Ge,ot,lt,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:lt,wrap:Ge,fullyVisible:!1}},Be=[];let Le=[];const ke=l,Ve=n.reparseOverscaled?p:l,rt=(ee-this._centerAltitude)*Q,ft=Ge=>{if(!this._elevation||!Ge.tileID||!T)return;const lt=this._elevation.getMinMaxForTile(Ge.tileID),ot=Ge.aabb;lt?(ot.min[2]=lt.min,ot.max[2]=lt.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(Ge.shouldSplit=vt(Ge),Ge.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},et=(Ge,lt)=>{if(.707*lt<Ge)return 1;const ot=lt/Ge;return ot/(1.4144271570014144+(Math.pow(1.1,ot-1.4144271570014144+1)-1)/(1.1-1)-1)},vt=Ge=>{if(Ge.zoom<de)return!0;if(Ge.zoom===ke)return!1;if(Ge.shouldSplit!=null)return Ge.shouldSplit;const lt=Ge.aabb.distanceX(re),ot=Ge.aabb.distanceY(re);let bt=rt,St=1;if(U){bt=Ge.aabb.distanceZ(re);const Gt=Math.pow(2,Ge.zoom),er=o.aM((Ge.y+1)/Gt),Tr=o.aM(Ge.y/Gt),vr=Math.min(Math.max(D,er),Tr),Xr=o.c5(vr)/o.c5(D);if(St=vr===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xr/this._mercatorScaleRatio),this.zoom<=o.c2&&Ge.zoom===ke-1&&Xr>=.9)return!0}else if(x&&(bt=Ge.aabb.distanceZ(re)*Q),this.projection.isReprojectedInTileSpace&&p<=5){const Gt=Math.pow(2,Ge.zoom),er=Se(new o.a5((Ge.x+.5)/Gt,(Ge.y+.5)/Gt));St=er>.85?1:er}if(!T){const Gt=Math.sqrt(lt*lt+ot*ot+bt*bt);let er=(1<<ke-Ge.zoom)*ye*St;return er*=et(Math.max(bt,rt),Gt),Gt<er}let ut=Number.MAX_VALUE,pt=0;const Kt=Ge.aabb.getCorners(),Mt=[];for(const Gt of Kt){o.a6.vec3.sub(Mt,Gt,re),U||(x?Mt[2]*=Q:Mt[2]=rt);const er=o.a6.vec3.dot(Mt,this._camera.forward());er<ut&&(ut=er,pt=Math.abs(Mt[2]))}let Nt=(1<<ke-Ge.zoom)*ye*St;if(Nt*=et(Math.max(pt,rt),ut),ut<Nt)return!0;const ir=Ge.aabb.closestPoint(B);return ir[0]===B[0]&&ir[1]===B[1]};if(this.renderWorldCopies)for(let Ge=1;Ge<=3;Ge++)Be.push(Ce(-Ge)),Be.push(Ce(Ge));for(Be.push(Ce(0));Be.length>0;){const Ge=Be.pop(),lt=Ge.x,ot=Ge.y;let bt=Ge.fullyVisible;const St=()=>this.projection.name==="globe"&&(Ge.y===0||Ge.y===(1<<Ge.zoom)-1);if(!bt){let ut=me?Ge.aabb.intersects(q):Ge.aabb.intersectsFlat(q);if(ut===0&&St()){const pt=new o.bP(Ge.zoom,lt,ot);ut=o.bQ(this,z,pt,!0).intersects(q)}if(ut===0)continue;bt=ut===2}if(Ge.zoom!==ke&&vt(Ge))for(let ut=0;ut<4;ut++){const pt=(lt<<1)+ut%2,Kt=(ot<<1)+(ut>>1),Mt={aabb:T?Ge.aabb.quadrant(ut):o.bR(this,z,Ge.zoom+1,pt,Kt,Ge.wrap,Ge.minZ,Ge.maxZ,this.projection),zoom:Ge.zoom+1,x:pt,y:Kt,wrap:Ge.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ge.minZ,maxZ:Ge.maxZ};x&&!U&&(Mt.tileID=new o.aA(Ge.zoom+1===ke?Ve:Ge.zoom+1,Ge.wrap,Ge.zoom+1,pt,Kt),ft(Mt)),Be.push(Mt)}else{const ut=Ge.zoom===ke?Ve:Ge.zoom;if(n.minzoom&&n.minzoom>ut)continue;let pt=0;if(!bt){let ir=me?Ge.aabb.intersectsPrecise(q):Ge.aabb.intersectsPreciseFlat(q);if(ir===0&&St()){const Gt=new o.bP(Ge.zoom,lt,ot);ir=o.bQ(this,z,Gt,!0).intersectsPrecise(q)}if(ir===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(Ge.aabb.center))pt=15;else for(let Gt=0;Gt<4;Gt++)Ge.aabb.quadrant(Gt).intersects(q)!==0&&(pt|=1<<Gt)}const Kt=B[0]-(.5+lt+(Ge.wrap<<Ge.zoom))*(1<<l-Ge.zoom),Mt=B[1]-.5-ot,Nt=Ge.tileID?Ge.tileID:new o.aA(ut,Ge.wrap,Ge.zoom,lt,ot);n.calculateQuadrantVisibility&&(Nt.visibleQuadrants=pt),Le.push({tileID:Nt,distanceSq:Kt*Kt+Mt*Mt})}}if(this.fogCullDistSq){const Ge=this.fogCullDistSq,lt=this.horizonLineFromTop();Le=Le.filter(ot=>{const bt=[0,0,0,1],St=[o.ab,o.ab,0,1],ut=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());o.a6.vec4.transformMat4(bt,bt,ut),o.a6.vec4.transformMat4(St,St,ut);const pt=o.a6.vec4.min([],bt,St),Kt=o.a6.vec4.max([],bt,St),Mt=o.bS(pt,Kt);if(Mt===0)return!0;let Nt=!1;const ir=this._elevation;if(ir&&Mt>Ge&&lt!==0){const Gt=this.calculateProjMatrix(ot.tileID.toUnwrapped());let er;n.isTerrainDEM||(er=ir.getMinMaxForTile(ot.tileID)),er||(er={min:ve,max:xe});const Tr=o.c3(this.rotation),vr=[Tr[0]*o.ab,Tr[1]*o.ab,er.max];o.a6.vec3.transformMat4(vr,vr,Gt),Nt=(1-vr[1])*this.height*.5<lt}return Mt<Ge||Nt})}return Le.sort((Ge,lt)=>Ge.distanceSq-lt.distanceSq).map(Ge=>Ge.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=o.ap(n.lat,-o.bT,o.bT),p=this.projection.project(n.lng,l);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let p,_;const x=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;p=(l.x-x.x)/C,_=(l.y-x.y)/C}else{const C=this.pointCoordinate(l),D=this.pointCoordinate(x);p=C.x-D.x,_=C.y-D.y}const T=this.locationCoordinate(n);this.setLocation(new o.a5(T.x-p,T.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const p=l?o.bD(l,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new o.a5(_.x,_.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const p=l??this._centerAltitude,_=[n.x,n.y,0,1],x=[n.x,n.y,1,1];o.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse),o.a6.vec4.transformMat4(x,x,this.pixelMatrixInverse);const T=x[3];o.a6.vec4.scale(_,_,1/_[3]),o.a6.vec4.scale(x,x,1/T);const C=_[2],D=x[2];return{p0:_,p1:x,t:C===D?0:(p-C)/(D-C)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return o.a6.vec4.transformMat4(l,l,this.pixelMatrixInverse),o.a6.vec4.transformMat4(p,p,this.pixelMatrixInverse),o.a6.vec4.scale(l,l,1/l[3]),o.a6.vec4.scale(p,p,1/p[3]),l[2]=o.bD(l[2],this._center.lat)*this.worldSize,p[2]=o.bD(p[2],this._center.lat)*this.worldSize,o.a6.vec4.scale(l,l,1/this.worldSize),o.a6.vec4.scale(p,p,1/this.worldSize),new o.aj([l[0],l[1],l[2]],o.a6.vec3.normalize([],o.a6.vec3.sub([],p,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:p,t:_}=n,x=o.bD(l[2],this._center.lat),T=o.bD(p[2],this._center.lat);return new o.a5(o.aa(l[0],p[0],_)/this.worldSize,o.aa(l[1],p[1],_)/this.worldSize,o.aa(x,T,_))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let l=this.projection.pointCoordinate3D(this,n.x,n.y);if(l)return new o.a5(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const x=.02*_,T=n.clone();for(let C=0;C<10&&_-p>x;C++){T.y=o.aa(p,_,.66);const D=this.projection.pointCoordinate3D(this,T.x,T.y);D?(_=T.y,l=D):p=T.y}return l?new o.a5(l[0],l[1],l[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.bU)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return o.a6.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new o.P(_[0]/_[3],_[1]/_[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(l,n)),T=this.pointLocation3D(new o.P(_,n)),C=this.pointLocation3D(new o.P(_,p)),D=this.pointLocation3D(new o.P(l,p));let z=Math.min(x.lng,T.lng,C.lng,D.lng),B=Math.max(x.lng,T.lng,C.lng,D.lng),U=Math.min(x.lat,T.lat,C.lat,D.lat),V=Math.max(x.lat,T.lat,C.lat,D.lat);const q=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,Q=(ee,re,me,ye,de)=>{const xe=(ee+me)/2,ve=(re+ye)/2,Pe=new o.P(xe,ve),{lng:Se,lat:Ce}=this.pointLocation3D(Pe),Be=Math.max(0,z-Se,U-Ce,Se-B,Ce-V);z=Math.min(z,Se),B=Math.max(B,Se),U=Math.min(U,Ce),V=Math.max(V,Ce),(de<K||Be>q)&&(Q(ee,re,xe,ve,de+1),Q(xe,ve,me,ye,de+1))};if(Q(l,n,_,n,1),Q(_,n,_,p,1),Q(_,p,l,p,1),Q(l,p,l,n,1),this.projection.name==="globe"){const[ee,re]=o.bV(this);ee?(V=90,B=180,z=-180):re&&(U=-90,B=180,z=-180)}return new o.as(new o.bK(z,U),new o.bK(B,V))}_getBoundsRectangular(n,l){const{top:p,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,C=new o.P(_,p),D=new o.P(T,p),z=new o.P(T,x),B=new o.P(_,x);let U=this.pointCoordinate(C,n),V=this.pointCoordinate(D,n);const q=this.pointCoordinate(z,l),K=this.pointCoordinate(B,l),Q=(ee,re)=>(re.y-ee.y)/(re.x-ee.x);return U.y>1&&V.y>=0?U=new o.a5((1-K.y)/Q(K,U)+K.x,1):U.y<0&&V.y<=1&&(U=new o.a5(-K.y/Q(K,U)+K.x,0)),V.y>1&&U.y>=0?V=new o.a5((1-q.y)/Q(q,V)+q.x,1):V.y<0&&U.y<=1&&(V=new o.a5(-q.y/Q(q,V)+q.x,0)),new o.as().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.bT,this.maxLat=o.bT,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.am(this.minLng)*this.tileSize,this.worldMaxX=o.am(this.maxLng)*this.tileSize,this.worldMinY=o.at(this.maxLat)*this.tileSize,this.worldMaxY=o.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=n.canonical,x=1/this.height,T=this.cameraWorldSize,C=T/this.zoomScale(_.z),D=(_.x+Math.pow(2,_.z)*n.wrap)*C,z=_.y*C,B=this.point;B.x*=T/this.worldSize,B.y*=T/this.worldSize;const U=this.angle,V=Math.sin(-U),q=-Math.cos(-U);return p[l]={bearing:[V,q],center:[(B.x-D)*x,(B.y-z)*x],scale:C/o.ab*x},p[l]}calculateFogTileMatrix(n){const l=n.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.a6.mat4.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(n,l=!1,p=!1){const _=n.key;let x;if(x=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,x[_])return x[_];const T=this.calculatePosMatrix(n,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.a6.mat4.multiply(T,C,T),x[_]=new Float32Array(T),x[_]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=o.bW(n,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=o.a6.mat4.fromScaling([],[n,n,n]);return o.a6.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=o.bD(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),x=o.bD(1,this._center.lat);p[2]/=x,_[2]/=x,o.a6.vec3.normalize(_,_);const T=n.raycast(p,_,n.exaggeration());if(T){const C=o.a6.vec3.scaleAndAdd([],p,_,T),D=new o.a5(C[0],C[1],o.bD(C[2],o.aM(C[1]))),z=(D.z+o.a6.vec3.length([D.x-p[0],D.y-p[1],D.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,p=o.bD(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),x=l.getAtPointOrZero(new o.a5(..._)),T=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),D=_[2]-T;if(D<=C)if(D<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),B=[_[0],_[1],z.z-_[2]],U=o.a6.vec3.length(B);B[2]-=(C-D)/this._pixelsPerMercatorPixel;const V=o.a6.vec3.length(B);if(V===0)return;o.a6.vec3.scale(B,B,U/V*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],z.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const V=this.center;return V.lat=o.ap(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(V.lng=o.ap(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let x=0,T=p,C=_;const D=this.width/2,z=this.height/2,B=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-z<B&&(C=B+z),_+z>U&&(C=U-z),U-B<this.height&&(x=Math.max(x,this.height/(U-B)),C=(U+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,K=this.worldSize/2-(V+q)/2;T=(p+K+this.worldSize)%this.worldSize-K,T-D<V&&(T=V+D),T+D>q&&(T=q-D),q-V<this.width&&(x=Math.max(x,this.width/(q-V)),T=(q+V)/2)}T===p&&C===_||(this.center=this.unproject(new o.P(T,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bD(1,this.center.lat)/o.bD(1,o.c4));const _=o.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,x);let C;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-n.x/this.width,D[9]=2*n.y/this.height,this.isOrthographic){let Ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Be=Ce*this.aspect,Le=-Be,ke=-Ce;Be-=n.x,Le-=n.x,Ce+=n.y,ke+=n.y,C=this._camera.getCameraToClipOrthographic(Le,Be,ke,Ce,this._nearZ,this._farZ),((Ve,rt,ft,et)=>{for(let vt=0;vt<16;vt++)Ve[vt]=tc(rt[vt],ft[vt],et)})(C,C,D,rc(this.pitch>=15?1:this.pitch/15))}else C=D;const z=o.a6.mat4.mul([],D,T);let B=o.a6.mat4.mul([],C,T);if(this.projection.isReprojectedInTileSpace){const Ce=this.locationCoordinate(this.center),Be=o.a6.mat4.identity([]);o.a6.mat4.translate(Be,Be,[Ce.x*this.worldSize,Ce.y*this.worldSize,0]),o.a6.mat4.multiply(Be,Be,o.bY(this)),o.a6.mat4.translate(Be,Be,[-Ce.x*this.worldSize,-Ce.y*this.worldSize,0]),o.a6.mat4.multiply(B,B,Be),o.a6.mat4.multiply(z,z,Be),this.inverseAdjustmentMatrix=o.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.mat4.scale([],B,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=B,this.invProjMatrix=o.a6.mat4.invert(new Float64Array(16),this.projMatrix),l){const Ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ce[8]=2*-n.x/this.width,Ce[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.a6.mat4.mul([],Ce,T)}else this.expandedFarZProjMatrix=this.projMatrix;const U=o.a6.mat4.invert([],C);this.frustumCorners=o.b_.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const V=new Float32Array(16);o.a6.mat4.identity(V),o.a6.mat4.scale(V,V,[1,-1,1]),o.a6.mat4.rotateX(V,V,this._pitch),o.a6.mat4.rotateZ(V,V,this.angle);const q=o.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.mat4.clone(q);const K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+K)/this.height,this.skyboxMatrix=o.a6.mat4.multiply(V,q,V);const Q=this.point,ee=Q.x,re=Q.y,me=this.width%2/2,ye=this.height%2/2,de=Math.cos(this.angle),xe=Math.sin(this.angle),ve=ee-Math.round(ee)+de*me+xe*ye,Pe=re-Math.round(re)+de*ye+xe*me,Se=new Float64Array(B);if(o.a6.mat4.translate(Se,Se,[ve>.5?ve-1:ve,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=Se,B=o.a6.mat4.create(),o.a6.mat4.scale(B,B,[this.width/2,-this.height/2,1]),o.a6.mat4.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=o.a6.mat4.create(),o.a6.mat4.scale(B,B,[1,-1,1]),o.a6.mat4.translate(B,B,[-1,-1,0]),o.a6.mat4.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=o.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},B=o.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.b$(this);const Ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.a6.vec3.transformMat4(Ce,Ce,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,l];o.a6.vec3.scale(x,x,_),o.a6.vec3.scale(p,p,-1),o.a6.vec3.multiply(p,p,x);const T=o.a6.mat4.create();o.a6.mat4.translate(T,T,p),o.a6.mat4.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,_)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,n/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((l-p)/_,1)),this._camera.position=o.a6.vec3.scaleAndAdd([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=o.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bB(this._maxPitch)),C=Math.max((n[2]-x)/Math.cos(p),T),D=this._zoomFromMercatorZ(C);o.a6.vec3.scaleAndAdd(n,n,l,C),this._pitch=o.ap(p,o.bB(this.minPitch),o.bB(this.maxPitch)),this.angle=o.bA(_,-Math.PI,Math.PI),this._setZoom(o.ap(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.a5(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,p=o.bU,_=0,x=1/0;for(;p-l>1e-6&&p>l;){const T=l+.5*(p-l),C=this.tileSize*Math.pow(2,T),D=this.getCameraToCenterDistance(this.projection,T,C),z=this.scaleZoom(D/(n*this.tileSize)),B=Math.abs(T-z);B<x&&(x=B,_=T),T<z?l=T:p=T}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const p=Math.min(n.x,l.x),_=Math.max(n.x,l.x),x=Math.min(n.y,l.y),T=Math.max(n.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.P(p,x),new o.P(_,T),new o.P(p,T),new o.P(_,x)],D=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const B of C){const U=this.pointRayIntersection(B);if(U.t<0)return!0;const V=this.rayIntersectionCoordinate(U);if(V.x<D||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,l){const p=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,p,_],x){const T=[l,p,_,1];o.a6.vec4.transformMat4(T,T,x);const C=T[3]=Math.max(T[3],1e-6);return T[0]/=C,T[1]/=C,T[2]/=C,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,p=this.worldSize){const _=o.bX(n,l,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,p,_);let T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=tc(1,T,rc(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Wa=(d,n)=>{if(n>0&&d.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=d.transform,p=Math.max(Math.abs(l._zoom-(d.minCutoffZoom-1)),1),_=l.isLODDisabled(!1)?o.a7(60,45,l.pitch):o.a7(30,15,l.pitch),x=l._farZ-l._nearZ,T=n*l.height,C=((1-(D=_))*l.cameraToCenterDistance+D*(l._farZ+T))*p;var D;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(C-l._nearZ)/x,(C-T-l._nearZ)/x]}}},En={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Bp{constructor(n,l){this.aabb=n,this.lastCascade=l}}class Ct{add(n,l){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[n.key]=new Bp(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,p){const _=o.c9.fromPoints(n.points);let x=0;for(const T in this.receivers){const C=this.receivers[T];if(!C||!_.intersectsAabb(C.aabb))continue;C.aabb.min=_.closestPoint(C.aabb.min),C.aabb.max=_.closestPoint(C.aabb.max);const D=C.aabb.getCorners();for(let z=0;z<p.length;z++){let B=!0;for(const U of D){const V=[U[0]*l,U[1]*l,U[2]];if(o.a6.vec3.transformMat4(V,V,p[z].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){B=!1;break}}if(C.lastCascade=z,x=Math.max(x,z),B)break}}return x+1}}class d_{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ct,this._depthMode=new Qt(n.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(En,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(En,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(En,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const _=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((K,Q)=>{const ee=p.style._mergedLayers[Q];return K+(ee.hasShadowPass()&&!ee.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=p.context,T=En.shadowMapResolution,C=En.shadowMapResolution;if(this._cascades.length===0||En.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<En.cascadeCount;++K){const Q=p._shadowMapDebug,ee=x.gl,re=x.createFramebuffer(T,C,Q,"texture"),me=new o.T(x,{width:T,height:C,data:null},ee.DEPTH_COMPONENT16);if(re.depthAttachment.set(me.texture),Q){const ye=new o.T(x,{width:T,height:C,data:null},ee.RGBA8);re.colorAttachment.set(ye.texture)}this._cascades.push({framebuffer:re,texture:me,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bN,scale:0})}}this.shadowDirection=Zh(l);let D=0;if(n.elevation){const K=n.elevation,Q=[1e4,-1e4];K.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const re=ee.dem.tree;Q[0]=Math.min(Q[0],re.minimums[0]),Q[1]=Math.max(Q[1],re.maximums[0])}),Q[0]!==1e4&&(D=(Q[1]-Q[0])*K.exaggeration())}const z=1.5*n.cameraToCenterDistance,B=3*z,U=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){const Q=this._cascades[K];let ee=n.height/50,re=1;En.cascadeCount===1?re=B:K===0?re=z:(ee=z,re=B);const[me,ye]=Yh(n,this.shadowDirection,ee,re,En.shadowMapResolution,D);Q.scale=n.scale,Q.matrix=me,Q.boundingSphereRadius=ye,o.a6.mat4.invert(U,Q.matrix),Q.frustum=o.bN.fromInvProjectionMatrix(U,1,0,!0),Q.far=re}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/En.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=En.shadowMapResolution,this._uniformValues.u_shadowmap_0=wi.ShadowMap0,this._uniformValues.u_shadowmap_1=wi.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const K of this._groundShadowTiles){let Q={min:0,max:0};if(q){const ee=q.getMinMaxForTile(K);ee&&(Q=ee)}this.addShadowReceiver(K.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,En.shadowMapResolution,En.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){p.currentShadowCascade=x,_.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),_.clear({color:o.bz.white,depth:1});for(const T of n.order){const C=n._mergedLayers[T];if(!C.hasShadowPass()||C.isHidden(p.transform.zoom))continue;const D=n.getLayerSourceCache(C),z=D?l[D.id]:void 0;(C.type==="model"||z&&z.length)&&p.renderLayer(p,D,C,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,p=n.context,_=l.directionalLight,x=l.ambientLight;if(!_||!x)return;const T=[],C=Wa(n,n.longestCutoffRange);C.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const D=Xh(l,_,x),z=new Qt(p.gl.LEQUAL,Qt.ReadOnly,n.depthRangeFor3D);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),V=n.isTileAffectedByFog(B),q=n.getOrCreateProgram("groundShadow",{defines:T,overrideFog:V});this.setupShadows(U,q),n.uploadCommonUniforms(p,q,U,null,C);const K={u_matrix:n.transform.calculateProjMatrix(U),u_ground_shadow_factor:D};q.draw(n,p.gl.TRIANGLES,z,pr.disabled,Mr.multiply,or.disabled,K,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mr.unblended:Mr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,p=l.calculatePosMatrix(n,l.worldSize);return o.a6.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return o.a6.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,l,p,_=0){if(!this.enabled)return;const x=this.painter.transform,T=this.painter.context,C=T.gl,D=this._uniformValues,z=new Float64Array(16),B=x.calculatePosMatrix(n,x.worldSize);for(let U=0;U<this._cascades.length;U++)o.a6.mat4.multiply(z,this._cascades[U].matrix,B),D[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),T.activeTexture.set(C.TEXTURE0+wi.ShadowMap0+U),this._cascades[U].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const U=o.c8(n.canonical),V=2/x.tileSize*o.ab/En.shadowMapResolution,q=V*this._cascades[0].boundingSphereRadius,K=V*this._cascades[this._cascades.length-1].boundingSphereRadius,Q=(p==="vector-tile"?1:3)/Math.pow(2,_-n.canonical.z-(1-x.zoom+Math.floor(x.zoom)));D.u_shadow_normal_offset=[U,q*Q,K*Q],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(T,D)}setupShadowsFromMatrix(n,l,p=!1){if(!this.enabled)return;const _=this.painter.context,x=_.gl,T=this._uniformValues,C=new Float64Array(16);for(let D=0;D<En.cascadeCount;D++)o.a6.mat4.multiply(C,this._cascades[D].matrix,n),T[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),_.activeTexture.set(x.TEXTURE0+wi.ShadowMap0+D),this._cascades[D].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const D=En.normalOffset;T.u_shadow_normal_offset=[1,D,D],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(_,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,p,_){if(_[2]>=0)return{};const x=function(D,z,B){const U=B/(1<<D.canonical.z);return new o.c9([D.canonical.x*U+D.wrap*B,D.canonical.y*U+D.wrap*B,0],[(D.canonical.x+1)*U+D.wrap*B,(D.canonical.y+1)*U+D.wrap*B,z])}(n,l,p).getCorners(),T=l/-_[2];_[0]<0?(o.a6.vec3.add(x[0],x[0],[_[0]*T,0,0]),o.a6.vec3.add(x[3],x[3],[_[0]*T,0,0])):_[0]>0&&(o.a6.vec3.add(x[1],x[1],[_[0]*T,0,0]),o.a6.vec3.add(x[2],x[2],[_[0]*T,0,0])),_[1]<0?(o.a6.vec3.add(x[0],x[0],[0,_[1]*T,0]),o.a6.vec3.add(x[1],x[1],[0,_[1]*T,0])):_[1]>0&&(o.a6.vec3.add(x[2],x[2],[0,_[1]*T,0]),o.a6.vec3.add(x[3],x[3],[0,_[1]*T,0]));const C={};return C.vertices=x,C.planes=[nc(x[1],x[0],x[4]),nc(x[2],x[1],x[5]),nc(x[3],x[2],x[6]),nc(x[0],x[3],x[7])],C}addShadowReceiver(n,l,p){this._receivers.add(n,o.c9.fromTileIdAndHeight(n,l,p))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function nc(d,n,l){const p=o.a6.vec3.sub([],l,n),_=o.a6.vec3.sub([],d,n),x=o.a6.vec3.cross([],p,_),T=o.a6.vec3.length(x);return T===0?[0,0,1,0]:(o.a6.vec3.scale(x,x,1/T),[x[0],x[1],x[2],-o.a6.vec3.dot(x,n)])}function Zh(d){const n=d.properties.get("direction"),l=o.c7(n.x,n.y,n.z);l[2]=o.ap(l[2],0,75);const p=o.ca([l[0],l[1],l[2]]);return o.a6.vec3.fromValues(p.x,p.y,p.z)}function Xh(d,n,l){const p=n.properties.get("color"),_=n.properties.get("intensity"),x=n.properties.get("direction"),T=[x.x,x.y,x.z],C=l.properties.get("color"),D=l.properties.get("intensity"),z=Math.max(o.a6.vec3.dot([0,0,1],T),0),B=[0,0,0];o.a6.vec3.scale(B,C.toRenderColor(d.getLut(n.scope)).toArray01Linear().slice(0,3),D);const U=[0,0,0];return o.a6.vec3.scale(U,p.toRenderColor(d.getLut(l.scope)).toArray01Linear().slice(0,3),z*_),o.cb([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function Yh(d,n,l,p,_,x){const T=d.zoom,C=d.scale,D=d.worldSize,z=1/D,B=d.aspect,U=Math.sqrt(1+B*B)*Math.tan(.5*d.fovX),V=U*U,q=p-l,K=p+l;let Q,ee;V>q/K?(Q=p,ee=p*U):(Q=.5*K*(1+V),ee=.5*Math.sqrt(q*q+2*(p*p+l*l)*V+K*K*V*V));const re=d.projection.pixelsPerMeter(d.center.lat,D),me=d._camera.getCameraToWorldMercator(),ye=[0,0,-Q*z];o.a6.vec3.transformMat4(ye,ye,me);let de=ee*z;const xe=d._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const bt=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?re:1),St=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,l,p);St[8]=2*-d.centerOffset.x/d.width,St[9]=2*d.centerOffset.y/d.height;const ut=new Float64Array(16);o.a6.mat4.mul(ut,St,bt);const pt=new Float64Array(16);o.a6.mat4.invert(pt,ut);const Kt=o.bN.fromInvProjectionMatrix(pt,D,T,!0);for(const Mt of Kt.points){const Nt=((ve=Mt)[0]/=C,ve[1]/=C,ve[2]=o.bD(ve[2],d._center.lat),ve);de=Math.max(de,o.a6.vec3.len(o.a6.vec3.subtract([],ye,Nt)))}}var ve;de*=_/(_-1);const Pe=Math.acos(n[2]),Se=Math.atan2(-n[0],-n[1]),Ce=new nl;Ce.position=ye,Ce.setPitchBearing(Pe,Se);const Be=Ce.getWorldToCamera(D,re),Le=de*D,ke=Math.min(d._mercatorZfromZoom(17)*D*-2,-2*Le),Ve=Ce.getCameraToClipOrthographic(-Le,Le,-Le,Le,ke,(Le+x*re)/n[2]),rt=new Float64Array(16);o.a6.mat4.multiply(rt,Ve,Be);const ft=o.a6.vec3.fromValues(Math.floor(1e6*ye[0])/1e6*D,Math.floor(1e6*ye[1])/1e6*D,0),et=.5*_,vt=[0,0,0];o.a6.vec3.transformMat4(vt,ft,rt),o.a6.vec3.scale(vt,vt,et);const Ge=[Math.floor(vt[0]),Math.floor(vt[1]),Math.floor(vt[2])],lt=[0,0,0];o.a6.vec3.sub(lt,vt,Ge),o.a6.vec3.scale(lt,lt,-1/et);const ot=new Float64Array(16);return o.a6.mat4.identity(ot),o.a6.mat4.translate(ot,ot,lt),o.a6.mat4.multiply(rt,ot,rt),[rt,Le]}class Ha extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,l){return o.aG(this.requestManager.transformRequest(l,o.R.Model).url).then(p=>{if(!p)return;const _=o.aH(p),x=new o.aI(n,void 0,void 0,_);return x.computeBoundsAndApplyParent(),x}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.t(new Error(`Could not load model ${n} from ${l}: ${p.message}`)))})}load(n,l){this.models[l]||(this.models[l]={});const p=Object.keys(n);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;const _=[];for(const x of p)_.push(this.loadModel(x,n[x]));Promise.allSettled(_).then(x=>{for(let T=0;T<x.length;T++){const{status:C,value:D}=x[T];C==="fulfilled"&&D&&(this.models[l][p[T]]={model:D,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new o.x("data",{dataType:"style"}))}).catch(x=>{this.fire(new o.t(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l){return!!this.getModel(n,l)}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}addModel(n,l,p){this.models[p]||(this.models[p]={}),this.hasModel(n,p)&&this.models[p][n].numReferences++,this.load({[n]:this.requestManager.normalizeModelURL(l)},p)}addModels(n,l){this.models[l]||(this.models[l]={});const p={};for(const _ in n)this.models[l][_]={},p[_]=this.requestManager.normalizeModelURL(n[_]);this.load(p,l)}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={});const p={};for(const _ of n)this.hasModel(_,l)?this.models[l][_].numReferences++:p[_]=this.requestManager.normalizeModelURL(_);this.load(p,l)}removeModel(n,l){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0)){const p=this.models[l][n].model;delete this.models[l][n],p.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(n.context)}}const Fp=new o.a0({data:new o.a1(o._.colorTheme.data)}),yo=(d,n)=>$e(d,n&&n.filter(l=>l.identifier!=="source.canvas")),Kh=o.ar(Br,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),ic=o.ar(Br,["setCenter","setZoom","setBearing","setPitch"]),p_={version:8,layers:[],sources:{}},m_={duration:300,delay:0};class _o extends o.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=o.l({},m_),this._buildingIndex=new Ip(this),this.crossTileSymbolIndex=new Gh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new Hr,this.dispatcher=l.dispatcher?l.dispatcher:new o.cd(o.ce(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new wn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.cf(n._requestManager,l.localFontFamily?o.cg.all:l.localIdeographFontFamily?o.cg.ideographs:o.cg.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Ha(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.ch());const p=this;this._rtlTextPluginCallback=_o.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,T)=>{if(o.ci(x),T&&T.every(C=>C))for(const C in p._sourceCaches){const D=p._sourceCaches[C],z=D.getSource().type;z!=="vector"&&z!=="geojson"||D.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getOwnSource(_.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.f(n))return n;const l=o.cj(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.ck(JSON.stringify(n))}`}_diffStyle(n,l,p){this.globalId=this._getGlobalId(n);const _=(x,T)=>{try{T(null,this.setState(x,p))}catch(C){T(C,!1)}};if(typeof n=="string"){const x=this.map._requestManager.normalizeStyleURL(n),T=this.map._requestManager.transformRequest(x,o.R.Style);o.n(T,(C,D)=>{C?this.fire(new o.t(C)):D&&_(D,l)})}else typeof n=="object"&&_(n,l)}loadURL(n,l={}){this.fire(new o.x("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const _=this.importsCache.get(n);if(_)return this._load(_,p);const x=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.n(x,(T,C)=>{if(this._request=null,T)this.fire(new o.t(T));else if(C)return this.importsCache.set(n,C),this._load(C,p)})}loadJSON(n,l={}){this.fire(new o.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.q.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new o.x("dataloading",{dataType:"style"})),this._load(p_,!1)}_loadImports(n,l,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const x of n){const T=this._createFragmentStyle(x),C=new Promise(B=>{T.once("style.import.load",B),T.once("error",B)}).then(()=>this.mergeAll());if(_.push(C),this.resolvedImports.has(x.url)){T.loadEmpty();continue}const D=x.data||this.importsCache.get(x.url);D?(T.loadJSON(D,{validate:l}),this._isInternalStyle(D)&&(T.globalId=null)):x.url?T.loadURL(x.url,{validate:l}):T.loadEmpty();const z={style:T,id:x.id,config:x.config};if(p){const B=this.fragments.findIndex(({id:U})=>U===p);this.fragments=this.fragments.slice(0,B).concat(z).concat(this.fragments.slice(B))}else this.fragments.push(z)}return Promise.allSettled(_)}getImportGlobalIds(n=this,l=new Set){for(const p of n.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?o.av(n.id,this.scope):n.id;let p;const _=this._initialConfig&&this._initialConfig[l];(n.config||_)&&(p=o.l({},n.config,_));const x=new _o(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){const p=n.schema;if(this._isInternalStyle(n)){const T=o.l({},p_,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(T,l)}if(this.updateConfig(this._config,p),l&&yo(this,po(n)))return;this._loaded=!0,this.stylesheet=o.cl(n);const _=()=>{for(const z in n.sources)this.addSource(z,n.sources[z],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);const T=Cp(this.stylesheet.layers);if(this._order=T.map(z=>z.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new qe(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new qe(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const z of T){const B=o.cq(z,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();const U=this.getOwnLayerSourceCache(B),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&B.canCastShadows()&&V&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.x("data",{dataType:"style"}));const D=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then(()=>{this._reloadImports(),this.fire(new o.x(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.x(D?"style.load":"style.import.load")))},x=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=x,x){const T=this._evaluateColorThemeData(x);this._loadColorTheme(T).then(()=>{_()}).catch(C=>{o.w(`Couldn't load color theme from the stylesheet: ${C}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,l,p,_,x,T,C,D;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(n=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(l=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);_=this._prioritizeTerrain(_,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(x=B.fog),B.stylesheet.camera!=null&&(D=B.stylesheet.camera),B.stylesheet.projection!=null&&(T=B.stylesheet.projection),B.stylesheet.transition!=null&&(C=B.stylesheet.transition),z[B.scope]=B._styleColorTheme}}),this.light=n,this.ambientLight=l,this.directionalLight=p,this.fog=x,this._styleColorThemeForScope=z,_===null?delete this.terrain:this.terrain=_,this.camera=D||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=o.l({},m_,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const l=p=>{for(const _ of p.fragments)l(_.style);n(p)};l(this)}_prioritizeTerrain(n,l,p){const _=n&&n.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:_?n:null:l!=null&&(!n||_||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},p={};this.forEachFragmentStyle(_=>{for(const x in _._sourceCaches){const T=o.av(x,_.scope);n[T]=_._sourceCaches[x]}for(const x in _._otherSourceCaches){const T=o.av(x,_.scope);l[T]=_._otherSourceCaches[x]}for(const x in _._symbolSourceCaches){const T=o.av(x,_.scope);p[T]=_._symbolSourceCaches[x]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const C=x._layers[T];if(C.type==="slot"){const D=o.cm(T);if(n[D])continue;n[D]=[]}C.slot&&n[C.slot]?n[C.slot].push(C):l.push(C)}}),this._mergedOrder=[];const _=(x=[])=>{for(const T of x)if(T.type==="slot"){const C=o.cm(T.id);n[C]&&_(n[C]),this._mergedSlots.push(C)}else{const C=o.av(T.id,T.scope);this._mergedOrder.push(C),p[C]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};_(l),this._mergedOrder.sort((x,T)=>{const C=p[x],D=p[T];return C.hasInitialOcclusionOpacityProperties?D.is3D()?1:0:C.is3D()&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=o.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(l,p,_){const x=o.l({},p);for(const C of Object.keys(o._.colorTheme))x[C]===void 0&&(x[C]=o._.colorTheme[C].default);const T=new o.$(Fp,l,new Map(_));return T.setTransitionOrValue(x,_),T.untransitioned().possiblyEvaluate(new o.a3(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,_)=>{const x="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=n;T.startsWith(x)||(T=x+T);const C="mapbox-reserved-lut",D=new Image;D.src=T,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:B,data:U}=o.q.getImageData(D);if(B>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==B*B)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new o.r({width:z,height:B},U),pixelRatio:1,sdf:!1,version:0});const V=this.imageManager.getImage(C,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:n},p()):_(new Error("Missing LUT image."))}})}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(l,p,_){let x,T,C;const D=o.q.devicePixelRatio>1?"@2x":"";let z=o.n(p.transformRequest(p.normalizeSpriteURL(l,D,".json"),o.R.SpriteJSON),(V,q)=>{z=null,C||(C=V,x=q,U())}),B=o.o(p.transformRequest(p.normalizeSpriteURL(l,D,".png"),o.R.SpriteImage),(V,q)=>{B=null,C||(C=V,T=q,U())});function U(){if(C)_(C);else if(x&&T){const V=o.q.getImageData(T),q={};for(const K in x){const{width:Q,height:ee,x:re,y:me,sdf:ye,pixelRatio:de,stretchX:xe,stretchY:ve,content:Pe}=x[K],Se=new o.r({width:Q,height:ee});o.r.copy(V,Se,{x:re,y:me},{x:0,y:0},{width:Q,height:ee},null),q[K]={data:Se,pixelRatio:de,sdf:ye,stretchX:xe,stretchY:ve,content:Pe}}_(null,q)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(n,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.t(l));else if(p)for(const _ in p)this.imageManager.addImage(_,this.scope,p[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.x("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const p=n.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.t(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,l)=>{const p=this.fragments[l];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const l=[];for(const p of n){const _=this._layers[p];_&&_.type!=="custom"&&l.push(_.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new o.t(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new o.t(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,l){const p=this.map.painter;if(p)for(let _=n.minzoom||0;_<(n.maxzoom||25.5);_++){const x=n.getProgramIds();if(x)for(const T of x){const C=n.getDefaultProgramParams(T,l.zoom,this._styleColorTheme.lut);C&&(p.style=this,this.fog&&(p._fogVisible=!0,C.overrideFog=!0,p.getOrCreateProgram(T,C)),p._fogVisible=!1,C.overrideFog=!1,p.getOrCreateProgram(T,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,p.getOrCreateProgram(T,C)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const p=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const C in T){const{updatedIds:D,removedIds:z}=T[C];(D||z)&&(this._updateWorkerLayers(C,D,z),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}const x={};for(const T in this._mergedSourceCaches){const C=this._mergedSourceCaches[T];x[T]=C.used,C.used=!1,C.tileCoverLift=0}for(const T of this._mergedOrder){const C=this._mergedLayers[T];if(C.recalculate(n,this._availableImages),!C.isHidden(n.zoom)){const D=this.getLayerSourceCache(C);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,n)}):this.precompilePrograms(C,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const T in x){const C=this._mergedSourceCaches[T];x[T]!==C.used&&C.getSource().fire(new o.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new o.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=this._changes.getUpdatedImages();if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,l,p){const _=this.getFragmentStyle(n);_&&this.dispatcher.broadcast("updateLayers",{layers:l?_._serializeLayers(l):[],scope:n,removedIds:p||[],options:_.options})}setState(n,l){if(this._checkLoaded(),yo(this,po(n)))return!1;(n=o.cl(n)).layers=Cp(n.layers);const p=function(T,C){if(!T)return[{command:Br.setStyle,args:[C]}];let D=[];try{if(!o.bh(T.version,C.version))return[{command:Br.setStyle,args:[C]}];if(o.bh(T.center,C.center)||D.push({command:Br.setCenter,args:[C.center]}),o.bh(T.zoom,C.zoom)||D.push({command:Br.setZoom,args:[C.zoom]}),o.bh(T.bearing,C.bearing)||D.push({command:Br.setBearing,args:[C.bearing]}),o.bh(T.pitch,C.pitch)||D.push({command:Br.setPitch,args:[C.pitch]}),o.bh(T.sprite,C.sprite)||D.push({command:Br.setSprite,args:[C.sprite]}),o.bh(T.glyphs,C.glyphs)||D.push({command:Br.setGlyphs,args:[C.glyphs]}),o.bh(T.imports,C.imports)||function(q=[],K=[],Q){K=K||[];const ee=(q=q||[]).map(Qs),re=K.map(Qs),me=q.reduce(Wl,{}),ye=K.reduce(Wl,{}),de=ee.slice();let xe,ve,Pe,Se;for(xe=0,ve=0;xe<ee.length;xe++)Pe=ee[xe],ye.hasOwnProperty(Pe)?ve++:(Q.push({command:Br.removeImport,args:[Pe]}),de.splice(de.indexOf(Pe,ve),1));for(xe=0,ve=0;xe<re.length;xe++)Pe=re[re.length-1-xe],de[de.length-1-xe]!==Pe&&(me.hasOwnProperty(Pe)?(Q.push({command:Br.removeImport,args:[Pe]}),de.splice(de.lastIndexOf(Pe,de.length-ve),1)):ve++,Se=de[de.length-xe],Q.push({command:Br.addImport,args:[ye[Pe],Se]}),de.splice(de.length-xe,0,Pe));for(const Ce of K){const Be=me[Ce.id];Be&&!o.bh(Be,Ce)&&Q.push({command:Br.updateImport,args:[Ce.id,Ce]})}}(T.imports,C.imports,D),o.bh(T.transition,C.transition)||D.push({command:Br.setTransition,args:[C.transition]}),o.bh(T.light,C.light)||D.push({command:Br.setLight,args:[C.light]}),o.bh(T.fog,C.fog)||D.push({command:Br.setFog,args:[C.fog]}),o.bh(T.projection,C.projection)||D.push({command:Br.setProjection,args:[C.projection]}),o.bh(T.lights,C.lights)||D.push({command:Br.setLights,args:[C.lights]}),o.bh(T.camera,C.camera)||D.push({command:Br.setCamera,args:[C.camera]}),!o.bh(T["color-theme"],C["color-theme"]))return[{command:Br.setStyle,args:[C]}];const z={},B=[];(function(q,K,Q,ee){let re;for(re in K=K||{},q=q||{})q.hasOwnProperty(re)&&(K.hasOwnProperty(re)||Vr(re,Q,ee));for(re in K){if(!K.hasOwnProperty(re))continue;const me=K[re];q.hasOwnProperty(re)?o.bh(q[re],me)||(q[re].type==="geojson"&&me.type==="geojson"&&nr(q,K,re)?Q.push({command:Br.setGeoJSONSourceData,args:[re,me.data]}):mb(re,K,Q,ee)):Op(re,K,Q)}})(T.sources,C.sources,B,z);const U=[];T.layers&&T.layers.forEach(q=>{q.source&&z[q.source]?D.push({command:Br.removeLayer,args:[q.id]}):U.push(q)});let V=T.terrain;V&&z[V.source]&&(D.push({command:Br.setTerrain,args:[void 0]}),V=void 0),D=D.concat(B),o.bh(V,C.terrain)||D.push({command:Br.setTerrain,args:[C.terrain]}),function(q,K,Q){K=K||[];const ee=(q=q||[]).map(Qs),re=K.map(Qs),me=q.reduce(Wl,{}),ye=K.reduce(Wl,{}),de=ee.slice(),xe=Object.create(null);let ve,Pe,Se,Ce,Be,Le,ke;for(ve=0,Pe=0;ve<ee.length;ve++)Se=ee[ve],ye.hasOwnProperty(Se)?Pe++:(Q.push({command:Br.removeLayer,args:[Se]}),de.splice(de.indexOf(Se,Pe),1));for(ve=0,Pe=0;ve<re.length;ve++)Se=re[re.length-1-ve],de[de.length-1-ve]!==Se&&(me.hasOwnProperty(Se)?(Q.push({command:Br.removeLayer,args:[Se]}),de.splice(de.lastIndexOf(Se,de.length-Pe),1)):Pe++,Le=de[de.length-ve],Q.push({command:Br.addLayer,args:[ye[Se],Le]}),de.splice(de.length-ve,0,Se),xe[Se]=!0);for(ve=0;ve<re.length;ve++)if(Se=re[ve],Ce=me[Se],Be=ye[Se],!xe[Se]&&!o.bh(Ce,Be))if(o.bh(Ce.source,Be.source)&&o.bh(Ce["source-layer"],Be["source-layer"])&&o.bh(Ce.type,Be.type)){for(ke in vu(Ce.layout,Be.layout,Q,Se,null,Br.setLayoutProperty),vu(Ce.paint,Be.paint,Q,Se,null,Br.setPaintProperty),o.bh(Ce.slot,Be.slot)||Q.push({command:Br.setSlot,args:[Se,Be.slot]}),o.bh(Ce.filter,Be.filter)||Q.push({command:Br.setFilter,args:[Se,Be.filter]}),o.bh(Ce.minzoom,Be.minzoom)&&o.bh(Ce.maxzoom,Be.maxzoom)||Q.push({command:Br.setLayerZoomRange,args:[Se,Be.minzoom,Be.maxzoom]}),Ce)Ce.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?vu(Ce[ke],Be[ke],Q,Se,ke.slice(6),Br.setPaintProperty):o.bh(Ce[ke],Be[ke])||Q.push({command:Br.setLayerProperty,args:[Se,ke,Be[ke]]}));for(ke in Be)Be.hasOwnProperty(ke)&&!Ce.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?vu(Ce[ke],Be[ke],Q,Se,ke.slice(6),Br.setPaintProperty):o.bh(Ce[ke],Be[ke])||Q.push({command:Br.setLayerProperty,args:[Se,ke,Be[ke]]}))}else Q.push({command:Br.removeLayer,args:[Se]}),Le=de[de.lastIndexOf(Se)+1],Q.push({command:Br.addLayer,args:[Be,Le]})}(U,C.layers,D)}catch(z){console.warn("Unable to compute style diff:",z),D=[{command:Br.setStyle,args:[C]}]}return D}(this.serialize(),n).filter(T=>!(T.command in ic));if(p.length===0)return!1;const _=p.filter(T=>!(T.command in Kh));if(_.length>0)throw new Error(`Unimplemented: ${_.map(T=>T.command).join(", ")}.`);const x=[];return p.forEach(T=>{x.push(this[T.command].apply(this,T.args))}),l&&Promise.all(x).then(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,l){return this.getImage(n)?this.fire(new o.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,l),this._afterImageUpdated(n),this)}updateImage(n,l){this.imageManager.updateImage(n,this.scope,l)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new o.t(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,l,p={}){return this._checkLoaded(),this._validate(De,`models.${n}`,l,null,p)||(this.modelManager.addModel(n,l,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new o.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Ks,`sources.${n}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Ul(n,l,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const x=T=>{const C=(T?"symbol:":"other:")+_.id,D=o.av(C,this.scope),z=this._sourceCaches[C]=new eo(D,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=z,z.onAdd(this.map)};x(!1),l.type!=="vector"&&l.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new o.t(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.t(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(n);for(const _ of p){const x=o.cm(_.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(_.id),_.fire(new o.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const p=this.getOwnSourceCache(l);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const p=n[l]._tiles;for(const _ in p){const x=p[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const _ of n){if(this._validate(jl,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(_),x.updateTransitions(l)}else this.ambientLight=new Kr(_,_r||(_r=new o.a0({color:new o.a1(o._.properties_light_ambient.color),intensity:new o.a1(o._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(_),x.updateTransitions(l)}else this.directionalLight=new Kr(_,Zr||(Zr=new o.a0({direction:new o.ad(o._.properties_light_directional.direction),color:new o.a1(o._.properties_light_directional.color),intensity:new o.a1(o._.properties_light_directional.intensity),"cast-shadows":new o.a1(o._.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.a1(o._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new o.a3(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),_=n.properties.get("color").toRenderColor(null).toArray01(),x=n.properties.get("intensity"),T=n.properties.get("direction"),C=1-o.c7(T.x,T.y,T.z)[2]/90,D=p(_)*x*C,z=l.properties.get("color").toRenderColor(null).toArray01(),B=l.properties.get("intensity");return(D+p(z)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(o.cn(n)){const l=o.co(n),p=this.fragments.find(({id:x})=>x===l);if(!p)throw new Error(`Style import not found: ${n}`);const _=o.cm(n);return p.style.getFragmentStyle(_)}{const l=this.fragments.find(({id:p})=>p===n);if(!l)throw new Error(`Style import not found: ${n}`);return l.style}}getConfigProperty(n,l){const p=this.getFragmentStyle(n);if(!p)return null;const _=o.av(l,p.scope),x=p.options.get(_),T=x?x.value||x.default:null;return T?T.serialize():null}setConfigProperty(n,l,p){const _=this.getFragmentStyle(n);if(!_)return;const x=_.stylesheet.schema;if(!x||!x[l])return;const T=o.M(p);if(T.result!=="success")return void yo(this,T.value);const C=T.value.expression,D=o.av(l,_.scope),z=_.options.get(D);if(!z)return;let B;const{minValue:U,maxValue:V,stepValue:q,type:K,values:Q}=x[l],ee=o.M(x[l].default);ee.result==="success"&&(B=ee.value.expression),B?(this.options.set(D,{...z,value:C,default:B,minValue:U,maxValue:V,stepValue:q,type:K,values:Q}),this.updateConfigDependencies(l)):this.fire(new o.t(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const p=l.stylesheet.schema;if(!p)return null;const _={};for(const x in p){const T=o.av(x,l.scope),C=l.options.get(T),D=C?C.value||C.default:null;_[x]=D?D.serialize():null}return _}setConfig(n,l){const p=this.getFragmentStyle(n);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const p in l){let _,x;const T=o.M(l[p].default);if(T.result==="success"&&(_=T.value.expression),n&&n[p]!==void 0){const V=o.M(n[p]);V.result==="success"&&(x=V.value.expression)}const{minValue:C,maxValue:D,stepValue:z,type:B,values:U}=l[p];if(_){const V=o.av(p,this.scope);this.options.set(V,{default:_,value:x,minValue:C,maxValue:D,stepValue:z,type:B,values:U})}else this.fire(new o.t(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const l of this._configDependentLayers){const p=this.getLayer(l);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(l=>{if(l._styleColorTheme.colorTheme){const p=l._evaluateColorThemeData(l._styleColorTheme.colorTheme);(!l._styleColorTheme.lut&&p!==""||l._styleColorTheme.lut&&p!==l._styleColorTheme.lut.data)&&l.setColorTheme(l._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(n,l,p={}){this._checkLoaded();const _=n.id;if(this._layers[_])return void this.fire(new o.t(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(n.type==="custom"){if(yo(this,o.cp(n)))return;x=o.cq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=o.cl(n),n=o.l(n,{source:_})),this._validate(Je,`layers.${_}`,n,{arrayIndex:-1},p))return;x=o.cq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let T=this._order.length;if(l){const B=this._order.indexOf(l);if(B===-1)return void this.fire(new o.t(new Error(`Layer with id "${l}" does not exist on this map.`)));x.slot===this._layers[l].slot?T=B:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const C=this.getOwnLayerSourceCache(x),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&x.canCastShadows()&&D&&(C.castsShadows=!0);const z=this._changes.getRemovedLayer(x);if(z&&x.source&&C&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const B=o.av(x.source,x.scope);z.type!==x.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===l)return;const _=this._order.indexOf(n);this._order.splice(_,1);let x=this._order.length;if(l){const T=this._order.indexOf(l);if(T===-1)return void this.fire(new o.t(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?x=T:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const _=this.getOwnLayerSourceCache(l);if(_&&_.castsShadows){let x=!1;for(const T in this._layers)if(this._layers[T].source===l.source&&this._layers[T].canCastShadows()){x=!0;break}_.castsShadows=x}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,p){this._checkLoaded();const _=this._checkLayer(n);_&&(_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(n,l,p={}){this._checkLoaded();const _=this._checkLayer(n);if(_&&!o.bh(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(ne,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=o.cl(l),this._updateLayer(_)))}getFilter(n){const l=this._checkLayer(n);if(l)return o.cl(l.filter)}setLayoutProperty(n,l,p,_={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!o.bh(x.getLayoutProperty(l),p)){if(p!=null&&(!_||_.validate!==!1)&&yo(x,we.call(po,{key:`layers.${n}.layout.${l}`,layerType:x.type,objectKey:l,value:p,styleSpec:o._,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(l,p),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,l){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(l)}setPaintProperty(n,l,p,_={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||o.bh(x.getPaintProperty(l),p)||p!=null&&(!_||_.validate!==!1)&&yo(x,he.call(po,{key:`layers.${n}.paint.${l}`,layerType:x.type,objectKey:l,value:p,styleSpec:o._})))return;const T=x.setPaintProperty(l,p);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,l){const p=this._checkLayer(n);if(p)return p.getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const p=n.source,_=n.sourceLayer,x=this._checkSource(p);if(!x)return;const T=x.type;if(T==="geojson"&&_)return void this.fire(new o.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(p);for(const D of C)D.setFeatureState(_,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const p=n.source,_=this._checkSource(p);if(!_)return;const x=_.type,T=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.t(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(p);for(const D of C)D.removeFeatureState(T,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,p=n.sourceLayer,_=this._checkSource(l);if(_){if(_.type!=="vector"||p)return n.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,n.id);this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=o.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),p=o.av(n.source,n.scope),_=this._changes.getUpdatedSourceCaches();n.source&&!_[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=C=>this._mergedLayers[C].is3D(),p=this.order,_={},x=[];for(let C=p.length-1;C>=0;C--){const D=p[C];if(l(D)){_[D]=C;for(const z of n){const B=z[D];if(B)for(const U of B)x.push(U)}}}x.sort((C,D)=>D.intersectionZ-C.intersectionZ);const T=[];for(let C=p.length-1;C>=0;C--){const D=p[C];if(l(D))for(let z=x.length-1;z>=0;z--){const B=x[z].feature;if(B.layer&&_[B.layer.id]<C)break;T.push(B),x.pop()}else for(const z of n){const B=z[D];if(B)for(const U of B)T.push(U.feature)}}return T}queryRenderedFeatures(n,l,p){l&&l.filter&&this._validate(ne,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.t(new Error("parameters.layers must be an Array."))),[];for(const z of l.layers){const B=this._mergedLayers[z];if(!B)return this.fire(new o.t(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];_[B.source]=!0}}const x=[],T=l.serializedLayers||{},C=l&&l.layers?l.layers.some(z=>{const B=this.getLayer(z);return B&&B.is3D()}):this.has3DLayers(),D=Tn.createFromScreenPoints(n,p);for(const z in this._mergedSourceCaches){const B=this._mergedSourceCaches[z].getSource();if(!B||B.scope!==l.scope)continue;const U=this._mergedSourceCaches[z].getSource().id;l.layers&&!_[U]||x.push(Ep(this._mergedSourceCaches[z],this._mergedLayers,T,D,l,p,C,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(z,B,U,V,q,K,Q){const ee={},re=K.queryRenderedSymbols(V),me=[];for(const ye of Object.keys(re).map(Number))me.push(Q[ye]);me.sort(Vl);for(const ye of me){const de=ye.featureIndex.lookupSymbolFeatures(re[ye.bucketInstanceId],B,ye.bucketIndex,ye.sourceLayerIndex,q.filter,q.layers,q.availableImages,z);for(const xe in de){const ve=ee[xe]=ee[xe]||[],Pe=de[xe];Pe.sort((Se,Ce)=>{const Be=ye.featureSortOrder;if(Be){const Le=Be.indexOf(Se.featureIndex);return Be.indexOf(Ce.featureIndex)-Le}return Ce.featureIndex-Se.featureIndex});for(const Se of Pe)ve.push(Se)}}for(const ye in ee)ee[ye].forEach(de=>{const xe=de.feature,ve=U(z[ye]);if(!ve)return;const Pe=ve.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=Pe});return ee}(this._mergedLayers,T,this.getLayerSourceCache.bind(this),D.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,l){l&&l.filter&&this._validate(ne,"querySourceFeatures.filter",l.filter,null,l);const p=this.getOwnSourceCaches(n);let _=[];for(const x of p)_=_.concat(gu(x,l));return _}addSourceType(n,l,p){return _o.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(_o.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,p={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const C in n)if(!o.bh(n[C],_[C])){x=!0;break}if(!x)return;const T=this._getTransitionParameters();this.light.setLight(n,l,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const _=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const C="terrain-dem-src";this.addSource(C,p.source),p=o.cl(p),p=o.l(p,{source:C})}const x=o.l({},p),T={};if(this.terrain&&_){x.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(T.style=C.serialize())}if(this._validate(pu,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new o.x("data",{dataType:"style"}))}else{const x=this.terrain,T=x.get();for(const C of Object.keys(o._.terrain))!p.hasOwnProperty(C)&&o._.terrain[C].default&&(p[C]=o._.terrain[C].default);for(const C in n)if(!o.bh(n[C],T[C])){x.set(n,this.options),this.stylesheet.terrain=n;const D=this._getTransitionParameters({duration:0});x.updateTransitions(D),this.fire(new o.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Ur(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.bh(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}setColorTheme(n){this._checkLoaded();const l=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()};if(this._styleColorTheme.colorTheme=n,!n)return this._styleColorTheme.lut=null,void l();const p=this._evaluateColorThemeData(n);this._loadColorTheme(p).then(()=>{this.fire(new o.x("colorthemeset")),l()}).catch(_=>{o.w(`Couldn't set color theme: ${_}`)})}_getTransitionParameters(n){return{now:o.q.now(),transition:o.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const p=this.terrain=new at(n,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,p,_,x={}){if(x&&x.validate===!1)return!1;const T=o.l({},this.serialize());return yo(this,n.call(po,o.l({key:l,style:T,value:p,styleSpec:o._},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const p of l)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const l=this.getSourceCaches(n);for(const p of l)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}updateSources(n){let l;this.directionalLight&&(l=Zh(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(n,void 0,void 0,l)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,p,_,x,T,C=!1){let D=!1,z=!1;const B={},U={};for(const V of this._mergedOrder){const q=this._mergedLayers[V];if(q.type!=="symbol")continue;const K=o.av(q.source,q.scope);let Q=B[K];if(!Q){const re=this.getLayerSourceCache(q);if(!re)continue;const me=re.getRenderableIds(!0).map(ye=>re.getTileByID(ye));U[K]=me.slice(),Q=B[K]=me.sort((ye,de)=>de.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(de.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(q,Q,l.center.lng,l.projection);D=D||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new o.x("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),l.zoom))&&(this.pauseablePlacement=new xu(l,this._mergedOrder,C,p,_,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),z=!0),D&&this.pauseablePlacement.placement.setStale()),z||D){this._buildingIndex.onNewFrame(l.zoom);for(let V=0;V<this._mergedOrder.length;V++){const q=this._mergedLayers[this._mergedOrder[V]];if(q.type!=="symbol")continue;const K=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,B[o.av(q.source,q.scope)],V,K?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:x})=>x===n.id)!==-1)return void this.fire(new o.t(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return p.push(n),this._loadImports([n],!0);const _=p.findIndex(({id:x})=>x===l);return _===-1&&this.fire(new o.t(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(n).concat(p.slice(_)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(n);return _===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==p[_].url&&this.setImportUrl(n,l.url),o.bh(l.config,p[_].config)||this.setImportConfig(n,l.config),o.bh(l.data,p[_].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let p=this.stylesheet.imports||[];const _=this.getImportIndex(n);if(_===-1)return this;const x=this.getImportIndex(l);if(x===-1)return this;const T=p[_],C=this.fragments[_];return p=p.filter(({id:D})=>D!==n),this.fragments=this.fragments.filter(({id:D})=>D!==n),this.stylesheet.imports=p.slice(0,x).concat(T).concat(p.slice(x)),this.fragments=this.fragments.slice(0,x).concat(C).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const p=this.stylesheet.imports||[],_=this.getImportIndex(n);if(_===-1)return this;p[_].url=l;const x=this.fragments[_];return x.style=this._createFragmentStyle(p[_]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const p=this.getImportIndex(n),_=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(n,_[p].url))}setImportConfig(n,l){this._checkLoaded();const p=this.getImportIndex(n),_=this.stylesheet.imports||[];if(p===-1)return this;l?_[p].config=l:delete _[p].config;const x=this.fragments[p],T=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=l,x.style.updateConfig(l,T),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return l===-1&&this.fire(new o.t(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[l];p&&n.push(p.getSource())}return n}getSource(n,l){const p=this.getSourceCache(n,l);return p&&p.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const p=o.av(n,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const l=o.av(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const p=n[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const p of l){const _=this.getLayer(p);_&&_.updateTransitions(n)}}getImages(n,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(n,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(n,l,p){return o.ct(l,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new o.t(new Error(`There is no source with ID '${n}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const p=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D()){if(p||l&&l.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_o.getSourceType=function(d){return Bh[d]},_o.setSourceType=function(d,n){Bh[d]=n},_o.registerForPluginStateChange=o.cc;var g_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Np=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,jp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Jh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",y_=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,__=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,v_=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,x_=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,$p=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,b_=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wu=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qh=[];Ts(g_,Qh),Ts(jp,Qh),Ts(Np,Qh);const Tu={"_prelude_fog.vertex.glsl":__,"_prelude_terrain.vertex.glsl":y_,"_prelude_shadow.vertex.glsl":b_,"_prelude_fog.fragment.glsl":v_,"_prelude_shadow.fragment.glsl":wu,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":x_,"_prelude_raster_particle.glsl":$p},oc={};kr("",y_),kr(v_,__),kr(wu,b_),kr(x_,""),kr($p,"");const Su=kr(Np,jp),ef=g_;var ws={background:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:kr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:kr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:kr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:kr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:kr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:kr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:kr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:kr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:kr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:kr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jh),skyboxGradient:kr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jh),skyboxCapture:kr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:kr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:kr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:kr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ts(d,n){const l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const x of _)n.includes(x)||n.push(x)}}function kr(d,n){const l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(z=>{const B=z.split(" ");return B[B.length-1]}),_=[...new Set(_)]);const x={},T=[],C=[];if(d=d.replace(l,(z,B)=>(C.push(B),"")),(n=n.replace(l,(z,B)=>(T.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Qh];Ts(d,D),Ts(n,D);for(const z of[...T,...C])Tu[z]||console.error(`Undefined include: ${z}`),oc[z]||(oc[z]=[],Ts(Tu[z],oc[z])),D=[...D,...oc[z]];return{fragmentSource:d=d.replace(p,(z,B,U,V,q)=>(x[q]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${U} ${V} ${q};
#else
uniform ${U} ${V} u_${q};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${U} ${V} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${U} ${V} ${q};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(z,B,U,V,q)=>{const K=V==="float"?"vec2":V,Q=q.match(/color/)?"color":K;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${U} ${V} a_${q};
#endif
`:x[q]?B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${U} ${K} a_${q};
out ${U} ${V} ${q};
#else
uniform ${U} ${V} u_${q};
#endif
`:B==="initialize"?Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${U} ${V} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${U} ${V} ${q} = u_${q};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${U} ${V} a_${q};
    out ${U} ${V} ${q};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${U} ${K} a_${q};
#else
uniform ${U} ${V} u_${q};
#endif
`:B==="define-instanced"?Q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${U} ${V} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${K} a_${q};
#else
uniform ${U} ${V} u_${q};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${U} ${V} ${q} = a_${q};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${U} ${V} ${q} = a_${q};
#else
    ${U} ${V} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${U} ${V} ${q} = unpack_mix_${Q}(a_${q}, u_${q}_t);
#else
    ${U} ${V} ${q} = u_${q};
#endif
`}),staticAttributes:_,usedDefines:D,vertexIncludes:T,fragmentIncludes:C}}class ac{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,p,_,x,T,C,D){this.context=n;let z=this.boundPaintVertexBuffers.length!==_.length;for(let U=0;!z&&U<_.length;U++)this.boundPaintVertexBuffers[U]!==_[U]&&(z=!0);let B=this.boundDynamicVertexBuffers.length!==C.length;for(let U=0;!B&&U<C.length;U++)this.boundDynamicVertexBuffers[U]!==C[U]&&(B=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||z||B||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(l,p,_,x,T,C,D);else{n.bindVertexArrayOES.set(this.vao);for(const U of C)U&&(U.bind(),D&&U.instanceCount&&U.setVertexAttribDivisor(n.gl,l,D));x&&x.dynamicDraw&&x.bind()}}freshBind(n,l,p,_,x,T,C){const D=n.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,l.enableAttributes(B,n),l.bind(),l.setVertexAttribPointers(B,n,x);for(const U of p)U.enableAttributes(B,n),U.bind(),U.setVertexAttribPointers(B,n,x);for(const U of T)U&&(U.enableAttributes(B,n),U.bind(),U.setVertexAttribPointers(B,n,x),C&&U.instanceCount&&U.setVertexAttribDivisor(B,n,C));_&&_.bind(),z.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Au(d,n){const l=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new o.a5(0,p/l).toLngLat().lat,new o.a5(0,(p+1)/l).toLngLat().lat]}function tf(d,n,l,p,_,x,T){const C=d.context,D=C.gl,z=l.hillshadeFBO;if(!z)return;d.prepareDrawTile();const B=d.isTileAffectedByFog(n),U=d.getOrCreateProgram("hillshade",{overrideFog:B});C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,z.colorAttachment.get());const V=((ee,re,me,ye)=>{const de=me.paint.get("hillshade-shadow-color"),xe=me.paint.get("hillshade-highlight-color"),ve=me.paint.get("hillshade-accent-color"),Pe=me.paint.get("hillshade-emissive-strength");let Se=o.bB(me.paint.get("hillshade-illumination-direction"));if(me.paint.get("hillshade-illumination-anchor")==="viewport")Se-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const Be=ee.style.directionalLight.properties.get("direction"),Le=o.c7(Be.x,Be.y,Be.z);Se=o.bB(Le[1])}const Ce=!ee.options.moving;return{u_matrix:ye||ee.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:Au(0,re.tileID),u_light:[me.paint.get("hillshade-exaggeration"),Se],u_shadow:de.toRenderColor(me.lut),u_highlight:xe.toRenderColor(me.lut),u_emissive_strength:Pe,u_accent:ve.toRenderColor(me.lut)}})(d,l,p,d.terrain?n.projMatrix:null);d.uploadCommonUniforms(C,U,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:K,tileBoundsSegments:Q}=d.getTileBoundsBuffers(l);U.draw(d,D.TRIANGLES,_,x,T,or.disabled,V,p.id,q,K,Q)}function rf(d,n,l){if(!n.needsDEMTextureUpload)return;const p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(l.stride);const x=l.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new o.T(p,x,_.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Eu(d,n,l){const p=d.context,_=p.gl;if(!n.dem)return;const x=n.dem;if(p.activeTexture.set(_.TEXTURE1),rf(d,n,x),!n.demTexture)return;n.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const T=x.dim;p.activeTexture.set(_.TEXTURE0);let C=n.hillshadeFBO;if(!C){const V=new o.T(p,{width:T,height:T,data:null},_.RGBA8);V.bind(_.LINEAR,_.CLAMP_TO_EDGE),C=n.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),C.colorAttachment.set(V.texture)}p.bindFramebuffer.set(C.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=d.getMercatorTileBoundsBuffers(),U=[];d.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(d,_.TRIANGLES,Qt.disabled,pr.disabled,Mr.unblended,or.disabled,((V,q)=>{const K=q.stride,Q=o.a6.mat4.create();return o.a6.mat4.ortho(Q,0,o.ab,-o.ab,0,0,1),o.a6.mat4.translate(Q,Q,[0,-o.ab,0]),{u_matrix:Q,u_image:1,u_dimension:[K,K],u_zoom:V.overscaledZ}})(n.tileID,x),l.id,D,z,B),n.needsHillshadePrepare=!1}class tn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Up extends tn{getDefault(){return o.bz.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class w_ extends tn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Vp extends tn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class nf extends tn{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Mu extends tn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class T_ extends tn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class S_ extends tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class A_ extends tn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class sc extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class E_ extends tn{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class xb extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class bb extends tn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class wb extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Gp extends tn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class qp extends tn{getDefault(){return o.bz.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wp extends tn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Hp extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class M_ extends tn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class P_ extends tn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Tb=class extends tn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Pu extends tn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Iu extends tn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class I_ extends tn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class vo extends tn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Zp extends tn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class of extends tn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class af extends tn{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Xp extends tn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Yp extends tn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class sf extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Kp extends tn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Cu extends tn{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class lf extends Cu{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Jp extends Cu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class C_ extends Cu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class lc extends Jp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Sb=(d,n,l)=>({u_matrix:d,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),O_=(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:C,u_frustum_br:D,u_frustum_bl:z,u_globe_pos:B,u_globe_radius:U,u_viewport:V,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:K});function k_(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const cc=new class{constructor(){this.operations={}}newMorphing(d,n,l,p,_){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:n,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const l=this.operations[n];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},D_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function L_(d,n,l){if(n===0)return 0;const p=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-d)*Math.max(n,1)*p}function Qp(d,n){const l=1<<d.z;return!n&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const Ou=d=>({u_matrix:d});function cf(d,n,l,p,_){if(_>0){const x=o.q.now(),T=(x-d.timeAdded)/_,C=n?(x-n.timeAdded)/_:-1,D=l.getSource(),z=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),B=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),U=B&&d.refreshedUponExpiration?1:o.ap(B?T:1-C,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class uc extends eo{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new o.cd(o.ce(),null),_=Ul("mock-dem",l,p,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class R_ extends eo{constructor(n){const l=Ul("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new o.cd(o.ce(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,p){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const C=new ma(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);C.state="loaded",this._tiles[T.key]=C}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class em extends o.aA{constructor(n,l,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class tm extends o.cE{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(D){const z=new o.a_,B=new o.aO,U=131;z.reserve(17161),B.reserve(33800);const V=o.ab/128,q=o.ab+V/2,K=q+V;for(let ee=-V;ee<K;ee+=V)for(let re=-V;re<K;re+=V){const me=re<0||re>q||ee<0||ee>q?24575:0,ye=o.ap(Math.round(re),0,o.ab),de=o.ap(Math.round(ee),0,o.ab);z.emplaceBack(ye+me,de)}const Q=(ee,re)=>{const me=re*U+ee;B.emplaceBack(me+1,me,me+U),B.emplaceBack(me+U,me+U+1,me+1)};for(let ee=1;ee<129;ee++)for(let re=1;re<129;re++)Q(re,ee);return[0,129].forEach(ee=>{for(let re=0;re<130;re++)Q(re,ee),Q(ee,re)}),[z,B,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(p,o.b0.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=o.b1.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=o.b1.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new R_(l.map),this.orthoMatrix=o.a6.mat4.create(),o.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.ab,0,o.ab,0,1);const C=T.gl;this._overlapStencilMode=new pr({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new uc(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const _=n.terrain.properties,x=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const C=n.terrain&&n.terrain.scope,D=_.get("source"),z=x?this._mockSourceCache:n.getSourceCache(D,C);if(!z)return void o.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=z,this._exaggeration=T?this.calculateExaggeration(l):_.get("exaggeration"),!l.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(l,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){const l=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const _=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const x=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let C=x-this._previousZoom;const D=this._previousUpdateTimestamp;let z=x;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(x-z)>.5&&(C=.5*(x-z+C)),C*_<0&&(z+=C)),this._evaluationZoom=z;const B=T.getExaggeration(z),U=B===T.getExaggeration(Math.max(0,z-.1));if(U&&Math.abs(B-this._exaggeration)<.01)return B;let V=Math.min(.1,.00375*(this._updateTimestamp-D));return(U||B<.1||Math.abs(C)<1e-4)&&(V=Math.min(.2,4*V)),o.aa(this._exaggeration,B,V)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.a5.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(D=>{const z=l.getTileByID(D).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(D,z){const B=z.transform.pointCoordinate(z.transform.getCameraPoint()),U=new o.P(B.x,B.y);D.sort((V,q)=>{if(q.overscaledZ-V.overscaledZ)return q.overscaledZ-V.overscaledZ;const K=new o.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Q=new o.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ee=U.mult(1<<V.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(K)-ee.distSqr(Q)})})(_,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const D in T){const z=T[D];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[D],x),z.usedForTerrain))continue;const B=n[D];z.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[l.id]=_.map(D=>new em(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const z=this.terrainTileForTile[D.key];if(!z)continue;const B=z.tileID.key;B in C||(this._visibleDemTiles.push(z),C[B]=B)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),rf(this.painter,_,x))}}_prepareDemTileUniforms(n,l,p,_){if(!l||l.demTexture==null)return!1;const x=n.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-x.z),C=_||"";return p[`u_dem_tl${C}`]=[x.x*T%1,x.y*T%1],p[`u_dem_scale${C}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&n++,p+x},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new o.cF({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(n,_,l.R32F,{premultiply:!1}),x}setupElevationDraw(n,l,p){const _=this.painter.context,x=_.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let C=null,D=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,K=p.morphing.dstDemTile;z=p.morphing.phase,q&&K&&(this._prepareDemTileUniforms(n,q,T,"_prev")&&(D=q),this._prepareDemTileUniforms(n,K,T)&&(C=K))}const B=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let U=null;var V;if(this.enabled?D&&C?(U=C.demTexture,_.activeTexture.set(x.TEXTURE4),D.demTexture.bind(B(D),x.CLAMP_TO_EDGE),T.u_dem_lerp=z):(C=this.terrainTileForTile[n.tileID.key],U=this._prepareDemTileUniforms(n,C,T)?C.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,_.activeTexture.set(x.TEXTURE2),U&&(T.u_dem_size=(V=U).size[0]===1?1:V.size[0]-2,U.bind(B(C),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,T),p&&p.useMeterToDem&&C){const q=(1<<C.tileID.canonical.z)*o.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,q)}}globeUniformValues(n,l,p){const _=n.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,o.ab,0),u_tile_br_up:_.upVector(l,o.ab,o.ab),u_tile_bl_up:_.upVector(l,0,o.ab),u_tile_up_scale:p?o.cG(1):_.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,T,C,D){if(_.transform.projection.name==="globe")(function(z,B,U,V,q){const K=z.context,Q=K.gl;let ee,re;const me=z.transform,ye=o.cx(z,K,me),de=(Ve,rt)=>{if(re===rt)return;const ft=[D_[rt],"PROJECTION_GLOBE_VIEW"];ye&&ft.push("CUSTOM_ANTIALIASING");const et=z.isTileAffectedByFog(Ve);ee=z.getOrCreateProgram("globeRaster",{defines:ft,overrideFog:et}),re=rt},xe=z.colorModeForRenderPass(),ve=new Qt(Q.LEQUAL,Qt.ReadWrite,z.depthRangeFor3D);cc.update(q);const Pe=o.cy(me),Se=[o.am(me.center.lng),o.at(me.center.lat)],Ce=z.globeSharedBuffers,Be=[me.width*o.q.devicePixelRatio,me.height*o.q.devicePixelRatio],Le=Float32Array.from(me.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const Ve=z.transform,rt=L_(Ve.zoom,B.exaggeration(),B.sourceCache._source.tileSize);re=-1;const ft=Q.TRIANGLES;for(const et of V){const vt=U.getTile(et),Ge=pr.disabled,lt=B.prevTerrainTileForTile[et.key],ot=B.terrainTileForTile[et.key];k_(lt,ot)&&cc.newMorphing(et.key,lt,ot,q,250),K.activeTexture.set(Q.TEXTURE0),vt.texture&&vt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const bt=cc.getMorphValuesForProxy(et.key),St=bt?1:0;bt&&o.C(ke,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:o.cw(bt.phase)}});const ut=o.cz(et.canonical),pt=o.cA(ut.getCenter().lat),Kt=o.cB(et.canonical,ut,pt,Ve.worldSize/Ve._pixelsPerMercatorPixel),Mt=o.b5(o.cC(et.canonical)),Nt=O_(Ve.expandedFarZProjMatrix,Le,Pe,Mt,o.a9(Ve.zoom),Se,Ve.frustumCorners.TL,Ve.frustumCorners.TR,Ve.frustumCorners.BR,Ve.frustumCorners.BL,Ve.globeCenterInViewSpace,Ve.globeRadius,Be,rt,Ve._farZ,Kt);if(de(et,St),ee&&(B.setupElevationDraw(vt,ee,ke),z.uploadCommonUniforms(K,ee,et.toUnwrapped()),Ce)){const[ir,Gt,er]=Ce.getGridBuffers(pt,rt!==0);ee.draw(z,ft,ve,Ge,xe,or.backCCW,Nt,"globe_raster",ir,Gt,er)}}}if(Ce&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const Ve=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ye&&Ve.push("CUSTOM_ANTIALIASING"),ee=z.getOrCreateProgram("globeRaster",{defines:Ve});for(const rt of V){const{x:ft,y:et,z:vt}=rt.canonical,Ge=et===0,lt=et===(1<<vt)-1,[ot,bt,St,ut]=Ce.getPoleBuffers(vt,!1);if(ut&&(Ge||lt)){const pt=U.getTile(rt);K.activeTexture.set(Q.TEXTURE0),pt.texture&&pt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Kt=o.cD(vt,ft,me);const Mt=o.b5(o.cC(rt.canonical)),Nt=(ir,Gt)=>ir.draw(z,Q.TRIANGLES,ve,pr.disabled,xe,or.disabled,O_(me.expandedFarZProjMatrix,Kt,Kt,Mt,0,Se,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,Be,0,me._farZ),"globe_pole_raster",Gt,St,ut);B.setupElevationDraw(pt,ee,ke),z.uploadCommonUniforms(K,ee,rt.toUnwrapped()),Ge&&z.renderDefaultNorthPole&&Nt(ee,ot),lt&&z.renderDefaultSouthPole&&(Kt=o.a6.mat4.scale(o.a6.mat4.create(),Kt,[1,-1,1]),Nt(ee,bt))}}}})(_,x,T,C,D);else{const z=_.context,B=z.gl;let U,V;const q=_.shadowRenderer,K=Wa(_,_.longestCutoffRange),Q=xe=>{if(V===xe)return;const ve=[];ve.push(D_[xe]),K.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),U=_.getOrCreateProgram("terrainRaster",{defines:ve}),V=xe},ee=_.colorModeForRenderPass(),re=new Qt(B.LEQUAL,Qt.ReadWrite,_.depthRangeFor3D);cc.update(D);const me=_.transform,ye=L_(me.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let de=[0,0,0];if(q){const xe=_.style.directionalLight,ve=_.style.ambientLight;xe&&ve&&(de=Xh(_.style,xe,ve))}{V=-1;const xe=B.TRIANGLES,[ve,Pe]=[x.gridIndexBuffer,x.gridSegments];for(const Se of C){const Ce=T.getTile(Se),Be=pr.disabled,Le=x.prevTerrainTileForTile[Se.key],ke=x.terrainTileForTile[Se.key];k_(Le,ke)&&cc.newMorphing(Se.key,Le,ke,D,250),z.activeTexture.set(B.TEXTURE0),Ce.texture&&Ce.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Ve=cc.getMorphValuesForProxy(Se.key),rt=Ve?1:0;let ft;Ve&&(ft={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:o.cw(Ve.phase)}});const et=Sb(Se.projMatrix,Qp(Se.canonical,me.renderWorldCopies)?ye/10:ye,de);if(Q(rt),!U)continue;x.setupElevationDraw(Ce,U,ft);const vt=Se.toUnwrapped();q&&q.setupShadows(vt,U),_.uploadCommonUniforms(z,U,vt,null,K),U.draw(_,xe,re,Be,ee,or.backCCW,et,"terrain_raster",x.gridBuffer,ve,Pe)}}}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),C=l.style.order,D=[];let z=0;for(const B of x){const U=_.getTileByID(B.proxyTileKey),V=_.proxyCachedFBO[B.key]?_.proxyCachedFBO[B.key][n]:void 0,q=V!==void 0?_.renderCache[V]:this.pool[z++],K=V!==void 0;if(U.texture=q.tex,K&&!q.dirty){D.push(U.tileID);continue}let Q;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:o.bz.transparent,stencil:0}),q.dirty=!1);for(let ee=T.start;ee<=T.end;++ee){const re=l.style._mergedLayers[C[ee]];if(re.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(re),ye=me?this.proxyToSource[B.key][me.id]:[B];if(!ye)continue;const de=ye;p.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(me?me.id:null)&&(this._setupStencil(q,ye,re,me),Q=me?me.id:null),l.renderLayer(l,me,re,de)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const re=l.style._mergedLayers[C[ee]];if(re.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(re),ye=me?this.proxyToSource[B.key][me.id]:[B];if(!ye)continue;const de=ye;p.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(me?me.id:null)&&(this._setupStencil(q,ye,re,me),Q=me?me.id:null),l.renderLayer(l,me,re,de)}this.renderedToTile?(q.dirty=!0,D.push(U.tileID)):K||--z,z===5&&(z=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let p=-1,_=l;for(let x=0;x<l;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?p=Math.max(p,x):_=Math.min(_,x);return _>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,C=1<<T.overscaledZ,{x:D,y:z}=T.canonical,B=D/C,U=(D+1)/C,V=z/C,q=(z+1)/C;return{minx:B,miny:V,maxx:U,maxy:q,t:x.dem.tree.raycastRoot(B,V,U,q,n,l,p),tile:x}});_.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,l,p);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,l=n.gl,p=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const _=new o.T(n,{width:p[0],height:p[1],data:null},l.RGBA8);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=n.createFramebuffer(p[0],p[1],!0,null);return x.colorAttachment.set(_.texture),x.depthAttachment=new lc(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._mergedLayers[n],p=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof zh){n=!0;break}if(!n)return;const l={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(x&&!l[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof o.a4){l[x.id]=!0;for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][x.id];if(C)for(const D of C)this._clearRenderCacheForTile(x.id,D)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof mu){n=!0;break}if(!n)return;const l={};for(let p=0;p<this._style.order.length;++p){const _=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(_);if(!x||l[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const T=_.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const D=this.proxyToSource[C.key][x.id];if(D)for(const z of D){const B=cf(x.getTile(z),x.findLoadedParent(z,0),x,this.painter.transform,T);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(x.id,z)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const p=[];this._pendingGroundEffectLayers=[];let _,x=0,T=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<l;)T=this._style._mergedLayers[n[x]];for(;x<l;++x){const C=this._style._mergedLayers[n[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=x):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),_!==void 0&&(p.push({start:_,end:x-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:x-1}),p.length!==0){const C=p[p.length-1];this._pendingGroundEffectLayers.every(D=>D>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<T.length;++C){const D=Object.values(T[C]);l.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const C=p[T];if(l.getTileByID(C.key),l.proxyCachedFBO[C.key]!==void 0){const D=n[C.key],z=this.proxyToSource[C.key];let B=0;for(const U in z){const V=z[U],q=D[U];if(!q||q.length!==V.length||V.some((K,Q)=>K!==q[Q]||_[U]&&_[U].hasOwnProperty(K.key))){B=-1;break}++B}for(const U in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][U]].dirty=B<0||B!==Object.values(D).length}}const x=[...this._drapedRenderBatches];x.sort((T,C)=>C.end-C.start-(T.end-T.start));for(const T of x)for(const C of p){if(l.proxyCachedFBO[C.key])continue;let D=l.renderCachePool.pop();D===void 0&&l.renderCache.length<50&&(D=l.renderCache.length,l.renderCache.push(this._createFBO())),D!==void 0&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][T.start]=D,l.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):pr.disabled}_renderTileClippingMasks(n,l){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(Mr.disabled),_.setDepthMode(Qt.disabled);const T=p.getOrCreateProgram("clippingMask");for(const C of n){const D=p._tileClippingMaskIDs[C.key]=--l;T.draw(p,x.TRIANGLES,Qt.disabled,new pr({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),Mr.disabled,or.disabled,Ou(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const p=[n.x,n.y,1,1];o.a6.vec4.transformMat4(p,p,l.pixelMatrixInverse),o.a6.vec4.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,x=o.bD(1,l.center.lat),T=[_[0],_[1],_[2]/x,0],C=o.a6.vec3.subtract([],p.slice(0,3),T);o.a6.vec3.normalize(C,C);const D=this.raycast(T,C,this._exaggeration);return D!==null&&D?(o.a6.vec3.scaleAndAdd(T,T,C,D),T[3]=T[2],T[2]*=x,T):null}_setupProxiedCoordsForOrtho(n,l,p){if(n.getSource()instanceof o.aD)return this._setupProxiedCoordsForImageSource(n,l,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let D=0;D<x.length;D++){const z=x[D],B=this._findTileCoveringTileID(z,n);if(B){const U=this._createProxiedId(z,B,p[z.key]&&p[z.key][n.id]);_.push(U),this.proxyToSource[z.key][n.id]=[U]}}let T=!1;const C=new Set;for(let D=0;D<l.length;D++){const z=n.getTile(l[D]);if(!z||!z.hasData())continue;const B=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==z.tileID.canonical.z){const U=this.proxyToSource[B.tileID.key][n.id],V=this._createProxiedId(B.tileID,z,p[B.tileID.key]&&p[B.tileID.key][n.id]);U?U.splice(U.length-1,0,V):this.proxyToSource[B.tileID.key][n.id]=[V];const q=this.proxyToSource[B.tileID.key][n.id];C.has(q)||C.add(q),_.push(V),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const D of C)D.sort((z,B)=>B.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(n,l,p){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords,T=n.getSource(),C=T.tileID;if(!C)return;const D=new o.P(C.x,C.y)._div(1<<C.z),z=T.coordinates.map(o.a5.fromLngLat).reduce((U,V)=>(U.min.x=Math.min(U.min.x,V.x-D.x),U.min.y=Math.min(U.min.y,V.y-D.y),U.max.x=Math.max(U.max.x,V.x-D.x),U.max.y=Math.max(U.max.y,V.y-D.y),U),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(U,V)=>{const q=U.wrap+U.canonical.x/(1<<U.canonical.z),K=U.canonical.y/(1<<U.canonical.z),Q=o.ab/(1<<U.canonical.z),ee=V.wrap+V.canonical.x/(1<<V.canonical.z),re=V.canonical.y/(1<<V.canonical.z);return q+Q<ee+z.min.x||q>ee+z.max.x||K+Q<re+z.min.y||K>re+z.max.y};for(let U=0;U<x.length;U++){const V=x[U];for(let q=0;q<l.length;q++){const K=n.getTile(l[q]);if(!K||!K.hasData()||B(V,K.tileID))continue;const Q=this._createProxiedId(V,K,p[V.key]&&p[V.key][n.id]),ee=this.proxyToSource[V.key][n.id];ee?ee.push(Q):this.proxyToSource[V.key][n.id]=[Q],_.push(Q)}}}_createProxiedId(n,l,p){let _=this.orthoMatrix;if(p){const x=p.find(T=>T.key===l.tileID.key);if(x)return x}if(l.tileID.key!==n.key){const x=n.canonical.z-l.tileID.canonical.z;let T,C,D;_=o.a6.mat4.create();const z=l.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(T=o.ab>>x,C=T*((l.tileID.canonical.x<<x)-n.canonical.x+z),D=T*((l.tileID.canonical.y<<x)-n.canonical.y)):(T=o.ab<<-x,C=o.ab*(l.tileID.canonical.x-(n.canonical.x+z<<-x)),D=o.ab*(l.tileID.canonical.y-(n.canonical.y<<-x))),o.a6.mat4.ortho(_,0,T,0,T,0,1),o.a6.mat4.translate(_,_,[C,D,0])}return new em(l.tileID,n.key,_)}_findTileCoveringTileID(n,l){let p=l.getTile(n);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],x=_[n.key];if(p=x?l.getTileByID(x):null,p&&p.hasData()||x===null)return p;let T=p?p.tileID:n,C=T.overscaledZ;const D=l.getSource().minzoom,z=[];if(!x){const U=l.getSource().maxzoom;if(n.canonical.z>=U){const V=n.canonical.z-U;l.getSource().reparseOverscaled?(C=Math.max(n.canonical.z+2,l.transform.tileZoom),T=new o.aA(C,n.wrap,U,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(C=U,T=new o.aA(C,n.wrap,U,n.canonical.x>>V,n.canonical.y>>V))}T.key!==n.key&&(z.push(T.key),p=l.getTile(T))}const B=U=>{z.forEach(V=>{_[V]=U}),z.length=0};for(C-=1;C>=D&&(!p||!p.hasData());C--){p&&B(p.tileID.key);const U=T.calculateScaledKey(C);if(p=l.getTileByID(U),p&&p.hasData())break;const V=_[U];if(V===null)break;V===void 0?z.push(U):p=l.getTileByID(V)}return B(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[l.key]=!0}}function rm(d,n,l){const p=function(C,D,z){const B=o.a6.vec3.dot(D,C),U=o.a6.vec3.dot(z,[.2126,.7152,.0722]),V=(K,Q,ee)=>(1-ee)*K+ee*Q,q=V(1-.3*Math.min(U,1),1,Math.min(B+1,1));return V(.92,1,Math.asin(o.ap(D[2],-1,1))/Math.PI+.5)*q}(d,[0,0,1],n),_=[0,0,0];o.a6.vec3.scale(_,l.slice(0,3),p);const x=[0,0,0];o.a6.vec3.scale(x,n.slice(0,3),d[2]);const T=[0,0,0];return o.a6.vec3.add(T,_,x),o.cb(T)}const il=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],z_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ss{static cacheKey(n,l,p,_){let x=`${l}${_?_.cacheKey:""}`;for(const T of p)n.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(n,l,p,_,x,T){const C=n.gl;this.program=C.createProgram(),this.configuration=_,this.name=l,this.fixedDefines=[...T];const D=_?_.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(D);let B=_?_.defines():[];B=B.concat(T.map(ee=>`#define ${ee}`));const U=`#version 300 es
`;let V=U+B.concat("precision mediump float;",ef,Su.fragmentSource).join(`
`);for(const ee of p.fragmentIncludes)V+=`
${Tu[ee]}`;V+=`
${p.fragmentSource}`;let q=U+B.concat("precision highp float;",ef,Su.vertexSource).join(`
`);for(const ee of p.vertexIncludes)q+=`
${Tu[ee]}`;q+=`
${p.vertexSource}`;const K=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(K,V),C.compileShader(K),C.attachShader(this.program,K);const Q=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(Q,q),C.compileShader(Q),C.attachShader(this.program,Q),this.attributes={},this.numAttributes=z.length;for(let ee=0;ee<this.numAttributes;ee++)if(z[ee]){const re=z[ee].startsWith("a_")?z[ee]:`a_${z[ee]}`;C.bindAttribLocation(this.program,ee,re),this.attributes[re]=ee}C.linkProgram(this.program),C.deleteShader(Q),C.deleteShader(K),this.fixedUniforms=x(n),this.binderUniforms=_?_.getUniforms(n):[],(T.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(ee=>({u_dem:new o.bJ(ee),u_dem_prev:new o.bJ(ee),u_dem_tl:new o.bG(ee),u_dem_scale:new o.bI(ee),u_dem_tl_prev:new o.bG(ee),u_dem_scale_prev:new o.bI(ee),u_dem_size:new o.bI(ee),u_dem_lerp:new o.bI(ee),u_exaggeration:new o.bI(ee),u_depth:new o.bJ(ee),u_depth_size_inv:new o.bG(ee),u_depth_range_unpack:new o.bG(ee),u_occluder_half_size:new o.bI(ee),u_occlusion_depth_offset:new o.bI(ee),u_meter_to_dem:new o.bI(ee),u_label_plane_matrix_inv:new o.bF(ee)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new o.bH(ee),u_tile_tr_up:new o.bH(ee),u_tile_br_up:new o.bH(ee),u_tile_bl_up:new o.bH(ee),u_tile_up_scale:new o.bI(ee)}))(n)),T.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new o.bF(ee),u_fog_range:new o.bG(ee),u_fog_color:new o.c6(ee),u_fog_horizon_blend:new o.bI(ee),u_fog_vertical_limit:new o.bG(ee),u_fog_temporal_offset:new o.bI(ee),u_frustum_tl:new o.bH(ee),u_frustum_tr:new o.bH(ee),u_frustum_br:new o.bH(ee),u_frustum_bl:new o.bH(ee),u_globe_pos:new o.bH(ee),u_globe_radius:new o.bI(ee),u_globe_transition:new o.bI(ee),u_is_globe:new o.bJ(ee),u_viewport:new o.bG(ee)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new o.c6(ee)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new o.bH(ee),u_lighting_directional_dir:new o.bH(ee),u_lighting_directional_color:new o.bH(ee),u_ground_radiance:new o.bH(ee)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new o.bF(ee),u_light_matrix_1:new o.bF(ee),u_fade_range:new o.bG(ee),u_shadow_normal_offset:new o.bH(ee),u_shadow_intensity:new o.bI(ee),u_shadow_texel_size:new o.bI(ee),u_shadow_map_resolution:new o.bI(ee),u_shadow_direction:new o.bH(ee),u_shadow_bias:new o.bH(ee),u_shadowmap_0:new o.bJ(ee),u_shadowmap_1:new o.bJ(ee)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}_drawDebugWireframe(n,l,p,_,x,T,C,D,z,B){const U=n.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const V=n.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||n._terrain&&n._terrain.renderingToTexture||!il.includes(this.name))||!(!U.layers3D||!z_.includes(this.name))))return;const q=V.gl,K=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,V);if(!K)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const ee=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});V.program.set(ee.program);const re=(de,xe,ve)=>{if(xe[de]&&ve[de])for(const Pe in xe[de])ve[de][Pe]&&ve[de][Pe].set(ve.program,Pe,xe[de][Pe].current)};z&&z.setUniforms(ee.program,V,ee.binderUniforms,C,{zoom:D}),re("fixedUniforms",this,ee),re("terrainUniforms",this,ee),re("globeUniforms",this,ee),re("fogUniforms",this,ee),re("lightsUniforms",this,ee),re("shadowUniforms",this,ee),K.bind(),V.setColorMode(new Mr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],o.bz.transparent,[!0,!0,!0,!1])),V.setDepthMode(new Qt(l.func===q.LESS?q.LEQUAL:l.func,Qt.ReadOnly,l.range)),V.setStencilMode(pr.disabled);const me=3*T.primitiveLength*2,ye=3*T.primitiveOffset*2*2;B&&B>1?q.drawElementsInstanced(q.LINES,me,q.UNSIGNED_SHORT,ye,B):q.drawElements(q.LINES,me,q.UNSIGNED_SHORT,ye),x.bind(),V.program.set(this.program),V.setDepthMode(l),V.setStencilMode(p),V.setColorMode(_)}draw(n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee){const re=n.context,me=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(p),re.setStencilMode(_),re.setColorMode(x),re.setCullFace(T);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,C[xe]);K&&K.setUniforms(this.program,re,this.binderUniforms,V,{zoom:q});const ye={[me.POINTS]:1,[me.LINES]:2,[me.TRIANGLES]:3,[me.LINE_STRIP]:1}[l],de=ee&&ee>0?1:void 0;for(const xe of U.get()){const ve=xe.vaos||(xe.vaos={});(ve[D]||(ve[D]=new ac)).bind(re,this,z,K?K.getPaintVertexBuffers():[],B,xe.vertexOffset,Q||[],de),ee&&ee>1?me.drawElementsInstanced(l,xe.primitiveLength*ye,me.UNSIGNED_SHORT,xe.primitiveOffset*ye*2,ee):B?me.drawElements(l,xe.primitiveLength*ye,me.UNSIGNED_SHORT,xe.primitiveOffset*ye*2):me.drawArrays(l,xe.vertexOffset,xe.vertexLength),l===me.TRIANGLES&&B&&this._drawDebugWireframe(n,p,_,x,B,xe,V,q,K,ee)}}}function nm(d,n){const l=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,d.transform.tileZoom)/l,_=p*(n.tileID.canonical.x+n.tileID.wrap*l),x=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ak(n,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const uf=o.a6.mat4.create(),im=(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q)=>{const ee=n.style.light,re=ee.properties.get("position"),me=[re.x,re.y,re.z],ye=o.a6.mat3.create();ee.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(ye,-n.transform.angle),o.a6.vec3.transformMat3(me,me,ye));const de=ee.properties.get("color"),xe=n.transform,ve={u_matrix:d,u_lightpos:me,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:x,u_width_scale:T,u_flood_light_color:V,u_vertical_scale:q,u_flood_light_intensity:K,u_ground_shadow_factor:Q};return xe.projection.name==="globe"&&(ve.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ve.u_zoom_transition=z,ve.u_inv_rot_matrix=U,ve.u_merc_center=B,ve.u_up_dir=xe.projection.upVector(new o.bP(0,0,0),B[0]*o.ab,B[1]*o.ab),ve.u_height_lift=D),ve},B_=(d,n,l,p)=>({u_matrix:d,u_edge_radius:n,u_width_scale:l,u_vertical_scale:p}),om=(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K)=>{const Q=im(d,n,l,p,_,x,T,C,z,B,U,V,q,K,1,[0,0,0]),ee={u_height_factor:-Math.pow(2,C.overscaledZ)/D.tileSize/8};return o.l(Q,nm(n,D),ee)},hf=(d,n)=>({u_matrix:d,u_emissive_strength:n}),F_=(d,n,l,p)=>o.l(hf(d,n),nm(l,p)),N_=(d,n,l)=>({u_matrix:d,u_world:l,u_emissive_strength:n}),ku=(d,n,l,p,_)=>o.l(F_(d,n,l,p),{u_world:_}),Ab=(d,n,l,p)=>{const _=o.ab/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},j_=(d,n,l=1)=>({u_matrix:d,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),$_=o.a6.mat4.create(),Eb=(d,n,l,p,_,x,T)=>{const C=d.transform,D=C.projection.name==="globe",z=D?o.cI(C.zoom,n.canonical)*C._pixelsPerMercatorPixel:o.ak(l,1,x),B={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:$_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){B.u_inv_rot_matrix=p,B.u_merc_center=_,B.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],B.u_zoom_transition=o.a9(C.zoom);const U=_[0]*o.ab,V=_[1]*o.ab;B.u_up_dir=C.projection.upVector(new o.bP(0,0,0),U,V)}return B};function ff(d,[n,l,p,_],[x,T]){if(x===T)return[0,0,0,0];const C=255*(d-1)/(d*(T-x));return[n*C,l*C,p*C,_*C]}function df(d,n,[l,p]){return l===p?0:.5/d+(n-l)*(d-1)/(d*(p-l))}const Du=(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re,me,ye,de)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:o.cJ(U.paint.get("raster-saturation")),u_contrast_factor:o.cK(U.paint.get("raster-contrast")),u_spin_weights:am(U.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:C,u_cutoff_params:D,u_colorization_mix:ff(o.cL,Q,re),u_colorization_offset:df(o.cL,ee,re),u_color_ramp:K,u_texture_offset:[ye/(me+2*ye),me/(me+2*ye)],u_texture_res:[me+2*ye,me+2*ye],u_emissive_strength:de});function am(d){d*=Math.PI/180;const n=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const _a=.05,U_=(d,n,l,p,_,x,T,C,D,z,B,U)=>({u_matrix:d,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:T,u_merc_center:C,u_cutoff_params:D}),pf=(d,n,l,p,_,x,T,C,D,z)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:p,u_color_ramp:x,u_velocity_res:_,u_max_speed:T,u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[_a,_a]}),mf=(d,n,l,p,_,x,T,C,D,z)=>({u_particle_texture:d,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:p,u_max_speed:_,u_speed_factor:x,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[_a,_a]}),gf=o.a6.mat4.create(),sm=(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re,me,ye,de)=>{const xe=_.transform,ve={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(me),u_rotate_symbol:+l,u_aspect_ratio:xe.width/xe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+z,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:B,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gf,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:de||0,u_gamma_scale:p?_.transform.getCameraToCenterDistance(me)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+V};return me.name==="globe"&&(ve.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ve.u_zoom_transition=K,ve.u_inv_rot_matrix=ee,ve.u_merc_center=Q,ve.u_camera_forward=xe._camera.forward(),ve.u_ecef_origin=o.cM(xe.globeMatrix,q.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(xe.globeMatrix),ve.u_up_vector=re),ve},V_=(d,n,l,p)=>({u_matrix:d,u_emissive_strength:n,u_opacity:l,u_color:p}),ol=(d,n,l,p,_,x,T,C,D)=>o.l(function(z,B,U,V,q,K){const{width:Q,height:ee}=V.imageManager.getPixelSize(B),re=Math.pow(2,K.tileID.overscaledZ),me=K.tileSize*Math.pow(2,V.transform.tileZoom)/re,ye=me*(K.tileID.canonical.x+K.tileID.wrap*re),de=me*K.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[Q,ee],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:q?[V.transform.width,-1*V.transform.height]:[1/o.ak(K,1,V.transform.tileZoom),1/o.ak(K,1,V.transform.tileZoom)],u_pixel_coord_upper:[ye>>16,de>>16],u_pixel_coord_lower:[65535&ye,65535&de]}}(0,x,T,p,C,D),{u_matrix:d,u_emissive_strength:n,u_opacity:l}),hc=new Float32Array(o.a6.mat4.identity([])),$t=(d,n,l,p,_,x,T,C,D,z,B,U,V,q=[0,0,0],K)=>{const Q=_.style.light,ee=Q.properties.get("position"),re=[-ee.x,-ee.y,ee.z],me=o.a6.mat3.create();Q.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(me,-_.transform.angle),o.a6.vec3.transformMat3(re,re,me));const ye=B.alphaMode==="MASK",de=Q.properties.get("color").toRenderColor(null),xe=V.paint.get("model-ambient-occlusion-intensity"),ve=V.paint.get("model-color").constantOr(o.bz.white).toRenderColor(null),Pe=V.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:p||hc,u_lightpos:re,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:q,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ye,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:D,u_roughnessFactor:z,u_baseColorTexture:wi.BaseColor,u_metallicRoughnessTexture:wi.MetallicRoughness,u_normalTexture:wi.Normal,u_occlusionTexture:wi.Occlusion,u_emissionTexture:wi.Emission,u_lutTexture:wi.LUT,u_color_mix:[ve.r,ve.g,ve.b,Pe],u_aoIntensity:xe,u_emissive_strength:U,u_occlusionTextureTransform:K||[0,0,0,0]}},lm=(d,n=hc,l=hc)=>({u_matrix:d,u_instance:n,u_node_matrix:l}),G_={fillExtrusion:d=>({u_matrix:new o.bF(d),u_lightpos:new o.bH(d),u_lightintensity:new o.bI(d),u_lightcolor:new o.bH(d),u_vertical_gradient:new o.bI(d),u_opacity:new o.bI(d),u_edge_radius:new o.bI(d),u_width_scale:new o.bI(d),u_ao:new o.bG(d),u_tile_id:new o.bH(d),u_zoom_transition:new o.bI(d),u_inv_rot_matrix:new o.bF(d),u_merc_center:new o.bG(d),u_up_dir:new o.bH(d),u_height_lift:new o.bI(d),u_flood_light_color:new o.bH(d),u_vertical_scale:new o.bI(d),u_flood_light_intensity:new o.bI(d),u_ground_shadow_factor:new o.bH(d)}),fillExtrusionDepth:d=>({u_matrix:new o.bF(d),u_edge_radius:new o.bI(d),u_width_scale:new o.bI(d),u_vertical_scale:new o.bI(d)}),fillExtrusionPattern:d=>({u_matrix:new o.bF(d),u_lightpos:new o.bH(d),u_lightintensity:new o.bI(d),u_lightcolor:new o.bH(d),u_vertical_gradient:new o.bI(d),u_height_factor:new o.bI(d),u_edge_radius:new o.bI(d),u_width_scale:new o.bI(d),u_ao:new o.bG(d),u_tile_id:new o.bH(d),u_zoom_transition:new o.bI(d),u_inv_rot_matrix:new o.bF(d),u_merc_center:new o.bG(d),u_up_dir:new o.bH(d),u_height_lift:new o.bI(d),u_image:new o.bJ(d),u_texsize:new o.bG(d),u_pixel_coord_upper:new o.bG(d),u_pixel_coord_lower:new o.bG(d),u_tile_units_to_pixels:new o.bI(d),u_opacity:new o.bI(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new o.bF(d),u_opacity:new o.bI(d),u_ao_pass:new o.bI(d),u_meter_to_tile:new o.bI(d),u_ao:new o.bG(d),u_flood_light_intensity:new o.bI(d),u_flood_light_color:new o.bH(d),u_attenuation:new o.bI(d),u_edge_radius:new o.bI(d),u_fb:new o.bJ(d),u_fb_size:new o.bI(d),u_dynamic_offset:new o.bI(d)}),fill:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d)}),fillPattern:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d),u_image:new o.bJ(d),u_texsize:new o.bG(d),u_pixel_coord_upper:new o.bG(d),u_pixel_coord_lower:new o.bG(d),u_tile_units_to_pixels:new o.bI(d)}),fillOutline:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d),u_world:new o.bG(d)}),fillOutlinePattern:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d),u_world:new o.bG(d),u_image:new o.bJ(d),u_texsize:new o.bG(d),u_pixel_coord_upper:new o.bG(d),u_pixel_coord_lower:new o.bG(d),u_tile_units_to_pixels:new o.bI(d)}),circle:o.cN,collisionBox:d=>({u_matrix:new o.bF(d),u_camera_to_center_distance:new o.bI(d),u_extrude_scale:new o.bG(d)}),collisionCircle:d=>({u_matrix:new o.bF(d),u_inv_matrix:new o.bF(d),u_camera_to_center_distance:new o.bI(d),u_viewport_size:new o.bG(d)}),debug:d=>({u_color:new o.cu(d),u_matrix:new o.bF(d),u_overlay:new o.bJ(d),u_overlay_scale:new o.bI(d)}),clippingMask:d=>({u_matrix:new o.bF(d)}),heatmap:d=>({u_extrude_scale:new o.bI(d),u_intensity:new o.bI(d),u_matrix:new o.bF(d),u_inv_rot_matrix:new o.bF(d),u_merc_center:new o.bG(d),u_tile_id:new o.bH(d),u_zoom_transition:new o.bI(d),u_up_dir:new o.bH(d)}),heatmapTexture:d=>({u_image:new o.bJ(d),u_color_ramp:new o.bJ(d),u_opacity:new o.bI(d)}),hillshade:d=>({u_matrix:new o.bF(d),u_image:new o.bJ(d),u_latrange:new o.bG(d),u_light:new o.bG(d),u_shadow:new o.cu(d),u_highlight:new o.cu(d),u_emissive_strength:new o.bI(d),u_accent:new o.cu(d)}),hillshadePrepare:d=>({u_matrix:new o.bF(d),u_image:new o.bJ(d),u_dimension:new o.bG(d),u_zoom:new o.bI(d)}),line:o.cO,linePattern:o.cP,raster:d=>({u_matrix:new o.bF(d),u_normalize_matrix:new o.bF(d),u_globe_matrix:new o.bF(d),u_merc_matrix:new o.bF(d),u_grid_matrix:new o.cv(d),u_tl_parent:new o.bG(d),u_scale_parent:new o.bI(d),u_fade_t:new o.bI(d),u_opacity:new o.bI(d),u_image0:new o.bJ(d),u_image1:new o.bJ(d),u_brightness_low:new o.bI(d),u_brightness_high:new o.bI(d),u_saturation_factor:new o.bI(d),u_contrast_factor:new o.bI(d),u_spin_weights:new o.bH(d),u_perspective_transform:new o.bG(d),u_raster_elevation:new o.bI(d),u_zoom_transition:new o.bI(d),u_merc_center:new o.bG(d),u_cutoff_params:new o.c6(d),u_colorization_mix:new o.c6(d),u_colorization_offset:new o.bI(d),u_color_ramp:new o.bJ(d),u_texture_offset:new o.bG(d),u_texture_res:new o.bG(d),u_emissive_strength:new o.bI(d)}),rasterParticle:d=>({u_matrix:new o.bF(d),u_normalize_matrix:new o.bF(d),u_globe_matrix:new o.bF(d),u_merc_matrix:new o.bF(d),u_grid_matrix:new o.cv(d),u_tl_parent:new o.bG(d),u_scale_parent:new o.bI(d),u_fade_t:new o.bI(d),u_opacity:new o.bI(d),u_image0:new o.bJ(d),u_image1:new o.bJ(d),u_raster_elevation:new o.bI(d),u_zoom_transition:new o.bI(d),u_merc_center:new o.bG(d),u_cutoff_params:new o.c6(d)}),rasterParticleTexture:d=>({u_texture:new o.bJ(d),u_opacity:new o.bI(d)}),rasterParticleDraw:d=>({u_particle_texture:new o.bJ(d),u_particle_texture_side_len:new o.bI(d),u_tile_offset:new o.bG(d),u_velocity:new o.bJ(d),u_color_ramp:new o.bJ(d),u_velocity_res:new o.bG(d),u_max_speed:new o.bI(d),u_uv_offset:new o.bG(d),u_data_scale:new o.bG(d),u_data_offset:new o.bI(d),u_particle_pos_scale:new o.bI(d),u_particle_pos_offset:new o.bG(d)}),rasterParticleUpdate:d=>({u_particle_texture:new o.bJ(d),u_particle_texture_side_len:new o.bI(d),u_velocity:new o.bJ(d),u_velocity_res:new o.bG(d),u_max_speed:new o.bI(d),u_speed_factor:new o.bI(d),u_reset_rate:new o.bI(d),u_rand_seed:new o.bI(d),u_uv_offset:new o.bG(d),u_data_scale:new o.bG(d),u_data_offset:new o.bI(d),u_particle_pos_scale:new o.bI(d),u_particle_pos_offset:new o.bG(d)}),symbol:d=>({u_is_size_zoom_constant:new o.bJ(d),u_is_size_feature_constant:new o.bJ(d),u_size_t:new o.bI(d),u_size:new o.bI(d),u_camera_to_center_distance:new o.bI(d),u_rotate_symbol:new o.bJ(d),u_aspect_ratio:new o.bI(d),u_fade_change:new o.bI(d),u_matrix:new o.bF(d),u_label_plane_matrix:new o.bF(d),u_coord_matrix:new o.bF(d),u_is_text:new o.bJ(d),u_elevation_from_sea:new o.bJ(d),u_pitch_with_map:new o.bJ(d),u_texsize:new o.bG(d),u_texsize_icon:new o.bG(d),u_texture:new o.bJ(d),u_texture_icon:new o.bJ(d),u_gamma_scale:new o.bI(d),u_device_pixel_ratio:new o.bI(d),u_tile_id:new o.bH(d),u_zoom_transition:new o.bI(d),u_inv_rot_matrix:new o.bF(d),u_merc_center:new o.bG(d),u_camera_forward:new o.bH(d),u_tile_matrix:new o.bF(d),u_up_vector:new o.bH(d),u_ecef_origin:new o.bH(d),u_is_halo:new o.bJ(d),u_icon_transition:new o.bI(d),u_color_adj_mat:new o.bF(d)}),background:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d),u_opacity:new o.bI(d),u_color:new o.cu(d)}),backgroundPattern:d=>({u_matrix:new o.bF(d),u_emissive_strength:new o.bI(d),u_opacity:new o.bI(d),u_image:new o.bJ(d),u_pattern_tl:new o.bG(d),u_pattern_br:new o.bG(d),u_texsize:new o.bG(d),u_pattern_size:new o.bG(d),u_pixel_coord_upper:new o.bG(d),u_pixel_coord_lower:new o.bG(d),u_pattern_units_to_pixels:new o.bG(d)}),terrainRaster:d=>({u_matrix:new o.bF(d),u_image0:new o.bJ(d),u_skirt_height:new o.bI(d),u_ground_shadow_factor:new o.bH(d)}),skybox:d=>({u_matrix:new o.bF(d),u_sun_direction:new o.bH(d),u_cubemap:new o.bJ(d),u_opacity:new o.bI(d),u_temporal_offset:new o.bI(d)}),skyboxGradient:d=>({u_matrix:new o.bF(d),u_color_ramp:new o.bJ(d),u_center_direction:new o.bH(d),u_radius:new o.bI(d),u_opacity:new o.bI(d),u_temporal_offset:new o.bI(d)}),skyboxCapture:d=>({u_matrix_3f:new o.cv(d),u_sun_direction:new o.bH(d),u_sun_intensity:new o.bI(d),u_color_tint_r:new o.c6(d),u_color_tint_m:new o.c6(d),u_luminance:new o.bI(d)}),globeRaster:d=>({u_proj_matrix:new o.bF(d),u_globe_matrix:new o.bF(d),u_normalize_matrix:new o.bF(d),u_merc_matrix:new o.bF(d),u_zoom_transition:new o.bI(d),u_merc_center:new o.bG(d),u_image0:new o.bJ(d),u_grid_matrix:new o.cv(d),u_skirt_height:new o.bI(d),u_far_z_cutoff:new o.bI(d),u_frustum_tl:new o.bH(d),u_frustum_tr:new o.bH(d),u_frustum_br:new o.bH(d),u_frustum_bl:new o.bH(d),u_globe_pos:new o.bH(d),u_globe_radius:new o.bI(d),u_viewport:new o.bG(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.bH(d),u_frustum_tr:new o.bH(d),u_frustum_br:new o.bH(d),u_frustum_bl:new o.bH(d),u_horizon:new o.bI(d),u_transition:new o.bI(d),u_fadeout_range:new o.bI(d),u_color:new o.c6(d),u_high_color:new o.c6(d),u_space_color:new o.c6(d),u_temporal_offset:new o.bI(d),u_horizon_angle:new o.bI(d)}),model:d=>({u_matrix:new o.bF(d),u_lighting_matrix:new o.bF(d),u_normal_matrix:new o.bF(d),u_node_matrix:new o.bF(d),u_lightpos:new o.bH(d),u_lightintensity:new o.bI(d),u_lightcolor:new o.bH(d),u_camera_pos:new o.bH(d),u_opacity:new o.bI(d),u_baseColorFactor:new o.c6(d),u_emissiveFactor:new o.c6(d),u_metallicFactor:new o.bI(d),u_roughnessFactor:new o.bI(d),u_baseTextureIsAlpha:new o.bJ(d),u_alphaMask:new o.bJ(d),u_alphaCutoff:new o.bI(d),u_baseColorTexture:new o.bJ(d),u_metallicRoughnessTexture:new o.bJ(d),u_normalTexture:new o.bJ(d),u_occlusionTexture:new o.bJ(d),u_emissionTexture:new o.bJ(d),u_lutTexture:new o.bJ(d),u_color_mix:new o.c6(d),u_aoIntensity:new o.bI(d),u_emissive_strength:new o.bI(d),u_occlusionTextureTransform:new o.c6(d)}),modelDepth:d=>({u_matrix:new o.bF(d),u_instance:new o.bF(d),u_node_matrix:new o.bF(d)}),groundShadow:d=>({u_matrix:new o.bF(d),u_ground_shadow_factor:new o.bH(d)}),stars:d=>({u_matrix:new o.bF(d),u_up:new o.bH(d),u_right:new o.bH(d),u_intensity_multiplier:new o.bI(d)}),occlusion:d=>({u_matrix:new o.bF(d),u_anchorPos:new o.bH(d),u_screenSizePx:new o.bG(d),u_occluderSizePx:new o.bG(d),u_color:new o.c6(d)})};class no{constructor(n,l,p,_){this.id=no.uniqueIdxCounter,no.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||_||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=no.uniqueIdxCounter,no.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}no.uniqueIdxCounter=0;const al={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ht{constructor(n,l,p,_,x,T){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.instanceCount=T,this.context=n;const C=n.gl;this.buffer=C.createBuffer(),n.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||x||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,l,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],T=l.attributes[x.name];T!==void 0&&n.vertexAttribPointer(T,x.components,n[al[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,l,p){for(let _=0;_<this.attributes.length;_++){const x=l.attributes[this.attributes[_].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yf{constructor(n,l,p,_,x){this.context=n,this.width=l,this.height=p;const T=this.framebuffer=n.gl.createFramebuffer();_&&(this.colorAttachment=new lf(n,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Jp(n,T):new C_(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class Mb{constructor(n,l){this.gl=n,this.clearColor=new Up(this),this.clearDepth=new w_(this),this.clearStencil=new Vp(this),this.colorMask=new nf(this),this.depthMask=new Mu(this),this.stencilMask=new T_(this),this.stencilFunc=new S_(this),this.stencilOp=new A_(this),this.stencilTest=new sc(this),this.depthRange=new E_(this),this.depthTest=new xb(this),this.depthFunc=new bb(this),this.blend=new wb(this),this.blendFunc=new Gp(this),this.blendColor=new qp(this),this.blendEquation=new Wp(this),this.cullFace=new Hp(this),this.cullFaceSide=new M_(this),this.frontFace=new P_(this),this.program=new Tb(this),this.activeTexture=new Pu(this),this.viewport=new Iu(this),this.bindFramebuffer=new I_(this),this.bindRenderbuffer=new vo(this),this.bindTexture=new Zp(this),this.bindVertexBuffer=new of(this),this.bindElementBuffer=new af(this),this.bindVertexArrayOES=new Xp(this),this.pixelStoreUnpack=new Yp(this),this.pixelStoreUnpackPremultiplyAlpha=new sf(this),this.pixelStoreUnpackFlipY=new Kp(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,p){return new no(this,n,l,p)}createVertexBuffer(n,l,p,_,x){return new Ht(this,n,l,p,_,x)}createRenderbuffer(n,l,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,n,l,p),this.bindRenderbuffer.set(null),x}createFramebuffer(n,l,p,_){return new yf(this,n,l,p,_)}clear({color:n,depth:l,stencil:p,colorMask:_}){const x=this.gl;let T=0;n&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(_||[!0,!0,!0,!0])),l!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.bh(n.blendFunction,Mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let _f;function vf(d,n,l,p,_,x,T){const C=d.context,D=C.gl,z=d.transform,B=d.getOrCreateProgram("collisionBox"),U=[];let V=0,q=0;for(let de=0;de<p.length;de++){const xe=p[de],ve=n.getTile(xe),Pe=ve.getBucket(l);if(!Pe)continue;const Se=c_(xe,Pe,z);let Ce=Se;_[0]===0&&_[1]===0||(Ce=d.translatePosMatrix(Se,ve,_,x));const Be=T?Pe.textCollisionBox:Pe.iconCollisionBox,Le=Pe.collisionCircleArray;if(Le.length>0){const ke=o.a6.mat4.create(),Ve=Ce;o.a6.mat4.mul(ke,Pe.placementInvProjMatrix,z.glCoordMatrix),o.a6.mat4.mul(ke,ke,Pe.placementViewportMatrix),U.push({circleArray:Le,circleOffset:q,transform:Ve,invTransform:ke,projection:Pe.getProjection()}),V+=Le.length/4,q=V}Be&&(d.terrain&&d.terrain.setupElevationDraw(ve,B),B.draw(d,D.LINES,Qt.disabled,pr.disabled,d.colorModeForRenderPass(),or.disabled,Ab(Ce,z,ve,Pe.getProjection()),l.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,z.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!T||!U.length)return;const K=d.getOrCreateProgram("collisionCircle"),Q=new o.cQ;Q.resize(4*V),Q._trim();let ee=0;for(const de of U)for(let xe=0;xe<de.circleArray.length/4;xe++){const ve=4*xe,Pe=de.circleArray[ve+0],Se=de.circleArray[ve+1],Ce=de.circleArray[ve+2],Be=de.circleArray[ve+3];Q.emplace(ee++,Pe,Se,Ce,Be,0),Q.emplace(ee++,Pe,Se,Ce,Be,1),Q.emplace(ee++,Pe,Se,Ce,Be,2),Q.emplace(ee++,Pe,Se,Ce,Be,3)}(!_f||_f.length<2*V)&&(_f=function(de){const xe=2*de,ve=new o.aO;ve.resize(xe),ve._trim();for(let Pe=0;Pe<xe;Pe++){const Se=6*Pe;ve.uint16[Se+0]=4*Pe+0,ve.uint16[Se+1]=4*Pe+1,ve.uint16[Se+2]=4*Pe+2,ve.uint16[Se+3]=4*Pe+2,ve.uint16[Se+4]=4*Pe+3,ve.uint16[Se+5]=4*Pe+0}return ve}(V));const re=C.createIndexBuffer(_f,!0),me=C.createVertexBuffer(Q,o.cR.members,!0);for(const de of U){const xe={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(ye=z).getCameraToCenterDistance(de.projection),u_viewport_size:[ye.width,ye.height]};K.draw(d,D.TRIANGLES,Qt.disabled,pr.disabled,d.colorModeForRenderPass(),or.disabled,xe,l.id,me,re,o.b1.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,z.zoom)}var ye;me.destroy(),re.destroy()}const Lu=o.a6.mat4.create();function cm(d){const n=d._camera.getWorldToCamera(d.worldSize,1),l=o.a6.mat4.multiply([],n,d.globeMatrix);o.a6.mat4.invert(l,l);const p=[0,0,0],_=[0,1,0,0];return o.a6.vec4.transformMat4(_,_,l),p[0]=_[0],p[1]=_[1],p[2]=_[2],o.a6.vec3.normalize(p,p),p}function Pb({width:d,height:n,anchor:l,textOffset:p,textScale:_},x){const{horizontalAlign:T,verticalAlign:C}=o.bx(l),D=-(T-.5)*d,z=-(C-.5)*n,B=o.bw(l,p);return new o.P((D/_+B[0])*x,(z/_+B[1])*x)}function Ib(d,n,l,p,_,x,T,C,D,z,B){const U=d.text.placedSymbolArray,V=d.text.dynamicLayoutVertexArray,q=d.icon.dynamicLayoutVertexArray,K={},Q=d.getProjection(),ee=xs(C,Q,x),re=x.elevation,me=Q.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;V.clear();for(let ye=0;ye<U.length;ye++){const de=U.get(ye),{tileAnchorX:xe,tileAnchorY:ve,numGlyphs:Pe}=de,Se=de.hidden||!de.crossTileID||d.allowVerticalPlacement&&!de.placedOrientation?null:p[de.crossTileID];if(Se){let Ce=0,Be=0,Le=0;if(re){const ot=re?re.getAtTileOffset(C,xe,ve):0,[bt,St,ut]=Q.upVector(C.canonical,xe,ve);Ce=ot*bt*me,Be=ot*St*me,Le=ot*ut*me}let[ke,Ve,rt,ft]=ki(de.projectedAnchorX+Ce,de.projectedAnchorY+Be,de.projectedAnchorZ+Le,l?ee:T);const et=Rr(x.getCameraToCenterDistance(Q),ft);let vt=_.evaluateSizeForFeature(d.textSizeData,z,de)*et/o.bq;l&&(vt*=d.tilePixelRatio/D);const Ge=Pb(Se,vt);l?({x:ke,y:Ve,z:rt}=Q.projectTilePoint(xe+Ge.x,ve+Ge.y,C.canonical),[ke,Ve,rt]=ki(ke+Ce,Ve+Be,rt+Le,T)):(n&&Ge._rotate(-x.angle),ke+=Ge.x,Ve+=Ge.y,rt=0);const lt=d.allowVerticalPlacement&&de.placedOrientation===o.bk.vertical?Math.PI/2:0;for(let ot=0;ot<Pe;ot++)o.bn(V,ke,Ve,rt,lt);B&&de.associatedIconIndex>=0&&(K[de.associatedIconIndex]={x:ke,y:Ve,z:rt,angle:lt})}else ya(Pe,V)}if(B){q.clear();const ye=d.icon.placedSymbolArray;for(let de=0;de<ye.length;de++){const xe=ye.get(de),{numGlyphs:ve}=xe,Pe=K[de];if(xe.hidden||!Pe)ya(ve,q);else{const{x:Se,y:Ce,z:Be,angle:Le}=Pe;for(let ke=0;ke<ve;ke++)o.bn(q,Se,Ce,Be,Le)}}d.icon.dynamicLayoutVertexBuffer.updateData(q)}d.text.dynamicLayoutVertexBuffer.updateData(V)}function Ru(d,n,l,p,_,x,T={}){const C=l.paint.get("icon-translate"),D=l.paint.get("text-translate"),z=l.paint.get("icon-translate-anchor"),B=l.paint.get("text-translate-anchor"),U=l.layout.get("icon-rotation-alignment"),V=l.layout.get("text-rotation-alignment"),q=l.layout.get("icon-pitch-alignment"),K=l.layout.get("text-pitch-alignment"),Q=l.layout.get("icon-keep-upright"),ee=l.layout.get("text-keep-upright"),re=l.paint.get("icon-color-saturation"),me=l.paint.get("icon-color-contrast"),ye=l.paint.get("icon-color-brightness-min"),de=l.paint.get("icon-color-brightness-max"),xe=l.paint.get("symbol-elevation-reference")==="sea",ve=l.paint.get("text-occlusion-opacity").constantOr(0),Pe=d.context,Se=Pe.gl,Ce=d.transform,Be=U==="map",Le=V==="map",ke=q==="map",Ve=K==="map",rt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ft=!1;const et=d.depthModeForSublayer(0,Qt.ReadOnly),vt=[o.am(Ce.center.lng),o.at(Ce.center.lat)],Ge=l.layout.get("text-variable-anchor"),lt=Ce.projection.name==="globe",ot=[],bt=[0,-1,0];for(const St of p){const ut=n.getTile(St),pt=ut.getBucket(l);if(!pt||pt.projection.name==="mercator"&&lt||pt.fullyClipped)continue;const Kt=pt.projection.name==="globe",Mt=Kt?o.a9(Ce.zoom):0,Nt=xs(St,pt.getProjection(),Ce),ir=Ce.calculatePixelsToTileUnitsMatrix(ut),Gt=Ge&&pt.hasTextData(),er=pt.hasIconTextFit()&&Gt&&pt.hasIconData(),Tr=pt.getProjection().createInversionMatrix(Ce,St.canonical),vr=Jr=>{Ce.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||d.terrain)&&(Jr.push("DEPTH_D24"),Jr.push("DEPTH_OCCLUSION"))},Xr=()=>{const Jr=Be&&l.layout.get("symbol-placement")!=="point",br=[];vr(br);const Nr=Jr||er,Gr=l.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&ke&&br.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(br.push("PROJECTION_GLOBE_VIEW"),Nr&&br.push("PROJECTED_POS_ON_VIEWPORT")),Gr>0&&br.push("ICON_TRANSITION"),pt.icon.zOffsetVertexBuffer&&br.push("Z_OFFSET"),re===0&&me===0&&ye===0&&de===1||br.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&br.push("RENDER_SDF");const kn=pt.icon.programConfigurations.get(l.id),jn=d.getOrCreateProgram("symbol",{config:kn,defines:br}),Dr=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],ri=pt.iconSizeData,ci=o.bj(ri,Ce.zoom),ni=ke||Ce.pitch!==0,ln=Cr(Nt,ut.tileID.canonical,ke,Be,Ce,pt.getProjection(),ir),Gi=to(Nt,ut.tileID.canonical,ke,Be,Ce,pt.getProjection(),ir),qi=d.translatePosMatrix(Gi,ut,C,z,!0),Do=d.translatePosMatrix(Nt,ut,C,z),bo=Nr?Lu:ln,oo=Be&&!ke&&!Jr;let Lo=bt;!lt&&!Ce.mercatorFromTransition||Be||(Lo=cm(Ce));const Ja=Kt?Lo:bt,Os=l.getColorAdjustmentMatrix(re,me,ye,de),wa=sm(ri.kind,ci,oo,ke,d,Do,bo,qi,xe,!1,Dr,[0,0],!0,St,Mt,vt,Tr,Ja,pt.getProjection(),Os,Gr),wc=ut.imageAtlasTexture?ut.imageAtlasTexture:null,Tc=l.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,zf=pt.sdfIcons||d.options.rotating||d.options.zooming||Tc||ni?Se.LINEAR:Se.NEAREST,Sc=pt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,cn=d.terrain&&ke&&Jr?o.a6.mat4.invert(o.a6.mat4.create(),ln):Lu;if(Jr&&pt.icon){const fl=Ce.elevation,Gb=fl?fl.getAtTileOffsetFunc(St,Ce.center.lat,Ce.worldSize,pt.getProjection()):null,cv=Or(Nt,ut.tileID.canonical,ke,Be,Ce,pt.getProjection(),ir);Hl(pt,Nt,d,!1,cv,Gi,ke,Q,Gb,St)}return{program:jn,buffers:pt.icon,uniformValues:wa,atlasTexture:wc,atlasTextureIcon:null,atlasInterpolation:zf,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:Sc,tile:ut,labelPlaneMatrixInv:cn}},rn=()=>{const Jr=Le&&l.layout.get("symbol-placement")!=="point",br=[],Nr=Jr||Ge||er;d.terrainRenderModeElevated()&&Ve&&br.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(br.push("PROJECTION_GLOBE_VIEW"),Nr&&br.push("PROJECTED_POS_ON_VIEWPORT")),pt.text.zOffsetVertexBuffer&&br.push("Z_OFFSET"),pt.iconsInText&&br.push("RENDER_TEXT_AND_SYMBOL"),br.push("RENDER_SDF"),vr(br);const Gr=pt.text.programConfigurations.get(l.id),kn=d.getOrCreateProgram("symbol",{config:Gr,defines:br});let jn,Dr=[0,0],ri=null;const ci=pt.textSizeData;pt.iconsInText&&(Dr=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],ri=ut.imageAtlasTexture?ut.imageAtlasTexture:null,jn=Ve||Ce.pitch!==0||d.options.rotating||d.options.zooming||ci.kind==="composite"||ci.kind==="camera"?Se.LINEAR:Se.NEAREST);const ni=ut.glyphAtlasTexture?ut.glyphAtlasTexture.size:[0,0],ln=o.bj(ci,Ce.zoom),Gi=Cr(Nt,ut.tileID.canonical,Ve,Le,Ce,pt.getProjection(),ir),qi=to(Nt,ut.tileID.canonical,Ve,Le,Ce,pt.getProjection(),ir),Do=d.translatePosMatrix(qi,ut,D,B,!0),bo=d.translatePosMatrix(Nt,ut,D,B),oo=Nr?Lu:Gi,Lo=Le&&!Ve&&!Jr;let Ja=bt;!lt&&!Ce.mercatorFromTransition||Le||(Ja=cm(Ce));const Os=sm(ci.kind,ln,Lo,Ve,d,bo,oo,Do,xe,!0,ni,Dr,!0,St,Mt,vt,Tr,Kt?Ja:bt,pt.getProjection(),ve),wa=ut.glyphAtlasTexture?ut.glyphAtlasTexture:null,wc=Se.LINEAR,Tc=l.paint.get("text-halo-width").constantOr(1)!==0,zf=d.terrain&&Ve&&Jr?o.a6.mat4.invert(o.a6.mat4.create(),Gi):Lu;if(Jr&&pt.text){const Sc=Ce.elevation,cn=Sc?Sc.getAtTileOffsetFunc(St,Ce.center.lat,Ce.worldSize,pt.getProjection()):null,fl=Or(Nt,ut.tileID.canonical,Ve,Le,Ce,pt.getProjection(),ir);Hl(pt,Nt,d,!0,fl,qi,Ve,ee,cn,St)}return{program:kn,buffers:pt.text,uniformValues:Os,atlasTexture:wa,atlasTextureIcon:ri,atlasInterpolation:wc,atlasInterpolationIcon:jn,isSDF:!0,hasHalo:Tc,tile:ut,labelPlaneMatrixInv:zf}},fn=pt.icon.segments.get().length,ko=pt.text.segments.get().length,Nn=fn&&!T.onlyText?Xr():null,Ir=ko&&!T.onlyIcons?rn():null,Qr=l.paint.get("icon-opacity").constantOr(1),bn=l.paint.get("text-opacity").constantOr(1);if(rt&&pt.canOverlap){ft=!0;const Jr=Qr&&!T.onlyText?pt.icon.segments.get():[],br=bn&&!T.onlyIcons?pt.text.segments.get():[];for(const Nr of Jr)ot.push({segments:new o.b1([Nr]),sortKey:Nr.sortKey,state:Nn});for(const Nr of br)ot.push({segments:new o.b1([Nr]),sortKey:Nr.sortKey,state:Ir})}else T.onlyText||ot.push({segments:Qr?pt.icon.segments:new o.b1([]),sortKey:0,state:Nn}),T.onlyIcons||ot.push({segments:bn?pt.text.segments:new o.b1([]),sortKey:0,state:Ir})}ft&&ot.sort((St,ut)=>St.sortKey-ut.sortKey);for(const St of ot){const ut=St.state;if(ut)if(d.terrain?d.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:Ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}):d.setupDepthForOcclusion(Ce.depthOcclusionForSymbolsAndCircles,ut.program),Pe.activeTexture.set(Se.TEXTURE0),ut.atlasTexture&&ut.atlasTexture.bind(ut.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),ut.atlasTextureIcon&&(Pe.activeTexture.set(Se.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,ut.program),ut.hasHalo){const pt=ut.uniformValues;pt.u_is_halo=1,zu(ut.buffers,St.segments,l,d,ut.program,et,_,x,pt,2),pt.u_is_halo=0}else{if(ut.isSDF){const pt=ut.uniformValues;ut.hasHalo&&(pt.u_is_halo=1,zu(ut.buffers,St.segments,l,d,ut.program,et,_,x,pt,1)),pt.u_is_halo=0}zu(ut.buffers,St.segments,l,d,ut.program,et,_,x,ut.uniformValues,1)}}}function zu(d,n,l,p,_,x,T,C,D,z){const B=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,x,T,C,or.disabled,D,l.id,d.layoutVertexBuffer,d.indexBuffer,n,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),B,z)}function xf(d,n,l,p,_,x,T){const C=d.context.gl,D=l.paint.get("fill-pattern"),z=l.is3D(),B=z?d.stencilModeFor3D():pr.disabled,U=D&&D.constantOr(1);let V,q,K,Q,ee;T?(q=U&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=C.LINES):(q=U?"fillPattern":"fill",V=C.TRIANGLES);for(const re of p){const me=n.getTile(re);if(U&&!me.patternsLoaded())continue;const ye=me.getBucket(l);if(!ye)continue;d.prepareDrawTile();const de=ye.programConfigurations.get(l.id),xe=d.isTileAffectedByFog(re),ve=d.getOrCreateProgram(q,{config:de,overrideFog:xe});U&&(d.context.activeTexture.set(C.TEXTURE0),me.imageAtlasTexture&&me.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),de.updatePaintBuffers());const Pe=D.constantOr(null);if(Pe&&me.imageAtlas){const Be=me.imageAtlas.patternPositions[Pe.toString()];Be&&de.setConstantPatternPositions(Be)}const Se=d.translatePosMatrix(re.projMatrix,me,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Ce=l.paint.get("fill-emissive-strength");if(T){Q=ye.indexBuffer2,ee=ye.segments2;const Be=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];K=q==="fillOutlinePattern"&&U?ku(Se,Ce,d,me,Be):N_(Se,Ce,Be)}else Q=ye.indexBuffer,ee=ye.segments,K=U?F_(Se,Ce,d,me):hf(Se,Ce);d.uploadCommonUniforms(d.context,ve,re.toUnwrapped()),ve.draw(d,V,_,z?B:d.stencilModeForClipping(re),x,or.disabled,K,l.id,ye.layoutVertexBuffer,Q,ee,l.paint,d.transform.zoom,de,void 0)}}function fc(d,n,l,p,_,x,T,C){l.resetLayerRenderingStats(d);const D=d.context,z=D.gl,B=d.transform,U=l.paint.get("fill-extrusion-pattern"),V=U.constantOr(1),q=l.paint.get("fill-extrusion-opacity"),K=d.style.enable3dLights(),Q=l.paint.get(K&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q],re=l.layout.get("fill-extrusion-edge-radius"),me=re>0&&!l.paint.get("fill-extrusion-rounded-roof"),ye=me?0:re,de=B.projection.name==="globe"?o.c_():0,xe=B.projection.name==="globe",ve=xe?o.a9(B.zoom):0,Pe=[o.am(B.center.lng),o.at(B.center.lat)],Se=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),Ce=l.paint.get("fill-extrusion-flood-light-intensity"),Be=l.paint.get("fill-extrusion-vertical-scale"),Le=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ke=Wa(d,l.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[];let rt;xe&&Ve.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Ve.push("FAUX_AO"),me&&Ve.push("ZERO_ROOF_RADIUS"),C&&Ve.push("HAS_CENTROID"),Ce>0&&Ve.push("FLOOD_LIGHT"),ke.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Le&&Ve.push("RENDER_WALL_MODE");const ft=d.renderPass==="shadow",et=d.shadowRenderer,vt=ft&&!!et;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let Ge=[0,0,0];if(et){const bt=d.style.directionalLight,St=d.style.ambientLight;bt&&St&&(Ge=Xh(d.style,bt,St)),rt=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}const lt=vt?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",ot=l.getLayerRenderingStats();for(const bt of p){const St=n.getTile(bt),ut=St.getBucket(l);if(!ut||ut.projection.name!==B.projection.name)continue;let pt=!1;et&&(pt=et.getMaxCascadeForTile(bt.toUnwrapped())===0);const Kt=d.isTileAffectedByFog(bt),Mt=ut.programConfigurations.get(l.id),Nt=d.getOrCreateProgram(lt,{config:Mt,defines:pt?rt:Ve,overrideFog:Kt});if(d.terrain&&d.terrain.setupElevationDraw(St,Nt,{useMeterToDem:!0}),!ut.centroidVertexBuffer){const rn=Nt.attributes.a_centroid_pos;rn!==void 0&&z.vertexAttrib2f(rn,0,0)}!ft&&et&&et.setupShadows(St.tileID.toUnwrapped(),Nt,"vector-tile",St.tileID.overscaledZ),V&&(d.context.activeTexture.set(z.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Mt.updatePaintBuffers());const ir=U.constantOr(null);if(ir&&St.imageAtlas){const rn=St.imageAtlas.patternPositions[ir.toString()];rn&&Mt.setConstantPatternPositions(rn)}const Gt=l.paint.get("fill-extrusion-vertical-gradient"),er=1/ut.tileToMeter;let Tr;if(ft&&et){if(fm(St.tileID,ut,d))continue;const rn=et.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());Tr=B_(rn,ye,er,Be)}else{const rn=d.translatePosMatrix(bt.expandedProjMatrix,St,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),fn=B.projection.createInversionMatrix(B,bt.canonical);Tr=V?om(rn,d,Gt,q,ee,ye,er,bt,St,de,ve,Pe,fn,Se,Be):im(rn,d,Gt,q,ee,ye,er,bt,de,ve,Pe,fn,Se,Be,Ce,Ge)}d.uploadCommonUniforms(D,Nt,bt.toUnwrapped(),null,ke);let vr=ut.segments;if(B.projection.name==="mercator"&&!ft&&(vr=ut.getVisibleSegments(St.tileID,d.terrain,d.transform.getFrustum(0)),!vr.get().length))continue;if(ot)if(ft)for(const rn of vr.get())ot.numRenderedVerticesInShadowPass+=rn.primitiveLength;else for(const rn of vr.get())ot.numRenderedVerticesInTransparentPass+=rn.primitiveLength;const Xr=[];(d.terrain||C)&&Xr.push(ut.centroidVertexBuffer),xe&&Xr.push(ut.layoutVertexExtBuffer),Le&&Xr.push(ut.wallVertexBuffer),Nt.draw(d,D.gl.TRIANGLES,_,x,T,or.backCCW,Tr,l.id,ut.layoutVertexBuffer,ut.indexBuffer,vr,l.paint,d.transform.zoom,Mt,Xr)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function pi(d,n,l,p,_,x,T,C,D,z,B,U,V,q,K,Q,ee,re,me){const ye=d.context,de=ye.gl,xe=d.transform,ve=d.transform.zoom,Pe=[],Se=Wa(d,l.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(Pe.push("CLEAR_SUBPASS"),me&&(Pe.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(de.TEXTURE0),me.bind(de.LINEAR,de.CLAMP_TO_EDGE))):z==="sdf"&&Pe.push("SDF_SUBPASS"),ee&&Pe.push("HAS_CENTROID"),Se.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF");const Ce=l.layout.get("fill-extrusion-edge-radius"),Be=(Le,ke,Ve,rt,ft)=>{const et=ke.programConfigurations.get(l.id),vt=d.isTileAffectedByFog(Le),Ge=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:Pe,overrideFog:vt}),lt=((bt,St,ut,pt,Kt,Mt,Nt,ir,Gt,er,Tr)=>({u_matrix:St,u_opacity:ut,u_ao_pass:pt?1:0,u_meter_to_tile:Kt,u_ao:Mt,u_flood_light_intensity:Nt,u_flood_light_color:ir,u_attenuation:Gt,u_edge_radius:er,u_fb:0,u_fb_size:Tr,u_dynamic_offset:1}))(0,rt,B,D,ft,[U,V*ft],q,K,Q,ve>=17?0:Ce*ft,me?me.size[0]:0),ot=[];ee&&ot.push(ke.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ye,Ge,Le.toUnwrapped(),null,Se),Ge.draw(d,ye.gl.TRIANGLES,_,x,T,C,lt,l.id,ke.vertexBuffer,ke.indexBuffer,Ve,l.paint,ve,et,ot)};for(const Le of p){const ke=n.getTile(Le),Ve=ke.getBucket(l);if(!Ve||Ve.projection.name!==xe.projection.name||!Ve.groundEffect||Ve.groundEffect&&!Ve.groundEffect.hasData())continue;const rt=Ve.groundEffect,ft=1/Ve.tileToMeter;{const et=d.translatePosMatrix(Le.projMatrix,ke,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),vt=rt.getDefaultSegment();Be(Le,rt,vt,et,ft)}if(re)for(let et=0;et<4;et++){const vt=o.c$[et](Le),Ge=n.getTile(vt);if(!Ge)continue;const lt=Ge.getBucket(l);if(!lt||lt.projection.name!==xe.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const ot=lt.groundEffect;let bt,St;et===0?(bt=[-o.ab,0,0],St=1):et===1?(bt=[o.ab,0,0],St=0):et===2?(bt=[0,-o.ab,0],St=3):(bt=[0,o.ab,0],St=2);const ut=ot.regionSegments[St];if(!ut)continue;const pt=new Float32Array(16);o.a6.mat4.translate(pt,Le.projMatrix,bt),Be(Le,ot,ut,d.translatePosMatrix(pt,ke,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ft)}}}function As(d,n,l,p,_,x,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const C=x?x.findDEMTileFor(l):null;if(!(C&&C.dem||T))return;const D=re=>new o.P(Math.ceil((re+o.d2)*o.d3),0),z=re=>{const me=n.getSource().minzoom,ye=xe=>{const ve=n.getTileByID(xe);if(ve&&ve.hasData())return ve.getBucket(_)},de=[0,-1,1];for(const xe of de){if(re.overscaledZ+xe<me)continue;const ve=ye(re.calculateScaledKey(re.overscaledZ+xe));if(ve)return ve}},B=[0,0,0],U=(re,me)=>(B[0]=Math.min(re.min.y,me.min.y),B[1]=Math.max(re.max.y,me.max.y),B[2]=o.ab-me.min.x>re.max.x?me.min.x-o.ab:re.max.x,B),V=(re,me)=>(B[0]=Math.min(re.min.x,me.min.x),B[1]=Math.max(re.max.x,me.max.x),B[2]=o.ab-me.min.y>re.max.y?me.min.y-o.ab:re.max.y,B),q=[(re,me)=>U(re,me),(re,me)=>U(me,re),(re,me)=>V(re,me),(re,me)=>V(me,re)],K=(re,me,ye,de,xe,ve,Pe)=>{if(!x)return 0;const Se=[[ve?ye:re,ve?re:ye,0],[ve?ye:me,ve?me:ye,0]],Ce=Pe<0?o.ab+Pe:Pe,Be=[ve?Ce:(re+me)/2,ve?(re+me)/2:Ce,0];return ye===0&&Pe<0||ye!==0&&Pe>0?x.getForTilePoints(xe,[Be],!0,de):Se.push(Be),x.getForTilePoints(l,Se,!0,C),Math.max(Se[0][2],Se[1][2],Be[2])/x.exaggeration()};for(let re=0;re<4;re++){const me=p.borderFeatureIndices[re];if(me.length===0)continue;const ye=o.c$[re](l),de=z(ye);if(!(de&&de instanceof o.d0)||p.borderDoneWithNeighborZ[re]===de.canonical.z)continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const xe=x?x.findDEMTileFor(ye):null;if(!(xe&&xe.dem||T))continue;const ve=(re<2?1:5)-re,Pe=de.borderDoneWithNeighborZ[ve]!==p.canonical.z,Se=de.borderFeatureIndices[ve];let Ce=0;if(p.canonical.z!==de.canonical.z){for(const Be of me)p.showCentroid(p.featuresOnBorder[Be]);if(Pe)for(const Be of Se)de.showCentroid(de.featuresOnBorder[Be]);p.borderDoneWithNeighborZ[re]=de.canonical.z,de.borderDoneWithNeighborZ[ve]=p.canonical.z}for(const Be of me){const Le=p.featuresOnBorder[Be],ke=p.centroidData[Le.centroidDataIndex],Ve=Le.borders[re];let rt;for(;Ce<Se.length;){rt=de.featuresOnBorder[Se[Ce]];const ft=rt.borders[ve];if(ft[1]>Ve[0]+3||ft[0]>Ve[0]-3)break;de.showCentroid(rt),Ce++}if(rt&&Ce<Se.length){const ft=Ce;let et=0;for(;!(rt.borders[ve][0]>Ve[1]-3)&&(et++,++Ce!==Se.length);)rt=de.featuresOnBorder[Se[Ce]];rt=de.featuresOnBorder[Se[ft]];let vt=!1;if(et>=1){const ot=rt.borders[ve];Math.abs(Ve[0]-ot[0])<3&&Math.abs(Ve[1]-ot[1])<3&&(et=1,vt=!0,Ce=ft+1)}else if(et===0){p.showCentroid(Le);continue}const Ge=de.centroidData[rt.centroidDataIndex];T&&vt&&(((Q=ke).flags|(ee=Ge).flags)&o.d1?(Q.flags|=o.d1,ee.flags|=o.d1):(Q.flags&=~o.d1,ee.flags&=~o.d1));const lt=Le.intersectsCount()>1||rt.intersectsCount()>1;if(et>1)Ce=ft,ke.centroidXY=Ge.centroidXY=new o.P(0,0);else if(xe&&xe.dem&&!lt){const ot=q[re](ke,Ge),bt=re%2?o.ab-1:0,St=K(ot[0],Math.min(o.ab-1,ot[1]),bt,xe,ye,re<2,ot[2]);ke.centroidXY=Ge.centroidXY=D(St)}else lt?ke.centroidXY=Ge.centroidXY=new o.P(0,0):(ke.centroidXY=p.encodeBorderCentroid(Le),Ge.centroidXY=de.encodeBorderCentroid(rt));p.writeCentroidToBuffer(ke),de.writeCentroidToBuffer(Ge)}else p.showCentroid(Le)}p.borderDoneWithNeighborZ[re]=de.canonical.z,de.borderDoneWithNeighborZ[ve]=p.canonical.z}var Q,ee;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(d)}const q_=[1,0,0],um=[0,1,0],hm=[0,0,1];function fm(d,n,l){const p=l.transform,_=l.shadowRenderer;if(!_)return!0;const x=d.toUnwrapped(),T=p.tileSize*_._cascades[l.currentShadowCascade].scale;let C=n.maxHeight;if(p.elevation){const Q=p.elevation.getMinMaxForTile(d);Q&&(C+=Q.max)}const D=[..._.shadowDirection];D[2]=-D[2];const z=_.computeSimplifiedTileShadowVolume(x,C,T,D);if(!z)return!1;const B=[q_,um,hm,D,[D[0],0,D[2]],[0,D[1],D[2]]],U=p.projection.name==="globe",V=p.scaleZoom(T),q=o.bN.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!U),K=_.getCurrentCascadeFrustum();return q.intersectsPrecise(z.vertices,z.planes,B)===0||K.intersectsPrecise(z.vertices,z.planes,B)===0}function dm(d){return[d[0]*o.d4,d[1]*o.d4,d[2]*o.d4,0]}function io(d,n,l,p,_,x,T,C,D){const z=p.getSource(),B=l.globeSharedBuffers;if(!B)return;let U,V,q;if(n&&(U=p.getTile(n)),z instanceof o.aD?(V=z.texture,q=o.cD(0,0,l.transform)):U&&n&&(V=U.texture,q=o.cD(n.canonical.z,n.canonical.x,l.transform)),!V||!q)return;d||(q=o.a6.mat4.scale(o.a6.mat4.create(),q,[1,-1,1]));const K=l.context,Q=K.gl,ee=_.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,re=l.colorModeForDrapableLayerRenderPass(x),me=T.defines;me.push("GLOBE_POLES");const ye=new Qt(Q.LEQUAL,Qt.ReadWrite,l.depthRangeFor3D),de=Float32Array.from(l.transform.expandedFarZProjMatrix),xe=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),K.activeTexture.set(Q.TEXTURE0),V.bind(ee,Q.CLAMP_TO_EDGE),K.activeTexture.set(Q.TEXTURE1),V.bind(ee,Q.CLAMP_TO_EDGE),V.useMipmap&&K.extTextureFilterAnisotropic&&l.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const[ve,Pe,Se,Ce]=n?B.getPoleBuffers(n.canonical.z,!1):B.getPoleBuffers(0,!0),Be=_.paint.get("raster-elevation");let Le;d?(Le=ve,l.renderDefaultNorthPole=Be!==0):(Le=Pe,l.renderDefaultSouthPole=Be!==0);const ke=dm(T.mix),Ve=((ft,et,vt,Ge,lt,ot,bt,St,ut,pt,Kt,Mt,Nt)=>Du(ft,et,vt,new Float32Array(16),new Float32Array(9),[0,0],Ge,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ot,[0,0],St,2,pt,Kt,Mt,1,0,Nt))(de,xe,q,o.a9(l.transform.zoom),0,_,0,Be,0,ke,T.offset,T.range,x),rt=l.getOrCreateProgram("raster",{defines:me});l.uploadCommonUniforms(K,rt,null),rt.draw(l,Q.TRIANGLES,ye,D,re,C,Ve,_.id,Le,Se,Ce)}function Cn(d){const n=d._nearZ,l=d.projection.farthestPixelDistance(d),p=l-n,_=.2*d.height,x=n+_;return[n,l,(x-_-n)/p,(x-n)/p]}function bf(d,n,l,p){if(d)return n instanceof $l&&d instanceof Fh?n.getTextureDescriptor(d,l,!0):{texture:d.texture,mix:dm(p.mix),offset:p.offset,buffer:0,tileSize:1}}var pm=o.d5([{name:"a_index",type:"Int16",components:1}]);class W_{constructor(n,l,p,_){const x={width:p[0],height:p[1],data:null},T=n.gl;this.targetColorTexture=new o.T(n,x,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,x,T.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,_),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,_=l.width*l.height;this.particleTexture0=new o.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.d6;x.reserve(_);for(let T=0;T<_;T++)x.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(x,pm.members,!0),this.particleSegment=o.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function H_(d,n,l){if(!d)return null;const p=n.getTextureDescriptor(d,l,!0);if(!p)return null;let{texture:_,mix:x,offset:T,tileSize:C,buffer:D,format:z}=p;if(!_||!z)return null;let B=!1;return z==="uint32"&&(B=!0,x[3]=0,x=ff(o.d7,x,[0,l.paint.get("raster-particle-max-speed")]),T=df(o.d7,T,[0,l.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[D/(C+2*D),C/(C+2*D)],tileSize:C,scalarData:B,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Z_(d){const n=d._nearZ,l=d.projection.farthestPixelDistance(d),p=l-n,_=.2*d.height,x=n+_;return[n,l,(x-_-n)/p,(x-n)/p]}const Cb=new o.bz(1,0,0,1),dc=new o.bz(0,1,0,1),pc=new o.bz(0,0,1,1),Et=new o.bz(1,0,1,1),Xt=new o.bz(0,1,1,1);function Jo(d,n,l,p,_,x,T){const C=d.context,D=d.transform,z=C.gl,B=D.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[];let V=o.a6.mat4.clone(l.projMatrix);if(B&&o.a9(D.zoom)>0){const ke=o.b4(l.canonical,D),Ve=o.d8(ke);V=o.a6.mat4.multiply(new Float32Array(16),D.globeMatrix,Ve),o.a6.mat4.multiply(V,D.projMatrix,V)}const q=o.a6.mat4.create();q[12]+=2*_/(o.q.devicePixelRatio*D.width),q[13]+=2*x/(o.q.devicePixelRatio*D.height),o.a6.mat4.multiply(V,q,V);const K=d.getOrCreateProgram("debug",{defines:U}),Q=n.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(Q,K);const ee=Qt.disabled,re=pr.disabled,me=d.colorModeForRenderPass(),ye="$debug";C.activeTexture.set(z.TEXTURE0),d.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(d.context,D):Q._makeDebugTileBoundsBuffers(d.context,D.projection);const de=Q._tileDebugBuffer||d.debugBuffer,xe=Q._tileDebugIndexBuffer||d.debugIndexBuffer,ve=Q._tileDebugSegments||d.debugSegments;if(K.draw(d,z.LINE_STRIP,ee,re,me,or.disabled,j_(V,p),ye,de,xe,ve,null,null,null,[Q._globeTileDebugBorderBuffer]),T){const ke=Q.latestRawTileData,Ve=Math.floor((ke&&ke.byteLength||0)/1024);let rt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(rt+=` => ${l.overscaledZ}`),rt+=` ${Q.state}`,rt+=` ${Ve}kb`,function(ft,et){ft.initDebugOverlayCanvas();const vt=ft.debugOverlayCanvas,Ge=ft.context.gl,lt=ft.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,vt.width,vt.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(et,5,5),lt.strokeText(et,5,5),ft.debugOverlayTexture.update(vt),ft.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(d,rt)}const Pe=n.getTile(l).tileSize,Se=512/Math.min(Pe,512)*(l.overscaledZ/D.zoom)*.5,Ce=Q._tileDebugTextBuffer||d.debugBuffer,Be=Q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Le=Q._tileDebugTextSegments||d.debugSegments;K.draw(d,z.TRIANGLES,ee,re,Mr.alphaBlended,or.disabled,j_(V,o.bz.transparent,Se),ye,Ce,Be,Le,null,null,null,[Q._globeTileDebugTextBuffer])}function xn(d,n,l,p){Bu(d,0,n+l/2,d.transform.width,l,p)}function Ze(d,n,l,p){Bu(d,n-l/2,0,l,d.transform.height,p)}function Bu(d,n,l,p,_,x){const T=d.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*o.q.devicePixelRatio,l*o.q.devicePixelRatio,p*o.q.devicePixelRatio,_*o.q.devicePixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}const wf=o.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mm}=wf;function Qo(d,n,l,p){d.emplaceBack(n,l,p)}class gm{constructor(n){this.vertexArray=new o.d9,this.indices=new o.aO,Qo(this.vertexArray,-1,-1,1),Qo(this.vertexArray,1,-1,1),Qo(this.vertexArray,-1,1,1),Qo(this.vertexArray,1,1,1),Qo(this.vertexArray,-1,-1,-1),Qo(this.vertexArray,1,-1,-1),Qo(this.vertexArray,-1,1,-1),Qo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,mm),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.b1.simpleSegment(0,0,36,12)}}function sl(d,n,l,p,_,x){const T=d.context.gl,C=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),B=((U,V,q,K,Q)=>({u_matrix_3f:U,u_sun_direction:V,u_sun_intensity:q,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(o.a6.mat3.fromMat4(o.a6.mat3.create(),p),_,z,C,D);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),l.draw(d,T.TRIANGLES,Qt.disabled,pr.disabled,Mr.unblended,or.frontCW,B,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const mc=o.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ob{constructor(n){const l=new o.da;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new o.aO;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,mc.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=o.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const kb=o.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class X_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Tf{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Mr([1,go,1,go],o.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mr([1,0,1,0],o.bz.transparent,[!1,!1,!1,!0]),this.params=new X_,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ob(l);const p=this.params.sizeRange,_=this.params.intensityRange,x=function(B){const U=o.dd(30),V=[];for(let q=0;q<B;++q){const K=2*Math.PI*U(),Q=Math.acos(1-2*U())-.5*Math.PI;V.push(o.a6.vec3.fromValues(Math.cos(Q)*Math.cos(K),Math.cos(Q)*Math.sin(K),Math.sin(Q)))}return V}(this.params.starsCount),T=o.dd(300),C=new o.db,D=new o.aO;let z=0;for(let B=0;B<x.length;++B){const U=o.a6.vec3.scale([],x[B],200),V=Math.max(0,1+.01*p*(1*T()-.5)),q=Math.max(0,1+.01*_*(1*T()-.5));C.emplaceBack(U[0],U[1],U[2],-1,-1,V,q),C.emplaceBack(U[0],U[1],U[2],1,-1,V,q),C.emplaceBack(U[0],U[1],U[2],1,1,V,q),C.emplaceBack(U[0],U[1],U[2],-1,1,V,q),D.emplaceBack(z+0,z+1,z+2),D.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=l.createVertexBuffer(C,kb.members),this.starsIdx=l.createIndexBuffer(D),this.starsSegments=o.b1.simpleSegment(0,0,C.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const p=n.context,_=p.gl,x=n.transform,T=new Qt(_.LEQUAL,Qt.ReadOnly,[0,1]),C=o.a9(x.zoom),D=n.style.getLut(l.scope),z=l.properties.get("color").toRenderColor(D).toArray01(),B=l.properties.get("high-color").toRenderColor(D).toArray01(),U=l.properties.get("space-color").toRenderColor(D).toArray01PremultipliedAlpha(),V=5e-4,q=o.dc(l.properties.get("horizon-blend"),0,1,V,.25),K=o.cx(n,p,x)&&q===V?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,Q=n.frameCounter/1e3%1,ee=o.a6.vec3.length(x.globeCenterInViewSpace),re=Math.sqrt(Math.pow(ee,2)-Math.pow(K,2)),me=Math.acos(re/ee),ye=de=>{const xe=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];de&&xe.push("ALPHA_PASS");const ve=n.getOrCreateProgram("globeAtmosphere",{defines:xe}),Pe=((Ce,Be,Le,ke,Ve,rt,ft,et,vt,Ge,lt,ot)=>({u_frustum_tl:Ce,u_frustum_tr:Be,u_frustum_br:Le,u_frustum_bl:ke,u_horizon:Ve,u_transition:rt,u_fadeout_range:ft,u_color:et,u_high_color:vt,u_space_color:Ge,u_temporal_offset:lt,u_horizon_angle:ot}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,C,q,z,B,U,Q,me);n.uploadCommonUniforms(p,ve);const Se=this.atmosphereBuffer;Se&&ve.draw(n,_.TRIANGLES,T,pr.disabled,de?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,or.backCW,Pe,de?"atmosphere_glow_alpha":"atmosphere_glow",Se.vertexBuffer,Se.indexBuffer,Se.segments)};ye(!1),ye(!0)}drawStars(n,l){const p=o.ap(l.properties.get("star-intensity"),0,1);if(p===0)return;const _=n.context,x=_.gl,T=n.transform,C=n.getOrCreateProgram("stars"),D=o.a6.quat.identity([]);o.a6.quat.rotateX(D,D,-T._pitch),o.a6.quat.rotateZ(D,D,-T.angle),o.a6.quat.rotateX(D,D,o.bB(T._center.lat)),o.a6.quat.rotateY(D,D,-o.bB(T._center.lng));const z=o.a6.mat4.fromQuat(new Float32Array(16),D),B=o.a6.mat4.multiply([],T.starsProjMatrix,z),U=o.a6.mat3.fromMat4([],z),V=o.a6.mat3.invert([],U),q=[0,1,0];o.a6.vec3.transformMat3(q,q,V),o.a6.vec3.scale(q,q,this.params.sizeMultiplier);const K=[1,0,0];o.a6.vec3.transformMat3(K,K,V),o.a6.vec3.scale(K,K,this.params.sizeMultiplier);const Q=(ee=q,re=K,me=p,{u_matrix:Float32Array.from(B),u_up:ee,u_right:re,u_intensity_multiplier:me});var ee,re,me;n.uploadCommonUniforms(_,C),this.starsVx&&this.starsIdx&&C.draw(n,x.TRIANGLES,Qt.disabled,pr.disabled,this.colorModeAlphaBlendedWriteRGB,or.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Sf(d,n){const l=[...d],p=n.cameraWorldSizeForFog/n.worldSize,_=o.a6.mat4.identity([]);return o.a6.mat4.scale(_,_,[p,p,1]),o.a6.mat4.multiply(l,_,l),o.a6.mat4.multiply(l,n.worldToFogMatrix,l),l}function Af(d,n,l,p,_){const x=l.material,T=p.context,{baseColorTexture:C,metallicRoughnessTexture:D}=x.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:B,emissionTexture:U}=x;function V(q,K,Q){if(q&&(d.push(K),T.activeTexture.set(T.gl.TEXTURE0+Q),q.gfxTexture)){const{minFilter:ee,magFilter:re,wrapS:me,wrapT:ye}=q.sampler;q.gfxTexture.bindExtraParam(ee,re,me,ye)}}V(C,"HAS_TEXTURE_u_baseColorTexture",wi.BaseColor),V(D,"HAS_TEXTURE_u_metallicRoughnessTexture",wi.MetallicRoughness),V(z,"HAS_TEXTURE_u_normalTexture",wi.Normal),V(B,"HAS_TEXTURE_u_occlusionTexture",wi.Occlusion),V(U,"HAS_TEXTURE_u_emissionTexture",wi.Emission),_&&(_.texture||(_.texture=new o.df(p.context,_.image,[_.image.height,_.image.height,_.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+wi.LUT),_.texture&&_.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(d.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Fu(d,n,l,p,_,x){const T=l.paint.get("model-opacity"),C=n.context,D=new Qt(n.context.gl.LEQUAL,Qt.ReadWrite,n.depthRangeFor3D),z=n.transform,B=d.mesh,U=B.material,V=U.pbrMetallicRoughness,q=n.style.fog;let K;K=n.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:o.a6.mat4.multiply([],p.zScaleMatrix,d.nodeModelMatrix),o.a6.mat4.multiply(K,p.negCameraPosMatrix,K);const Q=o.a6.mat4.invert([],K);o.a6.mat4.transpose(Q,Q);const ee=l.paint.get("model-emissive-strength").constantOr(0),re=$t(new Float32Array(d.worldViewProjection),new Float32Array(K),new Float32Array(Q),null,n,T,V.baseColorFactor.toRenderColor(null),U.emissiveFactor,V.metallicFactor,V.roughnessFactor,U,ee,l),me={defines:[]},ye=[];Af(me.defines,ye,B,n,l.lut);const de=n.shadowRenderer;de&&(de.useNormalOffset=!1);let xe=null;if(q){const Se=Sf(d.nodeModelMatrix,n.transform);if(xe=new Float32Array(Se),z.projection.name!=="globe"){const Ce=B.aabb.min,Be=B.aabb.max,[Le,ke]=q.getOpacityForBounds(Se,Ce[0],Ce[1],Be[0],Be[1]);me.overrideFog=Le>=zt||ke>=zt}}const ve=Wa(n,l.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Pe=n.getOrCreateProgram("model",me);n.uploadCommonUniforms(C,Pe,null,xe,ve),n.renderPass!=="shadow"&&de&&de.setupShadowsFromMatrix(d.nodeModelMatrix,Pe),Pe.draw(n,C.gl.TRIANGLES,D,_,x,B.material.doubleSided?or.disabled:or.backCCW,re,l.id,B.vertexBuffer,B.indexBuffer,B.segments,l.paint,n.transform.zoom,void 0,ye)}function Nu(d,n,l,p,_,x,T){let C;C=d.projection.name==="globe"?o.dg(l,d):[...l],o.a6.mat4.multiply(C,C,n.matrix);const D=o.a6.mat4.multiply([],p,C);if(n.meshes)for(const z of n.meshes){if(z.material.alphaMode!=="BLEND"){T.push({mesh:z,depth:0,modelIndex:_,worldViewProjection:D,nodeModelMatrix:C});continue}const B=o.a6.vec3.transformMat4([],z.centroid,D);B[2]>0&&x.push({mesh:z,depth:B[2],modelIndex:_,worldViewProjection:D,nodeModelMatrix:C})}if(n.children)for(const z of n.children)Nu(d,z,l,p,_,x,T)}function gc(d,n,l,p){const _=l.shadowRenderer;if(!_)return;const x=_.getShadowPassDepthMode(),T=_.getShadowPassColorMode(),C=_.calculateShadowPassMatrixFromMatrix(n),D=lm(C);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,x,pr.disabled,T,or.backCCW,D,p.id,d.vertexBuffer,d.indexBuffer,d.segments,p.paint,l.transform.zoom,void 0,void 0)}function Y_(d,n,l){const p=n.updateZoomBasedPaintProperties(),_=function(x,T,C){let D,z,B,U=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&U>0){const V=x.terrain,q=V.findDEMTileFor(C);q&&q.dem?D=o.di.create(V,C,q):U=0}if(U===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),U===T.validForExaggeration&&(U===0||D&&D._demTile&&D._demTile.tileID===T.validForDEMTile.id&&D._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const V in T.instancesPerModel){const q=T.instancesPerModel[V];for(let K=0;K<q.instancedDataArray.length;++K){const Q=(D?U*D.getElevationAt(0|q.instancedDataArray.float32[16*K],0|q.instancedDataArray.float32[16*K+1],!0,!0):0)+q.instancesEvaluatedElevation[K];q.instancedDataArray.float32[16*K+6]=Q,z=z?Math.min(T.terrainElevationMin,Q):Q,B=B?Math.max(T.terrainElevationMax,Q):Q}}return T.terrainElevationMin=z||0,T.terrainElevationMax=B||0,T.validForExaggeration=U,T.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,n,l);(p||_)&&(n.uploaded=!1,n.upload(d.context))}const ea={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.c9([0,0,0],[o.ab,o.ab,0])};function Db(d,n){const l=1<<d.canonical.z,p=n.getFreeCameraOptions().position,_=n.elevation,x=d.canonical.x/l,T=(d.canonical.x+1)/l,C=d.canonical.y/l,D=(d.canonical.y+1)/l;let z=n._centerAltitude;if(_){const q=_.getMinMaxForTile(d);q&&q.max>z&&(z=q.max)}const B=o.ap(p.x,x,T)-p.x,U=o.ap(p.y,C,D)-p.y,V=o.bD(z,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(B*B+U*U+V*V))}function Li(d,n,l,p,_,x,T){const C=d.context,D=d.renderPass==="shadow",z=d.shadowRenderer,B=D&&z?z.getShadowPassDepthMode():new Qt(C.gl.LEQUAL,Qt.ReadWrite,d.depthRangeFor3D),U=d.isTileAffectedByFog(x);if(l.meshes)for(const V of l.meshes){const q=["MODEL_POSITION_ON_GPU"],K=[];let Q,ee,re;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const me=Wa(d,n.paint.get("model-cutoff-fade-range"));if(me.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),D&&z)Q=d.getOrCreateProgram("modelDepth",{defines:q}),ee=lm(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(l.matrix)),re=z.getShadowPassColorMode();else{Af(q,K,V,d,n.lut),Q=d.getOrCreateProgram("model",{defines:q,overrideFog:U});const de=V.material,xe=de.pbrMetallicRoughness,ve=n.paint.get("model-opacity"),Pe=n.paint.get("model-emissive-strength").constantOr(0);ee=$t(x.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,d,ve,xe.baseColorFactor.toRenderColor(null),de.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,de,Pe,n,_),z&&(T.shadowUniformsInitialized?Q.setShadowUniformValues(C,z.getShadowUniformValues()):(z.setupShadows(x.toUnwrapped(),Q,"model-tile",x.overscaledZ),T.shadowUniformsInitialized=!0)),re=me.shouldRenderCutoff||ve<1||de.alphaMode!=="OPAQUE"?Mr.alphaBlended:Mr.unblended}d.uploadCommonUniforms(C,Q,x.toUnwrapped(),null,me);const ye=V.material.doubleSided?or.disabled:or.backCCW;if(p.instancedDataArray.length>20)K.push(p.instancedDataBuffer),Q.draw(d,C.gl.TRIANGLES,B,pr.disabled,re,ye,ee,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,d.transform.zoom,void 0,K,p.instancedDataArray.length);else{const de=D?"u_instance":"u_normal_matrix";for(let xe=0;xe<p.instancedDataArray.length;++xe)ee[de]=new Float32Array(p.instancedDataArray.arrayBuffer,64*xe,16),Q.draw(d,C.gl.TRIANGLES,B,pr.disabled,re,ye,ee,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,d.transform.zoom,void 0,K)}}if(l.children)for(const V of l.children)Li(d,n,V,p,_,x,T)}const Lb=[1,-1,1];function ju(d,n,l,p){if(!l.modelManager)return!0;const _=l.modelManager;if(!l.shadowRenderer)return!0;const x=l.shadowRenderer,T=n.aabb;let C=!0,D=d.maxHeight;if(D===0){let B=0;for(const U in d.instancesPerModel){const V=_.getModel(U,p);V?B=Math.max(B,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):C=!1}D=d.maxScale*B*1.41+d.maxVerticalOffset,C&&(d.maxHeight=D)}T.max[2]=D,T.min[2]+=d.terrainElevationMin,T.max[2]+=d.terrainElevationMax,o.a6.vec3.transformMat4(T.min,T.min,n.tileMatrix),o.a6.vec3.transformMat4(T.max,T.max,n.tileMatrix);const z=T.intersects(x.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=z===2),z===0}function mn(d,n){const l=d.uniformValues.u_cutoff_params[0],p=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return p===l||x===_?1:o.ap(((n-l)/(p-l)-_)/(x-_),0,1)}function Fr(d,n,l,p){if(n.pitch<20)return 1;const _=n.getWorldToCameraMatrix();o.a6.mat4.multiply(_,_,d);const x=o.a6.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let T=o.a6.vec4.transformMat4(o.a6.vec4.create(),x,_),C=T,D=T;x[1]=l.max[1],T=o.a6.vec4.transformMat4(o.a6.vec4.create(),x,_),C=T[1]<C[1]?T:C,D=T[1]>D[1]?T:D,x[0]=l.max[0],T=o.a6.vec4.transformMat4(o.a6.vec4.create(),x,_),C=T[1]<C[1]?T:C,D=T[1]>D[1]?T:D,x[1]=l.min[1],T=o.a6.vec4.transformMat4(o.a6.vec4.create(),x,_),C=T[1]<C[1]?T:C,D=T[1]>D[1]?T:D;const z=o.ap(p[0],0,1),B=100*n.pixelsPerMeter*o.ap(p[1],0,1),U=o.ap(p[2],0,1),V=o.a6.vec4.lerp(o.a6.vec4.create(),C,D,z),q=Math.tan(.5*n.fovX),K=-V[2]*q;if(B===0)return V[1]<-Math.abs(K)?U:1;const Q=(-Math.abs(K)-V[1])/B,ee=(me,ye,de)=>(1-de)*me+de*ye,re=o.ap(ee(1,U,Q),U,1);return ee(1,re,o.ap((n.pitch-20)/20,0,1))}class K_{}class Es{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,p){{const U=this._storage.get(l.id);if(U)return U.lastUsedFrameIdx=n,U.buf}const _=p.gl,x=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),T=new ArrayBuffer(x),C=new Int16Array(T);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const D=new o.dk;for(let U=0;U<x/2;U+=3){const V=C[U],q=C[U+1],K=C[U+2];D.emplaceBack(V,q),D.emplaceBack(q,K),D.emplaceBack(K,V)}const z=p.bindVertexArrayOES.current,B=new K_;return B.buf=new no(p,D),B.lastUsedFrameIdx=n,this._storage.set(l.id,B),p.bindVertexArrayOES.set(z),B.buf}update(n){for(const[l,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}class Ef{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ms={symbol:function(d,n,l,p,_){if(d.renderPass!=="translucent")return;const x=pr.disabled,T=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(z,B,U,V,q,K,Q){const ee=B.transform,re=q==="map",me=K==="map";for(const ye of z){const de=V.getTile(ye),xe=de.getBucket(U);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const ve=o.bj(xe.textSizeData,ee.zoom),Pe=xs(ye,xe.getProjection(),ee),Se=ee.calculatePixelsToTileUnitsMatrix(de),Ce=Cr(Pe,de.tileID.canonical,me,re,ee,xe.getProjection(),Se),Be=xe.hasIconTextFit()&&xe.hasIconData();if(ve){const Le=Math.pow(2,ee.zoom-de.tileID.overscaledZ);Ib(xe,re,me,Q,o.cS,ee,Ce,ye,Le,ve,Be)}}}(p,d,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_);const C=l.paint.get("icon-opacity").constantOr(1)!==0,D=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||D)?Ru(d,n,l,p,x,T):(C&&Ru(d,n,l,p,x,T,{onlyIcons:!0}),D&&Ru(d,n,l,p,x,T,{onlyText:!0})),n.map.showCollisionBoxes&&(vf(d,n,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),vf(d,n,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,l,p){if(d.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),C=l.layout.get("circle-sort-key").constantOr(1)!==void 0,D=l.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const z=d.context,B=z.gl,U=d.transform,V=d.depthModeForSublayer(0,Qt.ReadOnly),q=pr.disabled,K=d.colorModeForDrapableLayerRenderPass(D),Q=U.projection.name==="globe",ee=[o.am(U.center.lng),o.at(U.center.lat)],re=[];for(let ye=0;ye<p.length;ye++){const de=p[ye],xe=n.getTile(de),ve=xe.getBucket(l);if(!ve||ve.projection.name!==U.projection.name)continue;const Pe=ve.programConfigurations.get(l.id),Se=o.cT(l),Ce=d.isTileAffectedByFog(de);Q&&Se.push("PROJECTION_GLOBE_VIEW"),Se.push("DEPTH_D24"),d.terrain&&U.depthOcclusionForSymbolsAndCircles&&Se.push("DEPTH_OCCLUSION");const Be=d.getOrCreateProgram("circle",{config:Pe,defines:Se,overrideFog:Ce}),Le=ve.layoutVertexBuffer,ke=ve.globeExtVertexBuffer,Ve=ve.indexBuffer,rt=U.projection.createInversionMatrix(U,de.canonical),ft={programConfiguration:Pe,program:Be,layoutVertexBuffer:Le,globeExtVertexBuffer:ke,indexBuffer:Ve,uniformValues:o.cU(d,de,xe,rt,ee,l),tile:xe};if(C){const et=ve.segments.get();for(const vt of et)re.push({segments:new o.b1([vt]),sortKey:vt.sortKey,state:ft})}else re.push({segments:ve.segments,sortKey:0,state:ft})}C&&re.sort((ye,de)=>ye.sortKey-de.sortKey);const me={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const ye of re){const{programConfiguration:de,program:xe,layoutVertexBuffer:ve,globeExtVertexBuffer:Pe,indexBuffer:Se,uniformValues:Ce,tile:Be}=ye.state,Le=ye.segments;d.terrain&&d.terrain.setupElevationDraw(Be,xe,me),d.uploadCommonUniforms(z,xe,Be.tileID.toUnwrapped()),xe.draw(d,B.TRIANGLES,V,q,K,or.disabled,Ce,l.id,ve,Se,Le,l.paint,U.zoom,de,[Pe])}},heatmap:function(d,n,l,p){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,x=_.gl,T=pr.disabled,C=new Mr([x.ONE,x.ONE,x.ONE,x.ONE],o.bz.transparent,[!0,!0,!0,!0]);(function(q,K,Q,ee){const re=q.gl,me=K.width*ee,ye=K.height*ee;q.activeTexture.set(re.TEXTURE1),q.viewport.set([0,0,me,ye]);let de=Q.heatmapFbo;if(!de||de&&(de.width!==me||de.height!==ye)){de&&de.destroy();const xe=re.createTexture();re.bindTexture(re.TEXTURE_2D,xe),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),de=Q.heatmapFbo=q.createFramebuffer(me,ye,!0,null),function(ve,Pe,Se,Ce,Be,Le){const ke=ve.gl;ke.texImage2D(ke.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Be,Le,0,ke.RGBA,ve.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Se)}(q,0,xe,de,me,ye)}else re.bindTexture(re.TEXTURE_2D,de.colorAttachment.get()),q.bindFramebuffer.set(de.framebuffer)})(_,d,l,d.transform.projection.name==="globe"?.5:.25),_.clear({color:o.bz.transparent});const D=d.transform,z=D.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[],U=z?or.frontCCW:or.disabled,V=[o.am(D.center.lng),o.at(D.center.lat)];for(let q=0;q<p.length;q++){const K=p[q];if(n.hasRenderableParent(K))continue;const Q=n.getTile(K),ee=Q.getBucket(l);if(!ee||ee.projection.name!==D.projection.name)continue;const re=d.isTileAffectedByFog(K),me=ee.programConfigurations.get(l.id),ye=d.getOrCreateProgram("heatmap",{config:me,defines:B,overrideFog:re}),{zoom:de}=d.transform;d.terrain&&d.terrain.setupElevationDraw(Q,ye),d.uploadCommonUniforms(_,ye,K.toUnwrapped());const xe=D.projection.createInversionMatrix(D,K.canonical);ye.draw(d,x.TRIANGLES,Qt.disabled,T,C,U,Eb(d,K,Q,xe,V,de,l.paint.get("heatmap-intensity")),l.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,l.paint,d.transform.zoom,me,z?[ee.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,x){const T=_.context,C=T.gl,D=x.heatmapFbo;if(!D)return;T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(C.TEXTURE1);let z=x.colorRampTexture;z||(z=x.colorRampTexture=new o.T(T,x.colorRamp,C.RGBA8)),z.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,C.TRIANGLES,Qt.disabled,pr.disabled,_.colorModeForRenderPass(),or.disabled,((B,U,V,q)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(d,l))},line:function(d,n,l,p){if(d.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const T=l.paint.get("line-emissive-strength"),C=l.paint.get("line-occlusion-opacity"),D=d.context,z=D.gl,B=l.layout.get("line-z-offset"),U=!B.isConstant()||!!B.constantOr(0),V=U?new Qt(d.depthOcclusion?z.GREATER:z.LEQUAL,Qt.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,Qt.ReadOnly),q=d.colorModeForDrapableLayerRenderPass(T),K=d.terrain&&d.terrain.renderingToTexture,Q=K?1:o.q.devicePixelRatio,ee=l.paint.get("line-dasharray"),re=ee.constantOr(1),me=l.layout.get("line-cap"),ye=ee.constantOr(null),de=me.constantOr(null),xe=l.paint.get("line-pattern"),ve=xe.constantOr(1),Pe=xe.constantOr(null),Se=l.paint.get("line-opacity").constantOr(1);let Ce=!ve&&Se!==1||d.depthOcclusion&&C>0&&C<1;const Be=l.paint.get("line-gradient"),Le=ve?"linePattern":"line",ke=o.cV(l);let Ve;if(K&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Ce=!1),C!==0&&d.depthOcclusion){const ft=l.paint._values["line-opacity"];ft&&ft.value&&ft.value.kind==="constant"?Ve=ft.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(d.forceTerrainMode=!0),!U&&C!==0&&d.terrain&&!K)return void o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const rt=Ce&&U?d.stencilModeFor3D():pr.disabled;for(const ft of p){const et=n.getTile(ft);if(ve&&!et.patternsLoaded())continue;const vt=et.getBucket(l);if(!vt)continue;d.prepareDrawTile();const Ge=vt.programConfigurations.get(l.id),lt=d.isTileAffectedByFog(ft),ot=d.getOrCreateProgram(Le,{config:Ge,defines:U?[...ke,"ELEVATED"]:ke,overrideFog:lt});if(Pe&&et.imageAtlas){const Mt=et.imageAtlas.patternPositions[Pe.toString()];Mt&&Ge.setConstantPatternPositions(Mt)}if(!ve&&ye&&de&&et.lineAtlas){const Mt=et.lineAtlas.getDash(ye,de);Mt&&Ge.setConstantPatternPositions(Mt)}let[bt,St]=l.paint.get("line-trim-offset");(de==="round"||de==="square")&&bt!==St&&(bt===0&&(bt-=1),St===1&&(St+=1));const ut=K?ft.projMatrix:null,pt=ve?o.cW(d,et,l,ut,Q,[bt,St]):o.cX(d,et,l,ut,vt.lineClipsArray.length,Q,[bt,St]);if(Be){const Mt=vt.gradients[l.id];let Nt=Mt.texture;if(l.gradientVersion!==Mt.version){let ir=256;if(l.stepInterpolant){const Gt=n.getSource().maxzoom,er=ft.canonical.z===Gt?Math.ceil(1<<d.transform.maxZoom-ft.canonical.z):1;ir=o.ap(o.cY(vt.maxLineLength/o.ab*1024*er),256,D.maxTextureSize)}Mt.gradient=o.cZ({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:ir,image:Mt.gradient||void 0,clips:vt.lineClipsArray}),Mt.texture?Mt.texture.update(Mt.gradient):Mt.texture=new o.T(D,Mt.gradient,z.RGBA8),Mt.version=l.gradientVersion,Nt=Mt.texture}D.activeTexture.set(z.TEXTURE1),Nt.bind(l.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}re&&(D.activeTexture.set(z.TEXTURE0),et.lineAtlasTexture&&et.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),Ge.updatePaintBuffers()),ve&&(D.activeTexture.set(z.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ge.updatePaintBuffers()),U&&d.terrain.setupElevationDraw(et,ot),d.uploadCommonUniforms(D,ot,ft.toUnwrapped());const Kt=Mt=>{Ve!=null&&(Ve.value=Se*C),ot.draw(d,z.TRIANGLES,V,Mt,q,or.disabled,pt,l.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,l.paint,d.transform.zoom,Ge,[vt.layoutVertexBuffer2,vt.patternVertexBuffer,vt.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=Se)};if(Ce&&!U){const Mt=d.stencilModeForClipping(ft).ref;Mt===0&&K&&D.clear({stencil:0});const Nt={func:z.EQUAL,mask:255};pt.u_alpha_discard_threshold=.8,Kt(new pr(Nt,Mt,255,z.KEEP,z.KEEP,z.INVERT)),pt.u_alpha_discard_threshold=0,Kt(new pr(Nt,Mt,255,z.KEEP,z.KEEP,z.KEEP))}else Ce&&U&&(pt.u_alpha_discard_threshold=.001),Kt(U?rt:d.stencilModeForClipping(ft))}Ce&&(d.resetStencilClippingMasks(),K&&D.clear({stencil:0})),C===0||d.depthOcclusion||K||d.layersWithOcclusionOpacity.push(d.currentLayer),U&&(d.forceTerrainMode=!1)},fill:function(d,n,l,p){const _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity"),T=l.is3D(),C=new Qt(d.context.gl.LEQUAL,Qt.ReadWrite,d.depthRangeFor3D);if(x.constantOr(1)===0)return;const D=l.paint.get("fill-emissive-strength"),z=d.colorModeForDrapableLayerRenderPass(D),B=l.paint.get("fill-pattern"),U=d.opaquePassEnabledForLayer()&&!B.constantOr(1)&&_.constantOr(o.bz.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===U){const V=T?C:d.depthModeForSublayer(1,d.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);xf(d,n,l,p,V,z,!1)}if(!T&&d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const V=T?C:d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);xf(d,n,l,p,V,z,!0)}},"fill-extrusion":function(d,n,l,p){const _=l.paint.get("fill-extrusion-opacity"),x=d.context,T=x.gl,C=d.terrain,D=C&&C.renderingToTexture;if(_===0)return;const z=d.conflationActive&&d.style.isLayerClipped(l,n.getSource()),B=d.style.order.indexOf(l.fqid);if(z&&function(U,V,q,K,Q){for(const ee of K){const re=V.getTile(ee).getBucket(q);re&&(re.updateReplacement(ee,U.replacementSource,Q),re.uploadCentroid(U.context))}}(d,n,l,p,B),C||z)for(const U of p){const V=n.getTile(U).getBucket(l);V&&As(d.context,n,U,V,l,C,z)}if(d.renderPass==="shadow"&&d.shadowRenderer){const U=d.shadowRenderer;if(C&&_<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.a4)return;const V=U.getShadowPassDepthMode(),q=U.getShadowPassColorMode();fc(d,n,l,p,V,pr.disabled,q,z)}else if(d.renderPass==="translucent"){const U=!l.paint.get("fill-extrusion-pattern").constantOr(1),V=l.paint.get("fill-extrusion-color").constantOr(o.bz.white);if(!D&&V.a!==0){const q=new Qt(d.context.gl.LEQUAL,Qt.ReadWrite,d.depthRangeFor3D);_===1&&U?fc(d,n,l,p,q,pr.disabled,Mr.unblended,z):(fc(d,n,l,p,q,pr.disabled,Mr.disabled,z),fc(d,n,l,p,q,d.stencilModeFor3D(),d.colorModeForRenderPass(),z),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&U&&(!C&&d.transform.projection.name!=="globe"||D)){const q=l.paint.get("fill-extrusion-opacity"),K=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=l.paint.get("fill-extrusion-flood-light-intensity"),re=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),me=K>0&&Q>0,ye=ee>0,de=(ve,Pe,Se)=>(1-Se)*ve+Se*Pe,xe=ve=>{const Pe=d.depthModeForSublayer(1,Qt.ReadOnly,T.LEQUAL,!0),Se=l.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=de(.1,3,Se),Be=d._showOverdrawInspector;if(!Be){const Le=new pr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ke=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.bz.transparent,[!1,!1,!1,!0],T.MIN);pi(d,n,l,p,Pe,Le,ke,or.disabled,ve,"sdf",q,K,Q,ee,re,Ce,z,!1)}{const Le=Be?pr.disabled:new pr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ke=Be?d.colorModeForRenderPass():new Mr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],o.bz.transparent,[!0,!0,!0,!0]);pi(d,n,l,p,Pe,Le,ke,or.disabled,ve,"color",q,K,Q,ee,re,Ce,z,!1)}};if(D){const ve=(Pe,Se,Ce)=>{const Be=d.depthModeForSublayer(1,Qt.ReadOnly,T.LEQUAL,!1),Le=l.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=de(.1,3,Le);{const Ve=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.bz.transparent,[!1,!1,!1,!0]);pi(d,n,l,p,Be,pr.disabled,Ve,or.disabled,Pe,"clear",q,K,Q,ee,re,ke,z,Se)}{const Ve=new pr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),rt=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],o.bz.transparent,[!1,!1,!1,!0],T.MIN);pi(d,n,l,p,Be,Ve,rt,or.disabled,Pe,"sdf",q,K,Q,ee,re,ke,z,Se)}{const Ve=Pe?T.ZERO:T.ONE_MINUS_DST_ALPHA,rt=new pr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ft=new Mr([Ve,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],o.bz.transparent,[!0,!0,!0,!0]);pi(d,n,l,p,Be,rt,ft,or.disabled,Pe,"color",q,K,Q,ee,re,ke,z,Se)}{const Ve=new Mr([T.ONE,T.ONE,T.ONE,Pe?T.ZERO:T.ONE],o.bz.transparent,[!1,!1,!1,!0],Pe?T.FUNC_ADD:T.MAX);pi(d,n,l,p,Be,pr.disabled,Ve,or.disabled,Pe,"clear",q,K,Q,ee,re,ke,z,Se,Ce)}};if(me||ye){let Pe;if(d.prepareDrawTile(),C){const Se=C.drapeBufferSize[0],Ce=C.drapeBufferSize[1];Pe=C.framebufferCopyTexture,Pe&&(!Pe||Pe.size[0]===Se&&Pe.size[1]===Ce)||(Pe&&Pe.destroy(),Pe=C.framebufferCopyTexture=new o.T(x,new o.r({width:Se,height:Ce}),T.RGBA8)),Pe.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,0,0,Se,Ce,0)}me&&ve(!0,!1,Pe),ye&&ve(!1,!0,Pe)}}else me&&xe(!0),ye&&xe(!1),(me||ye)&&d.resetStencilClippingMasks()}}},hillshade:function(d,n,l,p){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const _=d.context,x=d.terrain&&d.terrain.renderingToTexture,[T,C]=d.renderPass!=="translucent"||x?[{},p]:d.stencilConfigForOverlap(p);for(const D of C){const z=n.getTile(D);if(z.needsHillshadePrepare&&d.renderPass==="offscreen")Eu(d,z,l);else if(d.renderPass==="translucent"){const B=d.depthModeForSublayer(0,Qt.ReadOnly),U=l.paint.get("hillshade-emissive-strength"),V=d.colorModeForDrapableLayerRenderPass(U),q=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(D):T[D.overscaledZ];tf(d,D,z,l,B,q,V)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,l,p,_,x){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const T=d.transform.projection.name==="globe",C=l.paint.get("raster-elevation")!==0,D=C&&T;if(d.renderElevatedRasterBackface&&!D)return;const z=d.context,B=z.gl,U=n.getSource(),V=function(ve,Pe,Se,Ce){const Be=Pe.paint.get("raster-color"),Le=ve.type==="raster-array",ke=[],Ve=Pe.paint.get("raster-resampling"),rt=Pe.paint.get("raster-color-mix");let ft=Pe.paint.get("raster-color-range");const et=[rt[0],rt[1],rt[2],0],vt=rt[3];let Ge=Ve==="nearest"?Ce.NEAREST:Ce.LINEAR;if(Le&&(ke.push("RASTER_ARRAY"),Be||ke.push("RASTER_COLOR"),Ve==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),Ge=Ce.NEAREST,!ft&&ve.rasterLayers)){const lt=ve.rasterLayers.find(({id:ot})=>ot===Pe.sourceLayer);lt&&lt.fields&&lt.fields.range&&(ft=lt.fields.range)}if(ft=ft||[0,1],Be){ke.push("RASTER_COLOR"),Se.activeTexture.set(Ce.TEXTURE2),Pe.updateColorRamp(ft);let lt=Pe.colorRampTexture;lt||(lt=Pe.colorRampTexture=new o.T(Se,Pe.colorRamp,Ce.RGBA8)),lt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}return{mix:et,range:ft,offset:vt,defines:ke,resampling:Ge}}(U,l,z,B);if(U instanceof o.aD&&!p.length&&!T)return;const q=l.paint.get("raster-emissive-strength"),K=d.colorModeForDrapableLayerRenderPass(q),Q=d.terrain&&d.terrain.renderingToTexture,ee=!d.options.moving,re=l.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(U instanceof o.aD&&!p.length&&(U.onNorthPole||U.onSouthPole)){const ve=C?d.stencilModeFor3D():pr.disabled;return void io(!!U.onNorthPole,null,d,n,l,q,V,or.disabled,ve)}if(!p.length)return;const[me,ye]=U instanceof o.aD||Q?[{},p]:d.stencilConfigForOverlap(p),de=ye[ye.length-1].overscaledZ;D&&V.defines.push("PROJECTION_GLOBE_VIEW"),C&&V.defines.push("RENDER_CUTOFF");const xe=(ve,Pe,Se)=>{for(const Ce of ve){const Be=Ce.toUnwrapped(),Le=n.getTile(Ce);if(Q&&(!Le||!Le.hasData()))continue;z.activeTexture.set(B.TEXTURE0);const ke=bf(Le,U,l,V);if(!ke||!ke.texture)continue;const{texture:Ve,mix:rt,offset:ft,tileSize:et,buffer:vt}=ke;let Ge,lt;Q?(Ge=Qt.disabled,lt=Ce.projMatrix):C?(Ge=new Qt(B.LEQUAL,Qt.ReadWrite,d.depthRangeFor3D),lt=T?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Be,ee)):(Ge=d.depthModeForSublayer(Ce.overscaledZ-de,l.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,B.LESS),lt=d.transform.calculateProjMatrix(Be,ee));const ot=d.terrain&&Q?d.terrain.stencilModeForRTTOverlap(Ce):me[Ce.overscaledZ],bt=x?0:l.paint.get("raster-fade-duration");Le.registerFadeDuration(bt);const St=n.findLoadedParent(Ce,0),ut=cf(Le,St,n,d.transform,bt);let pt,Kt;d.terrain&&d.terrain.prepareDrawTile(),z.activeTexture.set(B.TEXTURE0),Ve.bind(re,B.CLAMP_TO_EDGE),z.activeTexture.set(B.TEXTURE1),St?(St.texture&&St.texture.bind(re,B.CLAMP_TO_EDGE),pt=Math.pow(2,St.tileID.overscaledZ-Le.tileID.overscaledZ),Kt=[Le.tileID.canonical.x*pt%1,Le.tileID.canonical.y*pt%1]):Ve.bind(re,B.CLAMP_TO_EDGE),Ve.useMipmap&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Mt=d.transform;let Nt;const ir=C?Cn(Mt):[0,0,0,0];let Gt,er,Tr,vr,Xr,rn=0;if(D&&U instanceof o.aD&&U.coordinates.length>3)Gt=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0)))),er=Float32Array.from(Mt.globeMatrix),Tr=Float32Array.from(o.cy(Mt)),vr=[o.am(Mt.center.lng),o.at(Mt.center.lat)],Nt=U.elevatedGlobePerspectiveTransform,Xr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Ir=o.cz(Ce.canonical);rn=o.cA(Ir.getCenter().lat),Gt=Float32Array.from(o.b5(o.cC(Ce.canonical))),er=Float32Array.from(Mt.globeMatrix),Tr=Float32Array.from(o.cy(Mt)),vr=[o.am(Mt.center.lng),o.at(Mt.center.lat)],Nt=[0,0],Xr=Float32Array.from(o.cB(Ce.canonical,Ir,rn,Mt.worldSize/Mt._pixelsPerMercatorPixel))}else Nt=U instanceof o.aD?U.perspectiveTransform:[0,0],Gt=new Float32Array(16),er=new Float32Array(9),Tr=new Float32Array(16),vr=[0,0],Xr=new Float32Array(9);const fn=Du(lt,Gt,er,Tr,Xr,Kt||[0,0],o.a9(d.transform.zoom),vr,ir,pt||1,ut,l,Nt,C?l.paint.get("raster-elevation"):0,2,rt,ft,V.range,et,vt,q),ko=d.isTileAffectedByFog(Ce),Nn=d.getOrCreateProgram("raster",{defines:V.defines,overrideFog:ko});if(d.uploadCommonUniforms(z,Nn,Be),U instanceof o.aD){const Ir=U.elevatedGlobeVertexBuffer,Qr=U.elevatedGlobeIndexBuffer;if(Q||!T)U.boundsBuffer&&U.boundsSegments&&Nn.draw(d,B.TRIANGLES,Ge,pr.disabled,K,or.disabled,fn,l.id,U.boundsBuffer,d.quadTriangleIndexBuffer,U.boundsSegments);else if(Ir&&Qr){const bn=Mt.zoom<=o.c2?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Mt.center.lng);bn&&Nn.draw(d,B.TRIANGLES,Ge,pr.disabled,K,Pe,fn,l.id,Ir,Qr,bn)}}else if(D){Ge=new Qt(B.LEQUAL,Qt.ReadOnly,d.depthRangeFor3D);const Ir=d.globeSharedBuffers;if(Ir){const[Qr,bn,Jr]=Ir.getGridBuffers(rn,!1);Nn.draw(d,B.TRIANGLES,Ge,Se||ot,d.colorModeForRenderPass(),Pe,fn,l.id,Qr,bn,Jr)}}else{const{tileBoundsBuffer:Ir,tileBoundsIndexBuffer:Qr,tileBoundsSegments:bn}=d.getTileBoundsBuffers(Le);Nn.draw(d,B.TRIANGLES,Ge,ot,K,or.disabled,fn,l.id,Ir,Qr,bn)}}if(!(U instanceof o.aD)&&D)for(const Ce of ve){const Be=Ce.canonical.y===(1<<Ce.canonical.z)-1;Ce.canonical.y===0&&io(!0,Ce,d,n,l,q,V,Pe,Se||pr.disabled),Be&&io(!1,Ce,d,n,l,q,V,Pe===or.frontCW?or.backCW:or.frontCW,Se||pr.disabled)}};D?xe(ye,d.renderElevatedRasterBackface?or.backCW:or.frontCW,d.stencilModeFor3D()):xe(ye,or.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,n,l,p,_,x){d.renderPass==="offscreen"&&function(T,C,D,z){if(!z.length)return;const B=T.context,U=B.gl,V=C.getSource();if(!(V instanceof $l))return;const q=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let K=D.particlePositionRGBAImage;if(!K||K.width!==q){const ye=function(de){const xe=de*de,ve=new Uint8Array(4*xe),Pe=function(Ce){return Ce|=0,Ce=Math.imul(2747636419^Ce,2654435769),Ce=Math.imul(Ce^Ce>>>16,2654435769),((Ce=Math.imul(Ce^Ce>>>16,2654435769))>>>0)/4294967296},Se=1/1.1;for(let Ce=0;Ce<xe;Ce++){const Be=Se*(Pe(2*Ce+0)+_a),Le=Se*(Pe(2*Ce+1)+_a),ke=255*Be%1,Ve=255*Le%1,rt=ke,ft=Le-Ve/255,et=Ve;ve[4*Ce+0]=255*(Be-ke/255),ve[4*Ce+1]=255*rt,ve[4*Ce+2]=255*ft,ve[4*Ce+3]=255*et}return ve}(q);K=D.particlePositionRGBAImage=new o.r({width:q,height:q},ye)}let Q=D.particleFramebuffer;Q?Q.width!==q&&(Q.destroy(),Q=D.particleFramebuffer=B.createFramebuffer(q,q,!0,null)):Q=D.particleFramebuffer=B.createFramebuffer(q,q,!0,null);const ee=[];for(const ye of z){const de=C.getTile(ye);if(!(de instanceof Fh))continue;const xe=H_(de,V,D);if(!xe)continue;const ve=[de.tileSize,de.tileSize];let Pe=D.tileFramebuffer;Pe||(Pe=D.tileFramebuffer=B.createFramebuffer(ve[0],ve[1],!0,null));let Se=de.rasterParticleState;Se||(Se=de.rasterParticleState=new W_(B,ye,ve,K));const Ce=Se.update(D.lastInvalidatedAt);Se.particleTextureDimension!==q&&Se.updateParticleTexture(ye,K);const Be=Se.targetColorTexture;Se.targetColorTexture=Se.backgroundColorTexture,Se.backgroundColorTexture=Be;const Le=Se.particleTexture0;Se.particleTexture0=Se.particleTexture1,Se.particleTexture1=Le,ee.push([ye,xe,Se,Ce])}if(ee.length===0)return;const re=o.q.now(),me=D.previousDrawTimestamp?.001*(re-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=re,D.hasColorMap()){B.activeTexture.set(U.TEXTURE0+2);let ye=D.colorRampTexture;ye||(ye=D.colorRampTexture=new o.T(B,D.colorRamp,U.RGBA8)),ye.bind(U.LINEAR,U.CLAMP_TO_EDGE)}B.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(ye,de,xe){const ve=ye.context,Pe=ve.gl,Se=de.tileFramebuffer;ve.activeTexture.set(Pe.TEXTURE0);const Ce={u_texture:0,u_opacity:1.05*(Le=de.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},Be=ye.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const ke of xe){const[,,Ve,rt]=ke;Se.colorAttachment.set(Ve.targetColorTexture.texture),ve.viewport.set([0,0,Se.width,Se.height]),ve.clear({color:o.bz.transparent}),rt&&(Ve.backgroundColorTexture.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE),Be.draw(ye,Pe.TRIANGLES,Qt.disabled,pr.disabled,Mr.alphaBlended,or.disabled,Ce,de.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments))}}(T,D,ee),function(ye,de,xe,ve){const Pe=ye.context,Se=Pe.gl,Ce=xe.tileFramebuffer,Be=ye.transform.projection.name==="globe",Le=xe.paint.get("raster-particle-max-speed");for(const ke of ve){const[Ve,rt,ft]=ke;Pe.activeTexture.set(Se.TEXTURE0+0),rt.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),Ce.colorAttachment.set(ft.targetColorTexture.texture);const et=ye.getOrCreateProgram("rasterParticleDraw",{defines:rt.defines,overrideFog:!1});Pe.activeTexture.set(Se.TEXTURE0+1);const vt=rt.scalarData?[]:[0,1,2,3].map(ot=>o.c$[ot](Ve));vt.push(Ve);const Ge=Ve.canonical.x,lt=Ve.canonical.y;for(const ot of vt){const bt=de.getTile(Be?ot.wrapped():ot);if(!bt)continue;const St=bt.rasterParticleState;if(!St)continue;const ut=ot.canonical.x+(1<<ot.canonical.z)*(ot.wrap-Ve.wrap),pt=ot.canonical.y;St.particleTexture0.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);const Kt=pf(1,St.particleTexture0.size[0],[ut-Ge,pt-lt],0,rt.texture.size,2,Le,rt.textureOffset,rt.scale,rt.offset);et.draw(ye,Se.POINTS,Qt.disabled,pr.disabled,Mr.alphaBlended,or.disabled,Kt,xe.id,St.particleIndexBuffer,void 0,St.particleSegment)}}}(T,C,D,ee),B.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(ye,de,xe,ve){const Pe=ye.context,Se=Pe.gl,Ce=de.paint.get("raster-particle-max-speed"),Be=ve*de.paint.get("raster-particle-speed-factor")*.15,Le=function(Ve){return Math.pow(Ve,6)}(.01+1*de.paint.get("raster-particle-reset-rate-factor")),ke=de.particleFramebuffer;Pe.viewport.set([0,0,ke.width,ke.height]);for(const Ve of xe){const[,rt,ft]=Ve;Pe.activeTexture.set(Se.TEXTURE0+0),rt.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),Pe.activeTexture.set(Se.TEXTURE0+1);const et=ft.particleTexture0;et.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);const vt=mf(1,et.size[0],0,rt.texture.size,Ce,Be,Le,rt.textureOffset,rt.scale,rt.offset);ke.colorAttachment.set(ft.particleTexture1.texture),Pe.clear({color:o.bz.transparent}),ye.getOrCreateProgram("rasterParticleUpdate",{defines:rt.defines}).draw(ye,Se.TRIANGLES,Qt.disabled,pr.disabled,Mr.unblended,or.disabled,vt,de.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments)}}(T,D,ee,me)}(d,n,l,p),d.renderPass==="translucent"&&(function(T,C,D,z,B){const U=T.context,V=U.gl,q=C.getSource().tileSize,K=5*(1-o.a7(o.bU,o.bU+1,T.transform.zoom))*q+D.paint.get("raster-particle-elevation"),Q=!T.options.moving,ee=T.transform.projection.name==="globe";if(!z.length)return;const[re,me]=T.stencilConfigForOverlap(z),ye=[];ee&&ye.push("PROJECTION_GLOBE_VIEW");const de=T.stencilModeFor3D();for(const xe of me){const ve=xe.toUnwrapped(),Pe=C.getTile(xe);if(!Pe.rasterParticleState)continue;const Se=Pe.rasterParticleState,Ce=100;Pe.registerFadeDuration(Ce);const Be=C.findLoadedParent(xe,0),Le=cf(Pe,Be,C,T.transform,Ce);let ke,Ve;T.terrain&&T.terrain.prepareDrawTile(),U.activeTexture.set(V.TEXTURE0),Se.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),U.activeTexture.set(V.TEXTURE1),Be&&Be.rasterParticleState?(Be.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ke=Math.pow(2,Be.tileID.overscaledZ-Pe.tileID.overscaledZ),Ve=[Pe.tileID.canonical.x*ke%1,Pe.tileID.canonical.y*ke%1]):Se.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const rt=ee?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(ve,Q),ft=T.transform,et=Z_(ft),vt=o.cz(xe.canonical),Ge=o.cA(vt.getCenter().lat);let lt,ot,bt,St,ut;ee?(lt=Float32Array.from(o.b5(o.cC(xe.canonical))),ot=Float32Array.from(ft.globeMatrix),bt=Float32Array.from(o.cy(ft)),St=[o.am(ft.center.lng),o.at(ft.center.lat)],ut=Float32Array.from(o.cB(xe.canonical,vt,Ge,ft.worldSize/ft._pixelsPerMercatorPixel))):(lt=new Float32Array(16),ot=new Float32Array(9),bt=new Float32Array(16),St=[0,0],ut=new Float32Array(9));const pt=U_(rt,lt,ot,bt,ut,Ve||[0,0],o.a9(T.transform.zoom),St,et,ke||1,Le,K),Kt=T.isTileAffectedByFog(xe),Mt=T.getOrCreateProgram("rasterParticle",{defines:ye,overrideFog:Kt});if(T.uploadCommonUniforms(U,Mt,ve),ee){const Nt=new Qt(V.LEQUAL,Qt.ReadOnly,T.depthRangeFor3D),ir=0,Gt=T.globeSharedBuffers;if(Gt){const[er,Tr,vr]=Gt.getGridBuffers(Ge,ir!==0);Mt.draw(T,V.TRIANGLES,Nt,de,Mr.alphaBlended,T.renderElevatedRasterBackface?or.frontCCW:or.backCCW,pt,D.id,er,Tr,vr)}}else{const Nt=T.depthModeForSublayer(0,Qt.ReadOnly),ir=re[xe.overscaledZ],{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:er,tileBoundsSegments:Tr}=T.getTileBoundsBuffers(Pe);Mt.draw(T,V.TRIANGLES,Nt,ir,Mr.alphaBlended,or.disabled,pt,D.id,Gt,er,Tr)}}T.resetStencilClippingMasks()}(d,n,l,p),d.style.map.triggerRepaint())},background:function(d,n,l,p){const _=l.paint.get("background-color"),x=l.paint.get("background-opacity"),T=l.paint.get("background-emissive-strength"),C=l.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const D=d.context,z=D.gl,B=d.transform,U=B.tileSize,V=l.paint.get("background-pattern");let q;if(V!==void 0&&(V===null||(q=d.imageManager.getPattern(V.toString(),l.scope,d.style.getLut(l.scope)),!q)))return;const K=!V&&_.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==K)return;const Q=pr.disabled,ee=d.depthModeForSublayer(0,K==="opaque"?Qt.ReadWrite:Qt.ReadOnly),re=d.colorModeForDrapableLayerRenderPass(T),me=V?"backgroundPattern":"background";let ye,de=p;if(de||(ye=d.getBackgroundTiles(),de=Object.values(ye).map(xe=>xe.tileID)),V&&(D.activeTexture.set(z.TEXTURE0),d.imageManager.bind(d.context,l.scope)),C){const xe=d.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(o.a6.mat4.identity([])),Pe=new o.aA(0,0,0,0,0),Se=V?ol(ve,T,x,d,0,l.scope,q,C,{tileID:Pe,tileSize:U}):V_(ve,T,x,_.toRenderColor(l.lut));xe.draw(d,z.TRIANGLES,ee,Q,re,or.disabled,Se,l.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const xe of de){const ve=d.isTileAffectedByFog(xe),Pe=d.getOrCreateProgram(me,{overrideFog:ve}),Se=xe.toUnwrapped(),Ce=p?xe.projMatrix:d.transform.calculateProjMatrix(Se);d.prepareDrawTile();const Be=n?n.getTile(xe):ye?ye[xe.key]:new ma(xe,U,B.zoom,d),Le=V?ol(Ce,T,x,d,0,l.scope,q,C,{tileID:xe,tileSize:U}):V_(Ce,T,x,_.toRenderColor(l.lut));d.uploadCommonUniforms(D,Pe,Se);const{tileBoundsBuffer:ke,tileBoundsIndexBuffer:Ve,tileBoundsSegments:rt}=d.getTileBoundsBuffers(Be);Pe.draw(d,z.TRIANGLES,ee,Q,re,or.disabled,Le,l.id,ke,Ve,rt)}},sky:function(d,n,l){const p=d._atmosphere?o.a9(d.transform.zoom):1,_=l.paint.get("sky-opacity")*p;if(_===0)return;const x=d.context,T=l.paint.get("sky-type"),C=new Qt(x.gl.LEQUAL,Qt.ReadOnly,[0,1]),D=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(z,B,U,V){const q=z.context,K=q.gl;let Q=B.skyboxFbo;if(!Q){Q=B.skyboxFbo=q.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new gm(q),B.skyboxTexture=q.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,B.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ye=0;ye<6;++ye)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Q.framebuffer),q.viewport.set([0,0,32,32]);const ee=B.getCenter(z,!0),re=z.getOrCreateProgram("skyboxCapture"),me=new Float64Array(16);o.a6.mat4.identity(me),o.a6.mat4.rotateY(me,me,.5*-Math.PI),sl(z,B,re,me,ee,0),o.a6.mat4.identity(me),o.a6.mat4.rotateY(me,me,.5*Math.PI),sl(z,B,re,me,ee,1),o.a6.mat4.identity(me),o.a6.mat4.rotateX(me,me,.5*-Math.PI),sl(z,B,re,me,ee,2),o.a6.mat4.identity(me),o.a6.mat4.rotateX(me,me,.5*Math.PI),sl(z,B,re,me,ee,3),o.a6.mat4.identity(me),sl(z,B,re,me,ee,4),o.a6.mat4.identity(me),o.a6.mat4.rotateY(me,me,Math.PI),sl(z,B,re,me,ee,5),q.viewport.set([0,0,z.width,z.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(z,B,U,V,q){const K=z.context,Q=K.gl,ee=z.transform,re=z.getOrCreateProgram("skybox");K.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,B.skyboxTexture);const me=((ye,de,xe,ve,Pe)=>({u_matrix:ye,u_sun_direction:de,u_cubemap:0,u_opacity:ve,u_temporal_offset:Pe}))(ee.skyboxMatrix,B.getCenter(z,!1),0,V,q);z.uploadCommonUniforms(K,re),re.draw(z,Q.TRIANGLES,U,pr.disabled,z.colorModeForRenderPass(),or.backCW,me,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(d,l,C,_,D):T==="gradient"&&d.renderPass==="sky"&&function(z,B,U,V,q){const K=z.context,Q=K.gl,ee=z.transform,re=z.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new gm(K)),K.activeTexture.set(Q.TEXTURE0);let me=B.colorRampTexture;me||(me=B.colorRampTexture=new o.T(K,B.colorRamp,Q.RGBA8)),me.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const ye=((de,xe,ve,Pe,Se)=>({u_matrix:de,u_color_ramp:0,u_center_direction:xe,u_radius:o.bB(ve),u_opacity:Pe,u_temporal_offset:Se}))(ee.skyboxMatrix,B.getCenter(z,!1),B.paint.get("sky-gradient-radius"),V,q);z.uploadCommonUniforms(K,re),re.draw(z,Q.TRIANGLES,U,pr.disabled,z.colorModeForRenderPass(),or.backCW,ye,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(d,l,C,_,D)},debug:function(d,n,l,p,_,x){for(let T=0;T<l.length;T++)if(_){const z=new o.bz(p.r*.8,p.g*.8,p.b*.8,1);Jo(d,n,l[T],p,-1,-1,x),Jo(d,n,l[T],p,-1,1,x),Jo(d,n,l[T],p,1,1,x),Jo(d,n,l[T],p,1,-1,x),Jo(d,n,l[T],z,0,0,x)}else Jo(d,n,l[T],p,0,0,x)},custom:function(d,n,l,p){const _=d.context,x=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isDraped(n)){if(d.renderPass==="offscreen"){const T=x.prerender;if(T){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;T.call(x,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.a9(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else T.call(x,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const C=x.renderToTile;if(C){const D=p[0].canonical,z=new o.a5(D.x+p[0].wrap*(1<<D.z),D.y,D.z);_.setDepthMode(Qt.disabled),_.setStencilMode(pr.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),C.call(x,_.gl,z),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(pr.disabled);const T=x.renderingMode==="3d"?new Qt(d.context.gl.LEQUAL,Qt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Qt.ReadOnly);if(_.setDepthMode(T),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;x.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.a9(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else x.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,n,l,p){if(d.renderPass==="opaque")return;const _=l.paint.get("model-opacity");if(_===0)return;const x=l.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!x||d.terrain&&_<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.a4))return;const T=d.shadowRenderer,C=l.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,C||(T.enabled=!1));const D=()=>{T&&(T.useNormalOffset=!0,C||(T.enabled=!0))},z=n.getSource();if(d.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(re,me,ye,de,xe){const ve=re.transform;if(ve.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const Pe=ve.getFreeCameraOptions().position;if(!re.modelManager)return;const Se=re.modelManager;ye.modelManager=Se;const Ce=re.shadowRenderer;if(!ye._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Be=ye._unevaluatedLayout._values["model-id"],Le={...ye.layout.get("model-id").parameters},ke=re.style.order.indexOf(ye.fqid);for(const Ve of de){const rt=me.getTile(Ve).getBucket(ye);if(!rt||rt.projection.name!==ve.projection.name)continue;const ft=rt.getModelUris();ft&&!rt.modelsRequested&&(Se.addModelsFromBucket(ft,xe),rt.modelsRequested=!0);const et=Db(Ve,ve);Le.zoom=et;const vt=Be.possiblyEvaluate(Le);if(Y_(re,rt,Ve),ea.shadowUniformsInitialized=!1,ea.useSingleShadowCascade=!!Ce&&Ce.getMaxCascadeForTile(Ve.toUnwrapped())===0,re.renderPass==="shadow"&&Ce){if(re.currentShadowCascade===1&&rt.isInsideFirstShadowMapFrustum)continue;const ot=ve.calculatePosMatrix(Ve.toUnwrapped(),ve.worldSize);if(ea.tileMatrix.set(ot),ea.shadowTileMatrix=Float32Array.from(Ce.calculateShadowPassMatrixFromMatrix(ot)),ea.aabb.min.fill(0),ea.aabb.max[0]=ea.aabb.max[1]=o.ab,ea.aabb.max[2]=0,ju(rt,ea,re,ye.scope))continue}const Ge=1<<Ve.canonical.z,lt=[((Pe.x-Ve.wrap)*Ge-Ve.canonical.x)*o.ab,(Pe.y*Ge-Ve.canonical.y)*o.ab,Pe.z*Ge*o.ab];re.conflationActive&&Object.keys(rt.instancesPerModel).length>0&&re.style.isLayerClipped(ye,me.getSource())&&rt.updateReplacement(Ve,re.replacementSource,ke,xe)&&(rt.uploaded=!1,rt.upload(re.context));for(let ot in rt.instancesPerModel){const bt=rt.instancesPerModel[ot];bt.features.length>0&&(ot=vt.evaluate(bt.features[0].feature,{}));const St=Se.getModel(ot,xe);if(St&&St.uploaded)for(const ut of St.nodes)Li(re,ye,ut,bt,lt,Ve,ea)}}}(d,n,l,p,z.type==="vector"?l.scope:""),void D();if(!z.loaded())return;if(z.type==="batched-model")return function(re,me,ye,de){ye.resetLayerRenderingStats(re);const xe=re.context,ve=re.transform,Pe=re.style.fog,Se=re.shadowRenderer;if(ve.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Ce=re.transform.getFreeCameraOptions().position,Be=o.a6.vec3.scale([],[Ce.x,Ce.y,Ce.z],re.transform.worldSize),Le=o.a6.vec3.negate([],Be),ke=o.a6.mat4.identity([]),Ve=o.de(ve.center.lat,ve.zoom),rt=o.a6.mat4.fromScaling([],[1,1,1/Ve]);o.a6.mat4.translate(ke,ke,Le);const ft=ye.paint.get("model-opacity"),et=new Qt(xe.gl.LEQUAL,Qt.ReadWrite,re.depthRangeFor3D),vt=new Qt(xe.gl.LEQUAL,Qt.ReadOnly,re.depthRangeFor3D),Ge=new o.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),lt=re.renderPass==="shadow",ot=lt&&Se?Se.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),bt=ye.paint.get("model-front-cutoff"),St=bt[2]<1,ut=Wa(re,ye.paint.get("model-cutoff-fade-range")),pt=ye.getLayerRenderingStats();(function(Kt,Mt,Nt,ir){const Gt=Kt.terrain?Kt.terrain.exaggeration():0,er=Kt.transform.zoom;for(const Tr of ir){const vr=Mt.getTile(Tr).getBucket(Nt);vr&&(Kt.conflationActive&&vr.updateReplacement(Tr,Kt.replacementSource),vr.evaluateScale(Kt,Nt),Kt.terrain&&Gt>0&&vr.elevationUpdate(Kt.terrain,Gt,Tr,Nt.source),vr.needsReEvaluation(Kt,er,Nt)&&vr.evaluate(Nt))}})(re,me,ye,de),function(){let Kt,Mt,Nt;St?(Kt=de.length-1,Mt=-1,Nt=-1):(Kt=0,Mt=de.length,Nt=1);const ir=new Float64Array(16),Gt=o.a6.vec3.create(),er=new o.P(0,0);for(let Tr=Kt;Tr!==Mt;Tr+=Nt){const vr=de[Tr],Xr=me.getTile(vr).getBucket(ye);if(!Xr||!Xr.uploaded)continue;let rn=!1;Se&&(rn=Se.getMaxCascadeForTile(vr.toUnwrapped())===0);const fn=ve.calculatePosMatrix(vr.toUnwrapped(),ve.worldSize),ko=Xr.modelTraits;!lt&&St&&(o.a6.mat4.invert(ir,fn),o.a6.vec3.transformMat4(Gt,Be,ir),er.x=Gt[0],er.y=Gt[1]);const Nn=[];for(const Ir of Xr.getNodesInfo()){if(Ir.hiddenByReplacement||!Ir.node.meshes)continue;const Qr=Ir.node;let bn=0;re.terrain&&Qr.elevation&&(bn=Qr.elevation*re.terrain.exaggeration());const Jr=(()=>{const ln=Ir.aabb;return Ge.min=[...ln.min],Ge.max=[...ln.max],Ge.min[2]+=bn,Ge.max[2]+=bn,o.a6.vec3.transformMat4(Ge.min,Ge.min,fn),o.a6.vec3.transformMat4(Ge.max,Ge.max,fn),Ge})(),br=Ir.evaluatedScale;if(br[0]<=1&&br[1]<=1&&br[2]<=1&&Jr.intersects(ot)===0)continue;if(!lt&&St){const ln=.16666666666666666;Ir.cameraCollisionOpacity=Be[0]>Jr.min[0]&&Be[0]<Jr.max[0]&&Be[1]>Jr.min[1]&&Be[1]<Jr.max[1]&&Be[2]*Ve<Jr.max[2]&&Qr.footprint&&o.bu(er,Qr.footprint)?Math.max(Ir.cameraCollisionOpacity-ln,0):Math.min(1,Ir.cameraCollisionOpacity+ln)}const Nr=[...fn],Gr=Qr.anchor?Qr.anchor[0]:0,kn=Qr.anchor?Qr.anchor[1]:0;o.a6.mat4.translate(Nr,Nr,[Gr*(br[0]-1),kn*(br[1]-1),bn]),o.a6.vec3.exactEquals(br,o.dh)||o.a6.mat4.scale(Nr,Nr,br);const jn=o.a6.mat4.multiply([],Nr,Qr.matrix),Dr=o.a6.mat4.multiply([],ve.expandedFarZProjMatrix,jn),ri=o.a6.mat4.multiply([],ve.expandedFarZProjMatrix,Nr),ci=o.a6.vec4.transformMat4([],[Gr,kn,bn,1],Dr)[2];Qr.hidden=!1;let ni=ft;lt||(St&&(ni*=Ir.cameraCollisionOpacity,ni*=Fr(Nr,ve,Ir.aabb,bt)),ni*=mn(ut,ci)),ni!==0?Nn.push({nodeInfo:Ir,depth:ci,opacity:ni,wvpForNode:Dr,wvpForTile:ri,nodeModelMatrix:jn,tileModelMatrix:Nr}):Qr.hidden=!0}lt||Nn.sort((Ir,Qr)=>!St||Ir.opacity===1&&Qr.opacity===1?Ir.depth<Qr.depth?-1:1:Ir.opacity===1?-1:Qr.opacity===1?1:Ir.depth>Qr.depth?-1:1);for(const Ir of Nn){const Qr=Ir.nodeInfo,bn=Qr.node;let Jr=o.a6.mat4.multiply([],rt,Ir.tileModelMatrix);o.a6.mat4.multiply(Jr,ke,Jr);const br=o.a6.mat4.invert([],Jr);o.a6.mat4.transpose(br,br),o.a6.mat4.scale(br,br,Lb),Jr=o.a6.mat4.multiply(Jr,Jr,bn.matrix);const Nr=re.renderPass==="light-beam",Gr=ko&o.dj.HasMapboxMeshFeatures,kn=Gr?0:Qr.evaluatedRMEA[0][2];for(let jn=0;jn<bn.meshes.length;++jn){const Dr=bn.meshes[jn],ri=jn===bn.lightMeshIndex;let ci=Ir.wvpForNode;if(ri){if(!Nr&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}ci=Ir.wvpForTile}else if(Nr)continue;const ni={defines:[]},ln=[];if(Af(ni.defines,ln,Dr,re,ye.lut),Gr||ni.defines.push("DIFFUSE_SHADED"),rn&&ni.defines.push("SHADOWS_SINGLE_CASCADE"),pt&&(lt?pt.numRenderedVerticesInShadowPass+=Dr.vertexArray.length:pt.numRenderedVerticesInTransparentPass+=Dr.vertexArray.length),lt){gc(Dr,Ir.nodeModelMatrix,re,ye);continue}let Gi=null;if(Pe){const Ja=Sf(Ir.nodeModelMatrix,re.transform);if(Gi=new Float32Array(Ja),ve.projection.name!=="globe"){const Os=Dr.aabb.min,wa=Dr.aabb.max,[wc,Tc]=Pe.getOpacityForBounds(Ja,Os[0],Os[1],wa[0],wa[1]);ni.overrideFog=wc>=zt||Tc>=zt}}const qi=Dr.material;let Do;qi.occlusionTexture&&qi.occlusionTexture.offsetScale&&(Do=qi.occlusionTexture.offsetScale,ni.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!lt&&Se&&(Se.useNormalOffset=!!Dr.normalBuffer);const bo=re.getOrCreateProgram("model",ni);!lt&&Se&&Se.setupShadowsFromMatrix(Ir.tileModelMatrix,bo,Se.useNormalOffset),re.uploadCommonUniforms(xe,bo,null,Gi);const oo=qi.pbrMetallicRoughness;oo.metallicFactor=.9,oo.roughnessFactor=.5;const Lo=$t(new Float32Array(ci),new Float32Array(Jr),new Float32Array(br),new Float32Array(bn.matrix),re,Ir.opacity,oo.baseColorFactor.toRenderColor(null),qi.emissiveFactor,oo.metallicFactor,oo.roughnessFactor,qi,kn,ye,[0,0,0],Do);!ri&&(Qr.hasTranslucentParts||Ir.opacity<1)&&bo.draw(re,xe.gl.TRIANGLES,et,pr.disabled,Mr.disabled,or.backCCW,Lo,ye.id,Dr.vertexBuffer,Dr.indexBuffer,Dr.segments,ye.paint,re.transform.zoom,void 0,ln),bo.draw(re,xe.gl.TRIANGLES,ri?vt:et,pr.disabled,ri||Ir.opacity<1||Qr.hasTranslucentParts?Mr.alphaBlended:Mr.unblended,or.backCCW,Lo,ye.id,Dr.vertexBuffer,Dr.indexBuffer,Dr.segments,ye.paint,re.transform.zoom,void 0,ln)}}}}()}(d,n,l,p),void D();if(z.type!=="model")return;const B=z.getModels(),U=[],V=d.transform.getFreeCameraOptions().position,q=o.a6.vec3.scale([],[V.x,V.y,V.z],d.transform.worldSize);o.a6.vec3.negate(q,q);const K=[],Q=[];let ee=0;for(const re of B){const me=l.paint.get("model-rotation").constantOr(null),ye=l.paint.get("model-scale").constantOr(null),de=l.paint.get("model-translation").constantOr(null);re.computeModelMatrix(d,me,ye,de,!0,!0,!1);const xe=o.a6.mat4.identity([]),ve=o.de(re.position.lat,d.transform.zoom),Pe=o.a6.mat4.fromScaling([],[1,1,1/ve]);o.a6.mat4.translate(xe,xe,q),U.push({zScaleMatrix:Pe,negCameraPosMatrix:xe});for(const Se of re.nodes)Nu(d.transform,Se,re.matrix,d.transform.expandedFarZProjMatrix,ee,K,Q);ee++}if(K.sort((re,me)=>me.depth-re.depth),d.renderPass!=="shadow"){if(_===1)for(const re of Q)Fu(re,d,l,U[re.modelIndex],pr.disabled,d.colorModeForRenderPass());else{for(const re of Q)Fu(re,d,l,U[re.modelIndex],pr.disabled,Mr.disabled);for(const re of Q)Fu(re,d,l,U[re.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const re of K)Fu(re,d,l,U[re.modelIndex],pr.disabled,d.colorModeForRenderPass());D()}else{for(const re of Q)gc(re.mesh,re.nodeModelMatrix,d,l);for(const re of K)gc(re.mesh,re.nodeModelMatrix,d,l);D()}}},Mf={model:function(d,n,l){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?d.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const _=p.getModels();for(const x of _)x.upload(l.context)},raster:function(d,n,l){const p=n.getSource();if(!(p instanceof $l&&p.loaded()))return;const _=d.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-array-band")||p.getInitialBand(_);if(x==null)return;const T=n.getIds().map(C=>n.getTileByID(C));for(const C of T)C.updateNeeded(_,x)&&p.prepareTile(C,_,x)},"raster-particle":function(d,n,l){const p=n.getSource();if(!(p instanceof $l&&p.loaded()))return;const _=d.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(x==null)return;const T=n.getIds().map(C=>n.getTileByID(C));for(const C of T)C.updateNeeded(_,x)&&p.prepareTile(C,_,x)}};class ym{constructor(n,l,p,_){this.context=new Mb(n,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of x)this._debugParams.enabledLayers[C]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of x)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new Ef(_),this.setup(),this.numSublayers=eo.maxUnderzooming+eo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new d_(this),this._wireframeDebugCache=new Es,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const T=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,T,n.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(n,l){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tm(this,n));const _=this._terrain;this.transform.elevation=p?_:null,_.update(n,this.transform,l),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new tm(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*o.q.devicePixelRatio,this.height=l*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,l=new o.a_;l.emplaceBack(0,0),l.emplaceBack(o.ab,0),l.emplaceBack(0,o.ab),l.emplaceBack(o.ab,o.ab),this.tileExtentBuffer=n.createVertexBuffer(l,o.b0.members),this.tileExtentSegments=o.b1.simpleSegment(0,0,4,2);const p=new o.a_;p.emplaceBack(0,0),p.emplaceBack(o.ab,0),p.emplaceBack(0,o.ab),p.emplaceBack(o.ab,o.ab),this.debugBuffer=n.createVertexBuffer(p,o.b0.members),this.debugSegments=o.b1.simpleSegment(0,0,4,5);const _=new o.a_;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,o.b0.members),this.viewportSegments=o.b1.simpleSegment(0,0,4,2);const x=new o.aN;x.emplaceBack(0,0,0,0),x.emplaceBack(o.ab,0,o.ab,0),x.emplaceBack(0,o.ab,0,o.ab),x.emplaceBack(o.ab,o.ab,o.ab,o.ab),this.mercatorBoundsBuffer=n.createVertexBuffer(x,o.b3.members),this.mercatorBoundsSegments=o.b1.simpleSegment(0,0,4,2);const T=new o.aO;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const C=new o.a$;for(const z of[0,1,3,2,0])C.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(C),this.emptyTexture=new o.T(n,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.a6.mat4.create();const D=this.context.gl;this.stencilClearMode=new pr({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Qt.disabled,this.stencilClearMode,Mr.disabled,or.disabled,Ou(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,p){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const D of p)if(this._tileClippingMaskIDs[D.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(Mr.disabled),_.setDepthMode(Qt.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const D=l.getTile(C),z=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=this.getTileBoundsBuffers(D);T.draw(this,x.TRIANGLES,Qt.disabled,new pr({func:x.ALWAYS,mask:0},z,255,x.KEEP,x.KEEP,x.REPLACE),Mr.disabled,or.disabled,Ou(C.projMatrix),"$clipping",B,U,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new pr({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new pr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,p=n.sort((T,C)=>C.overscaledZ-T.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+_]=new pr({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[T,p]}return[{[_]:pr.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Mr([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mr.unblended:Mr.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.bz(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,p,_=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Qt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Qt(p||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),x=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&p!==0&&(this.depthFBO=new yf(this.context,l,p,!1,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),n.bindTexture(n.TEXTURE_2D,x),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,l,p,0,0,l,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,l)=>n+l/this._fpsHistory.length,0))}render(n,l){const p=o.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const _=this.style._mergedLayers,x=this.style.order.filter(Le=>{const ke=_[Le];return!(ke.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ke.type]});let T=!1,C=!1;for(const Le of x){const ke=_[Le];ke.type==="circle"&&(T=!0),ke.type==="symbol"&&(ke.hasInitialOcclusionOpacityProperties?C=!0:T=!0)}const D=x.map(Le=>_[Le]),z=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let B=0,U=!1;for(const Le in z){const ke=z[Le];ke.used&&(ke.prepare(this.context),ke.getSource().usedInConflation&&++B)}let V=!1;for(const Le of D)Le.isHidden(this.transform.zoom)||(Le.type==="clip"&&(V=!0),this.prepareLayer(Le));const q={},K={},Q={},ee={},re={};for(const Le in z){const ke=z[Le];q[Le]=ke.getVisibleCoordinates(),K[Le]=q[Le].slice().reverse(),Q[Le]=ke.getVisibleCoordinates(!0).reverse(),ee[Le]=ke.getShadowCasterCoordinates(),re[Le]=ke.sortCoordinatesByDistance(q[Le])}const me=Le=>{const ke=this.style.getLayerSourceCache(Le);return ke&&ke.used?ke.getSource():null};if(B||V||this._clippingActiveLastFrame){const Le=[],ke=[];let Ve=0;for(const rt of D)this.isSourceForClippingOrConflation(rt,me(rt))&&(Le.push(rt),ke.push(Ve)),Ve++;if(Le&&(V||Le.length>1)||this._clippingActiveLastFrame){V=!1;const rt=[];for(let ft=0;ft<Le.length;ft++){const et=Le[ft],vt=ke[ft],Ge=this.style.getLayerSourceCache(et);if(!Ge||!Ge.used||!Ge.getSource().usedInConflation&&et.type!=="clip")continue;let lt=o.dn,ot=o.bs.None;const bt=[];let St=!0;if(et.type==="clip"){lt=vt;for(const ut of et.layout.get("clip-layer-types"))ot|=ut==="model"?o.bs.Model:ut==="symbol"?o.bs.Symbol:o.bs.FillExtrusion;for(const ut of et.layout.get("clip-layer-scope"))bt.push(ut);et.isHidden(this.transform.zoom)?St=!1:V=!0}St&&rt.push({layer:et.fqid,cache:Ge,order:lt,clipMask:ot,clipScope:bt})}this.replacementSource.setSources(rt),U=!0}}this._clippingActiveLastFrame=V,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Le=0;Le<D.length;Le++){const ke=D[Le],Ve=ke.cutoffRange();if(this.longestCutoffRange=Math.max(Ve,this.longestCutoffRange),Ve>0){const rt=me(ke);rt&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom)),ke.minzoom&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom))}ke.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Le),this._lastOcclusionLayer=Le)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0);const de=this._shadowRenderer;if(de){de.updateShadowParameters(this.transform,this.style.directionalLight);for(const Le in z)for(const ke of q[Le]){let Ve={min:0,max:0};this.terrain&&(Ve=this.terrain.getMinMaxForTile(ke)||Ve),de.addShadowReceiver(ke.toUnwrapped(),Ve.min,Ve.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Tf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Bt.has(this.context.gl))return;this.renderPass="offscreen";for(const Le of D){const ke=n.getLayerSourceCache(Le);if(!Le.hasOffscreenPass()||Le.isHidden(this.transform.zoom))continue;const Ve=ke?K[ke.id]:void 0;(Le.type==="custom"||Le.type==="raster"||Le.type==="raster-particle"||Le.isSky()||Ve&&Ve.length)&&this.renderLayer(this,ke,Le,Ve)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ve=(()=>{if(l.showOverdrawInspector)return o.bz.black;const Le=this.style.fog;if(Le&&this.transform.projection.supportsFog){const ke=this.style.getLut(Le.scope);if(!xe){const Ve=Le.properties.get("color").toRenderColor(ke).toArray01();return new o.bz(...Ve)}if(xe){const Ve=Le.properties.get("space-color").toRenderColor(ke).toArray01();return new o.bz(...Ve)}}return o.bz.transparent})();if(this.context.clear({color:ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const Le=D[this.currentLayer],ke=n.getLayerSourceCache(Le);if(Le.isSky())continue;const Ve=ke?(Le.is3D()?re:K)[ke.id]:void 0;this._renderTileClippingMasks(Le,ke,Ve),this.renderLayer(this,ke,Le,Ve)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const Le=D[this.currentLayer],ke=n.getLayerSourceCache(Le);Le.isSky()&&this.renderLayer(this,ke,Le,ke?K[ke.id]:void 0)}function Pe(Le,ke){let Ve;return ke&&(Ve=(Le.type==="symbol"?Q:Le.is3D()?re:K)[ke.id]),Ve}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){const Le=D[this.currentLayer];if(Le.type==="raster"||Le.type==="raster-particle"){const ke=n.getLayerSourceCache(Le);this.renderLayer(this,ke,Le,Pe(Le,ke))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Se=0;de&&(Se=de.getShadowCastingLayerCount());let Ce=!1,Be=-1;for(let Le=0;Le<x.length;++Le){const ke=D[Le];ke.isHidden(this.transform.zoom)||ke.is3D()&&(Be=Le)}for(C&&Be===-1&&(T=!0);this.currentLayer<x.length;){const Le=D[this.currentLayer],ke=n.getLayerSourceCache(Le);if(Le.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Le)){if(Le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(T&&!Ce&&this.terrain&&!this.transform.isOrthographic&&(Ce=!0,this.blitDepth()),C&&Be!==-1&&this.currentLayer===Be+1&&!this.transform.isOrthographic&&this.blitDepth(),Le.is3D()||this.terrain||this._renderTileClippingMasks(Le,ke,ke?q[ke.id]:void 0),this.renderLayer(this,ke,Le,Pe(Le,ke)),!this.terrain&&de&&Se>0&&Le.hasShadowPass()&&--Se==0&&(de.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ve=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ve;this.currentLayer++){const rt=D[this.currentLayer];if(!rt.hasLightBeamPass())continue;const ft=n.getLayerSourceCache(rt);this.renderLayer(this,ft,rt,ft?K[ft.id]:void 0)}this.currentLayer=Ve,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ve=this.currentLayer;this.depthOcclusion=!0;for(const rt of this.layersWithOcclusionOpacity){this.currentLayer=rt;const ft=D[this.currentLayer],et=n.getLayerSourceCache(ft),vt=et?K[et.id]:void 0;ft.is3D()||this.terrain||this._renderTileClippingMasks(ft,et,et?q[et.id]:void 0),this.renderLayer(this,et,ft,vt)}this.depthOcclusion=!1,this.currentLayer=Ve,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Le=null;D.forEach(ke=>{const Ve=n.getLayerSourceCache(ke);Ve&&!ke.isHidden(this.transform.zoom)&&Ve.getVisibleCoordinates().length&&(!Le||Le.getSource().maxzoom<Ve.getSource().maxzoom)&&(Le=Ve)}),Le&&this.options.showTileBoundaries&&Ms.debug(this,Le,Le.getVisibleCoordinates(),o.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ms.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Le){const ke=Le.transform.padding;xn(Le,Le.transform.height-(ke.top||0),3,Cb),xn(Le,ke.bottom||0,3,dc),Ze(Le,ke.left||0,3,pc),Ze(Le,Le.transform.width-(ke.right||0),3,Et);const Ve=Le.transform.centerPoint;(function(rt,ft,et,vt){Bu(rt,ft-1,et-10,2,20,vt),Bu(rt,ft-10,et-1,20,2,vt)})(Le,Ve.x,Le.transform.height-Ve.y,Xt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(n.type);if(Mf[n.type]&&(p||this.terrain&&n.type==="custom")){const _=this.style.getLayerSourceCache(n);Mf[n.type](n,_,this)}this.gpuTimingEnd()}renderLayer(n,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||Ms[p.type](n,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,p=this.context.gl;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const p in n){const _=n[p],x=this.context.extTimerQuery,T=x.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(_.query),l[p]=T}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery,p=this.context.gl;let _=0;for(const x of n)_+=l.getQueryParameter(x,p.QUERY_RESULT)/1e6,l.deleteQueryEXT(x);return _}translatePosMatrix(n,l,p,_,x){if(!p[0]&&!p[1])return n;const T=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),B=Math.cos(T);p=[p[0]*B-p[1]*z,p[0]*z+p[1]*B]}const C=[x?p[0]:o.ak(l,p[0],this.transform.zoom),x?p[1]:o.ak(l,p[1],this.transform.zoom),0],D=new Float32Array(16);return o.a6.mat4.translate(D,n,C),D}saveTileTexture(n){const l=n.size[0],p=this._tileTextures[l];p?p.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,p){const _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||l!==void 0&&!l||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,l){this.cache=this.cache||{};const p=l&&l.defines||[],_=l&&l.config,x=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(p),T=Ss.cacheKey(ws[n],n,x,_);return this.cache[T]||(this.cache[T]=new Ss(this.context,n,ws[n],_,G_[n],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){const x=((T,C,D)=>{const z=T.properties.get("direction"),B=T.properties.get("color").toRenderColor(D.getLut(T.scope)).toArray01(),U=T.properties.get("intensity"),V=C.properties.get("color").toRenderColor(D.getLut(C.scope)).toArray01(),q=C.properties.get("intensity"),K=[z.x,z.y,z.z],Q=o.cH(V,q),ee=o.cH(B,U);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:K,u_lighting_directional_color:ee,u_ground_radiance:rm(K,ee,Q)}})(p,_,this.style);l.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,l,p,_,x){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const C=T.getOpacity(this.transform.pitch),D=((z,B,U,V,q,K,Q,ee,re,me,ye,de)=>{const xe=z.transform,ve=B.properties.get("color").toRenderColor(z.style.getLut(B.scope)).toArray01();ve[3]=V;const Pe=z.frameCounter/1e3%1,[Se,Ce]=B.properties.get("vertical-range");return{u_fog_matrix:U?xe.calculateFogTileMatrix(U):de||z.identityMat,u_fog_range:B.getFovAdjustedRange(xe._fov),u_fog_color:ve,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Se,Ce),Ce],u_fog_temporal_offset:Pe,u_frustum_tl:q,u_frustum_tr:K,u_frustum_br:Q,u_frustum_bl:ee,u_globe_pos:re,u_globe_radius:me,u_viewport:ye,u_globe_transition:o.a9(xe.zoom),u_is_globe:+(xe.projection.name==="globe")}})(this,T,p,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],_);l.setFogUniformValues(n,D)}x&&l.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=n[_.key]||new ma(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D()||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=zt||l[1]>=zt}setupDepthForOcclusion(n,l,p){const _=this.context,x=_.gl,T=!!p;var C;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(x.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.activeTexture.set(x.TEXTURE0),T||l.setTerrainUniformValues(_,p)}}function Za(d,n){let l=!1,p=null;const _=()=>{p=null,l&&(d(),p=setTimeout(_,n),l=!1)};return()=>(l=!0,p||_(),p)}class Ps{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Za(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Xa(n);if(this._hashName){const p=this._hashName;let _=!1;const x=location.hash.slice(1).split("&").map(T=>{const C=T.split("=")[0];return C===p?(_=!0,`${C}=${l}`):T}).filter(T=>T);return _||x.push(`${p}=${l}`),`#${x.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Xa(d,n){const l=d.getCenter(),p=Math.round(100*d.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),T=Math.round(l.lng*x)/x,C=Math.round(l.lat*x)/x,D=d.getBearing(),z=d.getPitch();let B=n?`/${T}/${C}/${p}`:`${p}/${C}/${T}`;return(D||z)&&(B+="/"+Math.round(10*D)/10),z&&(B+=`/${Math.round(z)}`),B}const ll={linearity:.3,easing:o.dp(0,0,.3,1)},Pf=o.l({deceleration:2500,maxSpeed:1400},ll),_m=o.l({deceleration:20,maxSpeed:1400},ll),vm=o.l({deceleration:1e3,maxSpeed:360},ll),xm=o.l({deceleration:1e3,maxSpeed:90},ll);class Is{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.q.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const x=cl(l.pan.mag(),p,o.l({},Pf,n||{}));_.offset=l.pan.mult(x.amount/l.pan.mag()),_.center=this._map.transform.center,yc(_,x)}if(l.zoom){const x=cl(l.zoom,p,_m);_.zoom=this._map.transform.zoom+x.amount,yc(_,x)}if(l.bearing){const x=cl(l.bearing,p,vm);_.bearing=this._map.transform.bearing+o.ap(x.amount,-179,179),yc(_,x)}if(l.pitch){const x=cl(l.pitch,p,xm);_.pitch=this._map.transform.pitch+x.amount,yc(_,x)}if(_.zoom||_.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function yc(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function cl(d,n,l){const{maxSpeed:p,linearity:_,deceleration:x}=l,T=o.ap(d*_/(n/1e3),-p,p),C=Math.abs(T)/(x*_);return{easing:l.easing,duration:1e3*C,amount:T*(C/2)}}class Vi extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p,_={}){const x=ht(l.getCanvasContainer(),p),T=l.unproject(x);super(n,o.l({point:x,lngLat:T,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class _c extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){const _=n==="touchend"?p.changedTouches:p.touches,x=st(l.getCanvasContainer(),_),T=x.map(D=>l.unproject(D)),C=x.reduce((D,z,B,U)=>D.add(z.div(U.length)),new o.P(0,0));super(n,{points:x,point:C,lngLats:T,lngLat:l.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class _i extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class bm{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new _i(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Vi(n.type,this._map,n))}mouseup(n){this._map.fire(new Vi(n.type,this._map,n))}preclick(n){const l=o.l({},n);l.type="preclick",this._map.fire(new Vi(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Vi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Vi(n.type,this._map,n))}mouseover(n){this._map.fire(new Vi(n.type,this._map,n))}mouseout(n){this._map.fire(new Vi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new _c(n.type,this._map,n))}touchmove(n){this._map.fire(new _c(n.type,this._map,n))}touchend(n){this._map.fire(new _c(n.type,this._map,n))}touchcancel(n){this._map.fire(new _c(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wm{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Vi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Vi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vc{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(se(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const p=l,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(_.x,p.x),C=Math.max(_.x,p.x),D=Math.min(_.y,p.y),z=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${D}px)`,this._box.style.width=C-T+"px",this._box.style.height=z-D+"px")})}mouseupWindow(n,l){if(!this._active)return;const p=this._startPos,_=l;if(p&&n.button===0){if(this.reset(),Ae(),p.x!==_.x||p.y!==_.y)return this._map.fire(new o.x("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),be(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.x(n,{originalEvent:l}))}}function Ya(d,n){const l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=n[p];return l}class Tm{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new o.P(0,0);for(const T of _)x._add(T);return x.div(_.length)}(l),this.touches=Ya(p,l)))}touchmove(n,l,p){if(this.aborted||!this.centroid)return;const _=Ya(p,l);for(const x in this.touches){const T=_[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,l,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class $u{constructor(n){this.singleTap=new Tm(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,p){this.singleTap.touchstart(n,l,p)}touchmove(n,l,p){this.singleTap.touchmove(n,l,p)}touchend(n,l,p){const _=this.singleTap.touchend(n,l,p);if(_){const x=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(x&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Sm{constructor(){this._zoomIn=new $u({numTouches:1,numTaps:2}),this._zoomOut=new $u({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,p){this._zoomIn.touchstart(n,l,p),this._zoomOut.touchstart(n,l,p)}touchmove(n,l,p){this._zoomIn.touchmove(n,l,p),this._zoomOut.touchmove(n,l,p)}touchend(n,l,p){const _=this._zoomIn.touchend(n,l,p),x=this._zoomOut.touchend(n,l,p);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uu={0:1,2:2};class Vu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const p=We(n);this._correctButton(n,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(n,l){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(_,x){const T=Uu[x];return _.buttons===void 0||(_.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(n){this._lastPoint&&We(n)===this._eventButton&&(this._moved&&Ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class If extends Vu{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Cf extends Vu{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=.8*(l.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class Of extends Vu{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const p=-.5*(l.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class J_{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,l,p){return this._calculateTransform(n,l,p)}touchmove(n,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,p)}}touchend(n,l,p){this._calculateTransform(n,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,p){p.length>0&&(this._active=!0);const _=Ya(p,l),x=new o.P(0,0),T=new o.P(0,0);let C=0;for(const z in _){const B=_[z],U=this._touches[z];U&&(x._add(B),T._add(B.sub(U)),C++,_[z]=B)}if(this._touches=_,C<this._minTouches||!T.mag())return;const D=T.div(C);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class kf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,p){return{}}touchstart(n,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,p){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[x,T]=_,C=Gu(p,l,x),D=Gu(p,l,T);if(!C||!D)return;const z=this._aroundCenter?null:C.add(D).div(2);return this._move([C,D],z,n)}touchend(n,l,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,T=Gu(p,l,_),C=Gu(p,l,x);T&&C||(this._active&&Ae(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gu(d,n,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return n[p]}function Am(d,n){return Math.log(d/n)/Math.LN2}class Q_ extends kf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Am(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Am(this._distance,p),pinchAround:l}}}function Em(d,n){return 180*d.angleWith(n)/Math.PI}class ev extends kf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Em(this._vector,p),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Em(n,p);return Math.abs(_)<l}}function Df(d){return Math.abs(d.y)>Math.abs(d.x)}class tv extends kf{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Df(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,p){const _=this._lastPoints;if(!_)return;const x=n[0].sub(_[0]),T=n[1].sub(_[1]);return this._map._cooperativeGestures&&!o.dq()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(n,l,p){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,x=l.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=n.y>0==l.y>0;return Df(n)&&Df(l)&&T}}const rv={panStep:100,bearingStep:15,pitchStep:10};class nv{constructor(){const n=rv;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,p=0,_=0,x=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const D=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:iv,zoom:l?Math.round(D)+l*(n.shiftKey?2:1):D,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:C.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function iv(d){return d*(2-d)}const Mm=4.000244140625,Rb=1/450;class zb{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Rb,o.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=o.q.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Mm==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ht(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Mm?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&B!==0&&(B=1/B);const U=l(),V=Math.pow(2,U),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*B))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,x=this._easing;let T,C=!1;if(this._type==="wheel"&&_&&x){const z=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),B=x(z);T=o.aa(_,p,B),z<1?this._frameId||(this._frameId=!0):C=!0}else T=p,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=T-l();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.dr;if(this._prevEase){const p=this._prevEase,_=(o.q.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);l=o.dp(T,C,.25,1)}return this._prevEase={start:o.q.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class On{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ov{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bb{constructor(){this._tap=new $u({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,l,p))}touchmove(n,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,l,p)}touchend(n,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,l,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fb{constructor(n,l,p){this._el=n,this._mousePan=l,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qu{constructor(n,l,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class av{constructor(n,l,p,_){this._el=n,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xc=d=>d.zoom||d.drag||d.pitch||d.rotate;class Lf extends o.x{}class Ka{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const p=o.a6.vec3.sub([],l,n);this.radius=o.a6.vec3.length(p[2]<0?o.a6.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){o.a6.vec3.div(n,n,this.constants),o.a6.vec3.normalize(n,n),o.a6.vec3.mul(n,n,this.constants);const l=o.a6.vec3.scale([],n,this.radius);if(l[2]>0){const p=o.a6.vec3.scale([],[0,0,1],o.a6.vec3.dot(l,[0,0,1])),_=o.a6.vec3.scale([],o.a6.vec3.normalize([],[l[0],l[1],0]),this.radius),x=o.a6.vec3.add([],l,o.a6.vec3.scale([],o.a6.vec3.sub([],o.a6.vec3.add([],_,p),l),2));l[0]=x[0],l[1]=x[1]}return l}}function ul(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Ri{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Is(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ka,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aJ(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,T]of this._listeners){const C=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(x,C,T)}}destroy(){for(const[n,l,p]of this._listeners){const _=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,_,p)}}_addDefaultHandlers(n){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new bm(l,n));const _=l.boxZoom=new vc(l,n);this._add("boxZoom",_);const x=new Sm,T=new ov;l.doubleClickZoom=new On(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const C=new Bb;this._add("tapDragZoom",C);const D=l.touchPitch=new tv(l);this._add("touchPitch",D);const z=new Cf(n),B=new Of(n);l.dragRotate=new qu(n,z,B),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new If(n),V=new J_(l,n);l.dragPan=new Fb(p,U,V),this._add("mousePan",U),this._add("touchPan",V,["touchZoom","touchRotate"]);const q=new ev,K=new Q_;l.touchZoomRotate=new av(p,K,q,C),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wm(l));const Q=l.scrollZoom=new zb(l,this);this._add("scrollZoom",Q,["mousePan"]);const ee=l.keyboard=new nv;this._add("keyboard",ee);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[re]&&l[re].enable(n[re])}_add(n,l,p){this._handlers.push({handlerName:n,handler:l,allowed:p}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,p){for(const _ in n)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const p of n)this._el.contains(p.target)&&l.push(p);return l}handleEvent(n,l){this._updatingCamera=!0;const p=n.type==="renderFrame",_=p?void 0:n,x={needsRenderFrame:!1},T={},C={},D=n.touches?this._getMapTouches(n.touches):void 0,z=D?st(this._el,D):p?void 0:ht(this._el,n);for(const{handlerName:V,handler:q,allowed:K}of this._handlers){if(!q.isEnabled())continue;let Q;this._blockedByActive(C,K,V)?q.reset():q[l||n.type]&&(Q=q[l||n.type](n,z,D),this.mergeHandlerResult(x,T,Q,V,_),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||q.isActive())&&(C[V]=q)}const B={};for(const V in this._previousActiveHandlers)C[V]||(B[V]=_);this._previousActiveHandlers=C,(Object.keys(B).length||ul(x))&&(this._changes.push([x,T,B]),this._triggerRenderFrame()),(Object.keys(C).length||ul(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,l,p,_,x){if(!p)return;o.l(n,p);const T={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(l.zoom=T),p.panDelta!==void 0&&(l.drag=T),p.pitchDelta!==void 0&&(l.pitch=T),p.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const n={},l={},p={};for(const[_,x,T]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),o.l(l,x),o.l(p,T);this._updateMapTransform(n,l,p),this._changes=[]}_updateMapTransform(n,l,p){const _=this._map,x=_.transform,T=me=>[me.x,me.y,me.z];if((me=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!ul(n)){const me=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),me!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!ul(n))return void this._fireEvents(l,p,!0);let{panDelta:C,zoomDelta:D,bearingDelta:z,pitchDelta:B,around:U,aroundCoord:V,pinchAround:q}=n;x._isCameraConstrained&&(D>0&&(D=0),x._isCameraConstrained=!1),q!==void 0&&(U=q),(D||(me=>l[me]&&!this._eventsInProgress[me])("drag"))&&U&&(this._dragOrigin=T(x.pointCoordinate3D(U)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,z&&(x.bearing+=z),B&&(x.pitch+=B),x._updateCameraState();const K=[0,0,0];if(C)if(x.projection.name==="mercator"){const me=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),ye=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(C)).dir);K[0]=ye[0]-me[0],K[1]=ye[1]-me[1]}else{const me=x.pointCoordinate(U);if(x.projection.name==="globe"){C=C.rotate(-x.angle);const ye=x._pixelsPerMercatorPixel/x.worldSize;K[0]=-C.x*o.ds(o.aM(me.y))*ye,K[1]=-C.y*o.ds(x.center.lat)*ye}else{const ye=x.pointCoordinate(U.sub(C));me&&ye&&(K[0]=ye.x-me.x,K[1]=ye.y-me.y)}}const Q=x.zoom,ee=[0,0,0];if(D){const me=T(V||x.pointCoordinate3D(U)),ye={dir:o.a6.vec3.normalize([],o.a6.vec3.sub([],me,x._camera.position))};if(ye.dir[2]<0){const de=x.zoomDeltaToMovement(me,D);o.a6.vec3.scale(ee,ye.dir,de)}}const re=o.a6.vec3.add(K,K,ee);x._translateCameraConstrained(re),D&&Math.abs(x.zoom-Q)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,p,!0)}_fireEvents(n,l,p){const _=xc(this._eventsInProgress),x=xc(n),T={};for(const B in n){const{originalEvent:U}=n[B];this._eventsInProgress[B]||(T[`${B}start`]=U),this._eventsInProgress[B]=n[B]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const B in T)this._fireEvent(B,T[B]);x&&this._fireEvent("move",x.originalEvent);for(const B in n){const{originalEvent:U}=n[B];this._fireEvent(B,U)}const C={};let D;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:V}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],D=l[U]||V,C[`${B}end`]=D)}for(const B in C)this._fireEvent(B,C[B]);const z=xc(this._eventsInProgress);if(p&&(_||x)&&!z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:D})):(this._map.fire(new o.x("moveend",{originalEvent:D})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.x(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Lf("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const va="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pm extends o.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aJ(["_renderFrameCallback"],this)}getCenter(){return new o.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,p){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,o.l({offset:n},l),p)}panTo(n,l,p){return this.easeTo(o.l({center:n},l),p)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,p){return this.easeTo(o.l({zoom:n},l),p)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,p){return this.easeTo(o.l({bearing:n},l),p)}resetNorth(n,l){return this.rotateTo(0,o.l({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.as.convert(n);const p=l&&l.bearing||0,_=l&&l.pitch||0,x=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,x,T,p,_,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?o.l({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:o.l({},l,n)}_extendCameraOptions(n){return(n=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):_/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,p,_,x,T){const C=n.clone(),D=this._extendCameraOptions(T);C.bearing=_,C.pitch=x;const z=o.bK.convert(l),B=o.bK.convert(p),U=.5*(z.lat+B.lat),V=.5*(z.lng+B.lng),q=o.dt(U,V),K=o.a6.vec3.normalize([],q),Q=o.a6.vec3.normalize([],o.a6.vec3.cross([],K,[0,1,0])),ee=o.a6.vec3.cross([],Q,K),re=[Q[0],Q[1],Q[2],0,ee[0],ee[1],ee[2],0,K[0],K[1],K[2],0,0,0,0,1],me=[q,o.dt(z.lat,z.lng),o.dt(B.lat,z.lng),o.dt(B.lat,B.lng),o.dt(z.lat,B.lng),o.dt(U,z.lng),o.dt(U,B.lng),o.dt(z.lat,V),o.dt(B.lat,V)];let ye=o.c9.fromPoints(me.map(ot=>[o.a6.vec3.dot(Q,ot),o.a6.vec3.dot(ee,ot),o.a6.vec3.dot(K,ot)]));const de=o.a6.vec3.transformMat4([],ye.center,re);o.a6.vec3.squaredLength(de)===0&&o.a6.vec3.set(de,0,0,1),o.a6.vec3.normalize(de,de),o.a6.vec3.scale(de,de,o.aq),C.center=o.du(de);const xe=C.getWorldToCameraMatrix(),ve=o.a6.mat4.invert(new Float64Array(16),xe);ye=o.c9.applyTransform(ye,o.a6.mat4.multiply([],xe,re));const Pe=this._extendAABB(ye,C,D,_);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Pe,o.a6.vec3.transformMat4(de,de,xe);const Se=.5*(ye.max[2]-ye.min[2]),Ce=this._minimumAABBFrustumDistance(C,ye),Be=o.a6.vec3.scale([],[0,0,1],Se),Le=o.a6.vec3.add(Be,de,Be),ke=Ce+(C.pitch===0?0:o.a6.vec3.distance(de,Le)),Ve=C.globeCenterInViewSpace,rt=o.a6.vec3.sub([],de,[Ve[0],Ve[1],Ve[2]]);o.a6.vec3.normalize(rt,rt),o.a6.vec3.scale(rt,rt,ke);const ft=o.a6.vec3.add([],de,rt);o.a6.vec3.transformMat4(ft,ft,ve);const et=o.dw/o.aq,vt=o.a6.vec3.length(ft),Ge=o.bD(Math.max(vt*et-o.dw,Number.EPSILON),0),lt=Math.min(C.zoomFromMercatorZAdjusted(Ge),D.maxZoom);return lt>.5*(o.c2+o.bU)?(C.setProjection({name:"mercator"}),C.zoom=lt,this._cameraForBounds(C,l,p,_,x,T)):{center:C.center,zoom:lt,bearing:_,pitch:x}}_extendAABB(n,l,p,_){const x=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),C=T,D=x,z=x,B=T,U=l.width-(D+z),V=l.height-(C+B),q=o.a6.vec3.sub([],n.max,n.min),K=Math.min(U/q[0],V/q[1]),Q=Math.min(l.scaleZoom(l.scale*K),p.maxZoom);if(isNaN(Q))return null;const ee=l.scale/l.zoomScale(Q),re=new o.c9([n.min[0]-D*ee,n.min[1]-B*ee,n.min[2]],[n.max[0]+z*ee,n.max[1]+C*ee,n.max[2]]),me=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.bB(_));return re.center[0]-=me.x*ee,re.center[1]+=me.y*ee,re}queryTerrainElevation(n,l){const p=this.transform.elevation;return p?(l=o.l({},{exaggerated:!0},l),p.getAtPoint(o.a5.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,p,_,x,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,p,_,x,T);const C=n.clone(),D=this._extendCameraOptions(T);C.bearing=_,C.pitch=x;const z=o.bK.convert(l),B=o.bK.convert(p),U=new o.bK(z.lng,B.lat),V=new o.bK(B.lng,z.lat),q=C.project(z),K=C.project(B),Q=this.queryTerrainElevation(z),ee=this.queryTerrainElevation(B),re=this.queryTerrainElevation(U),me=this.queryTerrainElevation(V),ye=[[q.x,q.y,Math.min(Q||0,ee||0,re||0,me||0)],[K.x,K.y,Math.max(Q||0,ee||0,re||0,me||0)]];let de=o.c9.fromPoints(ye);const xe=C.getWorldToCameraMatrix(),ve=o.a6.mat4.invert(new Float64Array(16),xe);de=o.c9.applyTransform(de,xe);const Pe=this._extendAABB(de,C,D,_);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=Pe;const Se=.5*o.a6.vec3.sub([],de.max,de.min)[2],Ce=this._minimumAABBFrustumDistance(C,de),Be=[0,0,1,0];o.a6.vec4.transformMat4(Be,Be,xe),o.a6.vec4.normalize(Be,Be);const Le=o.a6.vec3.scale([],Be,Ce+Se),ke=o.a6.vec3.add([],de.center,Le);o.a6.vec3.transformMat4(de.center,de.center,ve),o.a6.vec3.transformMat4(ke,ke,ve);const Ve=C.unproject(new o.P(de.center[0],de.center[1])),rt=o.dv(C.projection,Ve),ft=Math.pow(2,rt),et=Math.min(C._zoomFromMercatorZ(ke[2]*C.pixelsPerMeter*ft/C.worldSize),D.maxZoom);return C.mercatorFromTransition&&et<.5*(o.c2+o.bU)?(C.setProjection({name:"globe"}),C.zoom=et,this._cameraForBounds(C,l,p,_,x,T)):{center:Ve,zoom:et,bearing:_,pitch:x}}fitBounds(n,l,p){const _=this.cameraForBounds(n,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(n,l,p,_,x){const T=o.P.convert(n),C=o.P.convert(l),D=new o.P(Math.min(T.x,C.x),Math.min(T.y,C.y)),z=new o.P(Math.max(T.x,C.x),Math.max(T.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,C))return this;const B=this.transform.pointLocation3D(D),U=this.transform.pointLocation3D(z),V=this.transform.pointLocation3D(new o.P(D.x,z.y)),q=this.transform.pointLocation3D(new o.P(z.x,D.y)),K=[Math.min(B.lng,U.lng,V.lng,q.lng),Math.min(B.lat,U.lat,V.lat,q.lat)],Q=[Math.max(B.lng,U.lng,V.lng,q.lng),Math.max(B.lat,U.lat,V.lat,q.lat)],ee=_&&_.pitch?_.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,K,Q,p,ee,_);return this._fitInternal(re,_,x)}_fitInternal(n,l,p){return n?(l=o.l(n,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(n,l){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,T=!1;"zoom"in n&&p.zoom!==+n.zoom&&(_=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=o.bK.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(x=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(T=!0,p.pitch=+n.pitch);const C=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(C))if(n.retainPadding===!1){const D=p.clone();D.padding=C,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=C;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.x("movestart",l)).fire(new o.x("move",l)),_&&this.fire(new o.x("zoomstart",l)).fire(new o.x("zoom",l)).fire(new o.x("zoomend",l)),x&&this.fire(new o.x("rotatestart",l)).fire(new o.x("rotate",l)).fire(new o.x("rotateend",l)),T&&this.fire(new o.x("pitchstart",l)).fire(new o.x("pitch",l)).fire(new o.x("pitchend",l)),this.fire(new o.x("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(va),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(va),this;this.stop();const _=p.zoom,x=p.pitch,T=p.bearing;p.setFreeCameraOptions(n);const C=_!==p.zoom,D=x!==p.pitch,z=T!==p.bearing;return this.fire(new o.x("movestart",l)).fire(new o.x("move",l)),C&&this.fire(new o.x("zoomstart",l)).fire(new o.x("zoom",l)).fire(new o.x("zoomend",l)),z&&this.fire(new o.x("rotatestart",l)).fire(new o.x("rotate",l)).fire(new o.x("rotateend",l)),D&&this.fire(new o.x("pitchstart",l)).fire(new o.x("pitch",l)).fire(new o.x("pitchend",l)),this.fire(new o.x("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=o.l({offset:[0,0],duration:500,easing:o.dr},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),D="zoom"in n?+n.zoom:_,z="bearing"in n?this._normalizeBearing(n.bearing,x):x,B="pitch"in n?+n.pitch:T,U=this._extendPadding(n.padding),V=o.P.convert(n.offset);let q,K,Q;if(p.projection.name==="globe"){const Be=o.a5.fromLngLat(p.center),Le=V.rotate(-p.angle);Be.x+=Le.x/p.worldSize,Be.y+=Le.y/p.worldSize;const ke=Be.toLngLat(),Ve=o.bK.convert(n.center||ke);this._normalizeCenter(Ve),q=p.centerPoint.add(Le),K=new o.P(Be.x,Be.y).mult(p.worldSize),Q=new o.P(o.am(Ve.lng),o.at(Ve.lat)).mult(p.worldSize).sub(K)}else{q=p.centerPoint.add(V);const Be=p.pointLocation(q),Le=o.bK.convert(n.center||Be);this._normalizeCenter(Le),K=p.project(Be),Q=p.project(Le).sub(K)}const ee=p.zoomScale(D-_);let re,me;n.around&&(re=o.bK.convert(n.around),me=p.locationPoint(re));const ye=this._zooming||D!==_,de=this._rotating||x!==z,xe=this._pitching||B!==T,ve=!p.isPaddingEqual(U),Pe=n.retainPadding===!1?p.clone():p,Se=Be=>Le=>{if(ye&&(Be.zoom=o.aa(_,D,Le)),de&&(Be.bearing=o.aa(x,z,Le)),xe&&(Be.pitch=o.aa(T,B,Le)),ve&&(Pe.interpolatePadding(C,U,Le),q=Pe.centerPoint.add(V)),re)Be.setLocationAtPoint(re,me);else{const ke=Be.zoomScale(Be.zoom-_),Ve=D>_?Math.min(2,ee):Math.max(.5,ee),rt=Math.pow(Ve,1-Le),ft=Be.unproject(K.add(Q.mult(Le*rt)).mult(ke));Be.setLocationAtPoint(Be.renderWorldCopies?ft.wrap():ft,q)}return n.preloadOnly||this._fireMoveEvents(l),Be};if(n.preloadOnly){const Be=this._emulate(Se,n.duration,p);return this._preloadTiles(Be),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=de,this._pitching=xe,this._padding=ve,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,Ce),this._ease(Se(p),Be=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,Be)},n),this}_prepareEase(n,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new o.x("movestart",n)),this._zooming&&!p.zooming&&this.fire(new o.x("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new o.x("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new o.x("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.x("move",n)),this._zooming&&this.fire(new o.x("zoom",n)),this._rotating&&this.fire(new o.x("rotate",n)),this._pitching&&this.fire(new o.x("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.x("zoomend",n)),_&&this.fire(new o.x("rotateend",n)),x&&this.fire(new o.x("pitchend",n)),this.fire(new o.x("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const ot=o.ar(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ot,l)}this.stop(),n=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.dr},n);const p=this.transform,_=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),D="zoom"in n?o.ap(+n.zoom,p.minZoom,p.maxZoom):_,z="bearing"in n?this._normalizeBearing(n.bearing,x):x,B="pitch"in n?+n.pitch:T,U=this._extendPadding(n.padding),V=p.zoomScale(D-_),q=o.P.convert(n.offset);let K=p.centerPoint.add(q);const Q=p.pointLocation(K),ee=o.bK.convert(n.center||Q);this._normalizeCenter(ee);const re=p.project(Q),me=p.project(ee).sub(re);let ye=n.curve;const de=Math.max(p.width,p.height),xe=de/V,ve=me.mag();if("minZoom"in n){const ot=o.ap(Math.min(n.minZoom,_,D),p.minZoom,p.maxZoom),bt=de/p.zoomScale(ot-_);ye=Math.sqrt(bt/ve*2)}const Pe=ye*ye;function Se(ot){const bt=(xe*xe-de*de+(ot?-1:1)*Pe*Pe*ve*ve)/(2*(ot?xe:de)*Pe*ve);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Ce(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function Be(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const Le=Se(0);let ke=function(ot){return Be(Le)/Be(Le+ye*ot)},Ve=function(ot){return de*((Be(Le)*(Ce(bt=Le+ye*ot)/Be(bt))-Ce(Le))/Pe)/ve;var bt},rt=(Se(1)-Le)/ye;if(Math.abs(ve)<1e-6||!isFinite(rt)){if(Math.abs(de-xe)<1e-6)return this.easeTo(n,l);const ot=xe<de?-1:1;rt=Math.abs(Math.log(xe/de))/ye,Ve=function(){return 0},ke=function(bt){return Math.exp(ot*ye*bt)}}n.duration="duration"in n?+n.duration:1e3*rt/("screenSpeed"in n?+n.screenSpeed/ye:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const ft=x!==z,et=B!==T,vt=!p.isPaddingEqual(U),Ge=n.retainPadding===!1?p.clone():p,lt=ot=>bt=>{const St=bt*rt,ut=1/ke(St);ot.zoom=bt===1?D:_+ot.scaleZoom(ut),ft&&(ot.bearing=o.aa(x,z,bt)),et&&(ot.pitch=o.aa(T,B,bt)),vt&&(Ge.interpolatePadding(C,U,bt),K=Ge.centerPoint.add(q));const pt=bt===1?ee:ot.unproject(re.add(me.mult(Ve(St))).mult(ut));return ot.setLocationAtPoint(ot.renderWorldCopies?pt.wrap():pt,K),ot._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),ot};if(n.preloadOnly){const ot=this._emulate(lt,n.duration,p);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=ft,this._pitching=et,this._padding=vt,this._prepareEase(l,!1),this._ease(lt(p),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,l,p){p.animate===!1||p.duration===0?(n(1),l()):(this._easeStart=o.q.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.bA(n,-180,180);const p=Math.abs(n-l);return Math.abs(n-360-l)<p&&(n-=360),Math.abs(n+360-l)<p&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const p=n.lng-l.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,p){const _=Math.ceil(15*l/1e3),x=[],T=n(p.clone());for(let C=0;C<=_;C++){const D=T(C/_);x.push(D.clone())}return x}_preloadTiles(n,l){}}class Rf{constructor(n={}){this.options=n,o.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const _=ie("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",p),this._innerContainer=ie("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const p=l.reduce((_,x,T)=>(x.value&&(_+=`${x.key}=${x.value}${T<l.length-1?"&":""}`),_),"?");n.href=`${o.e.FEEDBACK_URL}/${p}#${Xa(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._mergedSourceCaches;for(const _ in l){const x=l[_];if(x.used){const T=x.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((_,x)=>_.length-x.length),n=n.filter((_,x)=>{for(let T=x+1;T<n.length;T++)if(n[T].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Im{constructor(){o.aJ(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ie("div","mapboxgl-ctrl");const l=ie("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const p=n[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class sv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Wu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.cw((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,p){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+p}}const Nb={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jb{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Cm{constructor(n){this.map=n,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(n,l){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const{type:p,filter:_}=l;if(_){const T=o.M(_,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(T.result==="error")throw new Error(T.value.map(C=>`${C.key}: ${C.message}`).join(", "));this.filters.set(n,T.value)}const x=this.interactionsByType.get(p)||new Map;x.size===0&&(this.map.on(p,this.handleType),this.interactionsByType.set(p,x)),x.set(n,l),this.typeById.set(n,p)}remove(n){const l=this.typeById.get(n);if(!l)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(l);p&&(p.delete(n),p.size===0&&this.map.off(l,this.handleType))}handleType(n){const l=n.features||this.map.queryRenderedFeatures(n.point);if(!l)return;const p=this.interactionsByType.get(n.type),_={zoom:0};for(const[x,T]of p){const C=this.filters.get(x),{handler:D,layers:z}=T;for(const B of l)if((!z||z.includes(B.layer.id))&&(!C||C.evaluate(_,B))&&D({id:x,feature:B,interaction:T})!==!1)break}}}const Om={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Hu={showCompass:!0,showZoom:!0,visualizePitch:!1};class bc{constructor(n,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Cf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Of({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),se()}move(n,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(n,l),x=_&&_.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,l),C=T&&T.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){be(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ht(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ht(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=st(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=st(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function xa(d,n,l){if(d=new o.bK(d.lng,d.lat),n){const p=new o.bK(d.lng-360,d.lat),_=new o.bK(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),T=l.locationPoint(d).distSqr(n),C=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(p).distSqr(n)<T&&(C||Math.abs(p.lng-l.center.lng)<x)?d=p:l.locationPoint(_).distSqr(n)<T&&(C||Math.abs(_.lng-l.center.lng)<x)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const xo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ba extends o.E{constructor(n,l){if(super(),(n instanceof HTMLElement||l)&&(n=o.l({element:n},l)),o.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie("div");const x=41,T=27,C=ae("svg",{display:"block",height:x*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${x}`},this._element),D=ae("radialGradient",{id:"shadowGradient"},ae("defs",{},C));ae("stop",{offset:"10%","stop-opacity":.4},D),ae("stop",{offset:"100%","stop-opacity":.05},D),ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=o.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const p=this._element.classList;for(const x in xo)p.remove(`mapboxgl-marker-anchor-${x}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=n&&n.className?n.className.trim().split(/\s+/):[];p.add(..._),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.bK.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,p=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const p=n.unproject(l),_=n.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(l);let _;n._showingGlobe()&&o.dz(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${xo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!n||p!=="map")return"";if(!l._showingGlobe()){const D=l.getPitch();return D?`rotateX(${D}deg)`:""}const _=o.c0(o.dA(l.transform,this._lngLat)),x=n.sub(o.dB(l.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const C=_/T;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const x=l.project(new o.bK(this._lngLat.lng,this._lngLat.lat+.001)),T=l.project(new o.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);p=o.c0(Math.atan2(T.y,T.x))-90}else p=-l.getBearing();else if(_==="horizon"){const x=o.a7(4,6,l.getZoom()),T=o.dB(l.transform);T.y+=x*l.transform.height;const C=n.sub(T),D=o.c0(Math.atan2(C.y,C.x));p=(D>90?D-270:D+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=xa(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const x=this._clickTolerance||l._clickTolerance;if(n.point.dist(p)<x)return;this._isDragging=!0}this._pos=n.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.x("dragstart"))),this.fire(new o.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.x("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,p=this._pos;l&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Cs={maxWidth:100,unit:"metric"},$b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ub={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vb=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lv(d=new o.P(0,0),n="bottom"){if(typeof d=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new o.P(0,d);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-d);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(d,0);case"right":return new o.P(-d,0)}return new o.P(0,0)}return d instanceof o.P||Array.isArray(d)?o.P.convert(d):o.P.convert(d[n]||[0,0])}return{version:L,supported:te.supported,setRTLTextPlugin:o.dC,getRTLTextPluginStatus:o.dD,Map:class extends Pm{constructor(d){F.mark($.create);const n=d;if((d=o.l({},Om,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.dx(window)&&(d.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hh(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new sv,this._domRenderTaskQueue=new sv,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aP(),this._locale=o.l({},Nb,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new kt(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){const l=document.getElementById(d.container);if(!l)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=l}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),o.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new jb),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ri(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||o.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new Ps(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const l=d.bounds;l&&(this.resize(),this.fitBounds(l,o.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Rf({customAttribution:d.customAttribution})),this._logoControl=new Im,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.x(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.x(`${l.dataType}dataloading`,l))}),this._interactions=new Cm(this)}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.x("movestart",d)).fire(new o.x("move",d)),this.fire(new o.x("resize",d)),n&&this.fire(new o.x("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.as.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(n=>n==="auto"?navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let l;n==="globe"&&d.zoom>=o.bU?(d.setMercatorFromTransition(),l=!0):n==="mercator"&&d.zoom<o.bU&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;return n=d.name==="globe"&&this.transform.zoom>=o.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(o.bK.convert(d))}unproject(d){return this.transform.pointLocation3D(o.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,l){if(d==="mouseenter"||d==="mouseover"){let p=!1;const _=T=>{const C=n.filter(z=>this.getLayer(z)),D=C.length?this.queryRenderedFeatures(T.point,{layers:C}):[];D.length?p||(p=!0,l.call(this,new Vi(d,this,T.originalEvent,{features:D}))):p=!1},x=()=>{p=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:_,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let p=!1;const _=T=>{const C=n.filter(D=>this.getLayer(D));(C.length?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?p=!0:p&&(p=!1,l.call(this,new Vi(d,this,T.originalEvent)))},x=T=>{p&&(p=!1,l.call(this,new Vi(d,this,T.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=n.filter(C=>this.getLayer(C)),T=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];T.length&&(_.features=T,l.call(this,_),delete _.features)};return{layers:new Set(n),listener:l,delegates:{[d]:p}}}}on(d,n,l){if(typeof n=="function"||l===void 0)return super.on(d,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const p=this._createDelegatedListener(d,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,n,l){if(typeof n=="function"||l===void 0)return super.once(d,n);if(Array.isArray(n)||(n=[n]),n){for(const _ of n)if(!this._isValidId(_))return this}const p=this._createDelegatedListener(d,n,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,n,l){if(typeof n=="function"||l===void 0)return super.off(d,n);const p=new Set(Array.isArray(n)?n:[n]);for(const T of p)if(!this._isValidId(T))return this;const _=(T,C)=>{if(T.size!==C.size)return!1;for(const D of T)if(!C.has(D))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[d]:void 0;return x&&(T=>{for(let C=0;C<T.length;C++){const D=T[C];if(D.listener===l&&_(D.layers,p)){for(const z in D.delegates)this.off(z,D.delegates[z]);return T.splice(C,1),this}}})(x),this}queryRenderedFeatures(d,n){if(!this.style)return[];if(n!==void 0||d===void 0||d instanceof o.P||Array.isArray(d)||(n=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(const l of n.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(d,n,this.transform)}querySourceFeatures(d,n){return this._isValidId(d)?this.style.querySourceFeatures(d,n):[]}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(d))}addInteraction(d,n){return this._interactions.add(d,n),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,n){return n=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&d&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(d,(l,p)=>{l?(o.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(d,n)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const l=o.l({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new _o(this,l).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new o.t(new Error("IDs can't be empty."))),!1):!o.cn(d)||(this.fire(new o.t(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,n){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,l)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,n,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:C,height:D,data:z}=o.q.getImageData(n);this.style.addImage(d,{data:new o.r({width:C,height:D},z),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new o.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:D}=n,z=n;this.style.addImage(d,{data:new o.r({width:C,height:D},new Uint8Array(z.data)),pixelRatio:l,stretchX:_,stretchY:x,content:T,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,d)}}updateImage(d,n){this._lazyInitEmptyStyle();const l=this.style.getImage(d);if(!l)return void this.fire(new o.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.q.getImageData(n):n,{width:_,height:x,data:T}=p;if(_===void 0||x===void 0)return void this.fire(new o.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==l.data.width||x!==l.data.height)return void this.fire(new o.t(new Error(`The width and height of the updated image (${_}, ${x})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const C=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);l.data.replace(T,C),this.style.updateImage(d,l)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new o.t(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){o.o(this._requestManager.transformRequest(d,o.R.Image),(l,p)=>{n(l,p instanceof HTMLImageElement?o.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(d,n){this._lazyInitEmptyStyle(),this.style.addModel(d,n)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new o.t(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,n){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)):this}getSlot(d){const n=this.getLayer(d);return n&&n.slot||null}setSlot(d,n){return this.style.setSlot(d,n),this.style.mergeLayers(),this._update(!0)}addImport(d,n){return this.style.addImport(d,n),this}updateImport(d,n){return typeof n!="string"&&n.id!==d?(this.removeImport(d),this.addImport(n)):(this.style.updateImport(d,n),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,n){return this.style.moveImport(d,n),this._update(!0)}moveLayer(d,n){return this._isValidId(d)?(this.style.moveLayer(d,n),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const n=this.style.getOwnLayer(d);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,n,l){return this._isValidId(d)?(this.style.setLayerZoomRange(d,n,l),this._update(!0)):this}setFilter(d,n,l={}){return this._isValidId(d)?(this.style.setFilter(d,n,l),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,n,l,p={}){return this._isValidId(d)?(this.style.setPaintProperty(d,n,l,p),this._update(!0)):this}getPaintProperty(d,n){return this._isValidId(d)?this.style.getPaintProperty(d,n):null}setLayoutProperty(d,n,l,p={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,n,l,p),this._update(!0)):this}getLayoutProperty(d,n){return this._isValidId(d)?this.style.getLayoutProperty(d,n):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,n){return this.style.setSchema(d,n),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,n){return this.style.setConfig(d,n),this._update(!0)}getConfigProperty(d,n){return this.style.getConfigProperty(d,n)}setConfigProperty(d,n,l){return this.style.setConfigProperty(d,n,l),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const n=d[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bK.convert(d),this.transform):0}setFeatureState(d,n){return this._isValidId(d.source)?(this.style.setFeatureState(d,n),this._update()):this}removeFeatureState(d,n){return this._isValidId(d.source)?(this.style.removeFeatureState(d,n),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,p,_,x=this._container;for(;x&&(!p||!_);){const T=window.getComputedStyle(x).transform;T&&T!=="none"&&(l=T.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),x=x.parentElement}this._containerWidth=p?Math.abs(d/p):d,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=ie("div","mapboxgl-canvas-container",d);this._canvas=ie("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=ie("div","mapboxgl-control-container",d),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{p[_]=ie("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const l=o.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=o.l({},te.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",d);n?(yn(n,!0),this.painter=new ym(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(n)):this.fire(new o.t(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.x("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.x("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;this.fire(new o.x("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,p=o.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=_.createQuery(),_.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,B=this.transform.pitch,U=o.q.now(),V=new o.a3(z,{now:U,fadeDuration:x,pitch:B,transition:this.style.transition});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark($.load),this.fire(new o.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const z=o.q.now()-p;_.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const B=_.getQueryParameter(n,_.QUERY_RESULT)/1e6;_.deleteQuery(n),this.fire(new o.x("gpu-timing-frame",{cpuTime:z,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(z);this.fire(new o.x("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(z);this.fire(new o.x("gpu-timing-deferred-render",{gpuTime:B}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new o.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new o.x("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,F.mark($.fullLoad),this._performanceMetricsCollection&&rr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const T=Math.abs(_-x);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){Me(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Tt||d.status===401)){const n=this.painter.context.gl;yn(n,!1),this._logoControl instanceof Im&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Sn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&sn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(d,n,l){let p=l[1]-l[0];const _=d.length/4;for(let x=0;x<n.length;x++){const T=n[x];let C=0;for(let D=0;D<T.length;D+=4)T[D]===d[D]&&T[D+1]===d[D+1]&&T[D+2]===d[D+2]&&T[D+3]===d[D+3]&&(C+=1);p+=(l[x+2]-l[x+1])*(1-C/_)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Bt.delete(this.painter.context.gl),Pr.remove(),Vt.remove(),this._removed=!0,this.fire(new o.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.q.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(d){const n=this.style?this.style.getSourceCaches():[];return o.bf(n,(l,p)=>l._preloadTiles(d,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,n){o.dy(d,n)}get version(){return L}},NavigationControl:class{constructor(d={}){this.options=o.l({},Hu,d),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),l=n===d.getMaxZoom(),p=n===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bc(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const l=ie("button",d,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(d,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(d={}){super();const n=navigator.geolocation;this.options=o.l({geolocation:n},hl,d),o.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Za(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),l=d.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.x("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("geolocate",d)),this._finish()}}_updateCamera(d){const n=new o.bK(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=o.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new o.bK(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=o.bD(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ie("button","mapboxgl-ctrl-geolocate",this._container),ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie("div","mapboxgl-user-location"),this._dotElement.appendChild(ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ba({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ba({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.x("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rf,ScaleControl:class{constructor(d={}){this.options=o.l({},Cs,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,p=n._containerWidth/2-d/2,_=n.unproject([p,l]),x=n.unproject([p+d,l]),T=_.distanceTo(x);if(this.options.unit==="imperial"){const C=3.2808*T;C>5280?this._setScale(d,C/5280,"mile"):this._setScale(d,C,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,n,l){this._map._requestDomTask(()=>{const p=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(D){const z=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*z)/z}(C),T*C}(n),_=p/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${$b[l]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),o.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(d){super(),this.options=o.l(Object.create(Ub),d),o.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.x("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.bK.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const n=document.createDocumentFragment(),l=document.createElement("body");let p;for(l.innerHTML=d;p=l.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ie("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const l=this._closeButton=ie("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,p=this._pos;if(!n||!l||!p)return"bottom";const _=l.offsetWidth,x=l.offsetHeight,T=p.x<_/2,C=p.x>n.transform.width-_/2;if(p.y+d<x)return T?"top-left":C?"top-right":"top";if(p.y>n.transform.height-x){if(T)return"bottom-left";if(C)return"bottom-right"}return T?"left":C?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=ie("div","mapboxgl-popup",n.getContainer()),this._tip=ie("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xa(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d instanceof o.P?d:n.project(this._lngLat),x=lv(this.options.offset),T=this._anchor=this._getAnchor(x.y),C=lv(this.options.offset,T),D=_.add(C).round();n._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${xo[T]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=o.dz(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Vb);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:ba,Style:_o,LngLat:o.bK,LngLatBounds:o.as,Point:o.P,MercatorCoordinate:o.a5,FreeCameraOptions:bs,Evented:o.E,config:o.e,prewarm:o.dE,clearPrewarmedResources:o.dF,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(d){o.e.ACCESS_TOKEN=d},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(d){o.e.API_URL=d},get workerCount(){return o.dG.workerCount},set workerCount(d){o.dG.workerCount=d},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.dH(d)},get workerUrl(){return o.dI.workerUrl},set workerUrl(d){o.dI.workerUrl=d},get workerClass(){return o.dI.workerClass},set workerClass(d){o.dI.workerClass=d},get workerParams(){return o.dI.workerParams},set workerParams(d){o.dI.workerParams=d},get dracoUrl(){return o.dJ()},set dracoUrl(d){o.dK(d)},get meshoptUrl(){return o.dL()},set meshoptUrl(d){o.dM(d)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var O=y;return O})})(kj);var Hfe=kj.exports;const nS=Fn(Hfe),_P=({incidents:e=[],center:t=[103.8,1.12],zoom:i=8})=>{const a=Wt.useRef(null),f=Wt.useRef(null),[y,w]=Wt.useState(!1);return Wt.useLayoutEffect(()=>{if(f.current)return;const O="pk.eyJ1IjoibWFyYS1hZG1pbiIsImEiOiJjbGQ5djVhc3QwOW03M25ucHZzeG92Z2kwIn0.TWD6NPNUnQ4CemIKMCKEpg";try{nS.accessToken=O;const o=new nS.Map({container:a.current,style:"mapbox://styles/mara-admin/clsbsqqvb011f01qqfwo95y4q",center:t,zoom:i,preserveDrawingBuffer:!0,trackResize:!0,attributionControl:!1,navigationControl:!1});o.on("load",()=>{console.log("Map loaded successfully");const L=200,$=F=>({width:L,height:L,data:new Uint8Array(L*L*4),onAdd:function(){const H=document.createElement("canvas");H.width=this.width,H.height=this.height,this.context=H.getContext("2d")},render:function(){const Y=performance.now()%1e3/1e3,oe=L/2*.3,te=L/2*.7*Y+oe,ie=this.context;return ie.clearRect(0,0,this.width,this.height),ie.beginPath(),ie.arc(this.width/2,this.height/2,te,0,Math.PI*2),ie.fillStyle=`rgba(${F}, ${1-Y})`,ie.fill(),ie.beginPath(),ie.arc(this.width/2,this.height/2,oe,0,Math.PI*2),ie.fillStyle=`rgba(${F}, 1)`,ie.strokeStyle="white",ie.lineWidth=2+4*(1-Y),ie.fill(),ie.stroke(),this.data=ie.getImageData(0,0,this.width,this.height).data,o.triggerRepaint(),!0}});o.addImage("pulsing-dot-robbery",$("239,68,68"),{pixelRatio:2}),o.addImage("pulsing-dot-attack",$("249,115,22"),{pixelRatio:2}),o.addImage("pulsing-dot-military",$("59,130,246"),{pixelRatio:2}),o.addSource("incidents",{type:"geojson",data:{type:"FeatureCollection",features:e.map(F=>({type:"Feature",geometry:{type:"Point",coordinates:[F.longitude,F.latitude]},properties:{title:F.title,description:F.description,type:F.type}}))}}),["robbery","attack","military"].forEach(F=>{o.addLayer({id:`incidents-${F}`,type:"symbol",source:"incidents",filter:["==","type",F],layout:{"icon-image":`pulsing-dot-${F}`,"icon-allow-overlap":!0}})}),o.on("click",["incidents-robbery","incidents-attack","incidents-military"],F=>{const H=F.features[0].geometry.coordinates.slice(),{title:Y,description:oe}=F.features[0].properties;new nS.Popup().setLngLat(H).setHTML(`
              <h3 class="font-bold">${Y}</h3>
              <p>${oe}</p>
            `).addTo(o)}),o.on("mouseenter",["incidents-robbery","incidents-attack","incidents-military"],()=>{o.getCanvas().style.cursor="pointer"}),o.on("mouseleave",["incidents-robbery","incidents-attack","incidents-military"],()=>{o.getCanvas().style.cursor=""})}),f.current=o,o.on("error",L=>{console.error("Map error:",L),w(!0)})}catch(o){console.error("Error initializing map:",o),w(!0)}return()=>{f.current&&(f.current.remove(),f.current=null)}},[]),Wt.useEffect(()=>{const O=f.current;!O||!O.loaded()||!O.getSource("incidents")||O.getSource("incidents").setData({type:"FeatureCollection",features:e.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:[o.longitude,o.latitude]},properties:{title:o.title,description:o.description,type:o.type}}))})},[e]),y?ze.jsx("div",{className:"w-full h-[300px] rounded-lg bg-gray-100 flex items-center justify-center",children:ze.jsx("p",{className:"text-gray-500",children:"Unable to load map. Please check console for errors."})}):ze.jsx("div",{className:"relative w-full",children:ze.jsx("div",{ref:a,className:"w-full h-[300px] rounded-lg",style:{border:"1px solid #e5e7eb"}})})},Zfe=[{latitude:1.12,longitude:103.8,title:"Singapore Strait Robbery",description:"Armed robbery aboard bulk carrier",type:"robbery"},{latitude:14.5,longitude:42.5,title:"Red Sea Attack",description:"Missile attack on commercial vessel",type:"attack"},{latitude:46.48,longitude:30.75,title:"Black Sea Incident",description:"Military activity affecting port operations",type:"military"},{latitude:18.37,longitude:-93.82,title:"Gulf of Mexico Incident",description:"Armed robbery near FPSO",type:"robbery"}],Bz=({data:e})=>ze.jsx($M,{width:"100%",height:20,children:ze.jsx(Oj,{data:e,children:ze.jsx(wp,{type:"monotone",dataKey:"value",stroke:"#6b7280",strokeWidth:1,dot:!1})})});function Xfe(){return ze.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow-lg rounded-lg my-8",children:[ze.jsx("div",{className:"p-6 border-b border-gray-200",children:ze.jsxs("div",{className:"flex justify-between items-baseline",children:[ze.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Maritime Security Executive Brief"}),ze.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Week 42 (Oct 14-21, 2024)"})]})}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Active Incidents"}),ze.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",children:ze.jsx(_P,{incidents:Zfe,center:[40,20],zoom:1})}),ze.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex justify-end gap-3",children:[ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 mr-1"})," Robbery"]}),ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500 mr-1"})," Attack"]}),ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 mr-1"})," Military"]})]})]}),ze.jsxs("div",{className:"px-6 pt-4 flex flex-wrap gap-2 text-sm",children:[ze.jsx("span",{className:"font-semibold text-gray-700",children:"Threat Levels:"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800",children:"⚠⚠ Critical"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-rose-100 text-rose-800",children:"⚠ Severe"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:"▲ Substantial"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:"► Moderate"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"● Low"})]}),ze.jsx("div",{className:"p-6 border-b border-gray-200",children:ze.jsx("div",{className:"overflow-x-auto",children:ze.jsxs("table",{className:"w-full border-collapse bg-white",children:[ze.jsx("thead",{children:ze.jsxs("tr",{className:"bg-gray-50",children:[ze.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border",children:"Region"}),ze.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border",children:"Threat Level"}),ze.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 border",children:"Incidents"}),ze.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700 border",children:"5-Week Trend"})]})}),ze.jsxs("tbody",{className:"divide-y divide-gray-200",children:[ze.jsxs("tr",{className:"hover:bg-gray-50",children:[ze.jsx("td",{className:"px-4 py-3 border",children:"Indian Ocean"}),ze.jsx("td",{className:"px-4 py-3 border",children:ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800",children:"⚠⚠ Critical"})}),ze.jsx("td",{className:"px-4 py-3 text-center border",children:"5"}),ze.jsx("td",{className:"px-4 py-3 border",children:ze.jsx("div",{className:"h-5",children:ze.jsx(Bz,{data:[{week:1,value:2},{week:2,value:3},{week:3,value:4},{week:4,value:3},{week:5,value:5}]})})})]}),ze.jsxs("tr",{className:"hover:bg-gray-50",children:[ze.jsx("td",{className:"px-4 py-3 border",children:"Europe"}),ze.jsx("td",{className:"px-4 py-3 border",children:ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-rose-100 text-rose-800",children:"⚠ Severe"})}),ze.jsx("td",{className:"px-4 py-3 text-center border",children:"4"}),ze.jsx("td",{className:"px-4 py-3 border",children:ze.jsx("div",{className:"h-5",children:ze.jsx(Bz,{data:[{week:1,value:4},{week:2,value:5},{week:3,value:4},{week:4,value:5},{week:5,value:4}]})})})]})]})]})})}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Key Developments"}),ze.jsxs("ul",{className:"space-y-4",children:[ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-red-600",children:"●"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Red Sea: Multiple missile attacks reported on commercial vessels in Bab el-Mandeb strait. Two vessels sustained damage, leading to major carriers rerouting around Cape of Good Hope."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-orange-600",children:"●"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Singapore Strait: Coordinated robberies targeting three bulk carriers within 2 hours on Oct 17. Two incidents involved armed perpetrators, indicating organized criminal activity."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-orange-600",children:"●"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Gulf of Mexico: Armed robbery reported near FPSO MIAMTE. Crew held at gunpoint and forced to transfer funds. First incident of 2024 involving forced banking transfers in the region."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-blue-600",children:"●"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Black Sea: Russian missile strike on Port of Odesa damaged two cargo vessels and port infrastructure. One port worker killed, insurance rates rising following repeated attacks."})]})]})]}),ze.jsxs("div",{className:"p-6",children:[ze.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"7-Day Forecast"}),ze.jsxs("ul",{className:"space-y-4",children:[ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-red-600",children:"↗"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Red Sea: High likelihood of continued attacks on commercial shipping. Vessels advised to maintain maximum distance from Yemen coastline or consider Cape routing."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-orange-600",children:"↗"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Singapore Strait: Elevated risk of night-time robbery attempts. Enhanced vigilance recommended during hours of darkness."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-blue-600",children:"→"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Black Sea: Sustained threat to shipping in Ukrainian ports from missile strikes. Further insurance rate increases expected."})]}),ze.jsxs("li",{className:"flex items-start",children:[ze.jsx("span",{className:"flex-shrink-0 h-5 w-5 text-yellow-600",children:"↘"}),ze.jsx("span",{className:"ml-2 text-gray-700",children:"Gulf of Guinea: Reduced activity expected due to weather conditions. Standard precautions should be maintained."})]})]})]})]})}const Yfe=[{month:"May",incidents:8,robberies:6,attacks:2,boardings:4},{month:"Jun",incidents:6,robberies:4,attacks:2,boardings:3},{month:"Jul",incidents:5,robberies:3,attacks:2,boardings:2},{month:"Aug",incidents:7,robberies:5,attacks:2,boardings:4},{month:"Sep",incidents:6,robberies:4,attacks:2,boardings:3},{month:"Oct",incidents:9,robberies:7,attacks:2,boardings:5}],Kfe=()=>{const e=[{latitude:1.12,longitude:103.8,title:"MARAN SPIRIT",description:"Perpetrator sighted in engine room. Alarm raised, crew mustered.",type:"robbery"},{latitude:1.13,longitude:103.5,title:"ASPASIA LUCK",description:"10 intruders armed with knives sighted in engine room. Engine spares stolen.",type:"robbery"},{latitude:1.13,longitude:103.49,title:"NYON",description:"Five intruders armed with knives sighted in engine room.",type:"robbery"}];return ze.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow-lg rounded-lg my-8",children:[ze.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-orange-50 to-orange-100",children:ze.jsxs("div",{className:"flex justify-between items-start",children:[ze.jsxs("div",{children:[ze.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Southeast Asia"}),ze.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Regional Maritime Security Brief - Week 42"})]}),ze.jsxs("div",{className:"text-right",children:[ze.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:"▲ SUBSTANTIAL"}),ze.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Updated: Oct 21, 2024"})]})]})}),ze.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-6 border-b border-gray-200",children:[ze.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"Weekly Incidents"}),ze.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"3"}),ze.jsx("p",{className:"text-xs text-orange-600",children:"↑ 50% from last week"})]}),ze.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"YTD Incidents"}),ze.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"32"}),ze.jsx("p",{className:"text-xs text-green-600",children:"↓ 15% from 2023"})]}),ze.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"Armed Incidents"}),ze.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"2"}),ze.jsx("p",{className:"text-xs text-gray-600",children:"67% of weekly total"})]}),ze.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"High-Risk Areas"}),ze.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"2"}),ze.jsx("p",{className:"text-xs text-gray-600",children:"Singapore Strait, Phillip Channel"})]})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Incidents"}),ze.jsx(_P,{incidents:e,center:[103.8,1.12],zoom:9}),ze.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex justify-end gap-3",children:[ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 mr-1"})," Robbery"]}),ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-500 mr-1"})," Attack"]}),ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 mr-1"})," Military"]})]})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"6-Month Trend"}),ze.jsx("div",{className:"h-64",children:ze.jsx($M,{width:"100%",height:"100%",children:ze.jsxs(Wfe,{data:Yfe,children:[ze.jsx(Tp,{dataKey:"month"}),ze.jsx(Sp,{}),ze.jsx(cs,{}),ze.jsx(qs,{type:"monotone",dataKey:"incidents",stroke:"#f97316",fill:"#fed7aa"}),ze.jsx(qs,{type:"monotone",dataKey:"robberies",stroke:"#ef4444",fill:"#fecaca"}),ze.jsx(qs,{type:"monotone",dataKey:"boardings",stroke:"#3b82f6",fill:"#bfdbfe"})]})})})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Incident Details"}),ze.jsxs("div",{className:"space-y-4",children:[ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsxs("div",{className:"flex justify-between items-start mb-2",children:[ze.jsx("h3",{className:"font-semibold text-gray-900",children:"MARAN SPIRIT"}),ze.jsx("span",{className:"text-sm text-gray-500",children:"Oct 17, 2024"})]}),ze.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"Perpetrator sighted in engine room. Alarm raised, crew mustered. No items stolen. Incident reported to Singapore VTIS West."}),ze.jsxs("div",{className:"flex gap-2",children:[ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Bulk Carrier"}),ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Attempted Theft"})]})]}),ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsxs("div",{className:"flex justify-between items-start mb-2",children:[ze.jsx("h3",{className:"font-semibold text-gray-900",children:"ASPASIA LUCK"}),ze.jsx("span",{className:"text-sm text-gray-500",children:"Oct 17, 2024"})]}),ze.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"10 intruders armed with knives sighted in engine room. Engine spares stolen. PCG conducted search upon arrival at Singapore Anchorage."}),ze.jsxs("div",{className:"flex gap-2",children:[ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Bulk Carrier"}),ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"Armed Robbery"})]})]}),ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsxs("div",{className:"flex justify-between items-start mb-2",children:[ze.jsx("h3",{className:"font-semibold text-gray-900",children:"NYON"}),ze.jsx("span",{className:"text-sm text-gray-500",children:"Oct 17, 2024"})]}),ze.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"Five intruders armed with knives sighted in engine room. Nothing stolen. PCG conducted search at Singapore Anchorage."}),ze.jsxs("div",{className:"flex gap-2",children:[ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Bulk Carrier"}),ze.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"Armed Robbery"})]})]})]})]}),ze.jsxs("div",{className:"p-6",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Analysis & Recommendations"}),ze.jsxs("div",{className:"space-y-4",children:[ze.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Key Findings"}),ze.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-2",children:[ze.jsx("li",{children:"Pattern of coordinated attacks suggests organized criminal activity"}),ze.jsx("li",{children:"Increased use of weapons in recent incidents"}),ze.jsx("li",{children:"Focus on engine room targeting indicates sophisticated approach"}),ze.jsx("li",{children:"All incidents occurred during hours of darkness"})]})]}),ze.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Recommendations"}),ze.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-2",children:[ze.jsx("li",{children:"Enhance engine room security during night hours"}),ze.jsx("li",{children:"Maintain vigilant watch when transiting Singapore Strait"}),ze.jsx("li",{children:"Test alarm systems and emergency communications before entering high-risk areas"}),ze.jsx("li",{children:"Conduct additional security drills focusing on armed intruder scenarios"})]})]})]})]})]})};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jfe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Lj=(...e)=>e.filter((t,i,a)=>!!t&&a.indexOf(t)===i).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qfe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ede=Wt.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:f="",children:y,iconNode:w,...O},o)=>Wt.createElement("svg",{ref:o,...Qfe,width:t,height:t,stroke:e,strokeWidth:a?Number(i)*24/Number(t):i,className:Lj("lucide",f),...O},[...w.map(([L,$])=>Wt.createElement(L,$)),...Array.isArray(y)?y:[y]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const db=(e,t)=>{const i=Wt.forwardRef(({className:a,...f},y)=>Wt.createElement(ede,{ref:y,iconNode:t,className:Lj(`lucide-${Jfe(e)}`,a),...f}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tde=db("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rde=db("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nde=db("Ship",[["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"iegodh"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76",key:"fp8vka"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M12 10v4",key:"1kjpxc"}],["path",{d:"M12 2v3",key:"qbqxhf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ide=db("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ode=[{month:"May",incidents:2},{month:"Jun",incidents:3},{month:"Jul",incidents:2},{month:"Aug",incidents:4},{month:"Sep",incidents:3},{month:"Oct",incidents:5}],ade=()=>{const e={latitude:1.13,longitude:103.5,title:"ASPASIA LUCK",description:"10 intruders armed with knives sighted in engine room. Engine spares stolen.",type:"robbery"},i=[e,...[{latitude:1.12,longitude:103.8,title:"MARAN SPIRIT",description:"Previous incident (Oct 17)",type:"robbery"},{latitude:1.13,longitude:103.49,title:"NYON",description:"Related incident (Oct 17)",type:"robbery"}]];return ze.jsxs("div",{className:"max-w-4xl mx-auto bg-white shadow-lg rounded-lg my-8",children:[ze.jsxs("div",{className:"bg-orange-50 p-6 rounded-t-lg border-b border-orange-100",children:[ze.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-4",children:[ze.jsx(tde,{className:"w-4 h-4"}),ze.jsx("span",{className:"text-sm",children:"Back to Incidents"})]}),ze.jsxs("div",{className:"flex justify-between items-start",children:[ze.jsxs("div",{children:[ze.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-red-100 text-red-800",children:"Alert ID: 2024-2662"}),ze.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:"Armed Robbery"})]}),ze.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"MV ASPASIA LUCK"}),ze.jsx("p",{className:"text-gray-600",children:"Bulk Carrier | IMO: 9223485 | Flag: Liberia"})]}),ze.jsxs("div",{className:"text-right",children:[ze.jsx("p",{className:"text-sm text-gray-500",children:"Reported"}),ze.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Oct 17, 2024 18:08 UTC"})]})]})]}),ze.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-6 border-b border-gray-200",children:[ze.jsxs("div",{className:"flex items-start gap-3",children:[ze.jsx(rde,{className:"w-5 h-5 text-gray-400 mt-1"}),ze.jsxs("div",{children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"Location"}),ze.jsx("p",{className:"font-semibold text-gray-900",children:"Singapore Strait"}),ze.jsx("p",{className:"text-sm text-gray-600",children:`1° 7' 52.8" N, 103° 30' 19.8" E`})]})]}),ze.jsxs("div",{className:"flex items-start gap-3",children:[ze.jsx(nde,{className:"w-5 h-5 text-gray-400 mt-1"}),ze.jsxs("div",{children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"Vessel Status"}),ze.jsx("p",{className:"font-semibold text-gray-900",children:"Underway"}),ze.jsx("p",{className:"text-sm text-gray-600",children:"En route to PEBGB"})]})]}),ze.jsxs("div",{className:"flex items-start gap-3",children:[ze.jsx(ide,{className:"w-5 h-5 text-gray-400 mt-1"}),ze.jsxs("div",{children:[ze.jsx("p",{className:"text-sm text-gray-600",children:"Crew Status"}),ze.jsx("p",{className:"font-semibold text-gray-900",children:"All Safe"}),ze.jsx("p",{className:"text-sm text-gray-600",children:"No injuries reported"})]})]})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Location"}),ze.jsx(_P,{incidents:i,center:[e.longitude,e.latitude],zoom:10}),ze.jsx("div",{className:"mt-2 text-xs text-gray-500",children:ze.jsxs("span",{className:"flex items-center",children:[ze.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 mr-1"}),"Incident Location (and related incidents in past 24h)"]})})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Incident Details"}),ze.jsxs("div",{className:"space-y-6",children:[ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),ze.jsx("p",{className:"text-gray-700",children:"While underway in the Singapore Strait, the master reported to Singapore VTIS West that 10 intruders armed with knives were sighted in the engine room. The alarm was raised, and the crew mustered to conduct a search aboard the ship. No intruders were found, but some engine spare parts were reported stolen."})]}),ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Response Actions"}),ze.jsxs("ul",{className:"list-disc list-inside text-gray-700 space-y-1",children:[ze.jsx("li",{children:"Alarm raised and crew mustered"}),ze.jsx("li",{children:"Incident reported to Singapore VTIS West"}),ze.jsx("li",{children:"Safety navigational broadcast initiated"}),ze.jsx("li",{children:"Republic of Singapore Navy's MSTF notified"}),ze.jsx("li",{children:"Police Coast Guard (PCG) notified"}),ze.jsx("li",{children:"Information shared with Indonesian authorities"}),ze.jsx("li",{children:"PCG conducted search at Singapore Anchorage"})]})]}),ze.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Stolen Items"}),ze.jsx("ul",{className:"list-disc list-inside text-gray-700",children:ze.jsx("li",{children:"Engine spare parts (detailed inventory pending)"})})]})]})]}),ze.jsxs("div",{className:"p-6 border-b border-gray-200",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Analysis"}),ze.jsxs("div",{className:"space-y-4",children:[ze.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Key Findings"}),ze.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-2",children:[ze.jsx("li",{children:"Part of coordinated series of incidents on October 17"}),ze.jsx("li",{children:"Perpetrators were armed and well-organized"}),ze.jsx("li",{children:"Targeted approach to engine room suggests prior knowledge"}),ze.jsx("li",{children:"Quick response from authorities demonstrated"})]})]}),ze.jsxs("div",{children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Historical Context"}),ze.jsx("div",{className:"h-48",children:ze.jsx($M,{width:"100%",height:"100%",children:ze.jsxs(Oj,{data:ode,children:[ze.jsx(Tp,{dataKey:"month"}),ze.jsx(Sp,{}),ze.jsx(cs,{}),ze.jsx(wp,{type:"monotone",dataKey:"incidents",stroke:"#f97316",strokeWidth:2})]})})}),ze.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Incidents in Singapore Strait (Past 6 Months)"})]})]})]}),ze.jsxs("div",{className:"p-6",children:[ze.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recommendations"}),ze.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ze.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Immediate Actions"}),ze.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-2",children:[ze.jsx("li",{children:"Enhance engine room security measures"}),ze.jsx("li",{children:"Increase watch rotations during night hours"}),ze.jsx("li",{children:"Review and update vessel security plan"}),ze.jsx("li",{children:"Conduct additional security drills"})]})]}),ze.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[ze.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Long-term Measures"}),ze.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-2",children:[ze.jsx("li",{children:"Install additional CCTV coverage"}),ze.jsx("li",{children:"Upgrade access control systems"}),ze.jsx("li",{children:"Enhance crew security training"}),ze.jsx("li",{children:"Implement new patrol procedures"})]})]})]})]})]})};function sde(){return ze.jsxs("div",{className:"min-h-screen bg-gray-100 py-8",children:[ze.jsx(Xfe,{}),ze.jsx(Kfe,{}),ze.jsx(ade,{})]})}YB(document.getElementById("root")).render(ze.jsx(sde,{}));
